//>>built
require({cache:{"xblox/main":function(){define(["dojo/_base/kernel"],function(){return dojo.xblox})},"xblox/component":function(){define(["dcl/dcl","xdojo/has","xide/model/Component"],function(l,q,n){return l(n,{beanType:"BLOCK",_load:function(){},hasEditors:function(){return["xblox"]},getDependencies:function(){return"xide/xide xblox/types/Types xblox/manager/BlockManager xblox/manager/BlockManagerUI xblox/embedded_ui xblox/views/BlockGridPalette xide/widgets/ExpressionJavaScript xide/widgets/Expression xide/widgets/RichTextWidget xide/widgets/ExpressionEditor xide/widgets/WidgetReference".split(" ")},
getLabel:function(){return"xblox"},getBeanType:function(){return this.beanType}})})},"xblox/types/Types":function(){define(["xide/types/Types","xide/utils"],function(l,q){l.BLOCK_MODE={NORMAL:0,UPDATE_WIDGET_PROPERTY:1};l.BLOCK_OUTLET={NONE:0,PROGRESS:1,ERROR:2,PAUSED:4,FINISH:8,STOPPED:16};q.mixin(l.EVENTS,{ON_RUN_BLOCK:"onRunBlock",ON_RUN_BLOCK_FAILED:"onRunBlockFailed",ON_RUN_BLOCK_SUCCESS:"onRunBlockSuccess",ON_BLOCK_SELECTED:"onItemSelected",ON_BLOCK_UNSELECTED:"onBlockUnSelected",ON_BLOCK_EXPRESSION_FAILED:"onExpressionFailed",
ON_BUILD_BLOCK_INFO_LIST:"onBuildBlockInfoList",ON_BUILD_BLOCK_INFO_LIST_END:"onBuildBlockInfoListEnd",ON_BLOCK_PROPERTY_CHANGED:"onBlockPropertyChanged",ON_SCOPE_CREATED:"onScopeCreated",ON_VARIABLE_CHANGED:"onVariableChanged",ON_CREATE_VARIABLE_CI:"onCreateVariableCI"});l.BlockType={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",
ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",
MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",
WhileStatement:"WhileStatement",WithStatement:"WithStatement"};l.BLOCK_CAPABILITIES={TOPMOST:16384,TARGET:262144,VARIABLE_INPUTS:128,VARIABLE_OUTPUTS:256,VARIABLE_OUTPUT_PARAMETERS:512,VARIABLE_INPUT_PARAMETERS:1024,CHILDREN:32,SIGNALS:128};l.EXECUTION_STATE={NONE:0,RUNNING:1,ERROR:2,PAUSED:4,FINISH:8,STOPPED:16,ONCE:2147483648,RESET_NEXT_FRAME:8388608,LOCKED:536870912};l.RUN_FLAGS={CHILDREN:32,WAIT:32768};return l})},"xblox/embedded":function(){define("dojo/_base/declare xide/types xblox/types/Types xide/factory xide/utils xide/mixins/ReloadMixin xide/mixins/EventedMixin xblox/model/logic/CaseBlock xblox/model/Block xblox/model/functions/CallBlock xblox/model/code/CallMethod xblox/model/code/RunScript xblox/model/code/RunBlock xblox/model/loops/ForBlock xblox/model/loops/WhileBlock xblox/model/variables/VariableAssignmentBlock xblox/model/logic/IfBlock xblox/model/logic/ElseIfBlock xblox/model/logic/SwitchBlock xblox/model/variables/VariableSwitch xblox/model/events/OnEvent xblox/model/events/OnKey xblox/model/logging/Log xblox/model/html/SetStyle xblox/model/html/SetCSS xblox/model/html/SetStyle xblox/manager/BlockManager xblox/factory/Blocks xdojo/has!xblox-ui?xblox/model/Block_UI".split(" "),
function(){Array.prototype.remove||(Array.prototype.remove=function(){for(var l,q=arguments,n=q.length,e;n&&this.length;){l=q[--n];if(null==this.indexOf)break;for(;-1!=(e=this.indexOf(l));)this.splice(e,1)}return this});Array.prototype.swap||(Array.prototype.swap=function(l,q){var n=this[l];this[l]=this[q];this[q]=n;return this});"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(l){return this.substring(0,l.length)===l});"function"!=typeof String.prototype.endsWith&&
(String.prototype.endsWith=function(l){return this.substring(this.length-l.length,this.length)===l});Function.prototype.bind||(Function.prototype.bind=Function.prototype.bind||function(l){return dojo.hitch(l,this)})})},"xblox/model/logic/CaseBlock":function(){define(["dcl/dcl","xide/utils","xblox/model/Block","dojo/Deferred","xblox/model/logic/BreakBlock"],function(l,q,n,e,g){return l(n,{declaredClass:"xblox.model.logic.CaseBlock",comparator:null,expression:null,items:null,name:"Case",icon:"",hasInlineEdits:!0,
toText:function(){return'\x3cspan style\x3d"text-indent: 1em;"\x3e\x26nbsp;\x26nbsp;\x26nbsp;'+this.getBlockIcon("I")+this.name+" "+this.makeEditable("comparator","right","text","Enter a comparison","inline")+(null!=this.expression?" "+this.makeEditable("expression","right","text","Enter a value to compare"):"")+"\x3c/span\x3e"},canAdd:function(){return[]},_solve:function(b,a,f){a=a||{highlight:!1};for(var m=[],e=0;e<this.items.length;e++){var u=this.items[e];-1!==u.declaredClass.indexOf("BreakBlock")&&
f.stop();this.addToEnd(m,u.solve(b,a))}return m},solve:function(b,a,f){try{var m=b.getVariableById(a.variable);!m&&f.args&&f.args[0]&&(m={value:f.args[0]});var e="";if(m)e=this._getArg(m.value,!0);else return this.onFailed(this,f),!1;if(!0!==b.parseExpression(""+e+""+this.comparator+this._getArg(this.expression,!0)))return this.onFailed(this,f),!1;this.onSuccess(this,f);this._solve(b,f,a);return!0}catch(u){logError(u)}},getChildren:function(){return this.items},getFields:function(){function b(a,b){return{label:b||
a,value:a}}var a=this.inherited(arguments)||this.getDefaultFields();a.push(q.createCI("Expression",13,this.expression,{group:"General",title:"Expression",dst:"expression"}));a.push(q.createCI("Comparator",3,this.comparator,{group:"General",title:"Comparator",dst:"comparator",widget:{options:[b("\x3d\x3d"),b("\x3c\x3d"),b("\x3d\x3e"),b("!\x3d"),b("\x3c"),b("\x3e")],editable:!0}}));return a},runAction:function(b){if("New/Break"===b.command){b=new e;var a=this.add(g,{group:null});b.resolve({select:[a],
focus:!0,append:!1});a.refresh();return b}},getActions:function(){return[this.createAction({label:"Break",command:"New/Break",tab:"Home",icon:"fa-stop",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}})]}})})},"xblox/model/Block":function(){define("dcl/dcl dojo/Deferred dojo/_base/lang dojo/has xblox/model/ModelBase xide/factory xide/utils xide/types xide/utils/ObjectUtils xide/lodash xdojo/has!xblox-ui?xblox/model/Block_UI".split(" "),function(l,q,n,e,g,b,a,f,m,v,u){function p(a,d){for(var c=
0;c<d.length;c++)if(a.id===d[c].id)return c}g=[g];u&&g.push(u);a.mixin(f,{BLOCK_FLAGS:{NONE:0,ACTIVE:1,SCRIPT:2,RESERVED1:4,USEFUNCTION:8,RESERVED2:16,SINGLE:32,WAITSFORMESSAGE:64,VARIABLEINPUTS:128,VARIABLEOUTPUTS:256,VARIABLEPARAMETERINPUTS:512,VARIABLEPARAMETEROUTPUTS:1024,TOPMOST:16384,BUILDINGBLOCK:32768,MESSAGESENDER:65536,MESSAGERECEIVER:131072,TARGETABLE:262144,CUSTOMEDITDIALOG:524288,RESERVED0:1048576,EXECUTEDLASTFRAME:2097152,DEACTIVATENEXTFRAME:4194304,RESETNEXTFRAME:8388608,INTERNALLYCREATEDINPUTS:16777216,
INTERNALLYCREATEDOUTPUTS:33554432,INTERNALLYCREATEDINPUTPARAMS:67108864,INTERNALLYCREATEDOUTPUTPARAMS:134217728,INTERNALLYCREATEDLOCALPARAMS:1073741824,ACTIVATENEXTFRAME:268435456,LOCKED:536870912,LAUNCHEDONCE:2147483648},BLOCK_CALLBACKMASK:{PRESAVE:1,DELETE:2,ATTACH:4,DETACH:8,PAUSE:16,RESUME:32,CREATE:64,RESET:4096,POSTSAVE:256,LOAD:512,EDITED:1024,SETTINGSEDITED:2048,READSTATE:4096,NEWSCENE:8192,ACTIVATESCRIPT:16384,DEACTIVATESCRIPT:32768,RESETINBREAKPOINT:65536,RENAME:131072,BASE:14,SAVELOAD:769,
PPR:304,EDITIONS:3072,ALL:4294967295}});u=l(g,{declaredClass:"xblox.model.Block",scopeId:null,isCommand:!1,outlet:0,_destroyed:!1,enabled:!0,serializeMe:!0,name:null,shareTitle:"",sharable:!1,items:null,parent:null,_return:null,_lastResult:null,_deferredObject:null,_currentIndex:0,_lastRunSettings:null,_onLoaded:!1,beanType:"BLOCK",override:{},ignoreSerialize:"_didSubscribe _currentIndex _deferredObject _destroyed _return parent __started ignoreSerialize _lastRunSettings _onLoaded beanType sharable override virtual _scenario _didRegisterSubscribers additionalProperties renderBlockIcon serializeMe _statusIcon _statusClass hasInlineEdits _loop help owner _lastCommand allowActionOverride canDelete isCommand lastCommand autoCreateElse _postCreated _counter".split(" "),
_parseString:function(t,d,c,k){try{d=d||this._lastSettings||{};k=k||d.flags||f.CIFLAG.EXPRESSION;var h=this.scope,r=!(k&f.CIFLAG.DONT_PARSE),w=k&f.CIFLAG.EXPRESSION;k&f.CIFLAG.TO_HEX&&(t=a.to_hex(t));!1!==r&&(t=a.convertAllEscapes(t,"none"));var b=d.override||this.override||{},p=b&&b.variables?b.variables:null,m="",m=w&&!1!==r?h.parseExpression(t,null,p,null,null,null,b.args,k):""+t}catch(F){console.error(F)}return m},postCreate:function(){},childrenByClass:function(a){for(var d=this.getChildren(),
c=[],k=0;k<d.length;k++){var h=d[k];h.isInstanceOf(a)&&c.push(h)}return c},childrenByNotClass:function(a){for(var d=this.getChildren(),c=[],k=0;k<d.length;k++){var h=d[k];h.isInstanceOf(a)||c.push(h)}return c},getInstance:function(){var a=this.scope.instance;return a?a:null},pause:function(){},mergeNewModule:function(a){for(var d in a){var c=a[d];c&&v.isFunction(c)&&(this[d]=c)}},__onReloaded:function(t){this.mergeNewModule(t.prototype);t=this.declaredClass;(t=n.getObject(a.replaceAll("/",".",t))||
n.getObject(t))&&t.prototype&&t.prototype.solve&&this.mergeNewModule(t.prototype)},reparent:function(){if(!this)return!1;if(!this.getParent()){var a=this.next(null,1)||this.next(null,-1);a&&(this.group=null,a._add(this))}},unparent:function(a,d){if(!this)return!1;var c=this.getParent();c&&c.removeBlock&&c.removeBlock(this,!1);this.group=a;this.parent=this.parentId=null;!1!==d&&(this._place(null,-1,null),this._place(null,-1,null))},move:function(a){if(!this)return!1;var d=this.getParent(),c=null;if(d){c=
d[d._getContainer(this)];if(!c||2>c.length||!this.containsItem(c,this))return!1;d=this.indexOf(c,this);if(0>d+a)return!1;var k=c[d+a];if(!k)return!1;c[d+a]=this;c[d]=k}else this._place(null,a);return!0},_place:function(a,d,c){var k=this._store,h=this;(a=a||h.next(null,d))?(a=v.isString(a)?k.getSync(a):a,h=v.isString(h)?k.getSync(h):h,c=c||k.storage.fullData,d=-1==d?0:1,c.remove(h),-1==d&&(d=0),c.splice(Math.max(p(a,c)+d,0),0,h),k._reindex()):console.error("have no next",this)},index:function(){var a=
this.getParent(),d=null,c=this.group,d=this._store;if(a)return d=a[a._getContainer(this)]||[],d=d.filter(function(k){return k.group===c}),!d||2>d.length||!this.containsItem(d,this)?!1:this.indexOf(d,this);d=d.storage.fullData;d=d.filter(function(k){return k.group===c});return this.indexOf(d,this)},numberOfParents:function(){var a=0,d=this.getParent();d&&(a++,a+=d.numberOfParents());return a},getTopRoot:function(){var a=this.getParent();if(a){var d=a.getParent();d&&(a=d)}return a},next:function(a,
d){function c(k,h,r,a,d){var w=k.indexOf(h,k),t=h[w+r*a];if(t){if(!t.parentId&&t.group&&t.group===k.group)return d=w+r*a,t;a++;return c(k,h,r,a,d)}return null}a=a||this._store.storage.fullData;return c(this,a,d,1,0)},getParent:function(a){if(this.parentId)return this.scope.getBlockById(this.parentId)},getScope:function(){var a=this.scope;if(this.scopeId&&0<this.scopeId.length){var d=a.owner;d&&d.hasScope&&(d.hasScope(this.scopeId)?a=d.getScope(this.scopeId):console.error("have scope id but cant resolve it",
this))}return a},canAdd:function(){return null},getTarget:function(){var a=this._targetReference;if(a)return a;var d=this.getParent();d&&d.getTarget&&(a=d.getTarget());return a},addToEnd:function(a,d){d&&null!=a.length&&null!=d.length&&a.push.apply(a,d);return a},removeBlock:function(a,d){a&&(!1!==d&&a.empty&&a.empty(),!1!==d&&delete a.items,a.parent=null,a.parentId=null,this.items&&this.items.remove(a))},_getContainer:function(a){return"items"},empty:function(a){try{this._empty(a)}catch(d){debugger}},
_empty:function(a){if(a=a||this.items)for(var d=0;d<a.length;d++){var c=a[d];c&&c.empty&&c.empty();c&&this.scope&&this.scope.blockStore&&this.scope.blockStore.remove(c.id)}},containsItem:function(a,d){for(var c=a.length;c--;)if(a[c].id===d.id)return!0;return!1},indexOf:function(a,d){for(var c=a.length;c--;)if(a[c].id===d.id)return c;return-1},_getBlock:function(a){if(!this||!this.parentId)return!1;var d=this.scope.getBlockById(this.parentId);if(!d)return null;d=d[d._getContainer(this)];if(!d||2>d.length||
!this.containsItem(d,this))return null;var c=this.indexOf(d,this);return 0>c+a?!1:(a=d[c+a])?a:null},getPreviousBlock:function(){return this._getBlock(-1)},getNextBlock:function(){return this._getBlock(1)},_getPreviousResult:function(){var a=this.getPreviousBlock()||this.getParent();return a&&null!=a._lastResult?this.isArray(a._lastResult)?a._lastResult:[a._lastResult]:null},getPreviousResult:function(){var a=null;if((a=(a=this.getPreviousBlock())&&a._lastResult&&a.enabled?a:this.getParent())&&!a._lastResult){var d=
a.getParent();d&&(a=d)}return a&&null!=a._lastResult?(this.isArray(a._lastResult),a._lastResult):null},_getArg:function(a,d){var c=parseFloat(a);return isNaN(c)?"true"===a||"false"===a?"true"===a:a&&d&&v.isString(a)?"'"+a+"'":a:c},getArgs:function(b){var d=[];b=b||{};var c=b.args||this._get("args");b.override&&b.override.args&&(c=b.override.args);c&&(d=a.getJson(c,null,!1));if(d&&0==d.length&&c&&c.length&&v.isString(c)){if(-1!==c.indexOf(",")){c=c.split(",");for(b=0;b<c.length;b++){var k=parseFloat(c[b]);
isNaN(k)?"true"===c[b]||"false"===c[b]?d.push(a.toBoolean(c[b])):d.push(c[b]):d.push(k)}return d}d=[this._getArg(c)]}!v.isArray(d)&&(d=[]);b=this.getPreviousResult();null!=b&&(v.isArray(b)&&1==b.length?d.push(b[0]):d.push(b));return d||[c]},remove:function(a){this._destroyed=!0;null!=this.parentId&&null==this.parent&&(this.parent=this.scope.getBlockById(this.parentId));if(this.parent&&this.parent.removeBlock)this.parent.removeBlock(this);else if(a=a||this)a.empty&&a.empty(),delete a.items,a.parent=
null,this.items&&this.items.remove(a)},prepareArgs:function(a){a||(a={});a.id||(a.id=this.createUUID());a.items||(a.items=[])},_add:function(a,d,c,k){var h=null;try{d?(this.prepareArgs(d),h=b.createBlock(a,d,null,k)):null==d&&(h=a);(h.scope=this.scope)&&(h=this.scope.registerBlock(h,k));if(e("debug")&&h.id===this.id){console.error("adding new block to our self");debugger}h.parent=this;h.parentId=this.id;h.scope=this.scope;var r=c||this._getContainer();if(r)if(this[r]||(this[r]=[]),-1!==this.indexOf(this[r],
h))console.error(" have already "+h.id+" in "+r);else{if(this.id==h.id){console.error("tried to add our self to "+r);return}this[r].push(h)}h.group=null;return h}catch(w){logError(w,"_add")}return null},getStore:function(){return this.getScope().getStore()},add:function(a,d,c){a=this._add(a,d,c);return a.getStore().getSync(a.id)},getContext:function(){return this.scope.instance&&this.scope.instance?this.scope.instance:null},resolved:function(){this._deferredObject&&(this._deferredObject.resolve(),
delete this._deferredObject)},_solve:function(a,d){d=d||{highlight:!1};for(var c=[],k=0;k<this.items.length;k++)this.addToEnd(c,this.items[k].solve(a,d));return c},solve:function(a,d){d=d||{highlight:!1};for(var c=[],k=0;k<this.items.length;k++)this.addToEnd(c,this.items[k].solve(a,d));return c},solveMany:function(a,d){!this._lastRunSettings&&d&&(this._lastRunSettings=d);d=this._lastRunSettings||d;this._currentIndex=0;this._return=[];var c=this[this._getContainer()];if(c.length)return c=this.runFrom(c,
0,d),this.onSuccess(this,d),c;this.onSuccess(this,d);return[]},runFrom:function(a,d,c){var k=this;a=a||this.items;this._return||(this._return=[]);var h=function(h){h._deferredObject.then(function(r){h._lastResult=h._lastResult||r;k._currentIndex++;k.runFrom(a,k._currentIndex,c)})};if(a.length)for(;d<a.length;d++){var r=a[d];if(!0===r.deferred){r._deferredObject=new q;this._currentIndex=d;h(r);this.addToEnd(this._return,r.solve(this.scope,c));break}else this.addToEnd(this._return,r.solve(this.scope,
c))}else this.onSuccess(this,c);return this._return},serializeField:function(a){return-1==this.ignoreSerialize.indexOf(a)},onLoad:function(){},activate:function(){},deactivate:function(){},_get:function(a){if(this.override)return a in this.override?this.override[a]:this[a]},onDidRun:function(){this.override&&(this.override.args&&delete this.override.args,delete this.override)},destroy:function(){this.stop(!0);this.reset();this._destroyed=!0},reset:function(){this._lastSettings={};clearTimeout(this._loop);
this._loop=null;delete this.override;this.override=null;delete this._lastResult;this.override={}},stop:function(){this.reset();this.getItems&&v.invoke(this.getItems(),"stop")}});u.FLAGS=f.BLOCK_FLAGS;u.EMITS=f.BLOCK_CALLBACKMASK;u.prototype.onSuccess||(u.prototype.onSuccess=function(){},u.prototype.onRun=function(){},u.prototype.onFailed=function(){});l.chainAfter(u,"stop");l.chainAfter(u,"destroy");l.chainAfter(u,"onDidRun");return u})},"xblox/model/ModelBase":function(){define(["dcl/dcl","xide/utils",
"xide/types","xide/mixins/EventedMixin","xide/lodash"],function(l,q,n,e,g){e=l(e.dcl,{declaredClass:"xblox.model.ModelBase",id:null,description:"",parent:null,parentId:null,group:null,order:0,_store:null,outputs:function(){return[]},takes:function(){return[]},needs:function(){return[]},constructor:function(b){for(var a in b)b.hasOwnProperty(a)&&(this[a]=b[a]);this.id||(this.id=this.createUUID());this.utils=q;this.types=n},keys:function(b){var a=[],f;for(f in b)a.push(f);return a},values:function(b){var a=
[],f;for(f in b)a.push(b[f]);return a},toArray:function(){return this.map()},size:function(){return this.toArray().length},createUUID:q.createUUID,canEdit:function(){return!0},getFields:function(){return null},isString:function(b){return"string"==typeof b},isNumber:function(b){return"number"==typeof b},isBoolean:function(b){return"boolean"==typeof b},isObject:g.isObject,isArray:g.isArray,getValue:function(b){var a=parseFloat(b);return isNaN(a)?"true"===b||!0===b?!0:"false"===b||!1===b?!1:b:a},isScript:function(b){return this.isString(b)&&
(-1!=b.indexOf("return")||-1!=b.indexOf(";")||-1!=b.indexOf("(")||-1!=b.indexOf("+")||-1!=b.indexOf("-")||-1!=b.indexOf("\x3c")||-1!=b.indexOf("*")||-1!=b.indexOf("/")||-1!=b.indexOf("%")||-1!=b.indexOf("\x3d")||-1!=b.indexOf("\x3d\x3d")||-1!=b.indexOf("\x3e")||-1!=b.indexOf("[")||-1!=b.indexOf("{")||-1!=b.indexOf("}"))},replaceAll:function(b,a,f){return this.isString(f)?f.split(b).join(a):f},isInValidState:function(){return!0},destroy:function(){}});l.chainAfter(e,"destroy");return e})},"xblox/model/logic/BreakBlock":function(){define(["dcl/dcl",
"xblox/model/Block"],function(l,q){return l(q,{declaredClass:"xblox.model.logic.BreakBlock",name:"Break",icon:"fa-stop",hasInlineEdits:!1,canAdd:!1,toText:function(){return'\x26nbsp;\x3cspan class\x3d"fa-stop text-warning"\x3e\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan\x3e'+this.name+"\x3c/span\x3e"},solve:function(l,e){this.onSuccess(this,e)}})})},"xblox/model/functions/CallBlock":function(){define("dcl/dcl xide/utils xide/types dojo/Deferred xblox/model/Block xcf/model/Command".split(" "),function(l,
q,n,e,g,b){return l(b,{declaredClass:"xblox.model.functions.CallBlock",command:"Select command please",icon:"",args:null,_timeout:100,isCommand:!0,_commandHandles:null,onCommandProgress:function(a){this.getScope().getContext();var b=a.params;b&&b.id&&(this._emit("cmd:"+a.cmd+"_"+b.id,{msg:a}),a.lastResponse&&this.storeResult(a.lastResponse),this._emit("progress",{msg:a,id:b.id}));this._lastResult=null;this._lastResult=a?a.result:null;a=this.getItems(n.BLOCK_OUTLET.PROGRESS);this._lastSettings||(this._lastSettings=
{});this._lastSettings.override={};a.length&&this.runFrom(a,0,this._lastSettings)},stop:function(){this._lastCommand&&this._lastCommand.stop()},pause:function(){this._lastCommand&&this._lastCommand.pause()},destroy:function(){_.invoke(this._commandHandles,"remove");delete this._commandHandles;delete this._lastCommand},solve:function(a,b){this._commandHandles&&_.invoke(this._commandHandles,"remove");this._commandHandles=[];var f=this._timeout||50;_.isString(f)&&(f=parseInt(f));var v=new e,u=this._commandHandles;
b=b||{};setTimeout(function(){if(this.command){var f=null;if(this.args){b.override=b.override||{};var m=a.expressionModel.replaceVariables(a,this.args,!1,!1,null,null,{begin:"%%",end:"%%"});try{f=q.fromJson(m)}catch(d){f=m}b.override.args=_.isArray(f)?f:[m];b.override.mixin=f}if(this._lastCommand=a.resolveBlock(this.command))u.push(this._lastCommand._on("paused",this.onCommandPaused,this)),u.push(this._lastCommand._on("finished",this.onCommandFinish,this)),u.push(this._lastCommand._on("stopped",this.onCommandStopped,
this)),u.push(this._lastCommand._on("error",this.onCommandError,this)),u.push(this._lastCommand._on("progress",this.onCommandProgress,this));if(f=a.solveBlock(this.command,b))this.onSuccess(this,b);else this.onFailed(this,b);v.resolve(f);return f}}.bind(this),f);return v},hasInlineEdits:!0,makeEditable:function(a,b,m,e,u,p,t){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+b+"' display-mode\x3d'"+(u||"popup")+"' display-type\x3d'"+(m||"text")+"' data-prop\x3d'"+a+"' data-title\x3d'"+e+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+
this[a]+"\x3c/a\x3e"},getFieldOptions:function(a){if("command"===a)return this.scope.getCommandsAsOptions("text")},toText:function(){var a="Unknown",b=this.scope.getBlock(this.command);b&&(a=b.name);-1!==this.command.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Call Command : "+a},getFields:function(){var a=this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);
a.push(q.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));a.push(q.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(q.createCI("timeout",13,this._timeout,{group:"General",title:"Delay",dst:"_timeout"}));return a}})})},"xblox/model/code/CallMethod":function(){define(["dcl/dcl","xblox/model/Block","xide/utils"],
function(l,q,n){return l(q,{declaredClass:"xblox.model.code.CallMethod",name:"Call Method",method:"",args:"",sharable:!0,solve:function(e,g){var b=this.getContext();if(b&&null!=b[this.method]){var a=[],f=b[this.method];try{var m=this.getArgs(g),a=f.apply(b,m||[]);this.onSuccess(this,g);return a}catch(v){console.error("call method "+this.method+" failed: "+v),logError(v),this.onFailed(this,g)}}else this.onFailed(this,g);return[]},toText:function(){var e=this.getBlockIcon()+" "+this.name+" ";this.method&&
(e+=this.makeEditable("method","bottom","text","Enter a driver method","inline"));return e},getFields:function(){var e=this.getDefaultFields();this.getContext();e.push(n.createCI("value",13,this.method,{group:"General",title:"Method",dst:"method"}));e.push(n.createCI("value",27,this.args,{group:"Arguments",dst:"args",widget:{title:""}}));return e},getBlockIcon:function(){return'\x3cspan class\x3d"fa-caret-square-o-right"\x3e\x3c/span\x3e'}})})},"xblox/model/code/RunScript":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains dojo/promise/all xide/types module".split(" "),
function(l,q,n,e,g,b,a,f,m,v,u,p,t){var d="undefined"!==typeof window?window.console:global.console;return l([e,b],{declaredClass:"xblox.model.code.RunScript",name:"Run Script",method:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-code",observed:["method"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve2:function(c,k,h,a){this._currentIndex=0;this._return=[];var r=""+this._get("method"),b=this,f=this.getContext();if(r&&r.length){var m=
function(){var c=new Function("{"+r+"}"),d=b.getArgs()||[];try{var w=c.apply(f,d||{});b._lastResult=w;h&&h("Expression "+r+" evaluates to "+w);if("false"!==w&&!1!==w)b.onSuccess(b,k,{result:w});else return b.onFailed(b,k),[]}catch(y){return a&&a("invalid expression : \n"+r+": "+y),b.onFailed(b,k),[]}};if(c.global)(function(){window=c.global;var d=b.getArgs()||[];try{var w=null,w=f.runExpression?f.runExpression(r,null,d):(new Function("{"+r+"}")).bind(this).apply(f,d||{});b._lastResult=w;h&&h("Expression "+
r+" evaluates to "+w);if("false"!==w&&!1!==w)b.onSuccess(b,k);else return b.onFailed(b,k),[]}catch(E){return b._lastResult=null,a&&a("invalid expression : \n"+r+": "+E),b.onFailed(b,k),[]}}).call(c.global);else return m()}else d.error("have no script");m=this[this._getContainer()];if(m.length)this.runFrom(m,0,k);else this.onSuccess(this,k);this.onDidRun();return[]},solve:function(c,k,h,a,b,f){this._currentIndex=0;this._return=[];k=k||{};h=a||(this._get("method")?this._get("method"):this.method);if(!c.expressionModel)throw Error("na");
var r=this;a=this.getContext();var w=this[this._getContainer()],x=new n,m=r.deferred,p=c.getExpressionModel();this.onRunThis(k);if(!p)return d.error("scope has no expression model"),!1;var e=p.replaceVariables(c,h,null,null);(c=p.expressionCache[e])||(c=p.expressionCache[e]=new Function("{"+e+"}"));p=r.getArgs(k)||[];try{m&&(a.resolve=function(c){r._deferredObject&&r._deferredObject.resolve();r.onDidRunThis(x,c,w,k)});var t=c.apply(a,p||{});r._lastResult=t;b&&b("Expression "+h+" evaluates to "+t);
if(!m)r.onDidRunThis(x,t,w,k);if("false"!==t&&!1!==t)r.onSuccess(r,k);else r.onFailed(r,k)}catch(z){z=z||{},r.onDidRunItemError(x,z,k),r.onFailed(r,k),f&&f("invalid expression : \n"+h+": "+z)}return x},toText:function(){var c='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.name+" :: \x3c/span\x3e";this.method&&(c+=this.method.substr(0,50));return c},canAdd:function(){return!0},getFields:function(){"No Description"===this.description&&(this.description=p);var c=this.inherited(arguments)||this.getDefaultFields(),
k=this;c.push(g.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));c.push(g.createCI("deferred",0,this.deferred,{group:"General",title:"Deferred",dst:"deferred"}));c.push(g.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));c.push(g.createCI("value",f.ECIType.EXPRESSION_EDITOR,this.method,{group:"Script",title:"Script",dst:"method",select:!0,widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!0,autoFocus:!1},
item:this},delegate:{runExpression:function(c,a,d){k.method=c;k.solve(k.scope,null,a,d)}}}));return c}})})},"xblox/model/Contains":function(){define(["dcl/dcl","dojo/promise/all","xide/types"],function(l,q,n){return l(null,{declaredClass:"xblox.model.Contains",runByType:function(e,g){var b=this.getItemsByType(e);b.length&&this.runFrom(b,0,g)},getItemsByType:function(e){var g=this.items;if(!e)return g;var b=[];_.each(g,function(a){a.outlet&e&&b.push(a)});return b},getContainer:function(){return this[this._getContainer()]},
mayHaveChildren:function(e){e=this[this._getContainer()];return null!=e&&0<e.length},getChildren:function(e){return this[this._getContainer()]},canAdd:function(){return[]},_solve:function(e,g,b,a){!this._lastRunSettings&&g&&(this._lastRunSettings=g);g=this._lastRunSettings||g;this._currentIndex=0;this._return=[];e=this[this._getContainer()];if(e.length)return e=this.runFrom(e,0,g),this.onSuccess(this,g),e;this.onSuccess(this,g);return[]},onDidRunItem:function(e,g){this._emit(n.EVENTS.ON_RUN_BLOCK_SUCCESS,
this);e.resolve(g)},onDidRunItemError:function(e,g){e.reject(g)},onRunThis:function(){this._emit(n.EVENTS.ON_RUN_BLOCK,this)},onDidRunThis:function(e,g,b,a){var f=this;if(b&&b.length)b=f.runFrom(b,0,a),q(b).then(function(){f.onDidRunItem(e,g,a)},function(b){f.onDidRunItem(e,b,a)});else f.onDidRunItem(e,g,a)},___solve:function(e,g,b,a){}})})},"xblox/model/code/RunBlock":function(){define(["dcl/dcl","xblox/model/Block","xide/types","xide/utils"],function(l,q,n,e){return l(q,{declaredClass:"xblox.model.code.RunBlock",
name:"Run Block",file:"",method:"",args:"",sharable:!0,block:"",description:"Runs another Block",solve:function(e,b){var a=this.getContext();if(a&&null!=a[this.method]){var f=[],m=a[this.method];try{var v=this._getArgs(),f=m.apply(a,v||[]);this.onSuccess(this,b);return f}catch(u){console.error("call method failed"),this.onFailed(this,b)}}else this.onFailed(this,b);return[]},toText:function(){var e=this.getBlockIcon()+" "+this.name+" ";this.method&&(e+=this.method.substr(0,20));return e},getFields:function(){var g=
this.getDefaultFields();g.push(e.createCI("Block",n.ECIType.BLOCK_REFERENCE,this.block,{toolTip:"Enter  block, you can use also the block's share title",group:"General",dst:"block",value:this.block,title:"Block",scope:this.scope}));g.push(e.createCI("File",n.ECIType.FILE,this.file,{toolTip:"Leave empty to auto-select this file",group:"General",dst:"file",value:this.file,intermediateChanges:!1,acceptFolders:!1,acceptFiles:!0,encodeFilePath:!1,buildFullPath:!0,filePickerOptions:{dialogTitle:"Select Block File",
filePickerMixin:{beanContextName:this.id,persistent:!1,globalPanelMixin:{allowLayoutCookies:!1}},configMixin:{beanContextName:this.id,LAYOUT_PRESET:n.LAYOUT_PRESET.SINGLE,PANEL_OPTIONS:{ALLOW_MAIN_MENU:!1,ALLOW_NEW_TABS:!0,ALLOW_MULTI_TAB:!1,ALLOW_INFO_VIEW:!0,ALLOW_LOG_VIEW:!1,ALLOW_CONTEXT_MENU:!0,ALLOW_LAYOUT_SELECTOR:!0,ALLOW_SOURCE_SELECTOR:!0,ALLOW_COLUMN_RESIZE:!0,ALLOW_COLUMN_REORDER:!0,ALLOW_COLUMN_HIDE:!0,ALLOW_ACTION_TOOLBAR:!0,ALLOW_BREADCRUMBS:!1}},defaultStoreOptions:{fields:1663,includeList:"xblox",
excludeList:"*"},startPath:this.file}}));return g},getBlockIcon:function(){return'\x3cspan class\x3d"el-icon-share-alt"\x3e\x3c/span\x3e'}})})},"xblox/model/loops/ForBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/variables/Variable xblox/model/Contains dojo/promise/all dojo/Deferred".split(" "),function(l,q,n,e,g,b){return l([q,e],{declaredClass:"xblox.model.loops.ForBlock",initial:null,"final":null,comparator:null,modifier:null,items:null,counterName:null,_counter:null,name:"For",
sharable:!0,icon:"",ignoreErrors:!1,deferred:!0,_forState:!1,_currentForIndex:0,runFrom:function(a,f,m){var e=this,u=a||this.items;a=[];var p=function(a){a._deferredObject.then(function(c){a._lastResult=a._lastResult||c;e._currentIndex++;e.runFrom(u,e._currentIndex,m)})};if(u.length)for(;f<u.length;f++){var t=u[f];if(!1!==t.enabled)if(!0===t.deferred){t._deferredObject=new b;this._currentIndex=f;p(t);a.push(t.solve(this.scope,m));break}else a.push(t.solve(this.scope,m))}else this.onSuccess(this,m);
return a},runFromDirect:function(a,f,m){var e=this,u=a||this.items;a=[];var p=function(a){a._deferredObject.then(function(c){a._lastResult=a._lastResult||c;e._currentIndex++;e.runFrom(u,e._currentIndex,m)})};if(u.length)for(;f<u.length;f++){var t=u[f];if(!1!==t.enabled)if(!0===t.deferred){t._deferredObject=new b;this._currentIndex=f;p(t);a.push(t.solve(this.scope,m));break}else a.push(t.solve(this.scope,m))}else this.onSuccess(this,m);return a},solveSubs:function(a,b,m,e){var f=this;e.override=e.override||
{};e.override.args=[this._currentForIndex];if(m.length)return b=f.runFrom(m,0,e),g(b).then(function(a){},function(b){f.onDidRunItem(a,b,e)}),b;f.onDidRunItem(a,b,e)},solveSubsDirect:function(a,b,m,e){e.override=e.override||{};e.override.args=[this._currentForIndex];if(m.length)return this.runFromDirect(m,0,e)},_solve:function(a,f){var m=new b,e=this,u=this.solveSubs(m,null,this.items,f);u?g(u).then(function(a){a=a.indexOf(!1);!0!==e.ignoreErrors&&-1!==a?m.resolve(!1):m.resolve(!0)}):m.resolve(!0);
return m},step:function(a,f){var e=this._checkCondition(a,f),g=new b;e&&this._solve(a,f).then(function(a){1==a?g.resolve(!0):g.resolve(!1)});return g},loop:function(a,b){var f=this;this.step(a,b).then(function(e){f._updateCounter(a);f._currentForIndex=f._counter.value;if(1==e)f.loop(a,b);else f.onFailed(f,b)})},_solveDirect:function(a,b){return this.solveSubsDirect(null,null,this.items,b)},stepDirect:function(a,b){return this._solveDirect(a,b)},loopDirect:function(a,b){this.stepDirect(a,b);for(var f=
parseInt(this.initial,10);f<parseInt(this["final"],10);f++)this.stepDirect(a,b)},solve:function(a,b){this._counter=new n({title:this.counterName,value:this.initial,scope:a,register:!1});this._forState=!0;this._currentForIndex=this.initial;this.deferred?this.loop(a,b):this.loopDirect(a,b);return[]},_checkCondition:function(a,b){var f=a.parseExpression(""+this._counter.value+this.comparator+this["final"]);if(0!=f)this.onSuccess(this,b);return this._forState=f},_updateCounter:function(a){var b=this._counter.value,
b=a.parseExpression(""+b+this.modifier);if(b==this._counter.value)return!1;this._counter.value=b;return!0},mayHaveChildren:function(){return null!=this.items&&0<this.items.length},getChildren:function(){var a=[];this.items&&(a=a.concat(this.items));return a},canAdd:function(){return[]},toText:function(){return this.getBlockIcon("F")+this.name+" "+this.initial+" "+this.comparator+" "+this["final"]+" with "+this.modifier},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();
return a=a.concat([this.utils.createCI("initial",13,this.initial,{group:"General",title:"Initial",dst:"initial"}),this.utils.createCI("Final",13,this["final"],{group:"General",title:"Final",dst:"final"}),this.utils.createCI("comparator",13,this.comparator,{group:"General",title:"Comparision",dst:"comparator"}),this.utils.createCI("modifier",13,this.modifier,{group:"General",title:"Modifier",dst:"modifier"}),this.utils.createCI("Abort on Error",0,this.ignoreErrors,{group:"General",title:"Ignore Errors",
dst:"ignoreErrors"}),this.utils.createCI("Deferred",0,this.deferred,{group:"General",title:"Use Deferred",dst:"deferred"})])}})})},"xblox/model/variables/Variable":function(){define(["dcl/dcl","xide/types","xblox/model/Block"],function(l,q,n){return l(n,{declaredClass:"xblox.model.variables.Variable",name:null,value:null,register:!0,readOnly:!1,initial:null,isVariable:!0,flags:4096,getValue:function(){return this.value},canDisable:function(){return!1},canMove:function(){return!1},getIconClass:function(){return"el-icon-quotes-alt"},
getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e '},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon()+this.makeEditable("name","right","text","Enter a unique name","inline")+"\x3c/span\x3e"},solve:function(){this.scope.parseExpression(this.getValue(),!0);return[]},getFields:function(){var e=this.getDefaultFields(),g=this;e.push(this.utils.createCI("title",q.ECIType.STRING,this.name,{group:"General",title:"Name",dst:"name"}));e.push(this.utils.createCI("value",
q.ECIType.EXPRESSION,this.value,{group:"General",title:"Value",dst:"value",delegate:{runExpression:function(b,a,f){return g.scope.expressionModel.parse(g.scope,b,!1,a,f)}}}));return e}})})},"xblox/model/loops/WhileBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/variables/Variable"],function(l,q,n){return l(q,{declaredClass:"xblox.model.loops.WhileBlock",condition:null,items:null,loopLimit:1500,name:"While",wait:0,_currentIndex:0,sharable:!0,icon:"",_timer:null,canAdd:function(){return[]},
_solve:function(e,g){for(var b=0;b<this.items.length;b++)this.items[b].solve(e,g);return[]},doStep:function(e){if(this._currentIndex<this.loopLimit){var g=[];this._checkCondition(this.scope)?(this.onSuccess(this,e),this.addToEnd(g,this._solve(this.scope,e)),this._currentIndex++):(this._timer&&clearInterval(this._timer),this.onFailed(this,e))}else console.error("--while block : reached loop limit"),this.reset()},reset:function(){this._timer&&(clearTimeout(this._timer),this._timer=null);this._currentIndex=
0},solve:function(e,g){this.loopLimit=1500;g=g||{};var b=0,a=this,f=this._getArg(this.wait);this.reset();if(0<f)return this._timer=setInterval(function(){a.doStep(g)},f),[];for(;this._checkCondition(e)&&b<this.loopLimit;)this._solve(e,g),b++;this.reset();return[]},toText:function(){return this.getBlockIcon("G")+this.name+" "+this.condition},_checkCondition:function(e){return e.parseExpression(this.condition)},mayHaveChildren:function(e){return null!=this.items&&0<this.items.length},getChildren:function(e){e=
[];this.items&&(e=e.concat(this.items));return e},getFields:function(){var e=this,g=this.inherited(arguments)||this.getDefaultFields();g.push(this.utils.createCI("condition",25,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(b,a,f){return e.scope.expressionModel.parse(e.scope,b,!1,a,f)}}}));g.push(this.utils.createCI("wait",13,this.wait,{group:"General",title:"Wait",dst:"wait"}));return g}})})},"xblox/model/variables/VariableAssignmentBlock":function(){define("dcl/dcl xblox/model/Block xide/utils xide/types dstore/legacy/DstoreAdapter xide/factory xdojo/has".split(" "),
function(l,q,n,e,g,b,a){return l(q,{declaredClass:"xblox.model.variables.VariableAssignmentBlock",variable:null,value:null,name:"Set Variable",icon:"",hasInlineEdits:!0,flags:4,toText:function(){var a=this.scope.getVariableById(this.variable),a=a?a.name:"";this.variable&&-1!==this.variable.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.variable)+"\x3c/span\x3e");return this.getBlockIcon("C")+this.name+" "+a+"\x3cspan class\x3d'text-muted small'\x3e to \x3ckbd class\x3d'text-warning'\x3e"+
this.makeEditable("value","bottom","text","Enter the string to send","inline")+"\x3c/kbd\x3e\x3c/span\x3e"},_getPreviousResult:function(){var a=null;return(a=(a=this.getPreviousBlock())&&a._lastResult&&a.enabled?a:this.getParent())&&null!=a._lastResult?(this.isArray(a._lastResult),a._lastResult):null},solve:function(a,m){var f=this.value,u=!1;if(!f){var p=this.getArgs();0<p.length&&(f=p[0])}if(this.variable&&null!==f){this.onRun(this,m);var t=-1!==this.variable.indexOf("://")?this.scope.resolveBlock(this.variable):
a.getVariableById(this.variable),p=this._getArg(f),d=this.getArgs(m)||[];if(!t)return[];var c=null;this.isScript(p)?(c=this.override||{},c=a.parseExpression(f,null,null,null,null,null,d||c.args),c=this.replaceAll("'","",c),t.value!==c&&(u=!0)):(d&&1==d.length&&null==f&&(p=d[0]),t.value!==p&&(u=!0),c=t.value=p);t.set("value",c);f=!1;this.getContext();this.flags&e.VARIABLE_FLAGS.PUBLISH&&u&&(f=!0);u&&b.publish(e.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:t,scope:this.scope,save:!1,block:this,name:t.name,
value:p,publish:f,result:c});this.onSuccess(this,m);return[]}},canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(!1),b=this;a.push(this.utils.createCI("value",29,this.value,{group:"General",title:"Value",dst:"value",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!1,autoSelect:!1,autoFocus:!1,hasConsole:!1,hasItemActions:function(){return!1}},item:this},delegate:{runExpression:function(a,f,e){return b.scope.expressionModel.parse(b.scope,
a,!1,f,e)}}}));a.push(n.createCI("value","xcf.widgets.CommandPicker",this.variable,{group:"Variable",title:"Variable",dst:"variable",block:this,pickerType:"variable",value:this.variable,widget:{store:this.scope.blockStore,labelField:"name",valueField:"id",value:this.variable,query:[{group:"basicVariables"},{group:"processVariables"}]}}));a.push(this.utils.createCI("flags",5,this.flags,{group:"Variable",title:"Flags",dst:"flags",data:[{value:2,label:"Publish to network",title:"Publish to network in order to make a network variable"},
{value:4,label:"Publish if server",title:"Publish only on network if this is running server side"}],widget:{hex:!0}}));return a}})})},"xblox/model/logic/IfBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/Statement xblox/model/logic/ElseIfBlock dojo/Deferred xide/utils".split(" "),function(l,q,n,e,g,b){return l(q,{declaredClass:"xblox.model.logic.IfBlock",condition:"Invalid Expression",consequent:null,elseIfBlocks:null,alternate:null,canAdd:function(){return[]},autoCreateElse:!0,name:"if",
icon:"",add:function(a,b,e){null==e&&(e="consequent");return this._add(a,b,e,!1)},__addToStore:function(a){a.put(this)},mayHaveChildren:function(){return null!==this.items&&this.items.length||null!==this.elseIfBlocks&&this.elseIfBlocks.length||null!=this.consequent&&this.consequent.length||null!=this.alternate&&this.alternate.length},getChildren:function(){var a=[];this.consequent&&(a=a.concat(this.consequent));this.elseIfBlocks&&(a=a.concat(this.elseIfBlocks));this.alternate&&(a=a.concat(this.alternate));
return a},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon("E")+this.name+" \x3c/span\x3e\x3cspan class\x3d'text-warning small'\x3e"+this.condition+"\x3cspan\x3e"},_checkCondition:function(a){return a.parseExpression(this.condition,null,null)},solve:function(a,b){var f=this._checkCondition(a),g=this.getElseIfBlocks(),u=this.childrenByNotClass(e),p=null,u=u.filter(function(a){return!a.isInstanceOf(n)});if(1==f||0<f){this.onSuccess(this,b);if(u&&u.length)for(g=0;g<u.length;g++)p=
u[g].solve(a,b);return p}p=!1;this.onFailed(this,b);if(g)for(u=0;u<g.length&&!p;u++){f=g[u];if(f._checkCondition(a))return f.onSuccess(f,b),p=!0,f.solve(a,b);f.onFailed(f,b)}u=this.childrenByClass(n);if(0<u.length&&!p){p=null;for(g=0;g<u.length;g++)p=u[g].solve(a,b);return p}return[]},empty:function(){this._empty(this.alternate);this._empty(this.consequent);this._empty(this.elseIfBlocks)},removeBlock:function(a){a&&(a&&a.empty&&a.empty(),delete a.items,a.parent=null,this.alternate.remove(a),this.consequent.remove(a),
this.elseIfBlocks.remove(a))},_getContainer:function(a){return-1!=this.consequent.indexOf(a)?"consequent":-1!=this.alternate.indexOf(a)?"alternate":-1!=this.elseIfBlocks.indexOf(a)?"elseIfBlocks":"_"},init:function(){this.alternate=this.alternate||[];this.consequent=this.consequent||[];this.elseIfBlocks=this.elseIfBlocks||[];for(var a=0;a<this.alternate.length;a++)this.alternate[a].parentId=this.id,this.alternate[a].parent=this;for(a=0;a<this.elseIfBlocks.length;a++)this.elseIfBlocks[a].parentId=
this.id,this.elseIfBlocks[a].parent=this;for(a=0;a<this.consequent.length;a++)this.consequent[a].parentId=this.id,this.consequent[a].parent=this},getFields:function(){var a=this,b=this.inherited(arguments)||this.getDefaultFields();b.push(this.utils.createCI("condition",this.types.ECIType.EXPRESSION_EDITOR,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(b,f,e){return a.scope.expressionModel.parse(a.scope,b,!1,f,e)}}}));return b},postCreate:function(){this._postCreated||
(this._postCreated=!0)},toCode:function(a,b){},getElseIfBlocks:function(){return this.childrenByClass(e)},runAction:function(a){var f=this.scope.blockStore;a=a.command;if("New/Else"===a||"New/Else If"===a){a="New/Else If"===a?e:n;var m=b.mixin({name:"else",items:[],dstField:"alternate",parentId:this.id,parent:this,scope:this.scope,canAdd:function(){return[]},canEdit:function(){return!1}},a==e?{name:"else if",dstField:"elseIfBlocks"}:{name:"else",dstField:"alternate"});a=this.add(a,m,a==n?"alternate":
"elseIfBlocks");var m={select:[a],focus:!0,append:!1,expand:!0,delay:10},v=new g;f._emit("added",{target:a});v.resolve(m);a.refresh();return v}},getActions:function(){var a=[];0==this.alternate.length&&a.push(this.createAction({label:"Else",command:"New/Else",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0}}));a.push(this.createAction({label:"Else If",command:"New/Else If",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0}}));
return a}})})},"xblox/model/Statement":function(){define(["dcl/dcl","xblox/model/Block"],function(l,q){return l(q,{declaredClass:"xblox.model.Statement",toText:function(){return this.name},getChildren:function(){return this.items}})})},"xblox/model/logic/ElseIfBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/Contains"],function(l,q,n){return l([q,n],{declaredClass:"xblox.model.logic.ElseIfBlock",condition:"",consequent:null,name:"else if",icon:"",solve:function(e,g){return this._checkCondition(e)?
this._solve(e,g):!1},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon("E")+this.name+" \x3c/span\x3e\x3cspan class\x3d'text-warning small'\x3e"+(this.condition||"")+"\x3cspan\x3e"},_checkCondition:function(e){return null!==this.condition?e.parseExpression(this.condition):!1},getFields:function(){var e=this,g=this.inherited(arguments)||this.getDefaultFields();g.push(this.utils.createCI("condition",this.types.ECIType.EXPRESSION_EDITOR,this.condition,{group:"General",
title:"Expression",dst:"condition",delegate:{runExpression:function(b,a,f){return e.scope.expressionModel.parse(e.scope,b,!1,a,f)}}}));return g}})})},"xblox/model/logic/SwitchBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/logic/CaseBlock xblox/model/logic/DefaultBlock dojo/Deferred xide/lodash".split(" "),function(l,q,n,e,g,b){return l(q,{declaredClass:"xblox.model.logic.SwitchBlock",items:null,name:"Switch",icon:null,toText:function(){return this.getBlockIcon("H")+this.name+" "},
canAdd:function(a){return a&&a.isInstanceOf?a.isInstanceOf(n)||a.isInstanceOf(e):[]},getFields:function(){return this.getDefaultFields(!1,!1)},solve:function(a,b){var f=this._stopped=!1,e=[];this.onSuccess(this,b);for(var g=0;g<this.items.length;g++){var p=this.items[g];if("xblox.model.logic.CaseBlock"===p.declaredClass&&(p=p.solve(a,this,b),0!=p)){f=!0;this.addToEnd(e,p);break}if(this._stopped)break}if(!f)for(g=0;g<this.items.length;g++)p=this.items[g],"xblox.model.logic.CaseBlock"!=p.declaredClass&&
this.addToEnd(e,p.solve(a,b));return e},getChildren:function(){return this.items},stop:function(){this._stopped=!0},runAction:function(a){var b=a.command;if("New/Case"===b||"New/Default"===a.command){a=this.scope.blockStore;var m=new g,v=null;switch(b){case "New/Case":v=this.add(n,{comparator:"\x3d\x3d",expression:"on",group:null});break;case "New/Default":v=this.add(e,{group:null})}m.resolve({select:[v],focus:!0,append:!1});v.refresh();a._emit("added",{target:v})}},getActions:function(a,f){var e=
[this.createAction({label:"New Case",command:"New/Case",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}})];b.find(this.items,{declaredClass:"xblox.model.logic.DefaultBlock"})||e.push(this.createAction({label:"Default",command:"New/Default",icon:"fa-eject",tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}}));return e}})})},"xblox/model/logic/DefaultBlock":function(){define(["dcl/dcl","xblox/model/Block"],function(l,q){return l(q,{declaredClass:"xblox.model.logic.DefaultBlock",
name:"Default",icon:"",hasInlineEdits:!1,toText:function(){return'\x26nbsp;\x3cspan class\x3d"fa-eject text-info"\x3e\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan\x3e'+this.name+"\x3c/span\x3e"},solve:function(l,e){this.onSuccess(this,e);return this._solve(l,e)}})})},"xblox/model/variables/VariableSwitch":function(){define("dcl/dcl xblox/model/logic/SwitchBlock xide/types xblox/model/logic/CaseBlock xblox/model/logic/DefaultBlock dojo/Deferred".split(" "),function(l,q,n,e,g,b){return l(q,{declaredClass:"xblox.model.variables.VariableSwitch",
name:"Switch on Variable",icon:"",variable:"PowerState",toText:function(){var a=this.scope.getVariableById(this.variable),a=a?a.name:"";return this.getBlockIcon("H")+this.name+" "+a},getFields:function(){var a=this.getDefaultFields(!1,!1);return a=a.concat([this.utils.createCI("Variable",3,this.variable,{group:"General",widget:{store:this.scope.blockStore,labelField:"name",valueField:"id",query:[{group:"basicVariables"},{group:"processVariables"}]},dst:"variable"})])}})})},"xblox/model/events/OnEvent":function(){define("dcl/dcl dojo/_base/lang dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xide/registry dojo/on xwire/_Base".split(" "),
function(l,q,n,e,g,b,a,f,m,v,u){return l([e,a.dcl,f.dcl,u],{declaredClass:"xblox.model.events.OnEvent",name:"On Event",event:"",reference:"",references:null,sharable:!0,_didSubscribe:!1,filterPath:"item.name",filterValue:"",valuePath:"item.value",_nativeEvents:"onclick ondblclick onmousedown onmouseup onmouseover onmousemove onmouseout onkeypress onkeydown onkeyup onfocus onblur onchange".split(" "),stop:function(){this._destroy()},solve:function(a,b,d,c){d&&this._destroy();b=this._lastSettings=b||
this._lastSettings;if(!this._didSubscribe)return this._registerEvent(this.event),this.onSuccess(this,b),!1;this.onSuccess(this,b);this._currentIndex=0;this._return=[];a=this[this._getContainer()];if(a.length)return a=this.runFrom(a,0,b),this.onSuccess(this,b),a;this.onSuccess(this,b);return[]},toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();
this.deserialize(this.reference);var f=null;if(-1<g.contains(this._nativeEvents,this.event))for(var f=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",
value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],d=0;d<f.length;d++){var c=f[d];if(c.value===this.event){c.selected=!0;break}}else f=this.scope.getEventsAsOptions(this.event);a.push(g.createCI("Event",b.ECIType.ENUMERATION,this.event,{group:"General",options:f,dst:"event",widget:{search:!0}}));a.push(g.createCI("Filter Path",13,this.filterPath,{group:"General",dst:"filterPath"}));a.push(g.createCI("Filter Value",13,this.filterValue,{group:"General",dst:"filterValue"}));
a.push(g.createCI("Value Path",13,this.valuePath,{group:"General",dst:"valuePath"}));a.push(g.createCI("Object/Widget",b.ECIType.WIDGET_REFERENCE,this.reference,{group:"Widget",dst:"reference",value:this.reference}));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bell"\x3e\x3c/span\x3e'},onEvent:function(a){this._lastResult=a;if(this.filterPath&&this.filterValue){var b=this.getValue(a,this.filterPath);if(b&&this.filterValue!==b)return}b=null;this.valuePath&&(this._lastSettings||(this._lastSettings=
{}),b=this.getValue(a,this.valuePath),null!==b&&(!this._lastSettings.override&&(this._lastSettings.override={}),this._lastSettings.override.args=[b]));this.solve(this.scope,this._lastSettings)},_subscribe:function(a,b,d){if(a)if(-1==g.contains(this._nativeEvents,a))this.__events&&this.__events[a]&&(d=this.__events[a],_.each(d,function(c){this.unsubscribe(c.type,c.handler);c.remove()},this),_.each(d,function(c){this.__events[a].remove(c)},this)),this.subscribe(a,this.onEvent);else if(d){b=a.replace("on",
"");var c=this;d=v(d,b,function(a){c.onEvent(a)});this._events.push(d)}},_registerEvent:function(a){try{if(!a||!a.length)return;var b=this.resolveReference(this.deserialize(this.reference)),d=this;if(b&&b.length)for(var c=0;c<b.length;c++){var k=b[c];if(k&&k.id){var h=m.byId(k.id);if(h&&h.on){var r=this.event.replace("on",""),w=h.on(r,q.hitch(this,function(c){d.onEvent(c)}));this._events.push(w)}else this._subscribe(a,this.onEvent,k)}else this._subscribe(a,this.onEvent,k)}else this._subscribe(a,this.onEvent)}catch(x){logError(x,
"registering event failed")}this._didSubscribe=a},onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},updateEventSelector:function(a,f){var d=[];if(a&&a.length)for(var d=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},
{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],c=0;c<d.length;c++){var k=d[c];if(k.value===this.event){k.selected=!0;break}}else d=this.scope.getEventsAsOptions(this.event);for(c=0;c<f.length;c++)if(k=f[c],k.widget&&"Event"===k.widget.title){c=k._widget;c.nativeWidget.set("options",d);c.nativeWidget.reset();c.nativeWidget.set("value",
this.event);this.publish(b.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this._destroy();this.reference=a;var d=this.resolveReference(this.deserialize(a));this.updateEventSelector(d,b);this._registerEvent(this.event)},onChangeField:function(a,b,d){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=b,this._registerEvent(b)));if("reference"==a)this.onReferenceChanged(b,d);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},
_destroy:function(){this._events||(this._events=[]);_.each(this._events,dojo.unsubscribe);this.unsubscribe(this.event,this.onEvent);this._lastResult=null;this._didSubscribe=!1}})})},"xblox/model/Referenced":function(){define(["dcl/dcl","dojo/_base/declare","xide/mixins/ReferenceMixin","xide/utils"],function(l,q,n,e){var g={reference:null,deserialize:function(b){if(!b||0==b.length)return{};try{return e.fromJson(b)}catch(a){return{}}}};q=q("xblox.model.Referenced",[n],g);q.dcl=l(n.dcl,g);return q})},
"xblox/model/events/OnKey":function(){define("dcl/dcl dojo/_base/lang dojo/_base/array dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xblox/model/Contains xblox/model/events/OnEvent xide/registry dojo/on".split(" "),function(l,q,n,e,g,b,a,f,m,v,u,p,t){return l([g,f.dcl,m.dcl,v],{declaredClass:"xblox.model.events.OnKey",name:"On Key",event:"",reference:"",references:null,description:"Triggers when a keyboard sequence "+this.event+" has been entered",
listeners:null,sharable:!0,toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var d=this.inherited(arguments)||this.getDefaultFields();d.push(b.createCI("Keyboard Sequence",a.ECIType.STRING,this.event,{group:"General",dst:"event",value:this.event,intermediateChanges:!1}));d.push(b.createCI("Object/Widget",a.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",value:this.reference}));
return d},getBlockIcon:function(){return'\x3cspan class\x3d"fa-keyboard-o"\x3e\x3c/span\x3e'},onEvent:function(a){this._lastResult=a;this.solve(this.scope,this._lastRunSettings)},_addListerner:function(a,c,k){null==this.listeners&&(this.listeners=[]);var h=null,h=new window.keypress.Listener(k,{is_unordered:!0,prevent_repeat:!1,prevent_default:!1,on_keyup:function(c){},on_keydown:function(c){},on_release:function(c){}});h.simple_combo(a,function(a){c&&c(arguments)});this.listeners.push(h)},_subscribe:function(a,
c,k){a&&(k&&k.domNode&&(k=k.domNode),this._addListerner(a,c,k))},_registerEvent:function(a){if(a&&a.length){var c=this.resolveReference(this.deserialize(this.reference)),k=this;if(c&&c.length)for(var h=0;h<c.length;h++){var r=c[h];if(r&&r.id){var b=p.byId(r.id);b=null,this._subscribe(a,function(){k.onEvent(arguments)},r)}else this._subscribe(a,function(){k.onEvent(arguments)},r)}else this._subscribe(a,function(){k.onEvent(arguments)})}},onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&
this.enabled&&this._registerEvent(this.event)},destroy:function(){this.inherited(arguments)},updateEventSelector:function(b,c){var k=[];if(b&&b.length)for(var k=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},
{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],h=0;h<k.length;h++){var r=k[h];if(r.value===this.event){r.selected=!0;break}}else k=this.scope.getEventsAsOptions(this.event);for(h=0;h<c.length;h++)if(r=c[h],r.widget&&"Event"===r.widget.title){h=r._widget;h.nativeWidget.set("options",k);h.nativeWidget.reset();h.nativeWidget.set("value",this.event);this.publish(a.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,
c){this._destroy();this.reference=a;this.resolveReference(this.deserialize(a));this._registerEvent(this.event)},onChangeField:function(a,c,k){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=c,this._registerEvent(c)));if("reference"==a)this.onReferenceChanged(c,k);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){if(this.listeners)for(var a=0;a<this.listeners.length;a++){var c=this.listeners[a];
c.stop_listening();var k=c.get_registered_combos();k&&c.unregister_many(k);c.reset()}this.listeners=[]},onFieldsRendered:function(a,c){}})})},"xblox/model/logging/Log":function(){define("dcl/dcl dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin".split(" "),function(l,q,n,e,g,b){return l([n,b.dcl],{declaredClass:"xblox.model.logging.Log",name:"Log Message",level:"info",message:'return "Message: " + arguments[0];',_type:"XBlox",host:"this host",sharable:!0,toText:function(){var a=
"text-primary";switch(this.level){case "info":a="text-info";break;case "warn":a="text-warning";break;case "error":a="text-danger"}a=this.getBlockIcon()+" "+this.name+" : \x3cspan class\x3d'"+a+" small'\x3e  :: ";this.message&&(a+=this.message);return a+"\x3c/span\x3e"},_solveExpression:function(a,b,m,g,u){if((a=""+a)&&a.length){a=e.convertAllEscapes(a,"none");var f=this.getArgs();try{var t=b.parseExpression(a,null,null,null,null,this,f);g&&g("Expression "+a+" evaluates to "+t);return t}catch(d){u&&
u("invalid expression : \n"+a+": "+d),this.onFailed(this,m)}}return a},solve:function(a,b,e,v){var f=new q,m=a.device;a=this._solveExpression(this.message,a,b,e,v);m={message:a,level:this.level,type:this._type,details:this.getArgs(),time:(new Date).getTime(),data:{device:m?m.info:null},write:!0};this.onSuccess(this,b);f.resolve(a);try{this.publish(g.EVENTS.ON_SERVER_LOG_MESSAGE,m)}catch(t){this.onFailed(this,b)}return f},canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||
this.getDefaultFields(),b=this;a.push(e.createCI("Level",3,this.level,{group:"General",options:[{value:"info",label:"Info"},{value:"warn",label:"Warning"},{value:"error",label:"Error"},{value:"debug",label:"Debug"},{value:"help",label:"Help"},{value:"verbose",label:"verbose"},{value:"silly",label:"Silly"}],dst:"level"}));a.push(e.createCI("message",25,this.message,{group:"General",title:"Message",dst:"message",delegate:{runExpression:function(a,f,e){b._solveExpression(a,b.scope,null,f,e)}}}));a.push(e.createCI("message",
13,this._type,{group:"General",title:"Type",dst:"_type"}));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bug"\x3e\x3c/span\x3e'}})})},"xblox/model/html/SetStyle":function(){define("dcl/dcl xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced dojo/dom-attr dojo/dom-style dojo/_base/Color xide/registry".split(" "),function(l,q,n,e,g,b,a,f,m,v){g={declaredClass:"xblox.model.html.SetStyle",name:"Set Style",reference:"",references:null,description:"Sets HTML Node Style Attribute",
value:"",mode:1,sharable:!0,solve:function(a,b){var f=this.value;b=b||{};var d=b.override||this.override||{};d.variables&&(f=n.replace(f,null,d.variables,{begin:"{",end:"}"}));d.args&&null!==d.args[0]&&(f=n.replace(f,null,{value:d.args[0]},{begin:"{",end:"}"}));this.updateObjects(null,f,this.mode,b);this.onSuccess(this,b);this.onDidRun()},toText:function(){var a=this.deserialize(this.reference),a=this.getBlockIcon()+" "+this.name+" :: on "+a.reference+" to"||"  to ";this.value&&(a+=" "+this.value);
return a},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();a.push(n.createCI("Value",e.ECIType.DOM_PROPERTIES,this.value,{group:"General",dst:"value",value:this.value,intermediateChanges:!1}));a.push(n.createCI("Mode",e.ECIType.ENUMERATION,this.mode,{group:"General",options:[n.createOption("Set",1),n.createOption("Add",2),n.createOption("Remove",3),n.createOption("Increase",4),n.createOption("Decrease",5)],dst:"mode"}));var b={group:"General",dst:"reference",value:this.reference};
this.scope&&(this.scope.global&&(b.window=this.scope.global,b.allowHTMLNodes=!0,b.allowWidgets=!1),this.scope.document&&(b.document=this.scope.document));a.push(n.createCI("Target",e.ECIType.WIDGET_REFERENCE,this.reference,b));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-paint-brush"\x3e\x3c/span\x3e'},updateEventSelector:function(a,b){var f=[];if(a&&a.length)for(var f=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},
{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],d=0;d<f.length;d++){var c=f[d];if(c.value===this.event){c.selected=!0;break}}else f=this.scope.getEventsAsOptions(this.event);
for(d=0;d<b.length;d++)if(c=b[d],c.widget&&"Event"===c.widget.title){d=c._widget;d.nativeWidget.set("options",f);d.nativeWidget.reset();d.nativeWidget.set("value",this.event);this.publish(e.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b,f){this.reference=a;this.references=this.resolveReference(this.deserialize(a),f);this.updateObjects(this.references,this.value,null,f)},getPropValue:function(a,b){for(var f in a)if(f===b)return a[f];return null},_getStyle:function(a,b,f){switch(a){case "height":return f.outerHeight();
case "width":return f.outerWidth();case "color":return f.css("color");case "border-color":return f.css("border-color")||"rgba(0,0,0,0)"}return null},updateObject:function(b,e,g,d){if(!b)return!1;g=g||1;(d=b.id?v.byId(b.id):null)&&(b=d);null!=b.domNode&&(b=b.domNode);d=a.get(b,"style");";"===d&&(d="");""===d&&(d=null!=b.lastStyle?b.lastStyle:e);";"===d&&(d=e);switch(g){case 1:var c=this._toObject(d);e=e.split(";");for(d=0;d<e.length;d++)g=e[d].split(":"),2==g.length&&(c[g[0]]=g[1]);d=[];for(var k in c)d.push(k+
":"+c[k]);$(b).attr("style",d.join(";"));break;case 2:e=_.uniq((d+";"+e).split(";")).join(";");a.set(b,"style",e);break;case 3:a.set(b,"style",n.replaceAll(e,"",d));break;case 4:case 5:k=new RegExp(/(\D*)(-?)(\d+)(\D*)/);g=this._toObject(e);var h={},r=$(b);if(g)for(c in g)d=this._getStyle(c,b,r),h[c]=d;r={};for(c in g){var w=""+c.trim();if(null!=h[w]){var x=g[c],B=h[c],p=-1!=x.indexOf("#"),t=-1!=x.indexOf("rgb"),u=-1!=x.indexOf("rgba");if(p||t||u){var l=dojo.colorFromString(x);dojo.colorFromString(x);
var q=dojo.colorFromString(B),A=new m;_.each(["r","g","b","a"],function(a){A[a]=Math.min(q[a]+l[a],"a"==a?1:255)});w="";p?w=A.toHex():t?w=A.toCss(!1):u&&(w=A.toCss(!0));r[c]=w;f.set(b,c,w)}else(p=k.exec(h[w]))&&3<=p.length&&parseInt(p[3])}}d=this._toObject(d);this._toObject(e);if(!d)return!1;for(c in d)w=""+c.trim();this._toStyleString(r)}},onDomStyleChanged:function(a,b,f,d){if(a=a||this.resolveReference(this.deserialize(this.reference),d))for(var c=0;c<a.length;c++){var k=a[c];k&&k.id&&-1!=k.id.indexOf("davinci")||
this.updateObject(k,b,f,d)}},updateObjects:function(a,b,f,d){a=a||this.resolveReference(this.deserialize(this.reference),d);this.onDomStyleChanged(a,b,f,d)},onChangeField:function(a,b,f){this._destroy();"mode"==a&&b!==this.mode&&(this.mode=b);"value"==a&&b!==this.value&&(this.onDomStyleChanged(null,b,this.mode),this.value=b);if("reference"==a)this.onReferenceChanged(b,f);this.inherited(arguments)},activate:function(){this._destroy()},deactivate:function(){this._destroy()},_destroy:function(){},_changeValue:function(a,
b){if(!a)return"";for(var f=a.split(" "),d="",c=0;c<f.length;c++){0<c&&(d+=" ");var k=f[c].match(/([-\d\.]+)([a-zA-Z%]*)/);if(k)if(1==k.length)d+=k[0];else for(var h=1;h<k.length;h++)d=isNaN(k[h])||""==k[h]?d+k[h]:d+(parseFloat(k[h])+b);else d+=f[c]}return d},_toObject:function(a){if(!a)return{};var b={};a=a.split(";");for(var f=0;f<a.length;f++){var d=a[f];if(d&&0!=d.length&&d.split){var c=d.split(":");c&&c.length&&(c=d.substring(0,d.indexOf(":")),d=d.substring(d.indexOf(":")+1,d.length),b[c]=d)}}return b},
_toStyleString:function(a){var b=[],f;for(f in a)b.push(f+":"+a[f]);return b.join(";")+";"}};l=l([q,b.dcl],g);l.Impl=g;return l})},"xblox/model/html/SetCSS":function(){define("dojo/_base/declare xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Targeted".split(" "),function(l,q,n,e,g,b){return l("xblox.model.html.SetCSS",[q,g,b],{name:"Set CSS",file:"",reference:"",references:null,description:"Sets HTML Node CSS",solve:function(a,b){this.onSuccess(this,b)},toText:function(){var a=
this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},getFields:function(){try{var a=this.inherited(arguments)||this.getDefaultFields();a.push(n.createCI("File",e.ECIType.FILE,this.file,{group:"General",dst:"file",value:this.file,intermediateChanges:!1,acceptFolders:!1,acceptFiles:!0,encodeFilePath:!1,buildFullPath:!0,filePickerOptions:{dialogTitle:"Select CSS File",filePickerMixin:{beanContextName:"CSSFilePicker",persistent:!1,globalPanelMixin:{allowLayoutCookies:!1}},configMixin:{beanContextName:"CSSFilePicker",
LAYOUT_PRESET:e.LAYOUT_PRESET.SINGLE,PANEL_OPTIONS:{ALLOW_MAIN_MENU:!1}},defaultStoreOptions:{fields:1663,includeList:"css",excludeList:"*"},startPath:this.file}}));a.push(n.createCI("Target",e.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",value:this.reference}))}catch(f){}return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-paint-brush"\x3e\x3c/span\x3e'},onReferenceChanged:function(a){this._destroy();this.reference=a},onChangeField:function(a,b,e){if("reference"==
a)this.onReferenceChanged(b,e);this.inherited(arguments)},activate:function(){this._destroy()},deactivate:function(){this._destroy()},_destroy:function(){}})})},"xblox/model/Targeted":function(){define(["dojo/_base/declare","./Referenced"],function(l,q){return l("xblox.model.Targeted",[q],{})})},"xblox/manager/BlockManager":function(){define("dcl/dcl dojo/has dojo/Deferred dojo/promise/all xide/types xide/utils xide/factory xblox/model/ModelBase xblox/model/Scope xblox/model/BlockModel xide/mixins/ReloadMixin xide/manager/ManagerBase xblox/data/Store xdojo/has!xblox-ui?xblox/manager/BlockManagerUI xide/lodash".split(" "),
function(l,q,n,e,g,b,a,f,m,v,u,p,t,d,c){return l([d,p,u.dcl],{declaredClass:"xblox/manager/BlockManager",serviceObject:null,loaded:{},test:function(){},scope:null,scopes:null,_createBlock:null,_registerActions:function(){},toScope:function(a){try{a=b.getJson(a)}catch(w){return console.error("BlockManager::toScope: failed,err\x3d"+w),null}a||(console.error("correct data"),a={blocks:[],variables:[]});var k=b.createUUID(),r=a;!c.isArray(a)&&c.isObject(a)&&(k=a.scopeId||k,r=a.blocks||[]);a=this.getScope(k,
{owner:this},!0);r=a.blocksFromJson(r);for(k=0;k<r.length;k++)r[k]._lastRunSettings={force:!1,highlight:!0};a.serviceObject=this.serviceObject;return a},loadFiles:function(a){for(var c=[],k=new n,b=0;b<a.length;b++){var d=a[b];c.push(this.load(d.mount,d.path,d.force))}e(c).then(function(a){k.resolve(a)});return k.promise},load:function(a,c,r){var k=new n,h=this,d=b.replaceAll("/","",a),f=b.replaceAll("./","",c),e=d+f,e=e.trim();this.loaded[e]&&!0===r&&(this.removeScope(this.loaded[e].id),this.loaded[e]=
null);if(!0!==r&&this.loaded[e])return k.resolve(this.loaded[e]),k.promise;this.ctx.getFileManager().getContent(d,f,function(b){if(b=h.toScope(b))h.loaded[e]=b,b.mount=a,b.path=c;k.resolve(b)},!1);return k.promise},onBlocksReady:function(a){for(var c=a.allBlocks(),k=0;k<c.length;k++)this.setScriptFunctions(c[k],a,this);if((a=a.getBlocks({group:"On Load"}))&&0<a.length)for(k=0;k<a.length;k++)if(c=a[k],c.onLoad)c.onLoad()},getBlock:function(){},setScriptFunctions:function(a,c,b){a.blockScope||(a.blockScope=
c);c.serviceObject=this.serviceObject;a.setVariable||(a.setVariable=function(k,h,r,d,f){if(k=this.blockScope.getVariable(k))k.value=h,!1!==d&&b.publish(g.EVENTS.ON_VARIABLE_CHANGED,{item:k,scope:c,driver:a,owner:b,save:!0===r,source:f||g.MESSAGE_SOURCE.BLOX})});a.getVariable||(a.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""})},hasScope:function(a){this.scopes||(this.scopes={});return this.scopes[a]?this.scopes[a]:null},getScope:function(c,h,b){this.scopes||(this.scopes=
{});if(!this.scopes[c]&&(this.scopes[c]=this.createScope({id:c,ctx:this.ctx}),this.scopes[c].userData=h,!1!==b))try{a.publish(g.EVENTS.ON_SCOPE_CREATED,this.scopes[c])}catch(w){console.error("bad, scope creation failed "+w,w)}return this.scopes[c]},removeScope:function(a){this.scopes||(this.scopes={});for(var c in this.loaded)this.loaded[c].id==a&&delete this.loaded[c];this.scopes[a]&&(this.scopes[a]._destroy(),delete this.scopes[a]);return null},createScope:function(a,c,r){c=c||[];var k=new t({data:[],
Model:v,id:b.createUUID(),__events:{},observedProperties:["name","enabled","value"],getLabel:function(a){return a.name},labelAttr:"name"});k.reset();k.setData([]);k={owner:this,blockStore:k,serviceObject:this.serviceObject,config:this.config};b.mixin(k,a);try{var h=new m(k);c&&h.initWithData(c,r);h.init()}catch(B){logError(B,"error creating scope, data:",a)}return h},onReloaded:function(){},init:function(){this.scope={variables:[],blocks:[]};f.prototype.types=g;f.prototype.factory=a;if(this.onReady)this.onReady()}})})},
"xblox/model/Scope":function(){define("dcl/dcl ./ModelBase ./Expression xide/factory xide/utils xide/types xide/mixins/EventedMixin dojo/_base/lang dojo/has xide/encoding/MD5 xcf/model/Variable xdojo/has!host-node?nxapp/utils/_console".split(" "),function(l,q,n,e,g,b,a,f,m,v,u,p){var t="undefined"!==typeof window?window.console:"undefined"!==typeof global?global.console:p;p&&(t=p);var d=m("xcf-ui");q=l([q,a.dcl],{declaredClass:"xblox.model.Scope",variableStore:null,serviceObject:null,context:null,
blockStore:null,expressionModel:null,start:function(){if(!0===this.__didStartBlocks)t.error("already started blocks");else{this.__didStartBlocks=!0;var a=this.getVariable("value");a||(a=new u({id:g.createUUID(),name:"value",value:"",scope:this,type:13,group:"processVariables",gui:!1,cmd:!1}),this.blockStore.putSync(a));var a=[],k=this.getBlocks({group:b.COMMAND_TYPES.INIT_COMMAND}),h=this;try{_.each(k,function(a){!1!==a.enabled&&!0!==a.__started&&(a.solve(h),a.__started=!0)},this)}catch(w){t.error("starting init blocks failed",
w),logError(w,this)}a=a.concat(this.getBlocks({group:b.COMMAND_TYPES.BASIC_COMMAND}));for(k=0;k<a.length;k++){var r=a[k];r.enabled&&r.start&&r.startup&&!0!==r.__started&&(r.start(),r.__started=!0)}}},getExpressionModel:function(){this.expressionModel||(this.expressionModel=new n);return this.expressionModel},toFriendlyName:function(a,k){if(!k||!a)return null;var c=this,b=this.ctx,d=this.driver,d=b.getDeviceManager(),f=b.getDriverManager();if(-1==k.indexOf("://"))return(c=c.getBlockById(k))?c.name:
k;var b=g.parse_url(k),b=g.urlArgs(b.host),e=d.getItemById(b.device.value);if(e){var m=d.toDeviceControlInfo(e),d=f.getDriverById(m.driverId);if((e=e.driverInstance)||d)if(c=d.blockScope?d.blockScope:e?e.blockScope:c,(a=c.getStore().getSync(b.block.value))||e&&e.blockScope&&(a=e.blockScope.getBlock(b.block.value)))return m.title+"/"+a.name}return k},getContext:function(){return this.instance},toString:function(){var a={blocks:null,variables:null},k=this.blocksToJson();try{g.fromJson(JSON.stringify(k))}catch(h){return}a.blocks=
k;return JSON.stringify(a,null,2)},initWithData:function(a,k){a&&this.blocksFromJson(a,null,k);this.clearCache()},getService:function(){return this.serviceObject},getStore:function(){return this.blockStore},reset:function(){this.getExpressionModel().reset()},empty:function(){this.clearCache();var a=this.blockStore,k=this.getBlocks();a.silent(!0);_.each(k,function(c){c&&a.removeSync(c.id)});a.setData([]);a.silent(!1)},fromScope:function(a){var c=this.blockStore;c.silent(!0);this.empty();a=a.blocksToJson();
this.blocksFromJson(a);c.silent(!1)},clearCache:function(){this.getExpressionModel().reset()},getVariableStore:function(){return this.blockStore},getBlockStore:function(){return this.blockStore},getVariables:function(a){if(!this.blockStore)return[];var c=this.blockStore.data,h=[];if(a&&"processVariables"===a.group){for(a=0;a<c.length;a++)"processVariables"===c[a].group&&h.push(c[a]);return h}if(!a){for(a=0;a<c.length;a++){var b=c[a],d=b.declaredClass;"xblox.model.variables.Variable"!=d&&"xcf.model.Variable"!=
d||h.push(b)}return h}return this.blockStore.query(a)},loopBlock:function(a,k){1==a._destroyed&&t.error("block destroyed");var c=a.getInterval?a.getInterval():0;if(a&&0<c&&a.enabled&&!0!==a._destroyed){var b=this;a._loop&&clearInterval(a._loop);a._loop=setInterval(function(){!a.enabled||a._destroyed?(clearInterval(a._loop),a._loop=null):a.solve(b,k||a._lastSettings)},c)}},getEventsAsOptions:function(a){var c=[],h;for(h in b.EVENTS)c.push({label:b.EVENTS[h],value:b.EVENTS[h]});c=c.concat([{label:"onclick",
value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}]);for(h=0;h<c.length;h++){var r=
c[h];if(r.value===a){r.selected=!0;break}}return c},getVariablesAsObject:function(){for(var a=this.getVariables(),k={},h=0;h<a.length;h++)k[a[h].title]=a[h].value;return k},getVariablesAsOptions:function(){var a=this.getVariables(),k=[];if(a)for(var h=0;h<a.length;h++)k.push({label:a[h].label,value:a[h].variable});return k},getCommandsAsOptions:function(a){var c=this.getBlocks({declaredClass:"xcf.model.Command"}),h=[];if(c)for(var b=0;b<c.length;b++){var d={};d[a||"label"]=c[b].name;d.value=c[b].name;
h.push(d)}return h},_cached:null,getBlocks:function(a,k){if(!d&&!1!==k&&(this._cached||(this._cached={}),a)){var c=v(JSON.stringify(a),1);if(c=this._cached[c])return c}if(!this.blockStore)return[];a=a||{id:/\S+/};var b=_.isEmpty(a)?this.blockStore.data:this.blockStore.query(a,null,!0);d||!1===k||(c=v(JSON.stringify(a),1),this._cached[c]=b);return b},registerVariable:function(a){this.variables[a.title]=a;this.blockStore&&this.blockStore.putSync(a)},getVariable:function(a){for(var c=this.getVariables(),
b=0;b<c.length;b++){var r=c[b];if(r.name===a)return r}return null},getVariableById:function(a){if(!a)return null;var c=a.split("/"),b=this;2==c.length&&((a=b.owner)&&a.hasScope&&(a.hasScope(c[0])?b=a.getScope(c[0]):t.error("have scope id but cant resolve it",this)),a=c[1]);return(c=b.blockStore.getSync(a))?c:null},registerBlock:function(a,k){var c=this.blockStore;if(c){var b=c.getSync(a.id);if(b)return b;b=null;return b=a.addToStore?a.addToStore(c):c.putSync(a,k)}},allBlocks:function(a,b){return this.getBlocks({},
b)},hasGroup:function(a){for(var c=this.allGroups({},!1),b=0;b<c.length;b++)if(c[b]===a)return!0;return!1},allGroups:function(){for(var a=[],b=this.allBlocks({},!1),h=function(c){for(var b=0;b<a.length;b++)if(a[b]===c)return!0;return!1},r=0;r<b.length;r++){var d=b[r];d.parentId||(d.group?h(d.group)||a.push(d.group):h("No Group")||a.push("No Group"))}return a},variablesToJson:function(){var a=[],b=this.variableStore?this.getVariables():this.variables,h;for(h in b){var r=b[h];if(!1!==r.serializeMe&&
null!=r.keys){var d={},f;for(f in r)if(this.isString(r[f])||this.isNumber(r[f])||this.isBoolean(r[f]))d[f]=r[f];a.push(d)}}return a},isScript:function(a){return this.isString(a)&&(-1!=a.indexOf("return")||-1!=a.indexOf(";")||-1!=a.indexOf("[")||-1!=a.indexOf("{")||-1!=a.indexOf("}"))},variablesToJavascriptEx:function(a,b){for(var c=[],k=this.variableStore?this.getVariables():this.variables,d=0;d<k.length;d++){var f=k[d];if(f!=a){var e=""+f.value;a&&a.value&&-1==a.value.indexOf(f.title)||b&&-1==b.indexOf(f.title)||
0==e.length||(this.isScript(e)||-1!=e.indexOf("'")?this.isScript(e)&&(e=this.expressionModel.parseVariable(this,f)):e="'"+e+"'","''"===e&&(e="'0'"),c.push(e))}}return c},variablesToJavascript:function(a,b){for(var c="",k=this.variableStore?this.getVariables():this.variables||[],d=0;d<k.length;d++){var f=k[d];if(f!=a){var e=""+f.value;a&&a.value&&-1==a.value.indexOf(f.title)||b&&-1==b.indexOf(f.title)||0==e.length||(this.isScript(e)||-1!=e.indexOf("'")?this.isScript(e)&&(e=this.expressionModel.parseVariable(this,
f)):e="'"+e+"'","''"===e&&(e="'0'"),c+="var "+f.title+" \x3d "+e+";",c+="\n")}}return c},variablesFromJson:function(a){for(var c=[],b=0;b<a.length;b++){var r=a[b];r.scope=this;if(r.declaredClass){var d=g.replaceAll(".","/",r.declaredClass);(d=require(d))&&c.push(new d(r))}}return c},regenerateIDs:function(a){for(var c=this,b=function(a){var k=g.createUUID(),h=c.getBlocks({parentId:a.id});if(h&&0<h.length)for(var r=0;r<h.length;r++){var d=h[r];d.parentId=k;b(d)}a.id=k},r=0;r<a.length;r++)b(a[r])},
cloneBlocks2:function(a,b){var c=this.blocksToJson(a),k=this.owner.getScope(g.createUUID(),null,!1),c=k.blocksFromJson(c,!1),d=this.blockStore,c=k.allBlocks();k.regenerateIDs(c);c=k.blocksToJson(c);if(b)for(k=0;k<c.length;k++){var f=c[k];null==f.parentId&&(f.group=b)}var e=[],c=this.blocksFromJson(c);_.each(c,function(a){e.push(d.getSync(a.id))});return e},cloneBlocks:function(a){a=this.blocksToJson(a);var c=this.owner.getScope(g.createUUID(),null,!1);a=c.blocksFromJson(a,!1);a=c.allBlocks();for(c=
0;c<a.length;c++){var b=a[c];b.id=g.createUUID();b.parentId=null}this.blocksToJson(a);this.blocksFromJson(a);return a},blockToJson:function(a){var c={_containsChildrenIds:[]},b;for(b in a)if("ctrArgs"!=b&&("function"===typeof a[b]||a.serializeField(b))){if(this.isString(a[b])||this.isNumber(a[b])||this.isBoolean(a[b]))c[b]=a[b];if("parent"!=b)if(this.isBlock(a[b]))c[b]=a[b].id,c._containsChildrenIds.push(b);else if(this.areBlocks(a[b])){c[b]=[];for(var d=0;d<a[b].length;d++)c[b].push(a[b][d].id);
c._containsChildrenIds.push(b)}}return c},blocksToJson:function(a){try{var c=[];a=a&&a.length?a:this.blockStore?this.blockStore.data:this.blocks;for(var b in a){var d=a[b];if(null!=d.keys&&!1!==d.serializeMe){var f={_containsChildrenIds:[]},e;for(e in d)if("ctrArgs"!=e&&("function"===typeof d[e]||d.serializeField(e))){if(this.isString(d[e])||this.isNumber(d[e])||this.isBoolean(d[e]))f[e]=d[e];_.isObject(d[e])&&d.serializeObject&&!0===d.serializeObject(e)&&(f[e]=JSON.stringify(d[e],null,2));if("parent"!=
e)if(this.isBlock(d[e]))f[e]=d[e].id,f._containsChildrenIds.push(e);else if(this.areBlocks(d[e])){f[e]=[];for(var m=0;m<d[e].length;m++)f[e].push(d[e][m].id);f._containsChildrenIds.push(e)}}c.push(f)}}}catch(D){t.error("from json failed : "+D)}return c},_createBlockStore:function(){},blockFromJson:function(a){a.scope=this;null==a._containsChildrenIds&&(a._containsChildrenIds=[]);for(var c={},b=0;b<a._containsChildrenIds.length;b++){var d=a._containsChildrenIds[b];c[d]=a[d];a[d]=null}delete a._containsChildrenIds;
if(!a.declaredClass)return null;d=b=null;try{d=g.replaceAll(".","/",a.declaredClass),b=require(d)}catch(w){try{d=g.replaceAll("/",".",a.declaredClass),b=require(d)}catch(x){}}b||(b=l.getObject(a.declaredClass));if(!b)return null;d=null;try{d=e.createBlock(b,a)}catch(w){return logError(w),null}d._children=c;return d},blocksFromJson:function(a,b,h){for(var c=[],k={},d=0;d<a.length;d++){var f=a[d];f.scope=this;null==f._containsChildrenIds&&(f._containsChildrenIds=[]);for(var m={},p=0;p<f._containsChildrenIds.length;p++){var v=
f._containsChildrenIds[p];m[v]=f[v];f[v]=null}delete f._containsChildrenIds;if(f.declaredClass){var u=p=null;try{u=g.replaceAll(".","/",f.declaredClass),p=require(u)}catch(y){t.error("couldnt resolve class "+u)}p||(p=l.getObject(f.declaredClass));if(p){u=null;try{u=e.createBlock(p,f,null,!1)}catch(y){t.error("error in block creation ",y+" "+f.declaredClass);logError(y);continue}u._children=m;k[u.id]=m;c.push(u)}}}a=this.allBlocks(null,!1);for(d=0;d<a.length;d++){f=a[d];f._children=k[f.id];if(f._children){for(v in f._children)if("string"==
typeof f._children[v])(m=this.getBlockById(f._children[v]))?(f[v]=m,m.parent=f,m.postCreate&&m.postCreate()):(this.blockStore.removeSync(f._children[v]),h&&h("   couldnt resolve child: "+f._children[v]+"@"+f.name+":"+f.declaredClass));else if("object"==typeof f._children[v])for(f[v]=[],p=0;p<f._children[v].length;p++)(m=this.getBlockById(f._children[v][p]))?(f[v].push(m),(u=this.getBlockById(m.parentId))?m.parent=u:t.error("child has no parent")):h&&h("   couldnt resolve child: "+f._children[v]+"@"+
f.name+":"+f.declaredClass);delete f._children}!1!==b&&null!=f.parentId&&null==this.getBlockById(f.parentId)&&(f.parentId=null);f.postCreate()}this.allBlocks();return c},resolveDevice:function(a){var c=this.ctx,b=this.device,d=c.getDeviceManager();c.getDriverManager();if(-1==a.indexOf("://"))return(b=this.getBlockById(a))?b:a;a=g.parse_url(a);a=g.urlArgs(a.host);c=d.getItemById(a.device.value);!c&&(d=d.getInstanceByName(a.device.value))&&(c=d.device);return b},resolveBlock:function(a){var b=this,
c=this.ctx,b=this.driver,b=c.getDeviceManager(),c=c.getDriverManager();if(-1==a.indexOf("://"))return(b=this.getBlockById(a))?b:a;a=g.parse_url(a);a=g.urlArgs(a.host);var d=b.getItemById(a.device.value);if(!d){var f=b.getInstanceByName(a.device.value);f&&(d=f.device)}if(d&&(b=b.toDeviceControlInfo(d))&&(b=c.getDriverById(b.driverId),(c=d.driverInstance)||b)&&(a=(b=c?c.blockScope:b.blockScope)?b.getStore().getSync(a.block.value):null))return a},getBlock:function(a){return this.getBlockById(a)},getBlockByName:function(a){if(-1!==
a.indexOf("://")){var b=this.resolveBlock(a);if(b)return b}for(var c=this.getBlocks(),d=0;d<c.length;d++)if(b=c[d],b.name===a)return b;return(a=this.blockStore.query({name:a}))&&0<a.length?a[0]:null},getBlockById:function(a){return this.blockStore.getSync(a)},_flatten:function(a){var b=[],c;for(c in a){var d=a[c];if(null!=d.keys){b.push(d);for(var f in d)if("ctrArgs"!=f&&"parent"!==f)if(this.isBlock(d[f]))b.push(d[f]);else if(this.areBlocks(d[f]))for(var e=0;e<d[f].length;e++)b.push(d[f][e])}}return b},
flatten:function(a){var b=[],c;for(c in a){var d=a[c];if(null!=d.keys){var f=_.find(b,{id:d.id});f||b.push(d);for(var e in d)if("ctrArgs"!=e&&"parent"!==e){var m=d[e];if(this.isBlock(m))(f=_.find(b,{id:m.id}))||b.push(m);else if(this.areBlocks(m))for(var g=0;g<m.length;g++){var p=m[g];(f=_.find(b,{id:p.id}))||b.push(p);b=b.concat(this.flatten([p]))}}}}return b=_.uniq(b,!1,function(a){return a.id})},_getSolve:function(a){return a.prototype?a.prototype.solve:a.__proto__.solve},solveBlock:function(a,
b,d,r){b=b||{highlight:!1};var c=null;this.isString(a)?(c=this.getBlockByName(a))||(c=this.getBlockById(a)):this.isObject(a)&&(c=a);a=null;if(c){if(!0!==b.force&&0==c.enabled)return null;!0===b.force&&(b.force=!1);var k=c.declaredClass;(k=f.getObject(g.replaceAll("/",".",k))||f.getObject(k))?k.prototype&&k.prototype.solve&&(a=k.prototype.solve.apply(c,[this,b])):(a=c.solve(c.getScope(),b,d,r),delete c.override,c.override={})}return a},solve:function(a,b){for(var c="",d=0;d<this.items.length;d++)c+=
this.items[d].solve(a,b);return c},parseExpression:function(a,b,d,f,e,m,g,p){return this.getExpressionModel().parse(this,a,b,f,e,m,d,g,p)},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isBoolean:function(a){return"boolean"==typeof a},isObject:function(a){return"object"===typeof a},isBlock:function(a){var b=!1;"object"==typeof a&&null!=a&&void 0==a.length&&a.serializeMe&&(b=!0);return b},areBlocks:function(a){var b=!1;"object"==typeof a&&null!=a&&0<a.length&&
this.isBlock(a[0])&&(b=!0);return b},_onVariableChanged:function(a){a.item&&this.getExpressionModel().variableFuncCache[a.item.title]&&delete this.expressionModel.variableFuncCache[a.item.title]},init:function(){this.getExpressionModel();this.subscribe(b.EVENTS.ON_DRIVER_VARIABLE_CHANGED,this._onVariableChanged);var a=this;this.subscribe(b.EVENTS.ON_MODULE_RELOADED,function(b){var c=b.module,d=b.newModule;(b=a.getBlocks().filter(function(a){return a.declaredClass==c||a.declaredClass==g.replaceAll("/",
".",c)?a:null}))&&_.each(b,function(a){var b=d.prototype,c;for(c in b){var k=b[c];k&&_.isFunction(k)&&(a[c]=k)}})})},_destroy:function(){for(var a=this.allBlocks(),d=0;d<a.length;d++){var h=a[d];if(h)try{h&&h.stop&&h.stop(!0),h&&h.reset&&h.reset(),h&&h._destroy&&h._destroy(),h&&h.destroy&&h.destroy(),h._emit&&h._emit(b.EVENTS.ON_ITEM_REMOVED,{item:h})}catch(r){}}},destroy:function(){this._destroy();this.reset();this._destroyed=!0;delete this.expressionModel},moveTo:function(a,b,d,f){if(f){if(b.canAdd&&
b.canAdd()){var c=this.getBlockById(a.parentId);c&&c.removeBlock(a,!1);return b.add(a,null,null)}t.error("cant reparent");return!1}if(b.parentId||!1!==f)if(!a.parentId&&b.parentId&&0==f)a.group=b.group;else if(a.parentId||b.parentId||!f){if(a.parentId&&b.parentId&&0==f&&a.parentId===b.parentId){var h=this.getBlockById(a.parentId);if(!h)return!1;var k=h[h._getContainer(a)],c=a.indexOf(k,a);b=a.indexOf(k,b);k=c>b?-1:1;d=Math.abs(c-(b+(1==d?-1:1)));for(b=0;b<d-1;b++)a.move(k);return!0}if(a.parentId&&
b.parentId&&0==f&&a.parentId!==b.parentId){c=this.getBlockById(a.parentId);if(c&&(h=this.getBlockById(b.parentId))&&c&&c.removeBlock&&h.canAdd&&h.canAdd())c.removeBlock(a,!1),h.add(a,null,null);else return!1;k=h[h._getContainer(a)];null==k&&t.error("weird : target parent has no item container");c=h.indexOf(k,a);b=h.indexOf(k,b);if(!c||!b){t.error(" weird : invalid drop processing state, have no valid item indicies");return}k=c>b?-1:1;d=Math.abs(c-(b+(1==d?-1:1)));for(b=0;b<d-1;b++)h.move(a,k);return!0}}else return b.canAdd&&
b.canAdd()&&(a.group=null,b.add(a,null,null)),!0;else{(c=this.getBlockById(a.parentId))&&c.removeBlock&&(c.removeBlock(a,!1),a.parentId=null,a.group=b.group);var h=[],k=this.getBlocks({group:b.group}),e=[],c=this.getBlockStore(),r=c.storage.index[b.id];for(b=0;b<k.length;b++)if(f=k[b],null==k[b].parentId&&k[b]!=a&&(f=c.storage.index[f.id],f=d?f>=r:f<=r))h.push(k[b]),e.push(c.storage.index[k[b].id]);for(b=0;b<h.length;b++)c.remove(h[b].id);this.getBlockStore().remove(a.id);d&&this.getBlockStore().putSync(a);
for(b=0;b<h.length;b++)c.put(h[b]);d||this.getBlockStore().putSync(a);return!0}return!1}});l.chainAfter(q,"destroy");return q})},"xblox/model/Expression":function(){define(["xdojo/declare","xdojo/has","xide/utils","xide/types","xblox/model/ModelBase"],function(l,q,n,e,g,b,a){var f="undefined"!==typeof window?window.console:global.console;return l("xblox.model.Expression",[g],{id:null,context:null,variableDelimiters:{begin:"[",end:"]"},blockCallDelimiters:{begin:"{",end:"}"},expressionCache:null,variableFuncCache:null,
constructor:function(){this.reset()},reset:function(){this.expressionCache={};this.variableFuncCache={}},replaceVariables:function(a,b,f,g,l,d,c,k){var h=e.CIFLAG;c=c||this.variableDelimiters;k=k||h.NONE;k&h.DONT_ESCAPE&&(g=!1);k&h.DONT_PARSE&&(f=!1);var r=this.findOccurrences(b,c);if(r)for(var m=0;m<r.length;m++){var p=r[m],p=p.replace(c.begin,""),p=p.replace(c.end,"");(p=this._getVar(a,p))&&p.flags&h.DONT_PARSE&&(f=!1);var v=null;if(p){if(d){b=b.replace(r[m],"this.getVariable('"+p.name+"')");continue}v=
this.getValue(p.value);l&&p.name in l&&(v=l[p.name]);if(this.isScript(v)&&!1!==f)try{var u=a.variablesToJavascript(p,!0);u&&(v=u+v);var t=(new Function("{\n"+v+"\n}")).call(a.context||{});"undefined"===t||"undefined"===typeof t?v=""+p.value:(v=t,k&h.DONT_ESCAPE||(v="'"+v+"'"))}catch(C){}else this.isNumber(v)||!1!==g&&(v="'"+v+"'")}else v=r[m];b=b.replace(r[m],v)}return b},parse:function(a,b,e,g,l,d,c,k,h){b=this.replaceAll("''","'",b);e=d||a.context||a.getContext()||{};b=this.replaceVariables(a,b,
null,null,c,null!=e.getVariable,null,h);a=this.isScript(b);if(!a&&(this.isString(b)||this.isNumber(b)))return g&&g("Expression "+b+" evaluates to "+b),b;-1==b.indexOf("return")&&a&&(b="return "+b);a=this;try{b=this.replaceAll("''","'",b);var r=this.expressionCache[b];r||(r=new Function("{"+b+"; }"),this.expressionCache[b]=r);a=r.apply(e,k)}catch(w){return f.error("invalid expression : \n"+b,w),l&&l("invalid expression : \n"+b+": "+w,w),""+b}g&&g("Expression "+b+" evaluates to "+a);return a},parseVariable:function(a,
b,f,e,g,d,c){var k=""+b.value;f=f||"";!1!==g?(g=this.variableFuncCache[a.id+"|"+b.title],g||(g=new Function("{"+f+k+"}"),this.variableFuncCache[a.id+"|"+b.title]=g)):g=new Function("{"+f+k+"}");a=g.apply(d||a.context||{},c||[]);return k="undefined"===a||"undefined"===typeof a?""+b.value:this.isNumber(a)||!1===e?a:"'"+a+"'"},replaceBlockCalls:function(a,b){var f=this.findOccurrences(b,this.blockCallDelimiters);if(f)for(var e=0;e<f.length;e++){var g=this._removeDelimiters(f[e],this.blockCallDelimiters),
g=a.solveBlock(g).join("\n");b=b.replace(f[e],g)}return b},_getVar:function(a,b){return a.getVariable(this._getVarName(b))},_getVarName:function(a){return this._removeDelimiters(a,this.variableDelimiters)},_removeDelimiters:function(a,b){return a.replace(b.begin,"").replace(b.end,"")},_escapeRegExp:function(a){for(var b="[](){}*+.".split(""),f=0;f<b.length;f++)a=a.replace(b[f],"\\"+b[f]);return a},findOccurrences:function(a,b){var f=this._escapeRegExp(b.begin),e=this._escapeRegExp(b.end);return a.match(new RegExp(f+
"([^"+e+"]*)"+e,"g"))}})})},"xblox/model/BlockModel":function(){define(["dcl/dcl","xdojo/declare","xide/data/Model","xide/data/Source"],function(l,q,n,e){return q("xblox.model.BlockModel",[n,e],{declaredClass:"xblox.model.BlockModel",icon:"fa-play",mayHaveChildren:function(e){return null!=this.items&&0<this.items.length},getChildren:function(e){return this.items},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e'}})})},"xblox/data/Store":function(){define(["dojo/_base/declare",
"xide/data/TreeMemory","xide/data/ObservableStore","dstore/Trackable","dojo/Deferred"],function(l,q,n,e,g){return l("xblox.data.Store",[q,e,n],{idProperty:"id",parentField:"parentId",parentProperty:"parentId",filter:function(b){var a=this.inherited(arguments);delete this._state.filter;this._state.filter=b;return a},getRootItem:function(){return{canAdd:function(){return!0},id:this.id+"_root",group:null,name:"root",isRoot:!0,parentId:null}},getChildren:function(b){return this.root.filter({parentId:this.getIdentity(b)})},
_fetchRange:function(b){var a=new g;b=this.fetchRangeSync(b);var f;if(this._state.filter){if(this._state.filter.parentId){var e=this.getSync(this._state.filter.parentId);e&&(this.reset(),f=e.items,e.getChildren&&(f=e.getChildren()),a.resolve(f),b=f)}this._state&&this._state.filter&&this._state.filter.group&&(f=this.getSync(this._state.filter.parent),e&&(this.reset(),b=e.items))}a.resolve(b);return a},mayHaveChildren:function(b){return b.mayHaveChildren?b.mayHaveChildren(b):null!=b.items&&0<b.items.length}})})},
"xblox/factory/Blocks":function(){define("xide/factory xide/utils xide/types xide/mixins/ReloadMixin xide/mixins/EventedMixin xblox/model/logic/CaseBlock xblox/model/Block xblox/model/functions/CallBlock xblox/model/functions/StopBlock xblox/model/functions/PauseBlock xblox/model/functions/SetProperties xblox/model/code/CallMethod xblox/model/code/RunScript xblox/model/loops/ForBlock xblox/model/loops/WhileBlock xblox/model/variables/VariableAssignmentBlock xblox/model/logic/IfBlock xblox/model/logic/ElseIfBlock xblox/model/logic/SwitchBlock xblox/model/variables/VariableSwitch xblox/model/logging/Log xblox/model/server/RunServerMethod xblox/model/server/Shell xblox/model/code/RunBlock xblox/model/events/OnEvent xblox/model/events/OnKey xblox/model/mqtt/Subscribe xblox/model/mqtt/Publish xblox/model/File/ReadJSON xcf/factory/Blocks".split(" "),
function(l,q,n,e,g,b,a,f,m,v,u,p,t,d,c,k,h,r,w,x,B,D,F,C,E,y,A,z,H){var G=null;l.createBlock=function(b,c,d,h){a.prototype.prepareArgs(c);b=l.createInstance(b,c,d);b.ctrArgs=null;var k;try{b&&b.init&&b.init(),b.scope&&(k=b.scope.registerBlock(b,h)),b.initReload&&b.initReload()}catch(M){logError(M,"create block")}return k||b};l.clearVariables=function(){};l.getAllBlocks=function(a,b,c,d,h){if(!1!==h&&null!=G)return G;0==h&&(G=null);h=l._getFlowBlocks(a,b,c,d);h=h.concat(l._getLoopBlocks(a,b,c,d));
h=h.concat(l._getCommandBlocks(a,b,c,d));h=h.concat(l._getCodeBlocks(a,b,c,d));h=h.concat(l._getEventBlocks(a,b,c,d));h=h.concat(l._getLoggingBlocks(a,b,c,d));h=h.concat(l._getServerBlocks(a,b,c,d));h=h.concat(l._getMQTTBlocks(a,b,c,d));return G=h=h.concat(l._getFileBlocks(a,b,c,d))};l._getMQTTBlocks=function(a,b,c,d){var h=[];h.push({name:"MQTT",iconClass:"fa-cloud",items:[{name:"Subscribe",owner:b,iconClass:"fa-bell",proto:A,target:c,ctrArgs:{scope:a,group:d}},{name:"Publish",owner:b,iconClass:"fa-send",
proto:z,target:c,ctrArgs:{scope:a,group:d}}]});l.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:h,group:"MQTT"});return h};l._getFileBlocks=function(a,b,c,d){var h=[];h.push({name:"File",iconClass:"fa-file",items:[{name:"%%Read JSON",owner:b,iconClass:"fa-file",proto:H,target:c,ctrArgs:{scope:a,group:d}}]});l.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:h,group:"File"});return h};l._getServerBlocks=function(a,b,c,d){var h=[];h.push({name:"Server",iconClass:"el-icon-repeat",items:[{name:"Run Server Method",
owner:b,iconClass:"fa-plug",proto:D,target:c,ctrArgs:{scope:a,group:d}},{name:"Shell",owner:b,iconClass:"fa-code",proto:F,target:c,ctrArgs:{scope:a,group:d}}]});l.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:h,group:"Server"});return h};l._getVariableBlocks=function(a,b,c,d){var k=[];k.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:h,target:c,ctrArgs:{scope:a,group:d,condition:"[value]\x3d\x3d'PW'"}}]});return k};l._getEventBlocks=
function(a,b,c,d){var h=[];h.push({name:"Events",iconClass:"fa-bell",items:[{name:"On Event",owner:b,iconClass:"fa-bell",proto:E,target:c,ctrArgs:{scope:a,group:d}},{name:"On Key",owner:b,iconClass:"fa-keyboard-o",proto:y,target:c,ctrArgs:{scope:a,group:d}}]});l.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:h,group:"Events"});return h};l._getLoggingBlocks=function(a,b,c,d){var h=[];h.push({name:"Logging",iconClass:"fa-bug",items:[{name:"Log",owner:b,iconClass:"fa-bug",proto:B,target:c,ctrArgs:{scope:a,
group:d}}]});l.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:h,group:"Logging"});return h};l._getCodeBlocks=function(a,b,c,d){var h=[];h.push({name:"Code",iconClass:"fa-code",items:[{name:"Call Method",owner:b,iconClass:"el-icon-video",proto:p,target:c,ctrArgs:{scope:a,group:d}},{name:"Run Script",owner:b,iconClass:"fa-code",proto:t,target:c,ctrArgs:{scope:a,group:d}},{name:"Run Block",owner:b,iconClass:"fa-code",proto:C,target:c,ctrArgs:{scope:a,group:d}},{name:"Set Properties",owner:b,iconClass:"fa-code",
proto:u,target:c,ctrArgs:{scope:a,group:d}}]});l.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:h,group:"Code"});return h};l._getFlowBlocks=function(a,b,c,d){var k=[];k.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:h,target:c,ctrArgs:{scope:a,group:d,condition:"[value]\x3d\x3d'PW'"}},{name:"Switch",owner:b,iconClass:"el-icon-fork",proto:w,target:c,ctrArgs:{scope:a,group:d}},{name:"Variable Switch",owner:b,iconClass:"el-icon-fork",proto:x,
target:c,ctrArgs:{scope:a,group:d}}]});l.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:k,group:"Flow"});return k};l._getLoopBlocks=function(a,b,h,k){var f=[];f.push({name:"Loops",iconClass:"el-icon-repeat",items:[{name:"While",owner:b,iconClass:"el-icon-repeat",proto:c,target:h,ctrArgs:{scope:a,group:k,condition:"[Volume]\x3c\x3d100"}},{name:"For",owner:b,iconClass:"el-icon-repeat",proto:d,target:h,ctrArgs:{scope:a,group:k,initial:"1",comparator:"\x3c\x3d","final":"5",modifier:"+1",counterName:"value"}}]});
l.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:f,group:"Loops"});return f};l._getMathBlocks=function(a,b,c,d){b=[];b.push({name:"Math",owner:this,iconClass:"el-icon-qrcode",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-compass",proto:h,item:c,ctrArgs:{scope:a,group:d}}]});return b};l._getTimeBlocks=function(a,b,c,d){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-qrcode",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-time",proto:h,item:c,ctrArgs:{scope:a,
group:d}}]});return b};l._getTransformBlocks=function(a,b,c,d){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-magic",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-time",proto:h,item:c,ctrArgs:{scope:a,group:d}}]});return b};return l})},"xblox/model/functions/StopBlock":function(){define(["dcl/dcl","xide/utils","xblox/model/Block"],function(l,q,n){return l(n,{declaredClass:"xblox.model.functions.StopBlock",command:"Select command please",icon:"",args:null,_timeout:100,hasInlineEdits:!0,
solve:function(e,g){if(this.command){var b=e.resolveBlock(this.command);if(b&&b.stop){var a=b.stop();this.onSuccess(this,g)}else this.onFailed(this,g);return a}},makeEditable:function(e,g,b,a,f){return'\x3ca tabIndex\x3d"-1" pos\x3d\''+g+"' display-mode\x3d'"+(f||"popup")+"' display-type\x3d'"+(b||"text")+"' data-prop\x3d'"+e+"' data-title\x3d'"+a+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[e]+"\x3c/a\x3e"},getFieldOptions:function(e){if("command"===e)return this.scope.getCommandsAsOptions("text")},
toText:function(){var e="Unknown",g=this.scope.getBlock(this.command);g&&(e=g.name);-1!==this.command.indexOf("://")&&(e='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Stop Command : "+e},onChangeField:function(e,g){},getFields:function(){var e=this.inherited(arguments)||this.getDefaultFields();e.push(q.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),
block:this,pickerType:"command",value:this.command}));return e}})})},"xblox/model/functions/PauseBlock":function(){define(["dcl/dcl","xide/utils","xide/types","dojo/Deferred","xblox/model/Block"],function(l,q,n,e,g){return l(g,{declaredClass:"xblox.model.functions.PauseBlock",command:"Select command please",icon:"",args:null,_timeout:100,hasInlineEdits:!0,solve:function(b,a){if(this.command){var f=b.resolveBlock(this.command);if(f&&f.pause){var e=f.pause();this.onSuccess(this,a)}else this.onFailed(this,
a);return e}},makeEditable:function(b,a,f,e,g,l,p){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+a+"' display-mode\x3d'"+(g||"popup")+"' display-type\x3d'"+(f||"text")+"' data-prop\x3d'"+b+"' data-title\x3d'"+e+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[b]+"\x3c/a\x3e"},getFieldOptions:function(b){if("command"===b)return this.scope.getCommandsAsOptions("text")},toText:function(){var b="Unknown",a=this.scope.getBlock(this.command);a&&(b=a.name);-1!==this.command.indexOf("://")&&(b='\x3cspan class\x3d"text-info"\x3e'+
this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Pause Command : "+b},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);b.push(q.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));return b}})})},"xblox/model/functions/SetProperties":function(){define("dcl/dcl xide/utils xide/types dojo/Deferred xblox/model/Block xide/lodash".split(" "),
function(l,q,n,e,g,b){return l(g,{declaredClass:"xblox.model.functions.SetProperties",command:"Select block",icon:"",args:null,_timeout:100,hasInlineEdits:!1,solve:function(a,b){var f=new e;if(this.command){var g=a.resolveBlock(this.command);if(g&&this.props){for(var l in this.props)g.set(l,this.props[l]),g[l]=this.props[l],g.onChangeField&&g.onChangeField(l,this.props[l]);this.onSuccess(this,b)}else this.onFailed(this,b);f.resolve([])}return f},makeEditable:function(a,b,e,g,l){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+
b+"' display-mode\x3d'"+(l||"popup")+"' display-type\x3d'"+(e||"text")+"' data-prop\x3d'"+a+"' data-title\x3d'"+g+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[a]+"\x3c/a\x3e"},getFieldOptions:function(a){if("command"===a)return this.scope.getCommandsAsOptions("text")},toText:function(){var a="Unknown",b=this.scope.getBlock(this.command);b&&(a=b.name);-1!==this.command.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");
return this.getBlockIcon("D")+"Set Properties : "+a},serializeObject:function(a){return"props"===a},onChangeField:function(a){"command"===a&&(delete this.props,this.props={})},init:function(){this.props&&b.isString(this.props)&&(this.props=q.fromJson(this.props))},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();a.push(q.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,
pickerType:"command",value:this.command}));var f=this.scope.resolveBlock(this.command);if(f&&f.getFields){this.props||(this.props={});var f=f.getFields(),e=b.find(f,{dst:"description"});f.remove(e);b.each(f,function(a){a.group="Properties";a.value=q.getAt(this.props,a.dst,a.value);a.dst="props."+a.dst},this);a=a.concat(f)}return a}})})},"xblox/model/server/RunServerMethod":function(){define(["dcl/dcl","xblox/model/server/ServerBlock","xide/utils"],function(l,q,n){return l(q,{declaredClass:"xblox.model.server.RunServerMethod",
description:"Runs a JSON-RPC-2.0 method on the server",name:"Run Server Method",method:"XShell::run",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onMethodChanged:function(e,g){this.method=e;if(!n.isValidString(this.args)){var b=this.getServerParams();b&&this._updateArgs(b,g)}},_getArgs:function(){var e=n.getJson(this.args||"[]"),g=[];if(e){var b=!1;e&&e[0]&&null!=e[0].optional&&(b=!0);if(b)for(b=0;b<e.length;b++){var a=e[b],f=a.value;-1!=a.name.indexOf("Base64")&&
(f=this.getService().base64_encode(f));"notset"!==a.value?-1!=a.value.indexOf("[")&&-1!=a.value.indexOf("]")?(f=this.scope.expressionModel.replaceVariables(this.scope,a.value,!1,!1),-1!=a.name.indexOf("Base64")&&(f=this.getService().base64_encode(f)),g.push(f)):g.push(f||a["default"]):g.push(a["default"]||f)}}else return[this.args];return g},_updateArgs:function(e,g){var b=this.utils.getCIWidgetByName(g,"args");if(b){var a=JSON.stringify(e);b.editBox.set("value",a);this.args=a}},getServerParams:function(){var e=
this.getService().getParameterMap(this.getServiceClass(),this.getServiceMethod());if(e)for(var g=0;g<e.length;g++)e[g].value="notset";return e},onReloaded:function(e){this._solve()},_solve:function(e,g,b,a){},solve:function(e,g,b,a){this._return=[];this._lastResult=null;e=[];if(!this.isInValidState())return this.onFailed(this,g),e;e=this._getArgs();this.onRun(this,g);this.getService();g=this.scope.serviceObject;console.error("run deferred");(g=g.runDeferred(this.getServiceClass(),this.getServiceMethod(),
e))&&g.then(function(a){console.error("returned ",a)});return g},toText:function(){var e=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(e+=this.method.substr(0,50));return e},canAdd:function(){return[]},getFields:function(){var e=this.inherited(arguments)||this.getDefaultFields(),g=this;e.push(n.createCI("value",25,this.method,{group:"General",title:"Method",dst:"method",description:"This should be in the format : MyServerClass::myMethod",delegate:{runExpression:function(b,a,f){g.method=b;
g.solve(g.scope,null,a,f)}}}));return e=e.concat(this.getServerDefaultFields())},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(e){return null!=this.items&&0<this.items.length},getChildren:function(e){return this.items},onChangeField:function(e,g,b){if("method"===e)this.onMethodChanged(g,b)},isInValidState:function(){return null!=this.getService()},getService:function(){var e=this.scope.getService();e||console.error("have no service object");
return e},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(e){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(e){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&
this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/server/ServerBlock":function(){define(["dcl/dcl","xblox/model/Block","xide/utils"],function(l,q,n){return l(q,{declaredClass:"xblox.model.server.ServerBlock",name:"Run Server Block",method:"XShell::run",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onReloaded:function(){},solve:function(e,g,b,a){this._currentIndex=0;this._return=
[];if((e=""+this.method)&&e.length){var f=new Function("{"+e+"}"),m=this.getArgs();try{var l=f.apply(this,m||{});this._lastResult=l;b&&b("Expression "+e+" evaluates to "+l);if("false"!==l&&!1!==l)this.onSuccess(this,g);else return this.onFailed(this,g),[]}catch(u){return a&&a("invalid expression : \n"+e+": "+u),this.onFailed(this,g),[]}}else console.error("have no script");b=this[this._getContainer()];if(b.length)this.runFrom(b,0,g);else this.onSuccess(this,g);return[]},toText:function(){var e=this.getBlockIcon()+
" "+this.name+" :: ";this.method&&(e+=this.method.substr(0,50));return e},canAdd:function(){return[]},getServerDefaultFields:function(e){e=e||[];e.push(n.createCI("args",27,this.args,{group:"General",title:"Arguments",dst:"args"}));return e},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(e){return null!=this.items&&0<this.items.length},getChildren:function(e){return this.items},isInValidState:function(){return null!=this.getService()},getService:function(){return this.scope.getService()},
getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(e){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(e){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&
this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/server/Shell":function(){define(["dcl/dcl","xblox/model/server/ServerBlock","xide/utils","xcf/model/Command"],function(l,q,n,e){return l([e,q],{declaredClass:"xblox.model.server.Shell",description:"Runs a JSON-RPC-2.0 method on the server",name:"Run Shell",method:"",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onMethodChanged:function(e,
b){this.method=e;if(!n.isValidString(this.args)){var a=this.getServerParams();a&&this._updateArgs(a,b)}},_getArgs:function(){var e=n.getJson(this.args||"[]"),b=[];if(e){var a=!1;e&&e[0]&&null!=e[0].optional&&(a=!0);if(a)for(a=0;a<e.length;a++){var f=e[a],m=f.value;-1!=f.name.indexOf("Base64")&&(m=this.getService().base64_encode(m));"notset"!==f.value?-1!=f.value.indexOf("[")&&-1!=f.value.indexOf("]")?(m=this.scope.expressionModel.replaceVariables(this.scope,f.value,!1,!1),-1!=f.name.indexOf("Base64")&&
(m=this.getService().base64_encode(m)),b.push(m)):b.push(m||f["default"]):b.push(f["default"]||m)}}else return[this.args];return b},_updateArgs:function(e,b){var a=this.utils.getCIWidgetByName(b,"args");if(a){var f=JSON.stringify(e);a.editBox.set("value",f);this.args=f}},getServerParams:function(){var e=this.getService().getParameterMap(this.getServiceClass(),this.getServiceMethod());if(e)for(var b=0;b<e.length;b++)e[b].value="notset";return e},solve:function(e,b,a,f,m,l){this._return=[];this._lastResult=
null;b=this._lastSettings=b||this._lastSettings;b=this.getInstance();e=e.expressionModel.replaceVariables(e,this.method,!1,!1);b.runShell(e,n.mixin({},{}),this.id,this.id,this)},toText:function(){var e=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(e+=this.method.substr(0,50));return e},canAdd:function(){return[]},getFields:function(){var e=this.inherited(arguments)||this.getDefaultFields(),b=this;e.push(n.createCI("value",25,this.method,{group:"General",title:"Cmd",dst:"method",delegate:{runExpression:function(a,
f,e){b.method=a;b.solve(b.scope,null,f,e)}}}));return e},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(e){return null!=this.items&&0<this.items.length},getChildren:function(e){return this.items},onChangeField:function(e,b,a){if("method"===e)this.onMethodChanged(b,a)},isInValidState:function(){return null!=this.getService()},getService:function(){var e=this.scope.getService();e||console.error("have no service object");return e},getServiceClass:function(){return this.method.split("::")[0]||
this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(e){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(e){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?
this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/mqtt/Subscribe":function(){define("dcl/dcl xdojo/has xblox/model/Block xide/utils xblox/model/Contains xide/types".split(" "),function(l,q,n,e,g,b,a,f){return l([n,g],{declaredClass:"xblox.model.mqtt.Subscribe",name:"Subscribe",topic:"Topic",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-bell",path:"",qos:0,stop:function(){var a=this.getInstance();a&&a.callMethod("unSubscribeTopic",e.mixin({topic:this.topic},
e.getJson(this.args||{})),this.id,this.id)},onData:function(a){if(a&&a.topic&&a.topic==this.topic){delete a.src;delete a.id;var b=this[this._getContainer()],f=this._lastSettings,g=[];if(0<b.length){var b=a,m=this.path&&this.path.length?this.path:null!==a.payload?"payload":null;m&&_.isObject(a)&&(b=e.getAt(a,m,a));for(a=0;a<this.items.length;a++)m=this.items[a],m.enabled&&(m.override={args:[b]},g.push(m.solve(this.scope,f)))}this.onSuccess(this,this._lastSettings);return g}},observed:["topic"],getContext:function(){return this.context||
(this.scope.getContext?this.scope.getContext():this)},solve:function(a,b){this._currentIndex=0;this._return=[];this._lastSettings=b;var f=this.getInstance();f&&f.callMethod("subscribeTopic",e.mixin({topic:this.topic,qos:this.qos},e.getJson(this.args||"{}")),this.id,this.id);b=b||{};this.onRunThis(b)},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+""+this.makeEditable("topic","bottom","text","Enter a topic","inline")+" :: \x3c/span\x3e";this.topic&&(a+=this.topic.substr(0,30));
return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();a.push(e.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));a.push(e.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(e.createCI("topic",b.ECIType.STRING,this.topic,{group:"General",title:"Topic",dst:"topic",select:!0}));a.push(e.createCI("name",b.ECIType.ENUMERATION,this.qos,{group:"General",title:"QOS",dst:"qos",widget:{options:[{label:"0 - at most once",
value:0},{label:"1 - at least once",value:1},{label:"2 - exactly once",value:2}]}}));a.push(e.createCI("path",b.ECIType.STRING,this.path,{group:"General",title:"Value Path",dst:"path"}));return a}})})},"xblox/model/mqtt/Publish":function(){define(["dcl/dcl","xdojo/has","xide/utils","xide/types","xcf/model/Command"],function(l,q,n,e,g,b,a){return l(g,{declaredClass:"xblox.model.mqtt.Publish",name:"Publish",topic:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-send",isCommand:!0,qos:0,retain:!1,
path:null,flags:0,onData:function(a){if(a&&a.topic&&a.topic==this.topic){this.getContext();var b=this[this._getContainer()],f=this._lastSettings,e=[];if(0<b.length)for(b=a,(this.path="value",_.isObject(a))&&(b=n.getAt(a,this.path,a)),a=0;a<this.items.length;a++){var g=this.items[a];g.enabled&&(g.override={args:[b]},e.push(g.solve(this.scope,f)))}this.onSuccess(this,this._lastSettings);return e}},observed:["topic"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():
this)},solve:function(a,b,g){this._currentIndex=0;this._return=[];b=this._lastSettings=b||this._lastSettings;var f=this.getInstance();!0===g&&this._loop&&this.reset();var m=this.args;g=this.getArgs(b);g[0]&&(m=g[0]);if(f){var l=b.flags||this.flags;g=!(l&e.CIFLAG.DONT_PARSE);l&=e.CIFLAG.EXPRESSION;m=n.getJson(m,!0,!1);null!==m&&0!==m&&!0!==m&&!1!==m&&_.isObject(m)||(m={payload:this.args});var d=a.expressionModel.replaceVariables(a,this.topic,!1,!1);if(m.payload&&_.isString(m.payload)&&g){var c=b.override||
this.override||{},k=c&&c.variables?c.variables:null;!1!==g&&(m.payload=n.convertAllEscapes(m.payload,"none"));l&&!1!==g&&(m.payload=a.parseExpression(m.payload,null,k,null,null,null,c.args))}f.callMethod("publishTopic",n.mixin({topic:d,qos:this.qos,retain:this.retain},m),this.id,this.id)}b=b||{};this.onDidRun();this.onSuccess(this,b);return!0},toText:function(a){a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.makeEditable("name","top","text","Enter a name","inline")+" :: \x3c/span\x3e";
this.topic&&(a+=this.makeEditable("topic","bottom","text","Enter a topic","inline"),this.startup&&(a+=this.getIcon("fa-bell inline-icon text-warning","text-align:right;float:right;","")),0<this.interval&&(a+=this.getIcon("fa-clock-o inline-icon text-warning","text-align:right;float:right","")));return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();a.push(n.createCI("qos",e.ECIType.ENUMERATION,this.qos,{group:"General",title:"QOS",dst:"qos",
widget:{options:[{label:"0 - at most once",value:0},{label:"1 - at least once",value:1},{label:"2 - exactly once",value:2}]}}));a.push(n.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(this.utils.createCI("flags",5,this.flags,{group:"Arguments",title:"Flags",dst:"flags",data:[{value:4096,label:"Dont parse",title:"Do not parse the string and use it as is"},{value:2048,label:"Expression",title:"Parse it as Javascript"}],widget:{hex:!0}}));a.push(n.createCI("topic",
e.ECIType.STRING,this.topic,{group:"General",title:"Topic",dst:"topic",select:!0}));a.push(n.createCI("retain",e.ECIType.BOOL,this.retain,{group:"General",title:"Retain",dst:"retain"}));a.remove(_.find(a,{name:"send"}));a.remove(_.find(a,{name:"waitForResponse"}));return a}})})},"xblox/model/File/ReadJSON":function(){define("dcl/dcl dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains xide/types xdojo/has!xblox-ui?xfile/data/DriverStore xdojo/has!xblox-ui?xfile/views/FileGridLight".split(" "),
function(l,q,n,e,g,b,a,f){function m(b,e,f){return new a({data:[],config:{},mount:"none",options:e,driver:f,micromatch:"(*.json)|!(*.*)",glob:b})}return l([n,g],{declaredClass:"xblox.model.File.ReadJSON",name:"Read JSON",deferred:!1,sharable:!1,context:null,icon:"fa-file",observed:["path"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},getFileContent:function(a){return this.getScope().ctx.getDeviceManager().getInstanceByName("File-Server").callCommand("GetProg",
{override:{args:[a]}})},processJSON:function(a,f){var g=this.jsonPath;this._lastResult=g?e.getAt(a,g):a;this.onSuccess(this,f);this.runByType(b.BLOCK_OUTLET.FINISH,f)},solve:function(a,b,f,g,d){this._currentIndex=0;this._return=[];b=this._lastSettings=b||this._lastSettings||{};f=""+this._get("path");var c=new q,k=this;this.onRunThis(b);a=a.expressionModel.replaceVariables(a,f,null,null);this.getFileContent(a).then(function(a){(a=a.content)&&(a=e.getJson(a,!0))&&k.processJSON(a,b)}.bind(this));try{g&&
g("Expression "+f+" evaluates to "+a)}catch(h){this.onDidRunItemError(c,h,b),this.onFailed(this,b),d&&d("invalid expression : \n"+f+": "+h)}return c},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.name+" :: \x3c/span\x3e";this.path&&(a+=this.path.substr(0,50));return a},canAdd:function(){return[]},getFields:function(){var g=this.inherited(arguments)||this.getDefaultFields(),l=this.getScope().ctx,p=l.getDeviceManager().getInstanceByName("File-Server"),n=e.clone(b.DEFAULT_FILE_GRID_PERMISSIONS);
p&&a&&(l={ctx:l,owner:this,selection:"/",resizeToParent:!0,Module:f,permissions:n},n={fields:b.FIELDS.SHOW_ISDIR|b.FIELDS.SHOW_OWNER|b.FIELDS.SHOW_SIZE|b.FIELDS.SHOW_FOLDER_SIZE|b.FIELDS.SHOW_MIME|b.FIELDS.SHOW_PERMISSIONS|b.FIELDS.SHOW_TIME|b.FIELDS.SHOW_MEDIA_INFO},l.leftStore=m("/*",n,p),l.rightStore=m("/*",n,p),g.push(e.createCI("path",4,this.path,{group:"General",title:"Path",dst:"path",filePickerOptions:l,widget:{item:this}})));g.push(e.createCI("jsonPath",13,this.jsonPath,{group:"General",
title:"Select",dst:"jsonPath"}));return g}})})},"xblox/embedded_ui":function(){define(["xblox/embedded","xblox/factory/Blocks","xide/widgets/ScriptWidget"],function(){})},"xblox/views/BlockGrid":function(){define("dojo/_base/declare xide/types xide/utils xide/factory xblox/views/Grid xide/layout/_Accordion xide/views/CIViewMixin xaction/DefaultActions dojo/dom-class dojo/Deferred xide/views/History".split(" "),function(l,q,n,e,g,b,a,f,m,v,u){function p(a){a.hightlightTimer&&(clearTimeout(a.hightlightTimer),
a.hightlightTimer=null)}var t=q.ACTION,t={highlightDelay:500,currentCIView:null,targetTop:null,lastSelectedTopTabTitle:"General",showHeader:!1,toolbarInitiallyHidden:!0,contextMenuArgs:{actionFilter:{quick:!0}},menuOrder:{File:110,Edit:100,View:90,Block:50,Settings:20,Navigation:10,Step:115,New:4,Window:1},permissions:[t.RELOAD,t.DELETE,t.CLIPBOARD,t.LAYOUT,t.COLUMNS,t.SELECTION,t.DOWNLOAD,t.SAVE,t.SEARCH,"Step/Run","Step/Move Up","Step/Move Down",t.TOOLBAR,"Step/Properties","Step/Edit","Step/Back",
"Step/Pause",t.HEADER,t.CONTEXT_MENU],tabOrder:{Home:100,View:50,Settings:20},tabSettings:{Step:{width:"190px"},Show:{width:"130px"},Settings:{width:"100%"}},groupOrder:{Clipboard:110,File:100,Step:80,Open:70,Organize:60,Insert:10,Select:0},options:n.clone(q.DEFAULT_GRID_OPTIONS),columns:[{renderExpando:!0,label:"Name",field:"name",sortable:!1,formatter:function(a,b){var c="";return b.toText?(c=b.toText(),'\x3cspan class\x3d"" style\x3d"width: 95%;"\x3e'+c+"\x3c/span\x3e"):a}}],getTypeMap:function(){return{}},
getBlock:function(a){return this.blockScope.getBlockById(a)},formatOrder:function(a,b){if(b){var c=b.getParent(),d=b.index();if(c){for(var c=b.numberOfParents(),f="\x26nbsp;",e=0;e<c;e++)f+="\x26nbsp;";f+="";for(e=0;e<c;e++)f+="-"}else return"\x26nbsp;"+d;return f+"\x26nbsp;"+d}return""},focus:function(a){if(a)return this.inherited(arguments)},postMixInProperties:function(){var a=!1,b=this;_.each(this.columns,function(b){"order"==b.field&&(a=!0)});a||"basicVariables"===this.blockGroup||this.columns.unshift({label:"Line",
field:"order",sortable:!1,hidden:!1,formatter:function(a,c){return b.formatOrder(a,c,b)}});this.inherited(arguments)},renderRow:function(a){if(this.collection){var b=this.inherited(arguments);0==a.enabled&&m.add(b,"disabledBlock");var d=$(b),h=a.getScope(),h=h?h.id:null;if(a.getStatusClass&&h){var h=a.getStatusClass(h),e=$(b);h&&!e[0].hightlightTimer&&this.mark($(b),h.className,a,h.delay)}if(a.hasInlineEdits){if(d.__inline)return;d.__inline=!0;d=d.find(".editable");_.each(d,function(b){b.object=a;
b=$(b);var c=b.attr("data-prop"),d=b.attr("display-type")||"text",c=a.getFieldOptions?a.getFieldOptions(c):null,d={type:d,placement:b.attr("pos")||"right",mode:b.attr("display-mode")||"popup",title:b.prop("data-title"),inputclass:"input-transparent",success:function(a,b){var c=$(this).attr("data-prop");this.object.set(c,b)}};c&&(d.source=c);b.editable(d);b.attr("tabIndex","-1")})}return b}},getCurrentParent:function(){var a=this.getHistory().getNow();return a?this.getBlock(a):null},addItem:function(a,
b){if(!a)return!1;b=b||{};var c=this.getSelection()[0],d=a.proto||b.proto,f=a.ctrArgs||b.ctrArgs,g=null,m=null;c||(c=this.getCurrentParent());if(!c){var l=this.getSelection()[0];l&&(c=l)}f&&(f.id&&(f.id=n.createUUID()),f.parent&&(f.parent=null),f.parentId&&(f.parentId=null),f.items&&(f.items=[]));c&&d&&f?(c.owner&&c.dstField&&(g=c.dstField,c=c.owner),f.parentId=c.id,f.group=null,f.parent=c,m=c.add(d,f,g),m.parent=c):!c&&d&&f&&("No Group"===f.group&&this.newRootItemGroup&&(f.group=this.newRootItemGroup),
!f.group&&this.newRootItemGroup&&(f.group=this.newRootItemGroup),!f.group&&this.blockGroup&&(f.group=this.blockGroup),f.group&&this.newRootItemGroup&&f.group!==this.newRootItemGroup&&(f.group=this.newRootItemGroup),m=e.createBlock(d,f));m&&m.postCreate&&m.postCreate();if(m){c=this.getStore(c)||this.collection;d=c.getSync(m[c.idProperty]);d||(console.error("new block not in store"),c.putSync(m));try{m.scope._emit(q.EVENTS.ON_ITEM_ADDED,{item:m,owner:m.scope})}catch(D){logError(D)}this._itemChanged("added",
m,c);return d}console.error("didnt create block")},_itemChanged:function(a,b,f){function c(a,b){d.select(a,null,!0,{focus:!0,delay:1,append:!1,expand:!0},b)}f=f||this.getStore(b);var d=this;switch(a){case "added":d.refreshRoot();d.refresh();d.refreshCurrent();c(b);break;case "deleted":a=b.getParent();f=b.getPreviousBlock()||b.getNextBlock()||a;if(a){var e=a.getContainer();e&&_.each(e,function(a){a.id==b.id&&e.remove(a)})}this.refresh();f&&c(f)}},printRootOrder:function(a){a=a||this.collection.storage.fullData;
_.each(a,function(a,b){})},refreshAll:function(a){a||this._preserveSelection();this.refreshRoot();this.refresh();a||this._restoreSelection();var b=this;a&&setTimeout(function(){b.select(a,null,!0,{focus:!0})},30)},getStore:function(a){return a&&(_.isArray()&&(a=a[0]),a._store)?a._store:null},refreshRoot:function(){return this.set("collection",this.collection.filter(this.getRootFilter()))},refresCurrent:function(){return this.set("collection",this.collection.filter(this.getRootFilter()))},getRootFilter:function(){return{group:this.blockGroup}},
_onCIChanged:function(a,b,f,h,e){},clearPropertyPanel:function(){var a=this.getPropertyStruct();a.currentCIView&&(a.currentCIView.empty(),a.currentCIView=null);a.targetTop&&(n.destroy(a.targetTop,!0),a.targetTop=null);a._lastItem=null;this.setPropertyStruct(a)},getState:function(a){a=this.inherited(arguments)||{};var b=this.getRightPanel();a.properties=b.isExpanded();return a},onCIChanged:function(a,b,f,h,e,g){f!==h&&(a=this.collection,b=this.collection.getSync(b.id),b.set(e,h),this.refreshActions(),
b[e]=h,a.emit("update",{target:b,type:"update"}),b._store.emit("update",{target:b}),this._itemChanged("changed",b,a),b.onChangeField(e,h,g,this),(h=this.cell(b.id,"1"))&&h.column&&this.refreshCell(h).then(function(a){}),"enabled"===e&&this.refresh(),this._itemChanged("changed",b,a))},onShowProperties:function(a){var b=this._console;if(b&&a){var d=a.send||a.method;b.getConsoleEditor().set("value",d);this._lastConsoleItem=a}},showProperties:function(d,c){function f(a,b){if(a){var c=a.title;b?l.lastSelectedTopTabTitle=
c:b||l.lastSelectedTopTabTitle!==c||(l.lastSelectedTopTabTitle=null)}}var h=new v,e=d||this.getSelection()[0],g=this,m=g.getPanelSplitPosition(q.DOCKER.DOCK.RIGHT);if(e&&1!=m&&!1!==e.canEdit()){m=this.getRightPanel("Properties",null,"DefaultTab",{});m.closeable(!1);var l=this.getPropertyStruct();if(e!=l._lastItem||!0===c){this.clearPropertyPanel();l=this.getPropertyStruct();l._lastItem=d;var p=l.targetTop;p||(p=n.addWidget(b,{},null,m.containerNode,!0),$(p.domNode).addClass("CIView Accordion"),l.targetTop=
p,g.addHandle("show",p._on("show",function(a){f(a.view,!0)})),g.addHandle("hide",p._on("hide",function(a){f(a.view,!1)})));_.each(p.getChildren(),function(a){p.removeChild(a)});l.currentCIView&&l.currentCIView.empty();if(e.getFields){for(var m=e.getFields(),t=0;t<m.length;t++)m[t].vertical=!0;t=new a({typeMap:g.getTypeMap(),tabContainerClass:b,tabContainer:l.targetTop,delegate:this,viewStyle:"padding:0px;",autoSelectLast:!0,item:e,source:this.callee,options:{groupOrder:{General:1,Advanced:2,Script:3,
Arguments:4,Description:5,Share:6}},cis:m});t.initWithCIS(m);l.currentCIView=t;if(e.onFieldsRendered)e.onFieldsRendered(e,m);g.addHandle("valueChanged",t._on("valueChanged",function(a){setTimeout(function(){g.onCIChanged&&g.onCIChanged(a.ci,e,a.oldValue,a.newValue,a.ci.dst)},10)}));p.getTab(l.lastSelectedTopTabTitle)?p.selectChild(l.lastSelectedTopTabTitle,!0):l.lastSelectedTopTabTitle=null;this.setPropertyStruct(l);this.onShowProperties(e);return h}}}},onSelectionChanged:function(a,b){var c=a.selection[0],
d=this,f=this.ctx,e=d.getActionStore(),g=this.getContextMenu(),m=this.getToolbar(),f=f.getWindowManager().getToolbar(),l=c&&c.getActions?c.getActions():null,p=this.getAction("Step/Enable");c&&(p.value=c.enabled);(c=e.query({global:!0}))&&!l&&(l=[]);_.each(c,function(a){(a=a.getActions?a.getActions(d.permissions,d):null)&&a.length&&(l=l.concat(a))});g&&g.removeCustomActions();m&&m.removeCustomActions();f&&f.removeCustomActions();l&&!_.isEmpty(l)&&(g=this.addActions(l),e._emit("onActionsAdded",g))},
startup:function(){if(!this._started){this.inherited(arguments);this._history=new u;this.propertyStruct||(this.propertyStruct={currentCIView:null,targetTop:null,_lastItem:null});this._dontSubscribeToHighligt=!0;$(this.domNode).addClass("blockGrid");var a=this,b=this.permissions||[],e=f.getDefaultActions(b,this),e=e.concat(this.getBlockActions(b));this.addActions(e);f.hasAction(b,"Step/Properties")&&this._on("selectionChanged",function(b){var c=b.selection[0];clearTimeout(a._propsTimer);a._propsTimer=
null;c?a._propsTimer=setTimeout(function(){a.getPropertyStruct();a.showProperties(c)},500):c||"clear"!=b.why||a.clearPropertyPanel();b.view=a;c&&a.publish("ON_SELECTED_BLOCK",b)});this.addHandle("update",this.collection.on("update",function(b){var c=b.target;"update"===b.type&&"value"===b.property&&(b=a.toNode(b))&&a.mark(b,"successBlock",c)}));this.addHandle("added",this.collection._on("added",function(b){a._refreshTimer||(a._refreshTimer=setTimeout(function(){a.refresh();delete a._refreshTimer;
a._refreshTimer=null;b.target&&a.select(b.target,null,!0,{focus:!0,append:!1,expand:!0,delay:10})},10))}));this.addHandle("update",this.collection._on("update",function(b){var c=b.target,d=a.toNode(b);"update"===b.type&&"value"===b.property&&a.mark(d,"successBlock",c)}));this.subscribe(q.EVENTS.ON_RUN_BLOCK,function(b){a.mark(a.toNode(b),"activeBlock",b.target,b.timeout)});this.subscribe(q.EVENTS.ON_RUN_BLOCK_FAILED,function(b){a.mark(a.toNode(b),"failedBlock",b.target,b.timeout)});this.subscribe(q.EVENTS.ON_RUN_BLOCK_SUCCESS,
function(b){a.mark(a.toNode(b),"successBlock",b.target,b.timeout)});this._on("selectionChanged",this.onSelectionChanged,this);this.publish("ON_BLOCK_GRID",{view:this});this.setRenderer(this.selectedRenderer,!1)}},removeRow:function(a,b){(a=a.element||a)&&a.hightlightTimer&&!1===b&&p(a);return this.inherited(arguments)},mark:function(a,b,f,e){if(a&&this.isRendered(f)&&(f=f||{},!1!==this._highlight&&!0!==f.__ignoreChangeMark&&(e=0==e?!1:this.highlightDelay||500,a[0]._currentHighlightClass!==b))){delete a[0]._currentHighlightClass;
a[0]._currentHighlightClass=null;a[0]._currentHighlightClass=b;var c=f.getScope().id;a.removeClass("failedBlock successBlock activeBlock");a.addClass(b);f.setStatusClass(c,{className:b,delay:e});p(a[0]);!1!==e&&0<e&&(a[0].hightlightTimer=setTimeout(function(){a.removeClass(b);a.removeClass("failedBlock successBlock activeBlock");f.setStatusClass(c,null);delete a[0]._currentHighlightClass;a[0]._currentHighlightClass=null},e))}},toNode:function(a){if(a=a.target||a)if(a=this.row(a))if(a=a.element)return $(a);
return null}};l=l("xblox.views.BlockGrid",g,t);l.IMPLEMENTATION=t;return l})},"xblox/views/Grid":function(){define("xdojo/declare xide/types xgrid/ListRenderer xgrid/TreeRenderer xblox/views/ThumbRenderer xgrid/Grid xgrid/MultiRenderer xide/views/_LayoutMixin xgrid/Defaults xgrid/Layout xgrid/Focus xgrid/KeyboardNavigation dgrid/OnDemandGrid xide/mixins/EventedMixin xide/utils xblox/BlockActions xgrid/Search xide/widgets/_Widget xblox/views/DnD".split(" "),function(l,q,n,e,g,b,a,f,m,v,u,p,t,d,c,k,
h,r,w){g=[e,g];l=l.classFactory("multiRenderer",{},g,a.Implementation);q=b.createGridClass("xblox.views.Grid",{options:c.clone(q.DEFAULT_GRID_OPTIONS)},{SELECTION:!0,KEYBOARD_SELECTION:!0,PAGINATION:!1,ACTIONS:q.GRID_FEATURES.ACTIONS,CONTEXT_MENU:q.GRID_FEATURES.CONTEXT_MENU,TOOLBAR:q.GRID_FEATURES.TOOLBAR,CLIPBOARD:q.GRID_FEATURES.CLIPBOARD,COLUMN_RESIZER:q.GRID_FEATURES.COLUMN_RESIZER,SPLIT:{CLASS:f},BLOCK_ACTIONS:{CLASS:k},DND:{CLASS:w},KEYBOARD_NAVIGATION:{CLASS:p},SEARCH:{CLASS:h},WIDGET:{CLASS:r}},
{RENDERER:l},{renderers:g,selectedRenderer:e},{GRID:t,LAYOUT:v,DEFAULTS:m,RENDERER:n,EVENTED:d,FOCUS:u});q.DEFAULT_RENDERERS=g;q.DEFAULT_MULTI_RENDERER=l;return q})},"xblox/views/ThumbRenderer":function(){define(["xdojo/declare","xide/utils","dojo/dom-construct","xgrid/ThumbRenderer","xide/$"],function(l,q,n,e,g){return l("xblox.views.ThumbRenderer",[e],{thumbSize:"400",resizeThumb:!0,deactivateRenderer:function(){g(this.domNode.parentNode).removeClass("metro");g(this.domNode).css("padding","");this.isThumbGrid=
!1},activateRenderer:function(){g(this.domNode.parentNode).addClass("metro");g(this.contentNode).css("padding","8px");this.isThumbGrid=!0;this.refresh()},renderRow:function(b){if(b.renderRow){var a=b.renderRow.apply(this,[b]);if(a)return a}var a=n.create("div",{className:"tile widget"}),f=!1===b.read&&!1===b.write,e=".."==b.name,l=!1,q="",p=b.icon?b.icon+" fa-5x":"fa fa-folder fa-5x";this._doubleWidthThumbs=!0;p=e?"fa fa-level-up fa-5x itemFolder":f?"fa fa-lock fa-5x itemFolder":"fa fa-folder fa-5x itemFolder";
l=!0;q=b.name;p=b.icon?b.icon+" fa-5x":"fa fa-folder fa-5x";b='\x3cdiv title\x3d"'+(q+"\n"+b.modified)+'" class\x3d"tile-content icon"\x3e'+('\x3cspan style\x3d"text-shadow: 2px 2px 5px rgba(0,0,0,0.3);font-size: 72px;opacity: 0.7" class\x3d"fa fa-6x '+p+'"\x3e\x3c/span\x3e')+'\x3c/div\x3e\x3cdiv class\x3d"brand opacity"\x3e\x3cspan class\x3d"thumbText text opacity ellipsis" style\x3d""\x3e'+q+"\x3c/span\x3e\x3c/div\x3e";this._doubleWidthThumbs&&g(a).addClass("double");if(l)return a.innerHTML=b,a;
a.innerHTML=b;return a}})})},"xblox/BlockActions":function(){define("xdojo/declare xdojo/has xide/utils xide/types xaction/DefaultActions xide/factory dojo/promise/all dojo/Deferred xide/views/History xfile/views/FilePreview xblox/views/BlockEditView xide/views/_CIPanelDialog xide/mixins/Electron xblox/model/variables/VariableAssignmentBlock xcf/model/Variable".split(" "),function(l,q,n,e,g,b,a,f,m,v,u,p,t,d,c){var k={};l=l("xblox.BlockActions",[t],{clipboardCopy:function(){this.currentCutSelection=
null;this.currentCopySelection=this.getSelection();k=null;k=this.currentCopySelection;var a=this.getClipboard();if(a){var b=this.blockScope.blocksToJson(this.currentCopySelection),b=JSON.stringify(b,null,2);a.writeText(b)}},download:function(){var a=this.blockScope.blocksToJson(),a=JSON.stringify(a,null,2);n.download("blocks.json",a)},save:function(){var a=this.userData.driver,b=this.ctx.getFileManager(),c=this.blockScope,f=a.path.replace(".meta.json",".xblox"),a=a.scope;c&&b.setContent(a,f,c.toString(),
function(){})},propertyStruct:{currentCIView:null,targetTop:null,_lastItem:null},getPropertyStruct:function(){return this.propertyStruct},setPropertyStruct:function(a){this.propertyStruct=a},onDrop:function(a,c,f,d,e,k){d=a.ctrArgs||{};var h=a.proto,r=!1;a.ctrArgs&&(d.scope=d.scope||c.scope,d.group=d.group||c.group,d.parentId=d.parentId||c.id,r=!0);if(r)c.parentId||k?k&&c.canAdd&&null!=c.canAdd()&&c.add(h,d,null):(d.parentId=null,b.createBlock(h,d));else if("Moved"===e&&a.scope&&c.scope&&a.scope==
c.scope)return a.group=null,c.scope.moveTo(a,c,f,k),a},_paste:function(a,b,c){if(a){var d=this.getSelection()[0],f,e=this.blockScope;if(b){if(!d){for(c=0;c<a.length;c++)d=a[c],d.parentId&&(d._parentOri=""+d.parentId,d.parentId=null);c=e.flatten(a);c=_.uniq(c,!1,function(a){return a.id});b=e.cloneBlocks2(c,this.newRootItemGroup);e.flatten(b);d=null;for(c=0;c<b.length;c++)e=b[c],d||(d=e);for(c=0;c<a.length;c++)d=a[c],d._parentOri&&(d.parentId=d._parentOri,delete d._parentOri);return b}f=a[0].scope;
if(f==d.scope){var h=d.canAdd()||!1,k=f.getBlockById(d.parentId);k||(k=d);c=e.flatten(a);c=_.uniq(c,!1,function(a){return a.id});a=f.cloneBlocks2(c);e=[];for(c=0;c<a.length;c++)f=a[c],f.parentId||(f.parentId=k.id,k.add(f),f=this.onDrop(f,d,!1,b,"Moved",h)),e.push(f);return e}}}},paste:function(a,b,c){if(a){var d=this.getSelection()[0],f,e=this.blockScope;if(b){if(!d){for(c=0;c<a.length;c++)d=a[c],d.parentId&&(d._parentOri=""+d.parentId,d.parentId=null);c=e.flatten(a);c=_.uniq(c,!1,function(a){return a.id});
b=e.cloneBlocks2(c,this.newRootItemGroup);e.flatten(b);d=null;for(c=0;c<b.length;c++){var k=b[c];d||(d=k)}for(c=0;c<a.length;c++)d=a[c],d._parentOri&&(d.parentId=d._parentOri,delete d._parentOri);return b}var h=a[0].scope,k=d.scope;if(h==k){var r=d.canAdd()||!1,g=h.getBlockById(d.parentId);g||(g=d);c=e.flatten(a);a=h.cloneBlocks2(c);e=[];h=d.getTopRoot();for(c=0;c<a.length;c++){f=a[c];f.getTopRoot();if(f.parentId&&!h){var m=k.getBlockById(f.parentId);m&&_.find(a,{id:m.id})||(f.parentId=null)}f.parentId&&
h&&(m=f.getTopRoot(),m.id&&h.id&&m.id!==d.id&&(f.parentId=null));f.parentId||(f.parentId=g.id,g.add(f),f=this.onDrop(f,d,!1,b,"Moved",r));e.push(f)}return e}}}},defaultActionResult:function(a){var b=new f;b.resolve({focus:!0,append:!1,delay:0,select:a,expand:!0});return b},setParentBlock:function(a){a=_.isString(a)?this.collection.getSync(a):a;this.set("collection",this.collection.filter({parentId:a.id}));this.getHistory().push(a.id)},refreshCurrent:function(){var a=this.getHistory().getNow();a&&
this.setParentBlock(a)},runAction:function(a){a=this.getAction(a);if(!a)return null;var d=this.getSelectedRenderer();if(d=d&&d.runAction?d.runAction.apply(this,[a]):null)return d;try{d=function(a,d,e){var k=new f;e=null;e=a==c?b.createBlock(a,{name:"No Title",scope:g.blockScope,group:d}):g.addItem({proto:a,ctrArgs:{scope:g.blockScope,group:d}});var h={select:[e],focus:!0,append:!1};(a=g.refresh())&&a.then&&a.then(function(){k.resolve(h)});g.grids?_.each(g.grids,function(a){a&&a.refreshRoot&&(a.refreshRoot(),
a.refresh(),a.refreshCurrent())}):g.refreshRoot&&(g.refreshRoot(),g.refresh(),g.refreshCurrent());return k};if(-1!==a.command.indexOf("Step/Insert"))return this.addItem(a.item,a);var k=this.getSelection(),h=k[0],g=this;if(a.command==e.ACTION.DOWNLOAD)return this.download();switch(a.command){case "File/Delete":return this.deleteBlock(k);case "File/Reload":return this.refresh();case "Step/Run":return this.execute(k);case "Step/Stop":return this.stop(k);case "Step/Pause":return this.pause(k);case "Step/Back":return this.goBack();
case "Step/Move Left":return this.reParentBlock(-1);case "Step/Move Right":return this.reParentBlock(1);case "Step/Move Up":return this.move(-1),this._itemChanged("moved",h);case "Step/Move Down":return this.move(1),this._itemChanged("moved",h);case "Step/Edit":return this.editBlock();case "Step/Open":return this.openBlock();case "New/Variable":return d(c,"Variables");case "File/Select/None":return this.deselectAll();case "Step/Enable":return _.each(k,function(a){a&&(a.enabled=!a.enabled);a.enabled?
a.activate():a.deactivate();a.set("enabled",a.enabled)}),this.refreshRoot(),this.refreshCurrent(),this.defaultActionResult(k);case "View/Show/Properties":var m=new f,l=this.getRightPanel();(function(){var a=l.getSplitter();if(a){if(a.isCollapsed())return a.expand(),!0;l.collapse();return!1}})()&&this.showProperties(h);m.resolve({focus:!0,append:!1,delay:500,select:k});this.onAfterAction("View/Show/Properties");return m;case "Step/Help":return this.showHelp(h)}}catch(C){logError(C)}return this.inherited(arguments)},
reParentBlock:function(a){var b=this.getSelection()[0];if(!b)return!1;-1==a?b.unparent(this.blockGroup):b.reparent();this.deselectAll();this.refreshRoot();this.refreshCurrent();a=new f;a.resolve({focus:!0,append:!1,delay:100,select:b,expand:!0});return a},move:function(a){var b=this.getSelection();if(b&&b.length){var c=this;_.each(b,function(b){b.move(a)}.bind(this));c.refresh();this.select(b,null,!0,{focus:!0,delay:10}).then(function(){c.refreshActions()})}},clipboardPaste:function(){var a=this.currentCopySelection||
this.currentCutSelection||k,b=this.getClipboard();if(b&&(!a||!a[0])&&(b=b.readText()))try{var c=JSON.parse(b);if(c&&c.length){var d=this.blockScope.owner.getScope(n.createUUID(),null,!1).blocksFromJson(c);d&&d.length&&(a=d)}}catch(B){logError(B,"clipboard extraction from electron failed")}if(a&&a[0])return a=this.paste(a,this,null!=this.currentCutSelection),c=new f,a&&(this.refreshRoot(),this.refreshCurrent(),c.resolve({focus:!0,append:!1,delay:2,select:a,expand:!0})),c},deleteBlock:function(a){var b=
a[0],c=b.getParent(),b=b.next(null,-1)||b.next(null,1)||c;_.each(a,function(a){if(!a)return!1;a.remove&&a.remove();a.destroy&&a.destroy();var b=this.getStore(a);b&&(b.getSync(a[b.idProperty]),b.removeSync(a[b.idProperty]));a._destroyed=!0;a.scope._emit(e.EVENTS.ON_ITEM_REMOVED,{item:a});return!0},this);this.refreshRoot();this.refreshCurrent();a=new f;a.resolve({focus:!0,append:!1,select:b});return a},editBlock2:function(a,b,c){function d(b){_.each(b,function(b){f.onCIChanged&&f.onCIChanged(b.ci,a,
b.oldValue,b.newValue,b.ci.dst,e,b.props)});k.showProperties(a,!0)}if(a&&a.canEdit()){var f=this;b="Edit "+a.name;var e=a.getFields(),k=this;return(new p({title:b,containerClass:"CIDialog",onOk:function(a){d(a);this.headDfd.resolve(a)},onCancel:function(a){this.headDfd.resolve(a)},cis:e,CIViewClass:u,CIViewOptions:{delegate:this,resizeToParent:!0,ciSort:!0,options:{groupOrder:{General:1,Send:2,Advanced:4,Description:5}},cis:e}})).show()}},_getText:function(a){q("debug")&&(a+="?time\x3d"+(new Date).getTime());
try{var b;dojo.xhrGet({url:a,sync:!0,handleAs:"text",cache:!1,load:function(a){b=a}});return b||"No help avaiable"}catch(w){return!1}},_helpCache:{},getHelp:function(a){a=n.replaceAll(".","/",a.declaredClass);a=a.replace("xcf","xblox");a="xblox/docs/"+a.replace("xblox/model/","");var b=this._helpCache[a];if(!1===b)return!1;if(_.isString(b))return b;b=this._getText(require.toUrl(a)+".md");if(!b)return!1;"undefined"!==typeof showdown&&(b=(new showdown.Converter).makeHtml(b));return this._helpCache[a]=
b},showHelp:function(a,b){function c(a,b){var c=f.getHelp(b);c&&a.html(c);a.addClass("xbloxHelp")}var d=this.row(a).element,f=this;if(this._preview)this._preview.open(),c(this._preview.preview,a);else{var e=new v({node:$(d),parent:$(d),ctx:f.ctx,container:b?b.containerNode:null,title:"Help"});b?e.buildRenderingEmbedded():e.buildRendering();e.init();e.exec();this._preview=e;this._preview.handler=this;e.onOpened=function(){c(e.preview,a)};this.add(e);f._on("selectionChanged",function(a){0!=f._preview.getstate()&&
(a=f.getSelectedItem())&&(e.item=a,c(f._preview.preview,a))})}},getHistory:function(){this._history||(this._history=new m);return this._history},goBack:function(){function a(a){g.resolve({select:a?a:k.getRows()[0],focus:!0,append:!1,delay:250})}var b=this.collection,c=this.getHistory(),d=null,e=c.getNow(),k=this,g=new f;c.pop();(d=c.getNow())&&b.getSync(d)?(this.set("collection",this.collection.filter({parentId:d})),a()):(b.reset(),this.refreshRoot(),a(b.getSync(e)));return g},openBlock:function(a,
b,c){if(a=this.getSelection()[0]||a){b=new f;var d=this;this.setParentBlock(a);c=!0;(a=d.getRows()[0])||setTimeout(function(){d.contentNode.focus()},10);b.resolve({select:!1!==c?a:null,focus:!0,append:!1,delay:1});return b}},editBlock:function(a,b,c){if(a=this.getSelection()[0]||a){var d=new f;a.getChildren();if(b=this.editBlock2(a,null))return b.then(function(){d.resolve({select:[a],focus:!0,append:!1,delay:1})}),d;d.resolve()}},execute:function(b){var c=this,d=[],f=[],k=e.EVENTS;b=_.isArray(b)?
b:[b];_.each(b,function(a){var b=a._on(k.ON_RUN_BLOCK,function(b){c.mark(c.toNode(b),"activeBlock",a)}),e=a._on(k.ON_RUN_BLOCK_SUCCESS,function(b){c.mark(c.toNode(b),"successBlock",a)}),h=a._on(k.ON_RUN_BLOCK_FAILED,function(b){c.mark(c.toNode(b),"failedBlock",a)});if(a&&a.scope){try{var g=a.scope.solveBlock(a,{highlight:!0,force:!0,listener:c});d.push(g)}catch(A){logError(A,"excecuting block -  "+a.name+" failed! : ")}f=f.concat([b,h,e]);return!0}console.error("have no scope")});a(d).then(function(){_.invoke(f,
"remove")})},stop:function(a){a=_.isArray(a)?a:[a];_.each(a,function(a){if(a&&a.scope){try{a.stop(!1)}catch(w){logError(w,"stop block -  "+a.name+" failed! : ")}return!0}console.error("have no scope")})},pause:function(a){a=_.isArray(a)?a:[a];_.each(a,function(a){if(a&&a.scope){try{a.pause(!0)}catch(w){logError(w,"pause block -  "+a.name+" failed! : ")}return!0}console.error("have no scope")})},getAddActions:function(a){var c=this.inherited(arguments)||[];a=a||{};c=b.getAllBlocks(this.blockScope,
this,a,this.blockGroup,!1);this.publish(e.EVENTS.ON_BUILD_BLOCK_INFO_LIST_END,{items:c,view:this,owner:this.owner,item:a,group:this.blockGroup,scope:this.blockScope});this._emit(e.EVENTS.ON_BUILD_BLOCK_INFO_LIST_END,{items:c,view:this,owner:this.owner});return c},getBlockActions:function(a){function b(){var a=m.getSelection();return a&&a.length&&a[0]?a:null}function c(){return b()?!1:!0}function f(){var a=b();if(!a)return!0;a=a[0];return"Step/Move Up"===this.command?!a.canMove(null,-1):!a.canMove(null,
1)}function k(a,b){for(var c=0;c<b.length;c++){var d=b[c];t=d.name;var f=a+"/"+t,e=!_.isEmpty(d.items);h.push(m.createAction({label:t,command:f,icon:d.iconClass,tab:"Home",group:"Insert",mixin:n.mixin({item:d,quick:!0},p)}));e&&k(f,d.items)}}var h=this.inherited(arguments)||[],g=e.ACTION_ICON,m=this,l=m.getActionStore(),p={addPermission:!0};h.push(m.createAction({label:"Save",command:"File/Save",icon:"fa-save",tab:"Home",group:"File",keycombo:["ctrl s"],mixin:n.mixin({quick:!0},p)}));h.push(m.createAction({label:"Save As",
command:"File/Save As",icon:"fa-save",tab:"Home",group:"File",mixin:p}));h.push(this.createAction({label:"Open",command:"Step/Open",icon:"fa-folder-open",keycombo:["ctrl enter"],tab:"Home",group:"Navigation",shouldDisable:c,mixin:n.mixin({quick:!0},p)}));h.push(m.createAction({label:"Go up",command:"Step/Back",icon:g.GO_UP,tab:"Home",group:"Navigation",keycombo:["backspace"],mixin:{quick:!0}}));h.push(m.createAction({label:"Run",command:"Step/Run",icon:"text-success fa-play",tab:"Home",group:"Step",
keycombo:["r"],shouldDisable:c,mixin:n.mixin({quick:!0},p)}));h.push(m.createAction({label:"Stop",command:"Step/Stop",icon:"text-warning fa-stop",tab:"Home",group:"Step",keycombo:["s"],shouldDisable:c,mixin:n.mixin({quick:!0},p)}));h.push(m.createAction({label:"Pause",command:"Step/Pause",icon:"text-info fa-pause",tab:"Home",group:"Step",keycombo:["p"],shouldDisable:c,mixin:n.mixin({quick:!0},p)}));h.push(m.createAction({label:"MoveUp",command:"Step/Move Up",icon:"text-info fa-arrow-up",tab:"Home",
group:"Move",keycombo:["alt up"],shouldDisable:f,mixin:n.mixin({quick:!0},p)}));h.push(m.createAction({label:"MoveDown",command:"Step/Move Down",icon:"text-info fa-arrow-down",tab:"Home",group:"Move",keycombo:["alt down"],shouldDisable:f,mixin:n.mixin({quick:!0},p)}));h.push(m.createAction({label:"MoveLeft",command:"Step/Move Left",icon:"text-info fa-arrow-left",tab:"Home",group:"Move",keycombo:["alt left"],shouldDisable:f,mixin:n.mixin({quick:!0},p)}));h.push(m.createAction({label:"MoveRight",command:"Step/Move Right",
icon:"text-info fa-arrow-right",tab:"Home",group:"Move",keycombo:["alt right"],shouldDisable:function(){var a=m.getSelection();return a?(a=a[0])?"Step/Move Left"===this.command?!a.getParent():a.getParent():!0:!0},mixin:n.mixin({quick:!0},p)}));h.push(m.createAction({label:"Help",command:"Step/Help",icon:"fa-question",tab:"Home",group:"Step",keycombo:["h"],shouldDisable:c,mixin:p}));h.push(m.createAction({label:"On",command:"Step/Enable",icon:"fa-toggle-off",tab:"Home",group:"Step",keycombo:["alt o"],
shouldDisable:c,mixin:n.mixin({actionType:"multiToggle",quick:!0},p),onCreate:function(a){a.value=!0;a.setVisibility(e.ACTION_VISIBILITY.RIBBON,{group:"Common"})},onChange:function(a,b){var c=m.getSelectedItem();c&&c.set("enabled",b);this.value=b;m.refreshActions()}}));h.push(this.createAction({label:"Variable",command:"New/Variable",icon:"fa-code",tab:"Home",group:"Insert",mixin:n.mixin({quick:!0},p)}));h.push(this.createAction({label:"Edit",command:"Step/Edit",icon:g.EDIT,keycombo:["f4","enter",
"dblclick"],tab:"Home",group:"Step",shouldDisable:c,mixin:n.mixin({quick:!0},p)}));h.push(m.createAction({label:"Properties",command:"View/Show/Properties",icon:"fa-gears",tab:"Home",group:"Show",keycombo:["alt p"],shouldDisable:c,mixin:n.mixin({actionType:"multiToggle",value:!0},p),onCreate:function(a){m.getRightPanel().getSplitter();a.value=!0},onChange:function(a,b){var c=m.getRightPanel();var d=c.getSplitter();d?d.isCollapsed()?(d.expand(),c=!0):(c.collapse(),c=!1):c=void 0;c&&m.showProperties(null);
m.onAfterAction("View/Show/Properties");return!0}}));var g=this.getAddActions(),t="";h.push(m.createAction({label:"Add Block",command:"Step/Insert",icon:"fa-plus",tab:"Home",group:"Insert",mixin:n.mixin({quick:!0},p)}));k("Step/Insert",g);h.push(m.createAction({label:"Set Variable",command:"Step/Insert/Set Variable",icon:"fa-paper-plane",tab:"Home",group:"Step",mixin:n.mixin({global:!0,quick:!0,getActions:function(a,b){for(var c=m.blockScope.getVariables(),f=[],e=0;e<c.length;e++){var k=c[e];f.push(m.createAction({label:k.name,
command:"Step/Insert/Set Variable/"+k.name,icon:"fa-paper-plane",tab:"Home",group:"Step",mixin:n.mixin({item:k,proto:d,custom:!0,ctrArgs:{variable:k.id,variableId:k.id,scope:m.blockScope,value:"0"}},p)}))}return f}},p)}));h.push(m.createAction({label:"None",command:"Step/Insert/Set Variable/None",icon:"fa-paper-plane",tab:"Home",group:"Step",mixin:n.mixin({proto:d,item:d,quick:!0,ctrArgs:{scope:this.blockScope,value:"0"}},p)}));this._emit("onAddActions",{actions:h,permissions:a,store:l});return h}});
l.BLOCK_INSERT_ROOT_COMMAND="Step/Insert";return l})},"xblox/views/BlockEditView":function(){define(["dcl/dcl","xide/views/CIView"],function(l,q){return l([q],{declaredClass:"xblox.views.BlockEditView",onSave:function(l,e){if(this.delegate&&this.delegate.onSave)this.delegate.onSave(l,e)}})})},"xblox/views/DnD":function(){define(["dojo/_base/declare","dojo/when","xgrid/DnD"],function(l,q,n){var e=l(n.GridSource,{declaredClass:"xblox/views/BlockGridDnDSource",_lastTargetId:null,_lastTargetCrossCounter:0,
_markTargetAnchor:function(b,a,f){if(this.current!=this.targetAnchor||this.before!==b||this.center!==a)this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this._removeItemClass(this.targetAnchor,"Disallow"),this._removeItemClass(this.targetAnchor,"Center")),this.targetAnchor=this.current,this.targetBox=null,this.before=b,this.center=a,this._before=b,this._center=a,this.targetAnchor&&(a&&(this._removeItemClass(this.targetAnchor,"Before"),this._removeItemClass(this.targetAnchor,
"After"),this._addItemClass(this.targetAnchor,"Center")),!a&&this._addItemClass(this.targetAnchor,this.before?"Before":"After"),a&&!1===f&&this._addItemClass(this.targetAnchor,"Disallow"))},onDropInternal:function(b,a,f){var e=this.grid,g=e.collection,l=this,p=l._targetAnchor,n;p&&(n=this._center?p:this.before?p.previousSibling:p.nextSibling);p=e.row(b[0]);if(a||n!==b[0]&&(f||!p||e.down(p).element!==b[0])){var d=e.__dndNodesToModel(b),c=e._sourceToModel(l,e),k={before:this._before,center:this._center,
targetGrid:e};this._center&&e.__onDrop(d,c,e,k,a);b.forEach(function(b){q(l.getObject(b),function(b){var h=g.getIdentity(b);e._trackError(function(){return g[a&&g.copy?"copy":"put"](b,{beforeId:f?g.getIdentity(f):null}).then(function(){l._selectedNodes[h]&&(l._selectedNodes[h]=e.row(h).element);!this.center&&e.__onDrop(d,c,e,k,a)})})})})}},onDropExternal:function(b,a,f,e){function g(a,b){a.refresh();return a.select(b,null,!0,{focus:!0,append:!1,expand:!0,delay:2},"mouse")}var m=this.grid,l=this.grid.collection,
n=b.grid,d=this;a.forEach(function(a,k){q(b.getObject(a),function(c){var h={before:d._before,center:d._center,targetGrid:m};if(c.toDropObject&&(c=c.toDropObject(c,h.center?n._sourceToModel(d):e,h,f),h.center))return g(m,c);m._trackError(function(){return l[l.copy?"copy":"put"](c,{beforeId:e?l.getIdentity(e):null}).then(function(){if(!f){if(n){var d=n.collection.getIdentity(c);!k&&b.selectNone();b.delItem(a.id);g(m,c);return n.collection.remove(d)}b.deleteSelectedNodes()}})})})})}}),g=l([e],{autoSync:!0,
skipForm:!0,selfAccept:!1,onDndDrop:function(b,a,e,g){this.targetAnchor&&this._removeItemClass(this.targetAnchor,"Hover");this==g&&(this.onDrop(b,a,e,g),this.grid.refresh());this.onDndCancel()}});l=l("xblox.widgets.DojoDndMixin",n,{dndParams:{allowNested:!0,checkAcceptance:function(b,a){return!0},isSource:!0},dndConstructor:g,dropEvent:"/dnd/drop",dragEvent:"/dnd/start",overEvent:"/dnd/source/over",__onDrop:function(b,a,e,g,l){var f=!0===g.center;_.each(b,function(b){b.toDropObject&&(b=b.toDropObject(b,
a,g,l));if(b!=a){if(f)!1!==a.canAdd(b)&&a.scope.moveTo(b,a,g.before,f);else{var e=b.getParent();if(e){var d=a.getParent();d?d==b.getParent()&&a.scope.moveTo(b,a,g.before,f):(b.group=this.blockGroup,e.removeBlock(b,!1),b._store.putSync(b))}}b.refresh()}},this);this.set("collection",this.collection.filter({group:this.blockGroup}));this.select(b[0],null,!0,{focus:!0,append:!1,expand:!0,delay:2},"mouse")}});l.BlockGridSource=e;return l})},"xblox/manager/BlockManagerUI":function(){define(["dcl/dcl","xide/manager/BeanManager"],
function(l,q){return l(q,{declaredClass:"xblox/manager/BlockManagerUI",init:function(){}})})},"xblox/views/BlocksFileEditor":function(){define("dcl/dcl dojo/_base/declare xide/factory xide/utils xblox/model/variables/Variable dojo/Deferred xide/types xide/views/_LayoutMixin xblox/views/BlockGrid xaction/ActionProvider xide/layout/Container xdocker/Docker2 xide/views/_CIPanelDialog xide/lodash".split(" "),function(l,q,n,e,g,b,a,f,m,v,u,p,t,d){f=l(f.dcl,{rootPanel:null,_lastTab:null,getDocker:function(){this._docker||
(this._docker=p.createDefault(this.containerNode),this.add(this._docker));return this._docker},getRootContainer:function(b){if(this.rootPanel)return this.rootPanel;this.reparent=!0;var c=this.getDocker(),d=a.DOCKER;return this.rootPanel=c.addTab(null,e.mixin({icon:!1,closeable:!0,moveable:!0,tabOrientation:d.TAB.TOP,location:d.DOCK.STACKED},b))},createLayout:function(){this.rootPanel||(this.rootPanel=this.getRootContainer({title:"test"}));return this.rootPanel},startup:function(){},getPropertyStruct:function(){return this.propertyStruct},
setPropertyStruct:function(a){this.propertyStruct=a},getGroupContainer:function(){return this.rootPanel},createGroupView:function(b,d,f,g,m,l,p){b=a.DOCKER;d={icon:m,closeable:!0,moveable:!0,title:d,target:this._lastTab||this.rootPanel,tabOrientation:b.TAB.TOP,location:b.DOCK.STACKED};this._lastTab=p=this.getDocker().addTab(null,e.mixin(d,p));this.tabs.push(p);return p}});q=q("BlockGrid",m,{move:function(a){var b=this.getSelection();if(b&&b.length){var c=this;d.each(b,function(b){b.move(b,a)});c.refreshRoot();
c.refreshCurrent();this.select(b,null,!0,{focus:!0,delay:10}).then(function(){c.refreshActions()})}},reParentBlock:function(a){var c=this.getSelection()[0];if(!c)return!1;-1==a?c.unparent(this.blockGroup):c.reparent();this.deselectAll();this.refreshRoot();this.refreshCurrent();a=new b;a.resolve({focus:!0,append:!1,delay:100,select:c,expand:!0});return a},defaultActionResult:function(a){var c=new b;c.resolve({focus:!0,append:!1,delay:0,select:a,expand:!0});return c}});return l([u,f,v.dcl],{declaredClass:"xblox.views.BlocksFileEditor",
registerView:!1,_item:null,cssClass:"bloxEditor",blockManager:null,blockManagerClass:"xblox.manager.BlockManager",model:null,store:null,tree:null,currentItem:null,didLoad:!1,selectable:!1,beanType:"BLOCK",newGroupPrefix:"",_debug:!1,blockScope:null,groupContainer:null,canAddGroups:!0,gridClass:q,activeGrid:null,activeTab:null,registerGrids:!0,visibileTab:null,setVisibleTab:function(a){this.visibileTab=a},getVisibleTab:function(){return this.visibileTab},constructor:function(a,b){e.mixin(this,a)},
onGridAction:function(b){var c=a.ACTION;switch((b.action?b.action:b).command){case c.SAVE:return this.save()}},clearGroupViews:function(a){d.each(this.tabs,function(a){a.destroy()});delete this.tabs;this.destroyWidgets()},getContainerLabel:function(b){var c=""+b;e.isNativeEvent(b)&&(c=c.replace("on",""));if(-1!==b.indexOf(a.EVENTS.ON_DRIVER_VARIABLE_CHANGED)){var d=this.ctx.getDeviceManager(),c=this.ctx.getDriverManager(),f=b.split("__")[1],d=(f=d.getDeviceByUrl(f))?d.getMetaValue(f,a.DEVICE_PROPERTY.CF_DEVICE_TITLE):
"Invalid Device";b=c.getBlock(b);c="("+d+"/"+(b?b.name:"Unknown Variable")+")"}return c},addNewBlockGroup:function(a){if(a){var b=this.blockScope,c=this.getContainerLabel(a),c=this.createGroupView(null,c,b,!0,"fa-bell");a=this.newGroupPrefix+a;b=this.createGroupedBlockView(c,a,b,{newRootItemGroup:a});this.activeGrid=c.grid=b;c.select()}},createGroupedBlockView:function(b,d,f,g,m){var c=this;m=m||this.gridClass;var k=f.blockStore;this._lastTab&&!this.__right&&(this.__right=this.getRightPanel(null,
null,"DefaultFixed",{target:this._lastTab}));d={__right:this.__right,ctx:this.ctx,blockScope:f,blockGroup:d,attachDirect:!0,resizeToParent:!0,collection:k.filter({group:d}),_parent:b,getPropertyStruct:this.getPropertyStruct,setPropertyStruct:this.setPropertyStruct};g&&e.mixin(d,g);var h=e.addWidget(m,d,null,b,!1);h.__editorActions||(h.__editorActions=!0,this.addGridActions(h,h));b.grid=h;h._on("selectionChanged",function(a){c._emit("selectionChanged",a)});h._on("onAfterAction",function(a){c.onGridAction(a)});
b.on(a.DOCKER.EVENT.VISIBILITY_CHANGED,function(a){a?(c.setVisibleTab(b),h.onShow(),c.getRightPanel().getSplitter().isCollapsed()||h.showProperties(h.getSelection()[0]),h.__last&&(h._restoreSelection(),h.focus(h.row(h.__last.focused)))):h.__last=h._preserveSelection()});this.registerGrids&&this.ctx.getWindowManager().registerView(h,!1);b._widgets||(b._widgets=[]);b.add(h);return h},getDeviceVariablesAsEventOptions:function(b){for(var c=[],d=function(a,b,c,d,f){d="";if(0<c)for(var e=0;e<c;e++)d+="\x26nbsp;",
d+="\x26nbsp;",d+="\x26nbsp;";return{label:d+("\x3cspan style\x3d''\x3e"+a+"\x3c/span\x3e"),label2:f,value:b}},f=this.ctx.getDeviceManager(),e=f.getDevices(!1,!0),g=0;g<e.length;g++){var m=e[g],l=m.driver;if(l){var p=f.getMetaValue(m,a.DEVICE_PROPERTY.CF_DEVICE_TITLE),m=f.getMetaValue(m,a.DEVICE_PROPERTY.CF_DEVICE_ID);c.push(d(p,l.id+"/"+l.id,b,!1));for(var n=l.blockScope.getVariables(),q=0;q<n.length;q++){var t=n[q];c.push(d(t.name,a.EVENTS.ON_DRIVER_VARIABLE_CHANGED+"__"+m+"__"+l.id+"__"+t.id,b+
1,!1,p+"/"+t.name))}}}return c},openNewGroupDialog:function(){var b=[],d=function(a,b,c,d){var f="";if(0<c)for(var e=0;e<c;e++)f+="\x26nbsp;",f+="\x26nbsp;",f+="\x26nbsp;";return{label:f+(!0!==d?"\x3cspan style\x3d''\x3e"+a+"\x3c/span\x3e":a),value:b,label2:a}};b.push(d("HTML","",0));var b=b.concat([d("onclick","click",1),d("ondblclick","dblclick",1),d("onmousedown","mousedown",1),d("onmouseup","mouseup",1),d("onmouseover","mouseover",1),d("onmousemove","mousemove",1),d("onmouseout","mouseout",1),
d("onkeypress","keypress",1),d("onkeydown","keydown",1),d("onkeyup","keyup",1),d("onfocus","focus",1),d("onblur","blur",1),d("onchange","change",1),d("input","input",1),d("load","load",1)]),f=this,b=new t({title:"Create a new block group",style:"width:500px;min-height:200px;",size:a.DIALOG_SIZE.SIZE_NORMAL,resizeable:!0,onOk:function(b){if(b&&b[0]&&"variable"===b[0].dst){b=b[0].newValue;var c=e.parse_url(b),c=e.urlArgs(c.host);f.addNewBlockGroup(a.EVENTS.ON_DRIVER_VARIABLE_CHANGED+"__"+b)}else b&&
b[0]&&f.addNewBlockGroup(b[0].newValue)},cis:[e.createCI("Event",a.ECIType.ENUMERATION,"",{group:"Event",delegate:null,options:b,value:"HTML",title:"Select an event \x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;",widget:{search:!0,"class":"xide.form.FilterSelect"}}),e.createCI("value","xcf.widgets.CommandPicker","",{group:"Event",title:" ",
dst:"variable",pickerType:"variable",value:" Select Driver Variable ",block:{scope:{ctx:f.ctx}},widget:{labelField:"name",valueField:"id",value:"Select Driver Variable",query:[{group:"basicVariables"},{group:"processVariables"}]}})]});this.add(b);return b.show()},onGroupsCreated:function(){},getActionStore:function(){return this.activeGrid?this.activeGrid.getActionStore():null},getTabContainer:function(){return this.groupContainer},onReloaded:function(){this.destroyWidgets();this.openItem(this._item)},
openItem:function(a){var c=new b;this._item=a;var d=this;this.getBlockManager().load(a.mount,a.path).then(function(a){d.initWithScope(a);c.resolve(d)});return c},initWithContent:function(a){var b=null;try{b=e.getJson(a)}catch(h){console.error("invalid block data")}b&&this.initWithData(b)},initWithScope:function(a){this.blockScope=a;var b=a.allGroups();-1==b.indexOf("Variables")&&b.push("Variables");-1==b.indexOf("Events")&&b.push("Events");-1==b.indexOf("On Load")&&b.push("On Load");this.renderGroups(b,
a)},getScopeUserData:function(){return{owner:this}},initWithData:function(a){this.onLoaded();var b=e.createUUID(),c=a;!d.isArray(a)&&d.isObject(a)&&(b=a.scopeId||b,c=a.blocks||[]);this.blockManager=a=this.getBlockManager();for(var f=this.getScopeUserData(),b=a.getScope(b,f,!0),c=b.blocksFromJson(c),f=0;f<c.length;f++)c[f]._lastRunSettings={force:!1,highlight:!0};a.onBlocksReady(b);if(c)return this.initWithScope(b)},destroyWidgets:function(){this.blockManager&&this.blockScope&&this.blockManager.removeScope(this.blockScope.id);
this.blockManager=null},destroy:function(){this.destroyWidgets();delete this.tabs;delete this.propertyStruct;delete this.visualEditor;delete this.widget;delete this.params;delete this.pageEditor;delete this.editorContext;delete this.activeGrid;this.delegate=this.blockScope=this.__right=this.docker=this.ctx=this._parent=this.item=null},getBlockManager:function(){if(!this.blockManager){if(this.ctx.blockManager)return this.ctx.blockManager;this.blockManager=n.createInstance(this.blockManagerClass,{ctx:this.ctx})}return this.blockManager},
getActiveGrid:function(){return this.activeGrid},runAction:function(a){return"File/New Group"==a.command?(this.openNewGroupDialog(),null):this.getActiveGrid().runAction(arguments)},addGridActions:function(a,b){var c=[],d={addPermission:!0};c.push(this.createAction({label:"New Group",command:"File/New Group",icon:"fa-magic",tab:"Home",group:"File",keycombo:["f7"],mixin:e.mixin({quick:!0},d)}));c.push(this.createAction({label:"Delete Group",command:"File/Delete Group",icon:"fa-remove",tab:"Home",group:"File",
keycombo:["ctrl f7"],mixin:e.mixin({quick:!0},d)}));(b||this).addActions(c)},onShowGrid:function(a){},renderGroup:function(a,b,d){b=b||this.blockScope;var c=this,f=a.replace(this.newGroupPrefix,"");e.isNativeEvent(a)&&(f=f.replace("on",""));var f=this.getContainerLabel(a.replace(this.newGroupPrefix,"")),k="Variables"===a,f=this.createGroupView(null,f,b,!k,k?" fa-info-circle":"fa-bell",!k),k={};"Variables"===a&&(k.newRootItemFunction=function(){new g({title:"No-Title-Yet",type:13,value:"No Value",
enumType:"VariableType",save:!1,initialize:"",group:"Variables",id:e.createUUID(),scope:b})},k.onGridDataChanged=function(a){var b=a.item;b&&(b[a.field]=a.newValue);c.save()},k.showAllBlocks=!1,k.newRootItemLabel="New Variable",k.newRootItemIcon="fa-code",k.storeField="variableStore",k.gridParams={cssClass:"bloxGridView",getColumns:function(){return[{label:"Name",field:"title",sortable:!0},{label:"Value",field:"value",sortable:!1}]}});k.newRootItemGroup=a;a=this.createGroupedBlockView(f,a,b,k,d);
f.blockView=a;!this.activeGrid&&(this.activeGrid=a);return a},renderGroups:function(a,b){this._isCreating=!0;this.activeGrid=null;this.tabs=[];this._lastTab=null;this.setPropertyStruct({currentCIView:null,targetTop:null,_lastItem:null,id:e.createUUID()});for(var c=0;c<a.length;c++){var d=a[c];if(""!=this.newGroupPrefix||-1===d.indexOf("__"))try{var f=b.getBlocks({group:d});("Variables"===d||f&&f.length)&&this.renderGroup(d,b)}catch(x){logError(x)}}this.tabs&&this.tabs[0]&&(this.tabs[0].silent=!0,
this.tabs[0].select(),this.tabs[0].silent=!1)},onSave:function(a){this.save()},save:function(){if(this.blockScope){var a=this.ctx.getFileManager(),b=this.item;a.setContent(b.mount,b.path,this.blockScope.toString(),function(){})}}})})},"xblox/model/Block_UI":function(){define(["dcl/dcl","xide/utils","xide/types","xide/data/Source","xaction/ActionProvider"],function(l,q,n,e,g){return l([e.dcl,g.dcl],{declaredClass:"xblox.model.Block_UI",_statusIcon:null,_statusClass:null,description:"No Description",
canDelete:!0,renderBlockIcon:!0,getStatusIcon:function(){return this._statusIcon},getStatusClass:function(b){return this._statusClass?this._statusClass[b]:null},setStatusClass:function(b,a){this._statusClass||(this._statusClass={});delete this._statusClass[b];a&&(this._statusClass[b]=a)},_getText:function(b){var a;dojo.xhrGet({url:b,sync:!0,handleAs:"text",load:function(b){a=b}});return""+a+""},getHelp:function(){},getIcon:function(b,a,f){return'\x3cspan style\x3d"'+(a||"")+'" class\x3d"'+b+'"\x3e\x3c/span\x3e '+
(f||"")},makeEditable2:function(b,a,f,e,g){return'\x3ca tabIndex\x3d"-1" pos\x3d\''+a+"' display-mode\x3d'"+(g||"popup")+"' display-type\x3d'"+(f||"text")+"' data-prop\x3d'"+b+"' data-title\x3d'"+e+"' class\x3d'editable'  href\x3d'#'\x3e"+this[b]+"\x3c/a\x3e"},makeEditable:function(b,a,f,e,g){return"\x3ca data-value\x3d'"+this[b]+"' tabIndex\x3d'-1' pos\x3d'"+a+"' display-mode\x3d'"+(g||"popup")+"' display-type\x3d'"+(f||"text")+"' data-prop\x3d'"+b+"' data-title\x3d'"+e+"' class\x3d'editable'  href\x3d'#'\x3e"+
this[b]+"\x3c/a\x3e"},canMove:function(b,a){b=b||this;if(!b)return!1;var f=b.getParent(),e=null;if(f){e=f[f._getContainer(b)];if(!e||2>e.length||!this.containsItem(e,b))return!1;f=this.indexOf(e,b);if(0>f+a||!e[f+a])return!1}else return e=this._store.storage.fullData,null!=this.next(e,a);return!0},move:function(b,a){b=b||this;if(!b)return!1;var f=b.getParent(),e=null,g=b._store;if(f){e=f[f._getContainer(b)];if(!e||2>e.length||!this.containsItem(e,b))return!1;f=this.indexOf(e,b);if(0>f+a)return!1;
g=e[f+a];if(!g)return!1;e[f+a]=b;e[f]=g}else{var l=function(a,b,d){var c=a.indexOf(b,a),e=b[c+d*n];if(e){if(!e.parentId&&e.group&&e.group===a.group)return p=c+d*n,e;n++;return l(a,b,d)}return null};g&&b.group&&(e=g.storage.fullData);var p=0,n=1,f=this.indexOf(e,b);if(0>f+a)return!1;var d=l(b,e,a);if(!d)return!1;e[p]=b;e[f]=d;g._reindex()}return!0},onActivity:function(b,a,e,g){g=g||{};g.target=b;this._emit(e,g,b);this.publish(e,g,b)},onRun:function(b,a,e){var f=a&&a.highlight;if(b&&f)this.onActivity(b,
a,n.EVENTS.ON_RUN_BLOCK,e);this._statusIcon="text-info fa-spinner fa-spin"},onFailed:function(b,a,e){var f=a&&a.highlight;if(b&&f)this.onActivity(b,a,n.EVENTS.ON_RUN_BLOCK_FAILED,e);this._statusIcon="text-danger fa-exclamation"},onSuccess:function(b,a,e){var f=a&&a.highlight;if(b&&f)this.onActivity(b,a,n.EVENTS.ON_RUN_BLOCK_SUCCESS,e);this._statusIcon="text-success fa-check"},canDisable:function(){return!0},getDefaultFields:function(b,a,e){a=[];this.canDisable&&!1!==this.canDisable()&&a.push(q.createCI("enabled",
0,this.enabled,{group:"General",title:"Enabled",dst:"enabled",actionTarget:"value",order:210}));a.push(q.createCI("description",26,this.description,{group:"Description",title:"Description",dst:"description",useACE:!1}));!1!==b&&a.push(q.createCI("icon",17,this.icon,{group:"General",title:"Icon",dst:"icon",useACE:!1,order:206}));!1!==e&&a.push(q.createCI("outlet",5,this.outlet,{group:"Special",title:"Type",dst:"outlet",order:205,data:[{value:1,label:"Progress",title:"Executed when progress"},{value:2,
label:"Error",title:"Executed when errors"},{value:4,label:"Paused",title:"Executed when paused"},{value:8,label:"Finish",title:"Executed when finish"},{value:16,label:"Stopped",title:"Executed when stopped"}],widget:{hex:!0}}));this.sharable&&a.push(q.createCI("enabled",13,this.shareTitle,{group:"Share",title:"Title",dst:"shareTitle",toolTip:"Enter an unique name to share this block!"}));return a},getFields:function(){return this.getDefaultFields()},toFriendlyName:function(b){for(var a="[](){}".split(""),
e=0;e<a.length;e++)b=b.replace(a[e],"");b=q.replaceAll("\x3d\x3d"," equals ",b);b=q.replaceAll("\x3c"," is less than ",b);b=q.replaceAll("\x3d\x3c"," is less than ",b);b=q.replaceAll("\x3e"," is greater than ",b);b=q.replaceAll("\x3e\x3d"," is greater than ",b);return b=q.replaceAll("'","",b)},getIconClass:function(){return this.icon},getBlockIcon:function(b){return 1==this.renderBlockIcon?'\x3cspan class\x3d"xBloxIcon '+this.icon+'"\x3e'+(b||"")+"\x3c/span\x3e":""},onFieldsRendered:function(b,a){},
onChangeField:function(b,a){"enabled"==b&&(1==a?this.activate():this.deactivate())},destroy:function(){this.setStatusClass(this.getScope().id,null)}})})},"xblox/RunScript":function(){define("dojo/_base/lang dojo/on dcl/dcl delite/register delite/CustomElement xide/factory/Events xide/utils/StringUtils xide/types/Types xblox/model/Referenced xide/mixins/EventedMixin xide/mixins/ReloadMixin xwire/Binding xwire/EventSource xwire/WidgetTarget".split(" "),function(l,q,n,e,g,b,a,f,m,v,u,p,t,d,c){l={declaredClass:"xblox/RunScript",
targetevent:"",sourceevent:"",sourceeventvaluepath:"",sourceeventnamepath:"",targetproperty:"",targetvariable:"",targetfilter:"",script:"",bidirectional:!1,blockGroup:"",block:"",_targetBlock:null,_targetReference:null,_appContext:null,_complete:!1,enabled:!0,stop:!1,_events:[],context:null,accept:"",transform:"",mode:0,_2wayHandle:null,binding:null,reset:function(){this._destroyHandles();this._2wayHandle&&this._2wayHandle.remove();this.binding&&this.binding.destroy();delete this.binding;this._targetReference=
this._appContext=null},onSettingsChanged:function(){this.reset();if(this.enabled)this.onAppReady(null)},getChildren:function(){return[]},destroy:function(){this.onDestroy&&this.onDestroy();this.reset();delete this.binding;delete this.context},run:function(a,b){if(this.enabled){var c={};if(this.context&&this.context.delegate){if(this.context.delegate.isDesignMode&&this.context.delegate.isDesignMode())return;this.context.delegate.getBlockSettings&&(c=this.context.delegate.getBlockSettings())}var d=
this._targetBlock,e=this._targetReference;d&&e&&(d.context=e,d._targetReference=e,this.targetvariable&&this.targetvariable.length&&null!=b&&(d.override={variables:{}},d.override.variables[this.targetvariable]=b),d.solve(d.scope,c))}},onReady:function(){this._targetReference||this._setupTargetReference();this._targetReference&&!0===this.bidirectional&&this.sourceevent&&this.sourceevent.length&&!this.binding&&this._setup2WayBinding();if(!this._complete){this._targetReference||console.error("have no target reference");
this._targetBlock||console.error("have no target block");if(this._targetReference&&this._targetBlock){if(this.targetevent){this._complete=!0;a.mixin(this._targetReference,v.prototype);var b=this._targetReference.domNode||this._targetReference,c=this.targetevent,d=this._targetReference.declaredClass||this._targetReference.startup,e=null!=this._targetReference.on&&null!=this._targetReference["on"+a.capitalize(c)],f=null,g=null!=b.render&&null!=b.on,l=this;if(d&&this._targetReference.baseClass&&-1!=
this._targetReference.baseClass.indexOf("dijitContentPane")||null!=this._targetReference.render||null!=this._targetReference.on)d=!1;b?(g||e&&d?(b=this._targetReference,g?f=b.on(this.targetevent,function(a){this.stop&&(a.preventDefault(),a.stopImmediatePropagation());this.run(this.targetevent,a.currentTarget.value)}.bind(this)):(c="on"+a.capitalize(c),this._targetReference[c]=function(a,c){!0!==b.ignore&&l.run(l.targetevent,a)})):f=q(b,this.targetevent,function(a){this.run(this.targetevent)}.bind(this)),
f&&this._events.push(f)):console.error("have no target to wire")}}else console.error("invalid params, abort",this);this.binding&&this.binding.start()}},resolveBlock:function(a){var b=this._appContext.getDeviceManager();if(-1!==a.indexOf("://")&&b&&(a=b.getBlock(this.block)))return a},_setBlock:function(b){if((b=b||window.appContext)&&b.getBlockManager){this._appContext=b;var c=b.getBlockManager();b=b.getDeviceManager();var d=this;if(c){var e=this.block?this.block:this.getAttribute("block");if(e&&
0<e.length){var f=a.parse_url(e);-1!==e.indexOf("://")?b&&(c=b.getBlock(e))&&(d._targetBlock=c,d.onReady()):c.load(f.scheme,f.host).then(function(a){if(a=a.getBlockById(d.blockid))d._targetBlock=a,d.onReady()})}else if(this.scopeid)if(c=c.hasScope(d.scopeid))if(b=c.getBlockById(d.blockid))d._targetBlock=b,d.onReady();else{if(b=c.getVariableById(d.blockid))d._targetBlock=b,d.onReady()}else console.error("have no scope!")}}},initWithReference:function(a){1===a.nodeType&&(this._targetReference=a,this._setBlock(null))},
resolveFilter:function(a,b,c){this._targetBlock&&(b=this._targetBlock.scope.expressionModel.parseVariable(this._targetBlock.scope,{value:a},"",!1,!1,c,[b]));return b},_setup1WayBinding:function(){this._2wayHandle&&this._2wayHandle.remove();if(this._targetBlock){var a=new t({trigger:this.sourceevent,path:this.sourceeventvaluepath,filters:[{path:this.sourceeventnamepath,value:this._targetBlock.name}]}),b=new d({path:this.targetproperty,object:this._targetReference,targetFilter:this.targetfilter,delegate:this});
this._findbyTagAndName("D-SCRIPT","accept");this._findbyTagAndName("D-SCRIPT","transform");this.binding=a=new p({source:a,target:b,accept:this._findbyTagAndName("D-SCRIPT","accept"),transform:this._findbyTagAndName("D-SCRIPT","transform")});a.start()}else console.error("invalid params for one way binding")},_findbyTagAndName:function(a,b){for(var c=$(this).find(a),d=0;d<c.length;d++){var e=c[d];if($(e).attr("name")===b)return e}return null},_setup2WayBinding:function(){if(!this.binding){this._2wayHandle&&
this._2wayHandle.remove();var a=new t({trigger:this.sourceevent,path:this.sourceeventvaluepath,filters:[{path:this.sourceeventnamepath,value:this.targetvariable}]}),b=new d({path:"value",object:this._targetReference});this.binding=new p({source:a,target:b});this.binding.start()}},getEnclosingWidget:function(a){if(a){do if(1===a.nodeType&&a.render)return a;while(a=a.parentNode)}return null},_setupTargetReference:function(){for(var a=0,b=this,c=null;2>a&&!c;)b&&(b=b.parentNode,(c=this.getEnclosingWidget(b,
"widgetId"))||(c=this.getEnclosingWidget(b,"widgetid"))),a++;c?this.initWithReference(c):this.domNode&&this.domNode.parentNode?this.initWithReference(this.domNode.parentNode):this.parentNode&&this.initWithReference(this.parentNode)},onAppReady:function(a){this._targetReference||this._setupTargetReference();this._targetBlock||this._setBlock(a?a.context:null);this.mode=!0===this.bidirectional?0:1;if(0===this.mode){if(this._targetBlock&&this._targetReference&&!0===this.bidirectional&&this.sourceevent&&
this.sourceevent.length&&this._setup2WayBinding(),this._targetReference&&this._targetBlock)this.onReady()}else 1===this.mode&&this._targetBlock&&this._targetReference&&this.sourceevent&&this.sourceevent.length&&this.targetproperty&&this.targetproperty.length&&(this._setup1WayBinding(),this.binding&&this.binding.start());a&&a.context&&(this.context=a.context)},detachedCallback:function(){this._appContext&&this.destroy()},createdCallback:function(){},attachedCallback:function(){this._started||(this.initReload(),
this.subscribe(f.EVENTS.ON_APP_READY),this._started=!0)},detachCallback:function(){},render:function(){},postRender:function(){},startup:function(){this.inherited(arguments);this.onAppReady();this.initReload();this.subscribe(f.EVENTS.ON_APP_READY)}};n=n([v.dcl,u.dcl,m.dcl],l);n.Impl=l;return e("d-xscript",[HTMLElement,g,n])})},"xblox/CSSState":function(){define("dcl/dcl delite/register delite/CustomElement xblox/_State xide/utils xdojo/has".split(" "),function(l,q,n,e,g,b){var a=[],f,m,v,u=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g;
b.add("dom-contains",function(a,b,d){return!!d.contains});b={_lastState:null,declaredClass:"xblox/CSSState",cssClass:"",addCssRule:function(b,e){f||(f=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(f),f=f.sheet||f.styleSheet,m=f.deleteRule?"deleteRule":"removeRule",v=f.cssRules?"cssRules":"rules");var d=a.length;a[d]=(f.cssRules||f.rules).length;f.addRule?f.addRule(b,e):f.insertRule(b+"{"+e+"}",a[d]);return{get:function(b){return f[v][a[d]].style[b]},set:function(b,
e){"undefined"!==typeof a[d]&&(f[v][a[d]].style[b]=e)},remove:function(){var b=a[d],e,g;if(void 0!==b)for(f[m](b),a[d]=void 0,e=d+1,g=a.length;e<g;e++)a[e]>b&&a[e]--},sheet:f}},escapeCssIdentifier:function(a,b){return"string"===typeof a?a.replace(u,b||"\\$1"):a},detachedCallback:function(){this._styles&&_.each(this._styles,function(a){a.remove()});delete this._styles},applyTo:function(a,b){this._lastState&&this._lastState.remove();delete this._lastStateName;this._lastStateName=b;if(this._attached){var d=
this.cssClass,c=a.id||g.createUUID(),e=a.tagName.replace(/\./g,"_")+"_"+c,c=""+this.innerHTML,c=c.replace(".style",""),c=c.replace(/<(?:.|\n)*?>/gm,""),c=c.replace("{",""),c=c.replace("}",""),c=c.replace(/(\r\n|\n|\r|\t)/gm,""),e=e+("_state_"+b);$(a).removeClass($(a).data("_lastCSSState"));$(a).removeClass($(a).data("_lastCSSClass"));$(a).removeClass(d);d?($(a).addClass(d),$(a).data("_lastCSSClass",d)):($(a).addClass(e),$(a).data("_lastCSSState",e),d="."+this.escapeCssIdentifier(e),this._styles||
(this._styles=[]),d=this.addCssRule(d,c),this._styles.push(d))}}};l=l([e],b);l.Impl=b;return q("d-xstate-css",[HTMLElement,n,l])})},"xblox/_State":function(){define("dojo/_base/lang dojo/on dcl/dcl delite/register delite/CustomElement xide/factory/Events xide/utils/StringUtils xide/types/Types xblox/model/Referenced xide/mixins/EventedMixin xide/mixins/ReloadMixin xwire/Binding xwire/EventSource xwire/WidgetTarget".split(" "),function(l,q,n,e,g,b,a,f,m,v,u,p,t,d){return n([v.dcl,m.dcl],{declaredClass:"xblox/_State",
script:"",bidirectional:!1,_targetBlock:null,_targetReference:null,_complete:!1,enabled:!0,stop:!1,_events:[],context:null,name:"Default",isState:!0,_isState:function(){return!0},reset:function(){},getChildren:function(){return[]},destroy:function(){this.onDestroy&&this.onDestroy();this.reset()},run:function(a,b){},onReady:function(){},getEnclosingWidget:function(a){if(a){do if(1===a.nodeType&&a.render)return a;while(a=a.parentNode)}return null},initWithReference:function(a){1===a.nodeType&&(this._targetReference=
a)},_setupTargetReference:function(){for(var a=0,b=this,d=null;2>a&&!d;)b&&(b=b.parentNode,(d=this.getEnclosingWidget(b,"widgetId"))||(d=this.getEnclosingWidget(b,"widgetid"))),a++;d?(this.initWithReference(d),d._attached&&d.stateReady&&d.stateReady(this)):this.domNode&&this.domNode.parentNode?this.initWithReference(this.domNode.parentNode):this.parentNode&&this.initWithReference(this.parentNode)},onAppReady:function(a){this._setupTargetReference();a&&a.context&&(this.context=a.context)},detachedCallback:function(){this._appContext&&
this.destroy()},applyTo:function(a){},createdCallback:function(){this._targetReference||(this._setupTargetReference(),this._targetReference&&this._targetReference.stateReady&&this._targetReference.stateReady(this))},attachedCallback:function(){this._started||(this.onAppReady(),this.subscribe(f.EVENTS.ON_APP_READY),this._started=!0)}})})},"xblox/model/html/SetState":function(){define("dcl/dcl xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced dojo/dom-attr dojo/dom-style dojo/_base/Color xide/registry".split(" "),
function(l,q,n,e,g,b,a,f,m,v){var u={declaredClass:"xblox.model.html.SetState",name:"Set State",reference:"",references:null,description:"Switches to a state",value:"",mode:1,sharable:!1,solve:function(a,b){var d=this.value;b=b||{};b.flags=e.CIFLAG.DONT_PARSE;var c=this.resolveReference(this.deserialize(this.reference),b);this.override&&this.override.variables&&(d=n.replace(d,null,this.override.variables,{begin:"{",end:"}"}));c&&c.length&&_.each(c,function(a){(a=v.byId(a.id)||a)&&a.setState&&a.setState(d)});
this.onSuccess(this,b);this.onDidRun()},toText:function(){var a=this.deserialize(this.reference),a=this.getBlockIcon()+" "+this.name+" :: on "+a.reference+" to"||"  to ";this.value&&(a+=" "+this.value);return a},getFields:function(){var a=this.getDefaultFields(!1),b={group:"General",dst:"reference",value:this.reference};a.push(n.createCI("State",e.ECIType.STRING,this.value,{group:"General",dst:"value",value:this.value,intermediateChanges:!1}));a.push(n.createCI("Target",e.ECIType.WIDGET_REFERENCE,
this.reference,b));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-paint-brush"\x3e\x3c/span\x3e'},getPropValue:function(a,b){for(var d in a)if(d===b)return a[d];return null},updateObject:function(b,e,d){if(!b)return!1;d=d||1;null!=b.domNode&&(b=b.domNode);var c=a.get(b,"style");";"===c&&(c="");""===c&&(c=null!=b.lastStyle?b.lastStyle:e);";"===c&&(c=e);switch(d){case 1:var c=this._toObject(c),g=e.split(";");for(e=0;e<g.length;e++)d=g[e].split(":"),2==d.length&&(c[d[0]]=d[1]);var g=
[],h;for(h in c)g.push(h+":"+c[h]);$(b).attr("style",g.join(";"));break;case 2:c=_.uniq((c+";"+e).split(";")).join(";");a.set(b,"style",c);break;case 3:a.set(b,"style",n.replaceAll(e,"",c));break;case 4:case 5:h=new RegExp(/(\D*)(-?)(\d+)(\D*)/);e=this._toObject(e);d={};var l=$(b);if(e)for(g in e)d[g]=this._getStyle(g,b,l);for(g in e){var p=""+g.trim();if(null!=d[p]){var q=e[g],t=d[g],l=-1!=q.indexOf("#"),u=-1!=q.indexOf("rgb"),v=-1!=q.indexOf("rgba");if(l||u||v){var C=dojo.colorFromString(q);dojo.colorFromString(q);
var E=dojo.colorFromString(t),y=new m;_.each(["r","g","b","a"],function(a){y[a]=Math.min(E[a]+C[a],"a"==a?1:255)});p="";l?p=y.toHex():u?p=y.toCss(!1):v&&(p=y.toCss(!0));f.set(b,g,p)}else(l=h.exec(d[p]))&&3<=l.length&&parseInt(l[3])}}g=this._toObject(c);if(!g)return!1}},activate:function(){this._destroy()},deactivate:function(){this._destroy()}};l=l([q,g.dcl,b.dcl],u);l.Impl=u;return l})},"xblox/views/BlockGridPalette":function(){define("dcl/dcl xdojo/declare xide/types xide/utils xgrid/ListRenderer xgrid/TreeRenderer xgrid/Grid xgrid/MultiRenderer dgrid/Editor xgrid/Defaults xgrid/Layout xgrid/Focus dgrid/OnDemandGrid xide/mixins/EventedMixin xblox/views/BlockGrid xblox/BlockActions xide/views/_LayoutMixin xide/widgets/_Widget module xide/factory xblox/views/ThumbRenderer xblox/views/DnD dojo/dom-construct xgrid/Selection xgrid/KeyboardNavigation xaction/ActionStore xlang/i18 xide/$ xide/_base/_Widget xdojo/has dojo/has!debug?xide/tests/TestUtils".split(" "),
function(l,q,n,e,g,b,a,f,m,v,u,p,t,d,c,k,h,r,w,x,B,D,F,C,E,y,A,z,H,G,N){function J(a,b){var c=a.mainView.leftLayoutContainer;return c.createTab(b,"fa-cube",!0,null,{parentContainer:c,open:!0,icon:"fa-folder"})}function K(a,b){if(b.blockPalette)b.blockPalette.lastSource=a.view;else{var c=J(b,"Block-Palette"),d=e.addWidget(I,{ctx:b,attachDirect:!0,open:!0,sources:[]},null,c,!0);c.add(d);b.blockPalette=d;d.lastSource=a.view}(function(a){-1===b.blockPalette.sources.indexOf(a)&&(b.blockPalette.sources.push(a),
a._on("destroy",function(){b.blockPalette&&b.blockPalette.sources.remove(a);b.blockPalette&&0===b.blockPalette.sources.length&&(e.destroy(b.blockPalette),e.destroy(b.blockPalette._parent),b.blockPalette=null)}))})(a.view)}m=q("xblox.ThumbRenderer2",[B],{thumbSize:"400",resizeThumb:!0,__type:"thumb",deactivateRenderer:function(){z(this.domNode.parentNode).removeClass("metro");z(this.domNode).css("padding","");this.isThumbGrid=!1},activateRenderer:function(){z(this.contentNode).css("padding","8px");
this.isThumbGrid=!0;this.refresh()},renderRow:function(a){var b=F.create("div",{className:"tile widget form-control",style:"margin-left:8px;margin-top:8px;margin-right:8px;width:150px;height:initial;max-width:200px;float:left;padding:8px"});b.innerHTML='\x3cdiv class\x3d"opacity"\x3e'+('\x3cspan style\x3d"float:left; margin-left:3px;margin-top:3px;margin-right:3px;text-shadow: 2px 2px 5px rgba(0,0,0,0.3);font-size: inherit;opacity: 0.4" class\x3d"'+(a.icon||"fa fa-folder fa-2x")+'"\x3e\x3c/span\x3e')+
'\x3cspan class\x3d"thumbText text opacity ellipsis" style\x3d"text-align:center"\x3e'+a.title+"\x3c/span\x3e\x3c/div\x3e";return b}});g=q("xblox.GroupRenderer",b,{itemClass:m,groupClass:b,renderRow:function(a){return(a.group?this.groupClass:this.itemClass).prototype.renderRow.apply(this,arguments)}});b=[g,m,b];f=q.classFactory("xgrid/MultiRendererGroups",{},b,f.Implementation);a=a.createGridClass("xfile.views.Grid",{},{SELECTION:{CLASS:C},KEYBOARD_SELECTION:!0,CONTEXT_MENU:!1,ACTIONS:n.GRID_FEATURES.ACTIONS,
WIDGET:{CLASS:r},KEYBOARD_NAVIGATION:{CLASS:E},Dnd:{CLASS:D}},{RENDERER:f},{renderers:b,selectedRenderer:g});var L=l(H,{templateString:'\x3cdiv class\x3d"xbloxHelp"\x3e\x3c/div\x3e',startup:function(){}}),I=q("ActionGrid",a,{dndParams:{allowNested:!1,checkAcceptance:function(a,b){return!1},isSource:!0},formatColumn:function(a,b,c){var d=this.selectedRenderer?this.selectedRenderer.prototype:this;if(d.formatColumn_&&(d=d.formatColumn.apply(arguments))||c.renderColumn_&&(d=c.renderColumn.apply(this,
arguments)))return d;switch(a){case "title":b=c.group?'\x3cspan style\x3d"float:left;margin-right: 10px"\x3e'+b+'\x3c/span\x3e\x3chr style\x3d"margin-top: 13px;margin-left: 4px"/\x3e':b}return b},_columns:{},postMixInProperties:function(){function a(b,h){for(var k=0;k<h.length;k++){var l=h[k];c=l.name;var m=b?b+"/"+c:c,n=!_.isEmpty(l.items);d.push(g.createAction({label:c,command:m,icon:l.iconClass,tab:"Home",mixin:e.mixin({item:l,parent:n?"root":b,quick:!0,title:A.localize(c),group:n,icon:l.iconClass,
toDropObject:function(a,b,c){var d=a.item;a=d.ctrArgs;a.id=null;a.items=null;a.scope=c.targetGrid.blockScope;d=d.proto;if(b=!0===c.center&&b?b:null)return c=x.createBlock(d,a),b.add(c,null,null);a.group=c.targetGrid.blockGroup;return x.createBlock(d,a)}},f)}));n&&a(m,l.items)}}var b=this.state;b&&b._columns&&(this._columns=b._columns);this.columns=this.getColumns();var b=this.getAddActions(),c="",d=[],f={addPermission:!0},g=this;a("",b);var h=new y({parentProperty:"parent",parentField:"parent",idProperty:"command",
mayHaveChildren:function(a){return!1===a._mayHaveChildren?!1:!0}});h.setData(d);b=h.query(null);_.each(b,function(a){a._store=h});z(this.domNode).addClass("xFileGrid metro");this.collection=h.filter({parent:"root"});return this.inherited(arguments)},getColumns:function(a){var b=this;return this.columns=[{renderExpando:!0,label:"Name",field:"title",sortable:!0,formatter:function(a,c){return b.formatColumn("title",a,c)},hidden:!1}]},getAddActions:function(a){a=a||{};var b=x.getAllBlocks(this.blockScope,
this,a,this.blockGroup,!1);this.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST_END,{items:b,view:this,owner:this,item:a,group:this.blockGroup,scope:this.blockScope});this._emit(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST_END,{items:b,view:this,owner:this});return b},startup:function(){this._showHeader(!1);this._on("selectionChanged",function(a){var b=a.selection[0];a=this.lastSource;if(b&&a&&b.item.proto&&b.item.proto.prototype&&(a.clearPropertyPanel(),b=a.getHelp(b.item.proto.prototype))){var c=a.getPropertyStruct();
a=e.addWidget(L,{},null,a.__right.containerNode,!0);z(a.domNode).append(b);c.targetTop=a}});var a=this.inherited(arguments);_.each(this.getRows(),function(a){this.expand(a)},this);z(this.domNode).addClass("blockPalette");return a}});I.init=function(a){function b(b){K(b,a)}a.subscribe("ON_SELECTED_BLOCK",b);a.subscribe("ON_BLOCK_GRID",b)};return I})}}});
//# sourceMappingURL=xblox.js.map