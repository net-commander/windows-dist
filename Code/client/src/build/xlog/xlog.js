//>>built
require({cache:{"xlog/main":function(){define(["dojo/_base/kernel","xlog/manager/LogManager","xlog/views/LogGrid","xlog/widgets/FilterWidget","xlog/widgets/RowDetailEditor"],function(k){return k.xlog})},"xlog/manager/LogManager":function(){define("dcl/dcl xdojo/declare xide/manager/ServerActionBase xide/manager/BeanManager xide/encoding/MD5 xide/types xide/utils dojo/cookie dojo/json dojo/Deferred xide/data/Memory xide/mixins/EventedMixin".split(" "),function(k,f,h,e,r,m,g,n,p,t,u,v){var w=f([v],
{bytesLoaded:null,percentValue:null,item:null,delegate:null,_onEnd:null,_onHandle:null,serviceClass:"XIDE_Log_Service",constructor:function(a){this.item=a;this.subscribe(a.progressMessage,this._onProgress);this.subscribe(a.progressFailedMessage,this._onProgressFailed)},_onProgressFailed:function(a){this.item.level="error";this.item.message=this.item.oriMessage+" : Failed";this.item._isTerminated=!0;a&&a.item&&a.item.error&&this.item.details&&(this.item.details.error=a.item.error)},_onFinish:function(){this._onHandle&&
this._onHandle.remove()},_onProgress:function(a){try{var b=a.progress;a=null;null==a&&(a=Math.round(100*b.loaded/b.total),this.bytesLoaded=b.loaded);this.percentValue!=a&&(this.item.message=""+(""+this.item.oriMessage+(" : "+a+"%")));this.percentValue=a;this._emit("progress");100<=this.percentValue&&(this.item.message=this.item.oriMessage+" : Done",this._emit("finish"),this._onFinish(),this.destroy())}catch(c){console.error("crash in log progress "+c)}}});return k([h,e],{declaredClass:"xcf.manager.LogManager",
serviceClass:"XIDE_Log_Service",cookiePrefix:"logging",singleton:!0,serviceView:null,clients:null,beanNamespace:"logging",views:null,stores:{},removeStore:function(a){var b=this.stores[a];b&&(b.destroy&&b.destroy(),delete this.stores[a])},getViewId:function(a){return this.beanNamespace+r(JSON.stringify({info:a.info}),1)},loadPreferences:function(){var a=n(this.cookiePrefix+"_debug_settings");return a=a?p.parse(a):{}},savePreferences:function(a){n(this.cookiePrefix+"_debug_settings",p.stringify(a))},
empty:function(a){this.clear(a);a=this.getStore(a);a.then&&a.then(function(a){a.setData([])})},clear:function(a){return this.runDeferred(null,"clearAbs",[a||""]).then(function(a){})},getViewTarget:function(){return this.ctx.getApplication().mainView.getNewAlternateTarget()},getStore:function(a){if(!a)return this.store;var b=new t;if(this.stores[a])return b.resolve(this.stores[a]),b;var c=this;this.runDeferred(null,"lsAbs",[a||""]).then(function(d){_.isString(d)&&(d=g.getJson(d));d=c.initStore(d);
c.stores[a]=d;b.resolve(d)});return b},isValid:function(){return null!=this.store},_buildLoggingMessage:function(a){var b={id:g.createUUID(),level:a.level,message:a.message,host:"",data:a.data||{},time:a.time||(new Date).getTime(),type:"",show:!0,showDevice:!0};a.type&&(b.type=a.type);a.device&&a.device.host&&(b.host=a.device.host+":"+a.device.port);a.deviceMessage&&(b.message=b.message+":"+a.deviceMessage);b.ori=a;return b},initStore:function(a){var b={identifier:"time",label:"level",items:[],sort:"time"};
0==a.length&&(a=[]);for(var c=0;c<a.length;c++)b.items.push(this._buildLoggingMessage(a[c]));return new (f("LogStore",[u],{}))({idProperty:"time",data:b,id:g.createUUID()})},createLoggingView:function(a,b,c){b=b||this.getViewTarget();return g.addWidget(!1,{delegate:this,store:a,title:"Log",closable:!0,style:"padding:0px",silent:c},this,b,!0)},updateViews:function(a,b){for(var c=0;c<this.views.length;c++)this.views[c].update(a,b)},refreshViews:function(){for(var a=0;a<this.views.length;a++)this.views[a].grid.refresh()},
addLogView:function(a){this.views.push(a)},openLogView:function(a,b){this.isValid()||this.initStore([]);a=this.createLoggingView(this.store,a,b);this.views.push(a);return a},_createPendingEvent:function(a,b,c,d){function q(a){!b._isTerminated&&l&&(b.message=b.oriMessage+" : Done",a&&!0===a.failed&&(b.level="error",b.message=b.oriMessage+" : Failed"),b._isTerminated=!0,l.remove(),l=null,e.refreshViews(),b.progressHandler&&b.progressHandler.destroy())}var l=null,e=this;b._isInProgress=!0;l=e.subscribe(c,
q,e)[0];b.showProgress&&b.progressMessage&&!b.progressHandler&&(a=new w(b,this),a._onEnd=q,a._onEndHandle=l,b.progressHandler=a)},addLoggingMessage:function(a){if(a&&a.data){var b=a.data.logId;!b&&a.data&&a.data.device&&(b=a.data.device,b=b.host+"_"+b.port+"_"+b.protocol)}var c={id:g.createUUID(),level:a.level,message:a.message,host:a.host||"",data:a.data||{},time:a.time||(new Date).getTime(),type:a.type||"",show:!0,showDevice:!0,terminatorItem:a.item,terminatorMessage:a.terminatorMessage,showProgress:a.showProgress,
progressMessage:a.progressMessage,progressFailedMessage:a.progressFailedMessage,details:a.details};a.data&&(a.data.type&&(c.type=a.data.type),a.data.device&&a.data.device.host&&(c.host=a.data.device.host+":"+a.data.device.port),a.data.deviceMessage&&(c.message=c.message+":"+a.data.deviceMessage));try{null==c.terminatorMessage||c._isTerminated||(null==c.oriMessage&&(c.oriMessage=""+c.message),this._createPendingEvent(c.oriMessage,c,c.terminatorMessage,c.time));var d=this.getStore(b);d&&(d.then?d.then(function(a){d=
a;c=a.putSync(c);a._emit("added",{item:c,store:d})}):(c=d.putSync(c),d._emit("added",{item:c,store:d})))}catch(q){console.error("adding log message to store failed "+q)}},onServerLogMessage:function(a){a.data&&a.data.time&&(a.time=a.data.time);this.addLoggingMessage(a);!0===a.write&&this.publish(m.EVENTS.ON_CLIENT_LOG_MESSAGE,{message:a.message,data:a.data,details:a.details,level:a.level,type:a.type,time:a.data.time||a.time})},init:function(){this.subscribe([m.EVENTS.ON_SERVER_LOG_MESSAGE]);this.views=
[];this.stores={}},onStoreReloaded:function(){for(var a=0;a<this.views.length;a++){var b=this.views[a];b.reload(this.store);b.update()}},reload:function(){var a=this;this.currentItem=null;this.ls(function(b){a.onStoreReloaded(b)})},ls:function(a,b,c){var d=this;return this.callMethodEx(null,"lsAbs",[b||""],c||function(b){d.rawData=b;_.isString(b)&&(b=g.getJson(b));d.store=d.initStore(b);a&&a(b)},!0)}})})},"xlog/views/LogGrid":function(){define("xdojo/declare xide/types xgrid/ListRenderer xgrid/Grid xgrid/Defaults xgrid/Focus xgrid/KeyboardNavigation xgrid/Search xgrid/Layout dgrid/OnDemandGrid xide/mixins/EventedMixin xide/utils xaction/DefaultActions xide/widgets/_Widget xlang/i18".split(" "),
function(k,f,h,e,r,m,g,n,p,t,u,v,w,a,b){h=e.createGridClass("xlog.views.LogGrid",{options:v.clone(f.DEFAULT_GRID_OPTIONS)},{SELECTION:!0,KEYBOARD_SELECTION:!0,PAGINATION:f.GRID_FEATURES.PAGINATION,ACTIONS:f.GRID_FEATURES.ACTIONS,CONTEXT_MENU:f.GRID_FEATURES.CONTEXT_MENU,TOOLBAR:f.GRID_FEATURES.TOOLBAR,FILTER:{CLASS:g},SEARCH:{CLASS:n},WIDGET:{CLASS:a}},{RENDERER:h},{},{GRID:t,EDITOR:null,LAYOUT:p,DEFAULTS:r,RENDERER:h,EVENTED:u,FOCUS:m});e=f.ACTION;return k("xlog.views.LogView",h,{rowsPerPage:30,
minRowsPerPage:100,delegate:{getStore:function(){},removeStore:function(){}},_columns:{Level:!0,Type:!1,Message:!0,Time:!1},permissions:[e.RELOAD,e.DELETE,e.LAYOUT,e.COLUMNS,e.SELECTION,e.SAVE,e.SEARCH,e.TOOLBAR],runAction:function(a){var b=this;"File/Reload"===a.command&&(this.delegate.removeStore(this.storeId),this.delegate.getStore(this.storeId).then(function(a){b.collection=a;b.set("collection",b.collection.filter(b.getRootFilter()).sort(b.getDefaultSort()))}));"File/Delete"===a.command&&(this.delegate.empty(this.storeId),
this.set("collection",this.collection.filter(this.getRootFilter()).sort(this.getDefaultSort())));return this.inherited(arguments)},getRootFilter:function(){return{show:!0}},postMixInProperties:function(){this.columns=this.getColumns();return this.inherited(arguments)},getDefaultSort:function(){return[{property:"time",descending:!0}]},getMessageFormatter:function(a,b){var c=this;b.progressHandler&&!b._subscribedToProgress&&(b.progressHandler._on("progress",function(){c.refresh()}),b._subscribedToProgress=
!0);var d=null!==b.terminatorMessage&&!0===b._isTerminated;b.terminatorMessage||(d=!0);return d?a:'\x3cspan class\x3d"fa-spinner fa-spin" style\x3d"margin-right: 4px"\x3e\x3c/span\x3e'+a},getColumns:function(){var a=this,d={Level:{field:"level",label:"Level",sortable:!0,formatter:function(a){switch(a){case "info":return'\x3cspan class\x3d"text-info" style\x3d""\x3e'+a+"\x3c/span\x3e";case "error":return'\x3cspan class\x3d"text-danger" style\x3d""\x3e'+a+"\x3c/span\x3e";case "warn":return'\x3cspan class\x3d"text-warning" style\x3d""\x3e'+
a+"\x3c/span\x3e"}return a}},Type:{field:"type",label:"Type",sortable:!0},Host:{field:"host",label:"Host",sortable:!0},Message:{field:"message",label:"Message",sortable:!0,formatter:function(b,c){return a.getMessageFormatter(b,c)}},Time:{field:"timeStr",label:"Time",sortable:!0,get:function(a){return a.time},formatter:function(a,c){if(!c.timeStr){if(""===a)return a;b.translations.dateFormat&&(a=b.formatDate(a),c.timeStr=a.replace("ms",""))}return c.timeStr}}};this.showSource||delete d.Host;return d},
set:function(a,b){var c=this;"collection"==a&&c.addHandle("added",b._on("added",function(){c.refresh()}));return this.inherited(arguments)},_onMessage:function(a){this._showing?this.isMyLog&&!1===this.isMyLog(a)||this.refresh():this._dirty=!0},onShow:function(){this._dirty&&(this.refresh(),this._dirty=!1);return this.inherited(arguments)},startup:function(){this.addActions(w.getDefaultActions(this.permissions,this));this.inherited(arguments);this.subscribe(f.EVENTS.ON_SERVER_LOG_MESSAGE,this._onMessage);
this.resize()}})})}}});
//# sourceMappingURL=xlog.js.map