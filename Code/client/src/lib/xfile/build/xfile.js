//>>built
require({cache:{"xfile/main":function(){define("dojo/_base/kernel xfile/types xfile/component xfile/views/Grid xfile/views/FileGrid xfile/FileActions xfile/Statusbar xfile/ThumbRenderer xfile/Breadcrumb xfile/types xfile/component xfile/config xfile/model/File xfile/manager/FileManager xfile/manager/MountManager xfile/manager/BlockManager xfile/views/FileConsole xfile/data/DriverStore xfile/views/FileGridLight xfile/views/manager/Electron".split(" "),function(){return dojo.xfile})},"xfile/types":function(){define(["dojo/_base/lang",
"xide/types","xide/types/Types"],function(r,k){k.registerCustomMimeIconExtension=function(e,a){k.customMimeIcons[e]=a};var g=k.ACTION;k.DEFAULT_FILE_GRID_PERMISSIONS=[g.EDIT,g.COPY,g.CLOSE,g.MOVE,g.RENAME,g.DOWNLOAD,g.RELOAD,g.DELETE,g.NEW_FILE,g.NEW_DIRECTORY,g.CLIPBOARD,g.LAYOUT,g.COLUMNS,g.SELECTION,g.PREVIEW,g.OPEN_IN,g.GO_UP,g.SEARCH,g.OPEN_IN_TAB,g.TOOLBAR,g.STATUSBAR,g.UPLOAD,g.SOURCE,g.SIZE_STATS,g.CONSOLE,g.HEADER,"File/Compress","File/New",g.CONTEXT_MENU];k.FIELDS={SHOW_ISDIR:1602,SHOW_OWNER:1604,
SHOW_MIME:1608,SHOW_SIZE:1616,SHOW_PERMISSIONS:1632,SHOW_TIME:1633,SHOW_FOLDER_SIZE:1634,SHOW_FOLDER_HIDDEN:1635,SHOW_TYPE:1636,SHOW_MEDIA_INFO:1637};k.FILE_PANEL_LAYOUT={TREE:1,LIST:2,THUMB:3,PREVIEW:4,COVER:5,SPLIT_VERTICAL:6,SPLIT_HORIZONTAL:7,IMAGE_GRID:8};k.LAYOUT_PRESET={DUAL:1,SINGLE:2,BROWSER:3,PREVIEW:4,GALLERY:5,EDITOR:6};k.PANEL_OPTIONS={ALLOW_NEW_TABS:!0,ALLOW_MULTI_TAB:!1,ALLOW_INFO_VIEW:!0,ALLOW_LOG_VIEW:!0,ALLOW_CONTEXT_MENU:!0,ALLOW_LAYOUT_SELECTOR:!0,ALLOW_SOURCE_SELECTOR:!0,ALLOW_COLUMN_RESIZE:!0,
ALLOW_COLUMN_REORDER:!0,ALLOW_COLUMN_HIDE:!0,ALLOW_ACTION_TOOLBAR:!0,ALLOW_MAIN_MENU:!0};k.FILE_PANEL_OPTIONS_LEFT={LAYOUT:2,AUTO_OPEN:!0};k.FILE_PANEL_OPTIONS_MAIN={LAYOUT:3,AUTO_OPEN:!0};k.FILE_PANEL_OPTIONS_RIGHT={LAYOUT:3,AUTO_OPEN:!0};k.FILE_GRID_COLUMNS={NAME:"name",SIZE:"size",MODIFIED:"modified"};k.ACTION_TOOLBAR_MODE={SELF:"self"};r.mixin(k.ITEM_TYPE,{FILE:"BTFILE"});r.mixin(k.EVENTS,{STORE_CHANGED:"onStoreChange",BEFORE_STORE_CHANGE:"onBeforeStoreChange",STORE_REFRESHED:"onStoreRefreshed",
ON_FILE_STORE_READY:"onFileStoreReady",ON_DID_OPEN_ITEM:"onDidOpenItem",ON_SHOW_PANEL:"onShowPanel",ITEM_SELECTED:"onItemSelected",ERROR:"fileOperationError",STATUS:"fileOperationStatus",IMAGE_LOADED:"imageLoaded",IMAGE_ERROR:"imageError",RESIZE:"resize",ON_UPLOAD_BEGIN:"onUploadBegin",ON_UPLOAD_PROGRESS:"onUploadProgress",ON_UPLOAD_FINISH:"onUploadFinish",ON_UPLOAD_FAILED:"onUploadFailed",ON_CLIPBOARD_COPY:"onClipboardCopy",ON_CLIPBOARD_PASTE:"onClipboardPaste",ON_CLIPBOARD_CUT:"onClipboardCut",
ON_CONTEXT_MENU_OPEN:"onContextMenuOpen",ON_PLUGIN_LOADED:"onPluginLoaded",ON_PLUGIN_READY:"onPluginReady",ON_MAIN_VIEW_READY:"onMainViewReady",ON_FILE_CONTENT_CHANGED:"onFileContentChanged",ON_PANEL_CLOSED:"onPanelClosed",ON_PANEL_CREATED:"onPanelCreated",ON_COPY_BEGIN:"onCopyBegin",ON_COPY_END:"onCopyEnd",ON_DOWNLOAD_TO_BEGIN:"onDownloadToBegin",ON_DOWNLOAD_TO_END:"onDownloadToEnd",ON_DELETE_BEGIN:"onDeleteBegin",ON_DELETE_END:"onDeleteEnd",ON_MOVE_BEGIN:"onMoveBegin",ON_MOVE_END:"onMoveEnd",ON_COMPRESS_BEGIN:"onCompressBegin",
ON_COMPRESS_END:"onCompressEnd",ON_SOURCE_MENU_OPEN:"onSourceMenuOpen",ON_MOUNT_DATA_READY:"onMountDataReady",ON_XFILE_READY:"onXFileReady",ON_CHANGE_PERSPECTIVE:"onChangePerspective",ON_FILE_PROPERTIES_RENDERED:"onFilePropertiesRendered"});k.SELECTION_MODE={SINGLE:"single",MULTI:"multiple",EXTENDED:"extended"};k.OPERATION={COPY:"copy",MOVE:"move",RENAME:"rename",DELETE:"delete",OPEN:"open",EDIT:"edit",DOWNLOAD:"download",DOWNLOAD_TO:"downloadTo",INFO:"info",COMPRESS:"compress",RELOAD:"reload",PREVIEW:"preview",
INSERT_IMAGE:"insertImage",COPY_PASTE:"copypaste",DND:"dnd",OPTIONS:"options",NEW_FILE:"mkfile",NEW_DIRECTORY:"mkdir",GET_CONTENT:"get",SET_CONTENT:"set",FIND:"find",CUSTOM:"custom",PERMA_LINK:"permaLink",ADD_MOUNT:"ADD_MOUNT",REMOVE_MOUNT:"REMOVE_MOUNT",EDIT_MOUNT:"EDIT_MOUNT",PERSPECTIVE:"PERSPECTIVE",EXTRACT:"extract"};k.OPERATION_INT={NONE:0,EDIT:1,COPY:2,MOVE:3,INFO:4,DOWNLOAD:5,COMPRESS:6,DELETE:7,RENAME:8,DND:9,COPY_PASTE:10,OPEN:11,RELOAD:12,PREVIEW:13,INSERT_IMAGE:15,NEW_FILE:16,NEW_DIRECTORY:17,
UPLOAD:18,READ:19,WRITE:20,PLUGINS:21,CUSTOM:22,FIND:23,PERMA_LINK:24,ADD_MOUNT:25,REMOVE_MOUNT:26,EDIT_MOUNT:27,PERSPECTIVE:28,CLIPBOARD_COPY:29,CLIPBOARD_CUT:30,CLIPBOARD_PASTE:31,EXTRACT:32};return k})},"xfile/component":function(){define(["dojo/_base/declare","xide/model/Component"],function(r,k){return r("xfile.component",k,{beanType:"BTFILE",getDependencies:function(){return["xfile/types","xfile/manager/FileManager","xfile/manager/MountManager","xfile/factory/Store","xfile/views/FileGrid"]},
getLabel:function(){return"xfile"},getBeanType:function(){return this.beanType}})})},"xfile/views/Grid":function(){define("xdojo/declare xide/types xgrid/ListRenderer xfile/ThumbRenderer xgrid/TreeRenderer xgrid/Grid xgrid/MultiRenderer xfile/FileActions xfile/Statusbar xfile/views/UploadMixin xide/views/_LayoutMixin xgrid/KeyboardNavigation xgrid/Search xgrid/Selection xide/mixins/_State xide/widgets/_Widget xdojo/has!FileConsole?xfile/views/FileConsole xfile/FolderSize xide/noob".split(" "),function(r,
k,g,e,a,d,w,v,m,q,p,b,n,t,h,f,c,l,u){g=[g,e,a];r=r.classFactory("multiRenderer",{},g,w.Implementation);k=d.createGridClass("xfile.views.Grid",{},{SELECTION:{CLASS:t},KEYBOARD_SELECTION:!0,CONTEXT_MENU:k.GRID_FEATURES.CONTEXT_MENU,TOOLBAR:k.GRID_FEATURES.TOOLBAR,CLIPBOARD:k.GRID_FEATURES.CLIPBOARD,ACTIONS:k.GRID_FEATURES.ACTIONS,ITEM_ACTIONS:{CLASS:v},STATUS_BAR:{CLASS:m},SPLIT:{CLASS:p},KEYBOARD_NAVIGATION:{CLASS:b},SEARCH:{CLASS:n},STATE:{CLASS:h},UPLOAD:{CLASS:q},WIDGET:{CLASS:f},CONSOLE:{CLASS:c?
c:u},SIZES:{CLASS:l}},{RENDERER:r},{renderers:g,selectedRenderer:a});k.DEFAULT_RENDERERS=g;k.DEFAULT_MULTI_RENDERER=r;return k})},"xfile/ThumbRenderer":function(){define(["xdojo/declare","xide/utils","dojo/dom-construct","xgrid/ThumbRenderer"],function(r,k,g,e){return r("xfile.ThumbRenderer",[e],{thumbSize:"400",resizeThumb:!0,__type:"thumb",deactivateRenderer:function(){$(this.domNode.parentNode).removeClass("metro");$(this.domNode).css("padding","");this.isThumbGrid=!1},activateRenderer:function(){$(this.domNode.parentNode).addClass("metro");
$(this.contentNode).css("padding","8px");this.isThumbGrid=!0;this.refresh()},_renderUpload:function(a,d,e){d=parseInt(d.replace("%",""));100==d&&(d=90);a='\x3cdiv class\x3d"tile widget uploadItem"\x3e\x3cdiv class\x3d"radial-progress tile widget " data-progress\x3d"'+d+'"\x3e\x3cdiv class\x3d"circle"\x3e\x3cdiv class\x3d"mask full"\x3e\x3cdiv class\x3d"fill"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mask half"\x3e\x3cdiv class\x3d"fill"\x3e\x3c/div\x3e\x3cdiv class\x3d"fill fix"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"shadow"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"inset"\x3e\x3cdiv class\x3d"percentage"\x3e\x3cdiv class\x3d"numbers"\x3e\x3cspan\x3e-\x3c/span\x3e';
for(d=0;99>d;d++)a+="\x3cspan\x3e"+d+"%\x3c/span\x3e";return a+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"},renderRow:function(a){if(!0===a.isUpload)return $(this._renderUpload(a.name,a.progress+"%",a))[0];if(a.renderRow){var d=a.renderRow.apply(this,[a]);if(d)return d}var d=g.create("div",{className:"tile widget"}),e=!1===a.read&&!1===a.write,v=".."==a.name,m=a&&!!a.directory,q=!1,p="",b="fa fa-folder fa-5x";this._doubleWidthThumbs=!0;var n="icon";m?(b=v?"fa fa-level-up fa-5x itemFolder":
e?"fa fa-lock fa-5x itemFolder":"fa fa-folder fa-5x itemFolder",q=!0):e?(b="fa fa-lock fa-5x itemFolder",q=!0):k.isImage(a.path)?(b=this.getImageUrl(a),a.icon=b?b:this.config.REPO_URL+"/"+a.path,b="imageFile"):(b="fa fa-5x "+k.getIconClass(a.path),q=!0);p=a.name;e='\x3cspan style\x3d"text-shadow: 2px 2px 5px rgba(0,0,0,0.3);font-size: 72px;opacity: 0.7" class\x3d"fa fa-6x '+b+'"\x3e\x3c/span\x3e';k.isImage(a.path)&&(b=this.getImageUrl(a),a.icon=b?b:this.config.REPO_URL+"/"+a.path,b="",n="image",e=
'\x3cdiv style\x3d"" class\x3d"tile-content image"\x3e\x3cimg class\x3d"'+b+'" src\x3d"'+a.icon+'"/\x3e\x3c/div\x3e',q=!0);p='\x3cdiv title\x3d"'+(p+"\n"+a.modified)+'" class\x3d"tile-content '+n+'"\x3e'+e+'\x3c/div\x3e\x3cdiv class\x3d"brand opacity"\x3e\x3cspan class\x3d"thumbText text opacity ellipsis" style\x3d""\x3e'+p+"\x3c/span\x3e\x3c/div\x3e";if(q)return d.innerHTML=p,d;d.innerHTML=m?p:'\x3cimg class\x3d"'+b+'" src\x3d"'+a.icon+'"/\x3e\x26nbsp;\x3cdiv class\x3d"name"\x3e'+a.name+"\x3c/div\x3e";
return d},renderRow2:function(a){var d=g.create("span",{className:"cell"}),e=!1===a.read&&!1===a.write,v=".."==a.name,m=a&&!!a.directory,q="",p=!1,b="";m?(q=v?"fa fa-level-up fa-5x itemFolder":e?"fa fa-lock fa-5x itemFolder":"fa fa-folder fa-5x itemFolder",p=!0):e?(q="fa fa-lock fa-5x itemFolder",p=!0):k.isImage(a.path)?(e=this.getImageUrl(a),a.icon=e?e:this.config.REPO_URL+"/"+a.path,q="imageFile"):(q="fa fa-5x "+k.getIconClass(a.path),p=!0);b=!0===a.showPath?a.path:a.name;if(p)return d.innerHTML=
'\x3cspan class\x3d"'+q+'""\x3e\x3c/span\x3e \x3cdiv class\x3d"name" style\x3d""\x3e'+b+"\x3c/div\x3e",d;d.innerHTML=m?'\x3cspan class\x3d"'+q+'""\x3e\x3c/span\x3e \x3cdiv class\x3d"name"\x3e'+a.name+"\x3c/div\x3e":'\x3cimg class\x3d"'+q+'" src\x3d"'+a.icon+'"/\x3e\x26nbsp;\x3cdiv class\x3d"name"\x3e'+a.name+"\x3c/div\x3e";return d},getImageUrl:function(a){var d=this.ctx.getFileManager();if(d&&d){var e=null;this.resizeThumb&&(e={width:this.thumbSize});return d.getImageUrl(a,null,e)}return null}})})},
"xfile/FileActions":function(){define("dcl/dcl xdojo/declare xdojo/has dojo/Deferred xide/utils xide/types xide/factory xide/model/Path xaction/DefaultActions xide/editor/Registry xide/editor/Default dojo/aspect xfile/views/FileOperationDialog xfile/views/FilePreview xide/views/_CIDialog xide/views/_Dialog xide/views/_PanelDialog xfile/views/FilePicker".split(" "),function(r,k,g,e,a,d,w,v,m,q,p,b,n,t,h,f,c,l){function u(){return{includes:["*",".*"],excludes:[],mode:1502}}function y(f,b){var h=b.userData.value||
"./AA/xfile_last/data/su.jpg",u=new e,n=this,p=new c({size:d.DIALOG_SIZE.SIZE_NORMAL,bodyCSS:{height:"auto","min-height":"500px",padding:"8px","margin-right":"16px"},picker:null,title:b.title,onOk:function(){var c=this.picker._selection;c&&c[0]&&(b.set("value",c[0].path),u.resolve(c[0].path),p.value=c[0].path)},onShow:function(c,f){var b=a.addWidget(l,{ctx:n.ctx,owner:n,selection:h||"./AA/xfile_last/data/su.jpg",resizeToParent:!0,mount:n.collection.mount,storeOptionsMixin:{includeList:"*,.*",excludeList:""},
Module:n.Module,permissions:a.clone(n.Module.DEFAULT_PERMISSIONS)},this,f,!0);this.picker=b;this.add(b,null,!1);this.startDfd.resolve();return[this.picker]}});p.show();return u}var x=d.ACTION;b={touch:function(){var c=new e;try{var f=this,b=this.getSelectedItem(),l=this.getCurrentFolder(),u=b?a.pathinfo(b.path,d.PATH_PARTS.ALL).filename:"",n=this.collection,p={inputs:[a.createCI("Name",13,u,{widget:{instant:!0,validator:function(c){return l?null==n.getSync(l.path+"/"+c)&&0<c.length:!0}}})]},t={select:b,
focus:!0,append:!1};(new h({cis:p,title:"Create new File",ctx:this.ctx,size:d.DIALOG_SIZE.SIZE_SMALL,bodyCSS:{height:"auto","min-height":"80px"},_onError:function(c,f,b){c=c||this.title;(b=b||this.notificationMessage)&&b.update({message:c+this.failedText+(f?"\x3cbr/\x3e"+f:""),type:"error",actions:!1,duration:15E3});this.onError&&this.onError(f)},onCancel:function(){c.resolve()},onOk:function(){var b=this.getField("name");if(null==b)c.resolve(t);else{var l=(f.getCurrentFolder()||{path:"."}).path+
"/"+b;f.ctx.getFileManager().mkfile(n.mount,l,{checkErrors:!0,returnProm:!1}).then(function(b){f.runAction(x.RELOAD).then(function(){n.getSync(l)&&c.resolve({select:l,append:!1,focus:!0})})},function(f){c.resolve(t);logError(f,"error creating directory")})}}})).show()}catch(w){logError(w,"error creating dialog")}return c},newTabArgs:null,openInOS:function(c){var f=this.ctx.getResourceManager().getVariable("VFS_CONFIG")||{},b=c.mount.replace("/","");if(f[b]){var l=window.eRequire;l||console.error("have no electron");
var h=l("os"),u=l("electron").shell,l=l("path"),b=f[b],b=a.replaceAll(" ","",b);c=c.path.replace("./","/");c=a.replaceAll("/",l.sep,c);b=l.resolve(b+l.sep+c);b=a.replaceAll(" ","",b);"win32"!==h.platform()?u.openItem(b):u.openItem("file:///"+b)}else console.error("open in os failed: have no VFS config for "+b)},getFileActions:function(c){c=c||this.permissions;var f=[],b=d.ACTION,l=d.ACTION_ICON,a=this,h=a.ctx,u=a.domNode,e=h.getResourceManager();e&&e.getVariable("VFS_CONFIG");a.getActionStore();f.push(a.createAction({label:"Go up",
command:b.GO_UP,icon:l.GO_UP,tab:"Home",group:"Navigation",keycombo:["backspace"],mixin:{quick:!0}}));f.push(a.createAction({label:"Copy",command:b.COPY,icon:"fa-paste",tab:"Home",group:"Organize",keycombo:["f5"],shouldDisable:function(){return null==a.getSelectedItem()}}));f.push(a.createAction({label:"Close",command:b.CLOSE,icon:"fa-close",tab:"View",group:"Organize",keycombo:["ctrl 0"]}));f.push(a.createAction({label:"Move",command:b.MOVE,icon:"fa-long-arrow-right",tab:"Home",group:"Organize",
keycombo:["f6"],shouldDisable:function(){return null==a.getSelectedItem()}}));location.href.indexOf("electron\x3dtrue")||g("electronx");f.push(this.createAction("Open In New Tab","File/OpenInNewTab","fa-share",["alt enter"],"Home","Open","item",null,null,{quick:!0},null,function(){var c=a.getSelectedItem();return c&&c.isDir?!1:!0},c,u,a));if(h&&h.getMountManager&&m.hasAction(c,b.SOURCE)){c.push(b.SOURCE);var n=h.getMountManager().getMounts(),p=0;if(n&&0<n.length){var t=a.collection.mount;f.push(this.createAction({label:"Source",
command:b.SOURCE,icon:"fa-hdd-o",keyCombo:["ctrl f1"],tab:"Home",group:"Navigation",mixin:{data:n,addPermission:!0,quick:!0},onCreate:function(c){c.set("value",t)}}));_.each(n,function(l){var h=l.label;c.push(b.SOURCE+"/"+h);h=a.createAction({label:h,command:b.SOURCE+"/"+h,icon:"fa-hdd-o",keyCombo:["alt f"+p],tab:"Home",group:"Navigation",mixin:{data:n,item:l,closeOnClick:!1,quick:!0},onCreate:function(c){c.set("value",l.name);c._oldIcon=this.icon;c.actionType=d.ACTION_TYPE.SINGLE_TOGGLE}});f.push(h);
p++})}}return f.concat(this.getEditorActions(c))},rename:function(c){var f=new e,b=this,l=c||this.getSelectedItem();c=this.getSelection();var u=this.getCurrentFolder(),n=l?a.pathinfo(l.path,d.PATH_PARTS.ALL).basename:"",p=this.collection,t={select:c,focus:!0,append:!1};c={inputs:[a.createCI("name",d.ECIType.STRING,n,{widget:{instant:!0,title:"New Name",validator:function(c){return null==p.getSync(u.path+"/"+c)&&0<c.length}}})]};(new h({cis:c,title:"Rename",ctx:this.ctx,size:d.DIALOG_SIZE.SIZE_NORMAL,
bodyCSS:{height:"auto","min-height":"80px",width:"100%","min-width":"400px"},onCancel:function(){f.resolve(t)},onOk:function(){var c=this.getField("name");if(null==c)f.resolve(t);else{var a=b.getCurrentFolder();b.ctx.getFileManager().rename(l.mount,l.path,c,{checkErrors:!0,returnProm:!1}).then(function(l){b.runAction(x.RELOAD).then(function(){t.select=a.path+"/"+c;f.resolve(t)})},function(c){logError(c,"__error renaming file!");f.resolve(t)})}}})).show();return f},move:function(c){var f=new e,b=this;
c=this.getSelectedItem();var l=this.getSelection(),n=this.getCurrentFolder();c&&a.pathinfo(c.path,d.PATH_PARTS.ALL);var p=this.collection,t={select:l,focus:!0,append:!1};if(!c.directory){var w=c.getParent();w&&(c=w)}c={inputs:[a.createCI("Name",d.ECIType.FILE,c.path,{widget:{instant:!0,title:"Target",validator:function(c){return null==p.getSync(n.path+"/"+c)&&0<c.length}}})]};var g=new h({cis:c,title:b.localize("Move"),ctx:this.ctx,size:d.DIALOG_SIZE.SIZE_NORMAL,onCancel:function(){f.resolve(t)},
onOk:function(){var c=this.getField("name");if(null==c)f.resolve(t);else{var h=b._buildServerSelection(l),d=(c=b.collection.getSync(c))?a.normalizePath(c.mount+"/"+c.path):"";c&&(h.dstPath=d);c=u();b.getCurrentFolder();b.ctx.getFileManager().moveItem(h.selection,h.dstPath,c.includes,c.excludes,c.mode,{checkErrors:!0,returnProm:!1}).then(function(c){b.runAction(x.RELOAD).then(function(){f.resolve(t)})},function(c){logError(c,"__error creating file!");f.resolve(t)})}}});g._on("widget",function(c){c.widget._onSelect=
function(c){return y.apply(b,[g,c])}});g.show();return f},copy:function(c){var f=new e,b=this,l=this.getSelectedItem(),p=this.getSelection(),t=this.getCurrentFolder();l&&a.pathinfo(l.path,d.PATH_PARTS.ALL);var w=this.collection,g={select:p,focus:!0,append:!1};l.directory||(c=l.getParent())&&(l=c);c={inputs:[a.createCI("Name",d.ECIType.FILE,l.path,{widget:{instant:!0,title:"Target",validator:function(c){return null==w.getSync(t.path+"/"+c)&&0<c.length}}})]};var v=new (r([n,h],{}))({cis:c,title:b.localize("Copy"),
ctx:this.ctx,size:d.DIALOG_SIZE.SIZE_NORMAL,bodyCSS:{height:"auto","min-height":"80px",width:"100%","min-width":"400px"},onCancel:function(){f.resolve(g)},onOk:function(){var c=this.getField("name");if(null==c)f.resolve(g);else{this.showMessage();var h=this,d=b._buildServerSelection(p),n=b.collection.getSync(c),e=n?a.normalizePath(n.mount+"/"+n.path):"";d.dstPath=n?e:a.normalizePath(l.mount+"/"+c);b.getCurrentFolder();c=b.ctx.getFileManager().copyItem(d.selection,d.dstPath,u(),{checkErrors:!0,returnProm:!1});
c.then(function(c){h._onSuccess(c)},function(c){h._onError()});c.then(function(c){b.runAction(x.RELOAD).then(function(){f.resolve(g)})},function(c){logError(c,"__error creating file!");f.resolve(g)})}}});v._on("widget",function(c){c.widget._onSelect=function(c){return y.apply(b,[v,c])}});v.show();return f},clipboardPaste:function(){var c=new e,f=this.currentCutSelection,b=f?this.currentCutSelection:this.currentCopySelection,l=this._buildServerSelection(b),f=f?"moveItem":"copyItem",a=this,h={select:b,
focus:!0,append:!1};if(!b)return c.resolve(),c;b=u();a.ctx.getFileManager()[f](l.selection,l.dstPath,{include:b.includes,exclude:b.excludes,mode:b.mode}).then(function(b){a.runAction(d.ACTION.RELOAD).then(function(){c.resolve(h)})},function(b){c.resolve(h)},function(b){c.resolve(h)});return c},mkdir:function(){var c=new e;try{var b=this,f=this.getSelectedItem(),l=this.getCurrentFolder(),u=f?a.pathinfo(f.path,d.PATH_PARTS.ALL).filename:"",n=this.collection,p={inputs:[a.createCI("Name",13,u,{widget:{instant:!0,
validator:function(c){return l?null==n.getSync(l.path+"/"+c)&&0<c.length:!0}}})]},t={select:f,focus:!0,append:!1};(new h({cis:p,title:"Create new Directory",ctx:this.ctx,size:d.DIALOG_SIZE.SIZE_NORMAL,bodyCSS:{height:"auto","min-height":"80px",width:"100%","min-width":"400px"},_onError:function(c,b,f){c=c||this.title;(f=f||this.notificationMessage)&&f.update({message:c+this.failedText+(b?"\x3cbr/\x3e"+b:""),type:"error",actions:!1,duration:15E3});this.onError&&this.onError(b)},onCancel:function(){c.resolve()},
onOk:function(){var f=this.getField("name");if(null==f)c.resolve(t);else{var l=(b.getCurrentFolder()||{path:"."}).path+"/"+f;b.ctx.getFileManager().mkdir(n.mount,l,{checkErrors:!0,returnProm:!1}).then(function(f){b.runAction(x.RELOAD).then(function(){n.getSync(l)&&c.resolve({select:l,append:!1,focus:!0})})},function(b){c.resolve(t);logError(b,"error creating directory")})}}})).show()}catch(w){logError(w,"error creating dialog")}return c},_buildServerSelection:function(c,b){!b&&(b=this.getCurrentFolder());
b&&!b.directory&&(b=b.getParent());_.isArray(c)||(c=[c]);var f=[],l=c[0].getStore(),h=b?a.normalizePath(b.mount+"/"+b.path):"";_.each(c,function(c){l.getSync(c.path)&&f.push(a.normalizePath(c.mount+"/"+c.path))});return{selection:f,store:c[0]._S,dstPath:"/"+h+"/",firstItem:c[0],parent:b}},openPreview:function(c,b){var f=this.row(c).element,l=this,a=new e;if(this._preview)return this._preview.item=c,this._preview.open().then(function(){l._preview.preview.trigger($.Event("update",{file:c}))});var h=
new t({node:$(f),item:c,delegate:this.ctx.getFileManager(),parent:$(f),ctx:l.ctx,container:b?b.containerNode:null});b?h.buildRenderingEmbedded():h.buildRendering();h.init();h.exec();this._preview=h;this._preview.handler=this;l._on("selectionChanged",function(c){if(c=l.getSelectedItem())h.item=c,h.preview.trigger($.Event("update",{file:c}))});this.add(h,null,!1);h._emit("changeState",function(b){0===b&&a.resolve({select:c,focus:!0,append:!1})});return a},deleteSelection:function(c){c=c||this.getSelection();
var b=new e,f=this.getNext(c[0],null,!0),l=this.getPrevious(c[0],null,!0),a=f||l,h=this._buildServerSelection(c),u=this;(new n({ctx:u.ctx,notificationMessage:null,title:"Delete "+h.selection.length+" items",type:d.DIALOG_TYPE.DANGER,onBeforeOk:function(){},getOkDfd:function(){var c=this;return this.ctx.getFileManager().deleteItems(h.selection,{hints:[1]},{checkErrors:!1,returnProm:!1,onError:function(b){c._onError(null,b.message)}})},onCancel:function(){b.resolve({select:c,focus:!0,append:!1})},onSuccess:function(){u.runAction(d.ACTION.RELOAD).then(function(){b.resolve({select:a,
focus:!0,append:!1})})}})).show();return b},goUp:function(c){c=this._history.getNow();c=_.isString(c)?this.collection.getSync(c):c;var b=new e,f=this,l=this.getHistory().getNow();if(!c){var a=this.getRows();a[0]&&a[0]._S&&(a=a[0]._S.getParent(a[0]))&&(a=a._S.getParent(a))&&(c=a)}c?(a=c._S.getParent(c))&&(c=this.openFolder(a,!0,!1))&&c.then&&c.then(function(){if(l){var c=f.collection.getSync(l);c&&b.resolve({select:c,focus:!0,delay:1})}}):l?(c=this.collection.getSync(l))&&this.select([c],null,!0,{focus:!0,
delay:1}):(a=this.getRows(),a[0]&&a[0]._S&&(a=a[0]._S.getParent(a[0]))&&(a=a._S.getParent(a))&&this.openFolder(a,!0));return b},reload:function(c){var b=new e,f=this.getSelection();c=c||this.getRows()[0];var l=this.getCurrentFolder()||{path:"."},a=this;l.isBack&&(l=this.collection.getSync(l.rPath));var h=!1;this.isExpanded&&this.expand&&c&&(h=this._isExpanded(c))&&this.expand(c,null,!1);a.collection.resetQueryLog();this.collection.loadItem(l,!0).then(function(c){"."===l&&a.collection.resetQueryLog();
a.refresh().then(function(){var c=a.openItem(l,!1,!1);c&&c.then&&c.then(function(){b.resolve({select:f,append:!1,focus:!0,delay:1})});a.deselectAll();b.resolve({select:f,append:!1,focus:!0,delay:2})})});return b},toHistory:function(c){c=(c.getFolder?new v(c.getFolder()):new v(".")).getSegments();var b=this.collection.rootSegment,f=b;c&&"."===c[0]&&(c[0]=b);var l=[];_.each(c,function(c){c=c!==f?f+(f.endsWith("/")?"":"/")+c:c;l.push(c);f=c});return l},openFolder:function(c,b,f){var l=this.getCurrentFolder(),
a=this.collection,h=this.getHistory();h.getNow();h.getNow();var u=this;(c=_.isString(c)?a.getSync(c):a.getSync(c.path)||c)||(c=a.getRootItem());var d=u.toHistory(c);h.set(d);if(!c)return this.setQueryEx(a.getRootItem());if(!(l&&c&&b&&l.path===c.path)&&c){this.deselectAll();var l=(l=this.row(c))?l.element:null,n;c._S.isItemLoaded(c)||((l=$(l).find("span.fa"))&&l[0]&&(n=$(l[0])),n&&(n.removeClass("fa fa-folder"),n.addClass("fa-spinner fa-spin")));var p=new e;this._emit("openFolder",{item:c,back:b});
(l=this.setQueryEx(c,null))&&l.then(function(){n&&(n.addClass("fa fa-folder"),n.removeClass("fa-spinner fa-spin"));p.resolve({select:!1!==f?b?c:u.getRows()[0]:null,focus:!0,append:!1,delay:1});u._emit("openedFolder",{item:c,back:b})});return p}},changeSource:function(c,b){var f=new e,l=this,a=l.ctx||a,h=a.getFileManager(),u=w.createFileStore(c.name,null,h.config,null,a),n=this.collection,a=this.getAction(x.SOURCE),h=c.label||c.name,d=this.getAction(x.SOURCE+"/"+h);n.destroy();!0!==b&&this._emit("changeSource",
c);this.set("loading",!0);this.set("collection",u.getDefaultCollection());a.set("value",c.name);l.set("title","Files ("+c.label+")");u=a.getChildren();_.each(u,function(c){c.set("icon",c._oldIcon)});a.set("label",h);d&&d.set("icon","fa-spinner fa-spin");this.refresh().then(function(){l.set("loading",!1);d&&d.set("icon","fa-check");!0!==b&&l._emit("changedSource",c);l.select([0],null,!0,{append:!1,focus:!0}).then(function(){f.resolve()})});return f},openInNewTab:function(c){var b=this.ctx,f=b.getWindowManager(),
l=new e,h=null,h=_.isFunction(this.newTarget)?this.newTarget({title:c.name,icon:"fa-folder",target:this._parent,location:null,tabOrientation:null}):f.createTab(c.name,"fa-folder",this.newTarget||this),u=this.collection;c.isDir||(c=this.getCurrentFolder());var n=w.createFileStore(u.mount,u.options,u.config,null,b),b=a.mixin({showToolbar:this.showToolbar,collection:n,selectedRenderer:this.selectedRenderer,showHeader:this.showHeader,newTarget:this.newTarget,style:this.style,options:a.clone(this.options),
permissions:this.permissions,_columns:this._columns,attachDirect:!0,registerEditors:this.registerEditors},this.newTabArgs||{}),d=a.addWidget(this.getClass(),b,null,h,!1);l.resolve();d.set("loading",!0);n.initRoot().then(function(b){(b=n.getItem(c.path,!0))&&b.then(function(){d.startup();d.refresh().then(function(){d.openItem(c).then(function(){d.focus();d.select([0],null,!0,{focus:!0,append:!1,delay:1});d.set("loading",!1)});f.registerView(d,!0)})})});return l},openItem:function(c,b,f){if(!c){var l=
this.getRows();l[0]&&l[0].isBack&&(c=l[0])}if(c&&c.isBack)return c._S=null,this.goUp();if(c=_.isString(c)?this.collection.getSync(c):c){if(!0===c.directory)return this.openFolder(c,b,f);b=q.getEditors(c);return(b=_.find(b,function(c){return!0===c.isDefault}))?b.onEdit(c,this):this.ctx.getWindowManager().openItem(c,this.newTarget||this,{global:!0})}},getSelectedItem:function(){return this.getSelection()[0]},openDefaultEditor:function(c){return p.Implementation.open(c)},close:function(){var c=this._parent;
if(c){var b=c.docker();b&&(this.onAfterAction=null,b.removePanel(c))}return!1},compress:function(c){c=c||this.getSelection();var b=this;(c=this._buildServerSelection(c))&&c.store&&c.selection&&b.ctx.getFileManager().compressItem(c.firstItem.mount,c.selection,"zip").then(function(c){b.reload()})},runAction:function(c,b){_.isString(c)&&(c=this.getAction(c));if(c&&c.command){var f=d.ACTION,l=this.getSelectedItem()||b,a=this.getSelection();if(-1!=c.command.indexOf(x.SOURCE))return this.changeSource(c.item);
switch(c.command){case "File/Compress":return this.compress(a);case f.PREVIEW:return this.openPreview(l);case "File/OpenInNewTab":return this.openInNewTab(l||this.collection.getRootItem());case f.EDIT:return this.openItem(l);case f.NEW_FILE:return this.touch(l);case f.NEW_DIRECTORY:return this.mkdir(l);case f.RELOAD:return this.reload(l);case f.RENAME:return this.rename(l);case f.GO_UP:return this.goUp(null);case f.COPY:return this.copy(null);case f.MOVE:return this.move(null);case f.DELETE:return this.deleteSelection(null);
case f.OPEN_IN+"/Default Editor":return this.openDefaultEditor(l);case f.DOWNLOAD:return this.ctx.getFileManager().download(l);case f.CLOSE:return this.close();case "File/OpenInOS":return this.openInOS(l)}return-1!=c.command.indexOf(f.OPEN_IN+"/")?c.editor.onEdit(l):this.inherited(arguments)}},getEditorActions:function(c){function b(c){function f(c,b){b.handler=function(){c.onEdit(e.getSelection()[0])}}function l(c){c=q.getEditors(c)||[];for(var b=[],a=0;a<c.length;a++){var h=c[a];if("Default Editor"!==
h.name){var d=e.createAction(h.name,n.OPEN_IN+"/"+h.name,h.iconClass,null,"Home","Open","item",null,function(){},{addPermission:!0,tab:"Home",editor:h,custom:!0},null,null,u,p,e);f(h,d);b.push(d)}}return b}var a=c.selection;if(a&&a[0]){var h=a[0],u=this.permissions,n=d.ACTION,e=this,p=e.domNode,t=e.getActionStore(),a=this.getContextMenu();"deselect"!=c.why&&(t.getSync(d.ACTION.OPEN_IN),c=e.addActions(l(h)),this._lastEditorActions&&(_.each(this._lastEditorActions,function(c){t.removeSync(c.command)}),
delete this._lastEditorActions),a&&a.removeCustomActions(),0<c.length&&(c=this.addActions(c),t._emit("onActionsAdded",c),this._lastEditorActions=c))}}c=c||this.permissions;var f=[],l=d.ACTION,a=d.ACTION_ICON,h=this,u=h.domNode;h.getActionStore();var n=null;this._selHandle||(this._selHandle=this._on("selectionChanged",function(c){b.apply(h,[c])}));n=this.createAction("Open In",l.OPEN_IN,a.EDIT,null,"Home","Open","item",null,function(){},{addPermission:!0,tab:"Home",onCreate:function(c){}},null,m.shouldDisableDefaultFileOnly,
c,u,h);f.push(n);c=h.createAction("Default Editor",l.OPEN_IN+"/Default Editor","fa-code",null,"Home","Open","item",null,function(){},{addPermission:!0,tab:"Home",forceSubs:!0},null,null,c,u,h);f.push(c);return f}};k=k("xfile.FileActions",null,b);k.Implementation=b;k.createFilePicker=function(b,f,h,u,n,e,p,t){(new c({size:d.DIALOG_SIZE.SIZE_NORMAL,bodyCSS:{height:"auto","min-height":"500px",padding:"8px","margin-right":"16px"},picker:null,title:u,onOk:function(){var c=this.picker._selection;c&&c[0]&&
(h(c[0]),p&&p.resolve(c[0],c,this.picker))},onShow:function(c,h){var u=a.addWidget(l,a.mixin({ctx:b.ctx,owner:b,selection:f||"./AA/xfile_last/data/su.jpg",resizeToParent:!0,storeOptionsMixin:{includeList:"*,.*",excludeList:""},Module:t,permissions:n||a.clone(d.DEFAULT_FILE_GRID_PERMISSIONS)},e),this,h,!0);this.picker=u;this.add(u);this.startDfd.resolve();return[this.picker]}})).show();return p};return k})},"xfile/views/FileOperationDialog":function(){define(["dcl/dcl","xide/types","xide/views/_Dialog"],
function(r,k,g){return r(g,{title:"",type:k.DIALOG_TYPE.INFO,size:k.DIALOG_SIZE.SIZE_SMALL,bodyCSS:{},failedText:" Failed!",successText:": Success!",showSpinner:!0,spinner:'  \x3cspan class\x3d"fa-spinner fa-spin"/\x3e',notificationMessage:null,doOk:function(e){this.onBeforeOk&&this.onBeforeOk();this.showMessage();var a=this;e.then(function(d){a._onSuccess(d)},function(d){a._onError()})},_onSuccess:function(e,a,d){e=e||this.title;(d=d||this.notificationMessage)&&d.update({message:e+this.successText+
(a?"\x3cbr/\x3e"+a:""),type:"info",actions:!1,duration:1500});this.onSuccess&&this.onSuccess()},_onError:function(e,a,d){e=e||this.title;(d=d||this.notificationMessage)&&d.update({message:e+this.failedText+(a?"\x3cbr/\x3e"+a:""),type:"error",actions:!1,duration:15E3});this.onError&&this.onError(a)},onOk:function(){this.showMessage();this.doOk(this.getOkDfd())},showMessage:function(e){if(this.notificationMessage)return this.notificationMessage;e=e||this.title;return this.notificationMessage=e=this.ctx.getNotificationManager().postMessage({message:e+
(this.showSpinner?this.spinner:""),type:"info",showCloseButton:!0,duration:4500})}})})},"xfile/views/FilePreview":function(){define("dcl/dcl xide/types xide/utils xide/mixins/EventedMixin xide/widgets/_Widget dojo/cache dojo/Deferred dijit/registry xide/editor/Default xaction/DefaultActions".split(" "),function(r,k,g,e,a,d,w,v,m,q){var p=[function(b){var a=["image/jpeg","image/png","image/gif"],d=b.preview;$.each(navigator.mimeTypes,function(b,f){var c=f.type;0===c.indexOf("image/")&&$.inArray(c,
a)&&a.push(c)});d.bind("update",function(h){var f=h.file,c;b.opened()&&-1!==$.inArray(f.mime,a)&&(h.stopImmediatePropagation(),h=null,b.resizeToPreview&&(h={width:d.width()}),c=$("\x3cimg/\x3e").hide().appendTo(d).load(function(){setTimeout(function(){var f=(c.width()/c.height()).toFixed(2);d.bind("changesize",function(){var b=parseInt(d.width()),a=parseInt(d.height()),h;f<(b/a).toFixed(2)?(h=a,b=Math.floor(h*f)):h=Math.floor(b/f);c.width(b).height(h).css("margin-top",h<a?Math.floor((a-h)/2):0)}).trigger("changesize");
b.hideinfo();c.fadeIn(100)},1)}),c.attr("src",b.fm.url(f,null,h)))})},function(b){var a=["text/html","application/xhtml+xml"],d=b.preview;d.bind("update",function(h){var f=h.file;b.opened()&&-1!==$.inArray(f.mime,a)&&(h.stopImmediatePropagation(),b.ctx.getFileManager().getContent(f.mount,f.path,function(c){b.hideinfo();doc=$('\x3ciframe class\x3d"elfinder-quicklook-preview-html"/\x3e').appendTo(d)[0].contentWindow.document;doc.open();doc.write(c);doc.close()}))})},function(b){var a=b.preview,d="application/x-empty application/javascript application/xhtml+xml audio/x-mp3-playlist application/x-web-config application/docbook+xml application/x-php application/x-perl application/x-awk application/x-config application/x-csh application/xml application/x-empty text/html text/x-c text/x-php text/plain text/x-c++ text/x-lisp".split(" ");
a.bind("update",function(h){var f=h.file,c=f.mime;if(b.opened()&&(0===c.indexOf("text/")||-1!==$.inArray(c,d))&&(h.stopImmediatePropagation(),b.useAce)){b.hideinfo();h=$('\x3cdiv class\x3d"elfinder-quicklook-preview-text-wrapper"\x3e\x3c/div\x3e');h.appendTo(a);var l=b._editor,c=l;if(!l&&(l=m.Implementation.open(f,h[0],b.editorOptions,!1,b),b._editor=l,b.add(l,null,!1),q.hasAction(b.editorOptions.permissions,k.ACTION.TOOLBAR))){var u=l.getToolbar();u&&$(u.domNode).addClass("bg-opaque")}c&&(h.append(l.domNode),
l.set("item",f));a.bind("changesize",function(){parseInt(a.width());parseInt(a.height());g.resizeTo(l.domNode,a[0],!0,!0);l.resize()})}})},function(b){var a=b.preview,d=!1,d=!1;$.each(navigator.plugins,function(b,f){$.each(f,function(c,b){if("application/pdf"==b.type)return!(d=!0)})});d&&a.bind("update",function(h){var f=h.file,c;b.opened()&&"application/pdf"==f.mime&&(h.stopImmediatePropagation(),a.one("change",function(){c.unbind("load").remove()}),c=$('\x3ciframe class\x3d"elfinder-quicklook-preview-pdf"/\x3e').hide().appendTo(a).load(function(){b.hideinfo();
c.show()}).attr("src",b.fm.url(f)))})},function(b){var a=b.fm,d=b.preview,h=!1;$.each(navigator.plugins,function(b,c){$.each(c,function(c,b){if("application/x-shockwave-flash"==b.type)return!(h=!0)})});h&&d.bind("update",function(f){var c=f.file;b.opened()&&"application/x-shockwave-flash"==c.mime&&(f.stopImmediatePropagation(),b.hideinfo(),d.append($('\x3cembed class\x3d"elfinder-quicklook-preview-flash" pluginspage\x3d"http://www.macromedia.com/go/getflashplayer" src\x3d"'+a.url(c)+'" quality\x3d"high" type\x3d"application/x-shockwave-flash" /\x3e')))})},
function(b){var a=b.preview,d=!!b.options.autoplay,h={"audio/mpeg":"mp3","audio/mpeg3":"mp3","audio/mp3":"mp3","audio/x-mpeg3":"mp3","audio/x-mp3":"mp3","audio/x-wav":"wav","audio/wav":"wav","audio/x-m4a":"m4a","audio/aac":"m4a","audio/mp4":"m4a","audio/x-mp4":"m4a","audio/ogg":"ogg"},f;a.bind("update",function(c){if(b.opened()){var l=c.file;b.support.audio[h[l.mime]]&&(c.stopImmediatePropagation(),f=$('\x3caudio class\x3d"elfinder-quicklook-preview-audio" controls preload\x3d"auto" autobuffer\x3e\x3csource src\x3d"'+
b.fm.url(l)+'" /\x3e\x3c/audio\x3e').appendTo(a),d&&f[0].play())}}).bind("change",function(){f&&f.parent().length&&(f[0].pause(),f.remove(),f=null)})},function(b){var a=b.preview,d=!!b.options.autoplay,h={"video/mp4":"mp4","video/x-m4v":"mp4","video/ogg":"ogg","application/ogg":"ogg","video/webm":"webm"},f;a.bind("update",function(c){if(b.opened()){var l=c.file;b.support.video[h[l.mime]]&&(c.stopImmediatePropagation(),b.hideinfo(),f=$('\x3cvideo class\x3d"elfinder-quicklook-preview-video" controls preload\x3d"auto" autobuffer\x3e\x3csource src\x3d"'+
b.fm.url(l)+'" /\x3e\x3c/video\x3e').appendTo(a),d&&f[0].play())}}).bind("change",function(){f&&f.parent().length&&(f[0].pause(),f.remove(),f=null)})},function(b){var a=b.preview,d=[],h;b.opened()&&($.each(navigator.plugins,function(b,c){$.each(c,function(c,b){0!==b.type.indexOf("audio/")&&0!==b.type.indexOf("video/")||d.push(b.type)})}),a.bind("update",function(f){if(b.opened()){var c=f.file,l=c.mime;-1!==$.inArray(c.mime,d)&&(f.stopImmediatePropagation(),(f=0===l.indexOf("video/"))&&b.hideinfo(),
h=$('\x3cembed src\x3d"'+b.fm.url(c)+'" type\x3d"'+l+'" class\x3d"elfinder-quicklook-preview-'+(f?"video":"audio")+'"/\x3e').appendTo(a))}}).bind("change",function(){h&&h.parent().length&&(h.remove(),h=null)}))}];e=r([a.dcl,e.dcl],{resizeToPreview:!0,useAce:!0,registerEditors:!1,editorPermissions:[],container:null,destroy:function(){this.window.empty();g.destroy(this.window[0]);this.inherited(arguments)},init:function(){var b=this.options={autoplay:!0,jplayer:"extensions/jplayer",ui:"button"},a=this,
d=this.window,h=this.preview,f=this.container;width=0<b.width?parseInt(b.width):450;height=0<b.height?parseInt(b.height):300;f||d.appendTo("body").zIndex(20);$(document).keydown(function(c){27==c.keyCode&&a.opened()&&d.trigger("close")});!f&&$.fn.resizable&&d.resizable({handles:"se",minWidth:350,minHeight:120,resize:function(){h.trigger("changesize")}});$.each(p||[],function(c,b){"function"==typeof b&&new b(a)});h.bind("update",function(){a.info.show()})},buildRenderingEmbedded:function(){var b=this,
a=this.navicon,d=this.container?$(this.container):null;$('\x3cdiv class\x3d"elfinder-quicklook-title" style\x3d"display: none"\x3e'+b.title+"\x3c/div\x3e");var h=$("\x3cdiv/\x3e"),f=$('\x3cdiv class\x3d"elfinder-quicklook-info"/\x3e');b.openDfd=new w;b.fsicon=$('\x3cdiv class\x3d"'+a+" "+a+' fa-2x fa-arrows-alt"/\x3e').mousedown(function(c){var f=b.window,h=f.is("."+b.fullscreen),d=$(window);c.stopPropagation();h?(f.css(f.data("position")).unbind("mousemove"),d.unbind("scroll.elfinder-finder").trigger(b.resize).unbind(b.resize),
b.navbar.unbind("mouseenter").unbind("mousemove")):(f.data("position",{left:f.css("left"),top:f.css("top"),width:f.width(),height:f.height()}).css({width:"100%",height:"100%"}),$(window).bind("scroll.elfinder-finder",function(){f.css({left:parseInt($(window).scrollLeft())+"px",top:parseInt($(window).scrollTop())+"px"})}).bind(b.resize,function(c){b.preview.trigger("changesize")}).trigger("scroll.elfinder-finder").trigger(b.resize),f.bind("mousemove",function(c){b.navbar.stop(!0,!0).show().delay(3E3).fadeOut("slow")}).mousemove(),
b.navbar.mouseenter(function(){b.navbar.stop(!0,!0).show()}).mousemove(function(c){c.stopPropagation()}));b.navbar.attr("style","").draggable(h?"destroy":{});f.toggleClass(b.fullscreen);$(this).toggleClass(a+"-fullscreen-off");parent||(parent=$(".xapp"))});b.navbar=$('\x3cdiv class\x3d"" style\x3d"display: none;"/\x3e');b.preview=$('\x3cdiv class\x3d"elfinder-quicklook-preview ui-helper-clearfix"/\x3e').bind("change",function(c){b.info.attr("style","").hide();h.removeAttr("class").attr("style","");
f.html("")}).bind("update",function(c){var f=c.file;f?(!f.read&&c.stopImmediatePropagation(),b.preview.unbind("changesize").trigger("change").children().remove(),b.info.delay(100).fadeIn(10)):c.stopImmediatePropagation()});b.info=$('\x3cdiv class\x3d"elfinder-quicklook-info-wrapper"/\x3e').append(h).append(f);b.window=$('\x3cdiv id\x3d"'+b.id+'" class\x3d"ui-helper-reset ui-widget elfinder-quicklook widget bg-opaque" style\x3d""/\x3e').click(function(c){c.stopPropagation()}).append(b.preview).append(b.info.hide()).bind("open",
function(c){b._open=!0;c=b.window;var f=b.node;b.closed()&&(b.update(1,b.value),b.navbar.attr("style",""),b.state=1,f&&f.trigger("scrolltoview"),c.css(b.closedCss(f)).show().animate(b.openedCss(),550,function(){b.state=2;b.update(2,b.value);b.openDfd.resolve()}))}).bind("close",function(c){var f=b.window,a=b.preview.trigger("change");c={};var h=function(){b._open=!1;b.state=0;f.hide();a.children().remove();b.update(0,b.value)};b.opened()&&(state=1,f.is("."+b.fullscreen)&&b.fsicon.mousedown(),c.length?
f.animate(b.closedCss(c),500,h):h())});d&&(console.error("container!"),d.append(b.window));d=this.supportTest;b.support={audio:{ogg:d('audio/ogg; codecs\x3d"vorbis"'),mp3:d("audio/mpeg;"),wav:d('audio/wav; codecs\x3d"1"'),m4a:d("audio/x-m4a;")||d("audio/aac;")},video:{ogg:d('video/ogg; codecs\x3d"theora"'),webm:d('video/webm; codecs\x3d"vp8, vorbis"'),mp4:d('video/mp4; codecs\x3d"avc1.42E01E"')||d('video/mp4; codecs\x3d"avc1.42E01E, mp4a.40.2"')}}},buildRendering:function(){var b=this,a=this.navicon,
d=this.container?$(this.container):null,h=$('\x3cdiv class\x3d"elfinder-quicklook-title"\x3e'+b.title+"\x3c/div\x3e"),f=$("\x3cdiv/\x3e"),c=$('\x3cdiv class\x3d"elfinder-quicklook-info"/\x3e');b.openDfd=new w;b.fsicon=$('\x3cdiv class\x3d"'+a+" "+a+' fa-2x fa-arrows-alt"/\x3e').mousedown(function(c){var f=b.window,h=f.is("."+b.fullscreen),d=$(window);c.stopPropagation();h?(f.css(f.data("position")).unbind("mousemove"),d.unbind("scroll.elfinder-finder").trigger(b.resize).unbind(b.resize),b.navbar.unbind("mouseenter").unbind("mousemove")):
(f.data("position",{left:f.css("left"),top:f.css("top"),width:f.width(),height:f.height()}).css({width:"100%",height:"100%"}),$(window).bind("scroll.elfinder-finder",function(){f.css({left:parseInt($(window).scrollLeft())+"px",top:parseInt($(window).scrollTop())+"px"})}).bind(b.resize,function(c){b.preview.trigger("changesize")}).trigger("scroll.elfinder-finder").trigger(b.resize),f.bind("mousemove",function(c){b.navbar.stop(!0,!0).show().delay(3E3).fadeOut("slow")}).mousemove(),b.navbar.mouseenter(function(){b.navbar.stop(!0,
!0).show()}).mousemove(function(c){c.stopPropagation()}));b.navbar.attr("style","").draggable(h?"destroy":{});f.toggleClass(b.fullscreen);$(this).toggleClass(a+"-fullscreen-off");parent||(parent=$(".xapp"))});b.navbar=$('\x3cdiv class\x3d"elfinder-quicklook-navbar"/\x3e').append($('\x3cdiv class\x3d"'+a+" "+a+' fa-2x fa-arrow-left"/\x3e').mousedown(function(){b.navtrigger(37)})).append(b.fsicon).append($('\x3cdiv class\x3d"'+a+" "+a+' fa-2x fa-arrow-right"/\x3e').mousedown(function(){b.navtrigger(39)})).append('\x3cdiv class\x3d"elfinder-quicklook-navbar-separator"/\x3e').append($('\x3cdiv class\x3d"'+
a+" "+a+'-close"/\x3e').mousedown(function(){b.window.trigger("close")}));b.preview=$('\x3cdiv class\x3d"elfinder-quicklook-preview ui-helper-clearfix"/\x3e').bind("change",function(a){b.info.attr("style","").hide();f.removeAttr("class").attr("style","");c.html("")}).bind("update",function(c){var f=c.file;f?(!f.read&&c.stopImmediatePropagation(),b.preview.unbind("changesize").trigger("change").children().remove(),b.info.delay(100).fadeIn(10)):c.stopImmediatePropagation()});b.info=$('\x3cdiv class\x3d"elfinder-quicklook-info-wrapper"/\x3e').append(f).append(c);
b.window=$('\x3cdiv id\x3d"'+b.id+'" class\x3d"ui-helper-reset ui-widget elfinder-quicklook widget bg-opaque" style\x3d"position:absolute"/\x3e').click(function(c){c.stopPropagation()}).append($('\x3cdiv class\x3d"elfinder-quicklook-titlebar"/\x3e').append(h).append($('\x3cspan class\x3d"fa-close" style\x3d"margin-left: 4px; color: white; font-size: 16px; text-align: center; position: absolute; left: 0px; top: 2px;"/\x3e').mousedown(function(c){c.stopPropagation();b.window.trigger("close")}))).append(b.preview.add(b.navbar)).append(b.info.hide()).draggable({handle:"div.elfinder-quicklook-titlebar"}).bind("open",
function(c){b._open=!0;c=b.window;var f=b.node;b.closed()&&(b.update(1,b.value),b.navbar.attr("style",""),b.state=1,f.trigger("scrolltoview"),c.css(b.closedCss(f)).show().animate(b.openedCss(),550,function(){b.state=2;b.update(2,b.value);b.openDfd.resolve()}))}).bind("close",function(c){var f=b.window,a=b.preview.trigger("change");c={};var h=function(){b._open=!1;b.state=0;f.hide();a.children().remove();b.update(0,b.value)};b.opened()&&(state=1,f.is("."+b.fullscreen)&&b.fsicon.mousedown(),c.length?
f.animate(b.closedCss(c),500,h):h())});d&&(console.error("container!"),d.append(b.window));d=this.supportTest;b.support={audio:{ogg:d('audio/ogg; codecs\x3d"vorbis"'),mp3:d("audio/mpeg;"),wav:d('audio/wav; codecs\x3d"1"'),m4a:d("audio/x-m4a;")||d("audio/aac;")},video:{ogg:d('video/ogg; codecs\x3d"theora"'),webm:d('video/webm; codecs\x3d"vp8, vorbis"'),mp4:d('video/mp4; codecs\x3d"avc1.42E01E"')||d('video/mp4; codecs\x3d"avc1.42E01E, mp4a.40.2"')}}},constructor:function(b){g.mixin(this,b)},editorOptions:{permissions:[k.ACTION.TOOLBAR,
k.ACTION.RELOAD,"Editor/Settings","View/Increase Font Size","View/Decrease Font Size","View/Themes","File/Search"]},title:"Preview",width:450,height:300,fm:null,state:0,navicon:"elfinder-quicklook-navbar-icon",fullscreen:"elfinder-quicklook-fullscreen",parent:null,cwd:null,resize:"resize.elfinder-finder",alwaysEnabled:!0,value:null,handlers:{select:function(){this.update(void 0,this.fm.selectedFiles()[0])},error:function(){self.window.is(":visible")&&self.window.data("hash","").trigger("close")},
"searchshow searchhide":function(){this.opened()&&this.window.trigger("close")}},shortcuts:[{pattern:"space"}],navtrigger:function(b){$(document).trigger($.Event("keydown",{keyCode:b,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1}))},closedCss:function(b){return{opacity:0,width:20,height:20,top:b?b.offset().top+"px":0,left:b?b.offset().left+"px":0}},openedCss:function(){var b=this.container?$(this.container):null,a=b||$(window),d=b?"100%":Math.min(this.width,a.width()-10),b=b?"100%":Math.min(this.height,
a.height()-80);return{opacity:1,width:d,height:b,top:parseInt((a.height()-b-60)/2+a.scrollTop()),left:parseInt((a.width()-d)/2+a.scrollLeft())}},supportTest:function(b){var a=document.createElement(b.substr(0,b.indexOf("/"))),d=!1;try{d=a.canPlayType&&a.canPlayType(b)}catch(h){}return d&&""!==d&&"no"!=d},changeView:function(b){this.currentView&&(g.destroy(this.currentView),this.currentView.destroy&&this.currentView.destroy())},update:function(b){this._open=b;this._emit("changeState",b);if(1==b&&this.onAnimate)this.onAnimate();
if(2==b&&this.onOpened)this.onOpened();if(0==b&&this.onClosed)this.onClosed()},closed:function(){return 0==this.state},opened:function(){return 2==this.state},bind:function(b,a){var d;if("function"==typeof a)for(b=(""+b).toLowerCase().split(/\s+/),d=0;d<b.length;d++)void 0===listeners[b[d]]&&(listeners[b[d]]=[]),listeners[b[d]].push(a);return this},one:function(b,a){var d=this,h=$.proxy(a,function(f){setTimeout(function(){d.unbind(f.type,h)},3);return a.apply(this,arguments)});return this.bind(b,
h)},open:function(b){var a=this;b=a.window;var d=a.node;a._open=!0;a.openDfd=new w;a.closed()?(a.navbar.attr("style",""),a._open=!0,a.state=1,d&&d.trigger("scrolltoview"),b.css(a.closedCss(d)).show().animate(a.openedCss(),550,function(){a.state=2;a.update(1,a.value);a.openDfd.resolve()})):a.openDfd.resolve();return a.openDfd},close:function(b){this._open=!1;var a=this,d=a.window,h=a.preview.trigger("change");b=a.node;var f=function(){a.state=0;d.hide();h.children().remove();a.update(0,a.value);a.closeDfd&&
a.closeDfd.resolve()};a.opened()&&(a.state=1,d.is("."+a.fullscreen)&&a.fsicon.mousedown(),b&&b.length?d.animate(a.closedCss(b),500,f):f());return a.closeDfd},getstate:function(){return 2==this.state?1:0},exec:function(){this.window.trigger(this.opened()?"close":"open")},hideinfo:function(){this.info.stop(!0).hide()}});e=r(e,{destroy:function(){this.close();this.preview.trigger($.Event("update",{file:null}));this.inherited(arguments);g.destroy(this._editor);g.destroy(this.preview);g.destroy(this.window)},
onOpened:function(){var a=this;a.fm={url:function(d,e,h){return a.delegate.getImageUrl(d,e,h)}};a.preview.trigger($.Event("update",{file:a.item}))},onClosed:function(){},onAnimate:function(){}});r=r(e,{resize:function(){this.preview.trigger("changesize")},constructor:function(a){this.parent=$(a._parent.containerNode);this.container=a._parent.containerNode;this.resizeToParent=!0;this.delegate=a.ctx.getFileManager();this.item=a.item},openItem:function(a){this.id=g.createUUID();v.add(this);this.item=
a||this.item;this.buildRenderingEmbedded();this.init();this.exec();this.window.css({height:"100%",width:"100%"});this._parent.add(this,null,!1);this.preview.trigger($.Event("update",{file:this.item}));this._parent.resize();this.resize()}});e.EditorClass=r;return e})},"xfile/views/FilePicker":function(){define("dcl/dcl xide/types xide/utils xide/factory module xide/_base/_Widget xdocker/Docker2 xfile/ThumbRenderer dojo/promise/all xfile/Breadcrumb".split(" "),function(r,k,g,e,a,d,w,v,m,q){return r(d,
{declaredClass:"xfile.views.FilePicker",templateString:'\x3cdiv class\x3d"FilePicker"\x3e\x3c/div\x3e',resizeToParent:!0,docker:null,dockerOptions:{resizeToParent:!0},breadcrumb:null,leftStore:null,rightStore:null,storeOptionsMixin:null,storeOptions:null,leftGrid:null,leftGridArgs:null,rightGrid:null,rightGridArgs:null,removePermissions:[k.ACTION.OPEN_IN_TAB],defaultGridArgs:{registerEditors:!1,_columns:{Name:!0,Path:!1,Size:!1,Modified:!1}},selection:null,mount:"root",_selection:null,getDocker:function(){if(this.docker)return this.docker;
var a=this.dockerOptions||{resizeToParent:!0},a=this.docker||w.createDefault(this.domNode,a);a.resizeToParent=!0;this.add(a,null,!1);return this.docker=a},createLayout:function(){var a=this.getDocker();this.layoutTop=a.addPanel("DefaultFixed",k.DOCKER.DOCK.TOP,null,{h:50,title:!1});this.layoutTop._minSize.y=50;this.layoutTop._maxSize.y=50;this.layoutTop._scrollable={x:!1,y:!1};this.breadcrumb=g.addWidget(q,{},null,this.layoutTop,!0);this.layoutLeft=a.addPanel("DefaultFixed",k.DOCKER.DOCK.BOTTOM,null,
{w:100,title:!1});this.layoutLeft._minSize.x=150;this.layoutLeft.moveable(!0);this.layoutMain=a.addPanel("DefaultFixed",k.DOCKER.DOCK.RIGHT,this.layoutLeft,{w:"70%",title:!1});this.layoutTop.initSize(100,"100%");this.layoutLeft.initSize("100%",150);a.resize()},setSelection:function(a){this._selection=a},connectGrids:function(a,b){var d=this;b._on("selectionChanged",function(a){"deselect"!==a.why&&(a=b.getSelection(),b.getSelectedItem()&&d.setSelection(a))});a._on("selectionChanged",function(e){e=
a.getSelection();var h=a.getSelectedItem();h||(h=a.getCurrentFolder());if(h){var f=null;h.directory?f=h:(h.getParent||console.error("item has no item.getParent!"),f=h.getParent?h.getParent():null);f&&b.openFolder(f.path,!1);h&&d.setSelection(e)}})},createFileGrid:function(a,b,d){return this.Module.createDefault(this.ctx,d,b,!1,!0,a)},onLeftGridReady:function(a){},onRightGridReady:function(a){},onError:function(a,b){},startGrids:function(a,b){var d=this,e=a.collection,h=b.collection,f={focus:!0,append:!1},
c=[a.refresh(),b.refresh()],l=this.selection,u=g.pathinfo(l,k.PATH_PARTS.ALL).dirname||"";"."===u&&(u=l);a.showStatusbar&&a.showStatusbar(!1);a._on("changeSource",function(c){b.changeSource(c,!0)});a._on("changedSource",function(c){a.select([0],null,!0,f)});b._on("changeSource",function(c){a.changeSource(c,!0)});b._on("changedSource",function(c){a.select([0],null,!0,f)});m(c).then(function(){d.onLeftGridReady(a);d.onRightGridReady(b);d.getDocker().resize();m([e.getItem(u,!0),h.getItem(u,!0)]).then(function(c){m(_.invoke([a],
"openFolder",u)).then(function(){m(_.invoke([a,b],"select",[l],null,!0,f)).then(function(){l._selection=l;d.connectGrids(a,b);d.setupBreadcrumb(a,b,l)},function(c){d.onError(c,"selecting items")})},function(c){d.onError(c,"open folder")})},function(c){d.onError(c,"loading items")})},function(c){d.onError(err,"refresh grid")})},setupBreadcrumb:function(a,b,d){function e(c,a,b){h.grid!=b&&h.setSource(b);h.clear();h.setPath(".",f.getRootItem(),a.getPath(),c)}var h=this.breadcrumb;a.getCurrentFolder();
var f=a.collection,c=b.collection;h.setSource(a);this.addHandle("click",a.on("click",function(){h.setSource(a)}));this.addHandle("click",b.on("click",function(){h.setSource(b)}));a._on("openFolder",function(c){e(f,c.item,a)});b._on("openFolder",function(a){e(c,a.item,b)})},destroy:function(){g.destroy(this.leftStore);g.destroy(this.rightStore);g.destroy(this.leftGrid);g.destroy(this.rightGrid);g.destroy(this.breadcrumb);g.destroy(this.docker)},startup:function(){this.createLayout();var a=this.layoutLeft,
b=this.layoutMain,d=this.ctx,w=d.config,h=this.mount||"root",f=this.storeOptions,c=this.storeOptionsMixin||{includeList:"*.jpg,*.png",excludeList:"*"},l=this.leftStore||e.createFileStore(h,f,w,c,d),d=this.rightStore||e.createFileStore(h,f,w,c,d),h=this.layoutMain,w=g.mixin({},g.clone(this.defaultGridArgs)),u=this.removePermissions,h=g.mixin(w,this.leftGridArgs||{newTarget:h});_.remove(h.permissions,function(c){return-1!==_.indexOf(u,c)});this.leftGrid=a=this.leftGrid||this.createFileGrid(l,a,h);l=
g.mixin(w,this.rightGridArgs||{selectedRenderer:v});_.remove(l.permissions,function(c){return-1!==_.indexOf(u,c)});this.rightGrid=b=this.rightGrid||this.createFileGrid(d,b,l);return this.startGrids(a,b)}})})},"xfile/Breadcrumb":function(){define(["dcl/dcl","xide/widgets/TemplatedWidgetBase","xide/model/Path","xide/_base/_Widget"],function(r,k,g,e){return r(e,{templateString:"\x3cul attachTo\x3d'root' style\x3d'-webkit-app-region:drag' class\x3d'breadcrumb'\x3e\x3c/ul\x3e",grid:null,destroy:function(){this.clear();
this.grid=null},setSource:function(a){if(this.grid!=a){this.grid=a;var d=a.collection;this.clear();var e=a.getBreadcrumbPath?a.getBreadcrumbPath():null;!1!==e&&(e?this.setPath(e.root,null,e,null):d&&a.getCurrentFolder&&(a=(a=a.getCurrentFolder())?a.path:"",this.setPath(".",d.getRootItem(),a,d)))}},setPath:function(a,d,e,v,m){this.clear();d&&a&&this.addSegment(a,!0,d);a=(new g(e)).getSegments();var k=m||".";_.each(a,function(a){var b=k+"/"+a;this.addSegment(a,!0,v?v.getSync(b):null);k=b},this)},onClick:function(a,
d,e){this._emit("click",{element:e,event:d,label:a,data:e.data})},addSegment:function(a,d,e){if(e&&this.has(e))return null;var g=this;a=$("\x3cli class\x3d'"+(d?"active":"")+"'\x3e\x3ca href\x3d'#'\x3e"+a+"\x3c/a\x3e\x3c/li\x3e");_.each(this.all(),function(a){a.el.removeClass("active")});$(this.domNode).append(a);e&&(a.on("click",function(a){g.grid&&g.grid.openFolder(e)}),a[0].data=e);return a},pop:function(){this.last().remove()},last:function(){return $(this.root).children().last()},has:function(a){for(var d=
this.all(),e=0;e<d.length;e++)if(d[e].data.path===a.path)return!0;return!1},all:function(){var a=[];_.each(this.$root.children(),function(d){a.push({el:$(d),label:d.outerText,data:d.data})});return a},clear:function(){for(var a=this.all();a.length;){var d=a[a.length-1];d.el.remove();d.data=null;a.remove(d)}},unwind:function(a){var d=this.all().reverse();_.each(d,function(d){d.data&&d.data.path!==(a&&a.path)&&"."!==d.data.path&&this.pop()},this)},startup:function(){this._on("click",function(a){a=a.element[0].data;
var d=this.grid;a&&(this.unwind(a),d&&d.openFolder(a))}.bind(this))}})})},"xfile/Statusbar":function(){define(["xdojo/declare","xide/types","xfile/Breadcrumb"],function(r,k,g){return r("xgrid.Statusbar",null,{statusbar:null,setState:function(e){this.showStatusbar(e.statusBar);return this.inherited(arguments)},getState:function(e){e=this.inherited(arguments)||{};e.statusBar=null!=this.statusbar;return e},runAction:function(e){e.command==k.ACTION.STATUSBAR&&this.showStatusbar(this.statusbar?!1:!0);
return this.inherited(arguments)},showStatusbar:function(e,a){!e&&this.statusbar?this._destroyStatusbar():e&&this.getStatusbar();this.resize();this._statusbarAction&&!0!==a&&this._statusbarAction.set("value",e)},_destroyStatusbar:function(){this.statusbarRoot&&this.statusbarRoot.remove();this.statusbarRoot=this.statusbar=null},_statusbarAction:null,buildRendering:function(){this.inherited(arguments);var e=this;this._on("onAddActions",function(a){var d=a.actions,g=k.ACTION.STATUSBAR;a.store.getSync(g)||
(a=e.createAction({label:"Statusbar",command:g,icon:k.ACTION_ICON.STATUSBAR,tab:"View",group:"Show",mixin:{actionType:"multiToggle"},onCreate:function(a){a.set("value",null!==e.statusbar);e._statusbarAction=a},onChange:function(a,d,g){e.showStatusbar(d,!0)}}),d.push(a))})},getStatusbar:function(){return this.statusbar?this.statusbar:this.createStatusbar()},onRenderedStatusBar:function(e,a,d){e=this.__bc;!e&&a&&a.append&&(e=new g({},$("\x3cdiv\x3e")),a.append(e.domNode),$(e.domNode).css({"float":"right",
padding:0,"margin-right":10,top:0,right:50,position:"absolute"}),this.__bc=e,e.setSource(this));e&&(e.clear(),a=this.collection,d=(d=this.getCurrentFolder())?d.path:"",e.setPath(".",a.getRootItem(),d,a))},onStatusbarCollapse:function(e){},createStatusbar:function(e){e=e=this.footer;var a=this.statusbar,d=this;if(!a){var g=$('\x3cdiv class\x3d"statusbar widget" style\x3d"width:inherit;padding: 0;margin:0;padding-left: 4px;"\x3e\x3c/div\x3e')[0];e.appendChild(g);a=$('\x3cdiv class\x3d"status-bar-text ellipsis" style\x3d"display: inline-block;"\x3e0 items selected\x3c/div\x3e')[0];
g.appendChild(a);var v=$('\x3cdiv class\x3d"status-bar-collapser fa-caret-up" style\x3d"" \x3e\x3c/div\x3e');v.click(function(a){d.onStatusbarCollapse(v)});e=v[0];g.appendChild(e);this.statusbar=a;this.statusbarCollapse=e;this.statusbarRoot=g;this._emit("createStatusbar",{root:g,statusbar:a,collapser:e})}return a},startup:function(){function e(a){if(0==a)return"0 Byte";var d=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,d),2)+" "+["Bytes","KB","MB","GB","TB"][d]}
function a(a){var d=0,g="0 KB";_.each(a,function(a){d+=a.sizeBytes||0});0<d&&(g=e(d));return{bytes:d,sizeStr:g}}this.inherited(arguments);if(this.hasPermission(k.ACTION.STATUSBAR)){var d=this.getStatusbar(),g=this;d&&this._on("selectionChanged",function(e){var m=e.selection||[];e=m.length;m=a(m);e=e+"  "+g.localize("selected")+" ("+m.sizeStr+")";d.innerHTML=e;if(g.onRenderedStatusBar)g.onRenderedStatusBar(d,g.statusbarRoot,e)})}}})})},"xfile/views/UploadMixin":function(){define(["xdojo/declare","xide/utils",
"xide/types","dojo/promise/all"],function(r,k,g,e){return r("xfiles.views.UploadMixin",null,{cssClass:"uploadFilesList droparea dropareaHover",__currentDragOverRow:null,__currentDragOverTimer:null,__currentDragOverTimeRow:null,buildRendering:function(){this.inherited(arguments);$(this.domNode).addClass(this.cssClass)},_createUploadItemTemplate:function(a,d,e){return'\x3cdiv class\x3d"" style\x3d"position: relative;margin: 0.1em;height: auto"\x3e\x3cdiv style\x3d"margin:0;vertical-align: middle;padding: 1px;" class\x3d"progress" role\x3d"progressbar" aria-valuemin\x3d"0" aria-valuemax\x3d"100"\x3e\x3cdiv class\x3d"progress-bar progress-bar-info" style\x3d"width:'+
d+';background-color: rgba(102, 161, 179, 0.35);height:auto;magin:0;"\x3e\x3cspan class\x3d"'+(e.failed?"text-danger":"text-info")+'" style\x3d"left: 0px"\x3e'+a+"\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"},_createUploadItems:function(a){function d(a){var b={sizeBytes:k.humanFileSize(a.size),size:k.humanFileSize(a.size),name:a.name,type:a.type,path:m.path+"/"+a.name+"__uploading__"+Math.random(2),isDir:!1,mount:m.mount,parent:m.path,progress:0,isUpload:!0,modified:a.lastModified/1E3,renderColumn:function(a,
b,d){if("name"===a)return e._createUploadItemTemplate(d.name,d.progress+"%",d);if("sizeBytes"===a&&100>d.progress)return k.humanFileSize(d.loaded)+" of "+k.humanFileSize(d.total)}};g.putSync(b);b=g.getSync(b.path);return a._item=b}var e=this,g=this.collection,m=this.getCurrentFolder();this.__currentDragOverRow&&(m=this.__currentDragOverRow.data);var q=[];_.each(a,function(a){q.push(d(a))});return q},_onAllUploaded:function(a){a=this._toUploadItems(a);var d=this;_.each(a,function(a){var d=a._store?
a:a._item;d&&(d.progress=d.failed?0:100,d.refresh(),setTimeout(function(){d.remove()},1))});setTimeout(function(){d.runAction(g.ACTION.RELOAD).then(function(){})},1)},_onBrowserFilesDropped:function(a,d,e){var g=this.ctx.getFileManager(),m=a.getCurrentFolder();this.__currentDragOverRow&&(m=this.__currentDragOverRow.data);this._createUploadItems(d);return g.upload(d,m.mount,m?m.path:"./tmp",a,e)},_onUploadFailed:function(a){a&&(a.failed=!0,a.done=!0)},_onSomeFileUploaded:function(a){var d=this;a&&
(a.progress=100,a.done=!0,a.renderColumn=null,a.renderRow=null,a.refresh(),setTimeout(function(){d.runAction(g.ACTION.RELOAD).then(function(){});a.remove()},1));return!0},_toUploadItems:function(a){var d=[];_.each(a,function(a){_.each(a,function(a){d.push(a)})});return d},_toUploadStoreItem:function(a){return a.file._item},onBrowserFilesDropped:function(a,d){function g(){var a=0;_.each(q,function(d){d.done&&a++});a==q.length&&m._onAllUploaded(d)}var k=this._onBrowserFilesDropped(this,d,a),m=this,
q=m._toUploadItems(d),p=1==q.length;e(k).then(this._onAllUploaded.bind(this,[d]));_.each(k,function(a){a.then(function(a){!p&&m._onSomeFileUploaded(m._toUploadStoreItem(a))&&g()},function(a){m._onUploadFailed(m._toUploadStoreItem(a));p&&m._onAllUploaded(d);!p&&g()},function(a){var b=a.progress;a=a.item.file._item;var d=Math.round(100*b.loaded/b.total);a&&(a.progress=d,a.loaded=b.loaded,a.total=b.total,a.refresh())})})},onBrowserUrlDropped:function(a,d){if(this.delegate&&this.delegate.onBrowserUrlDropped)this.delegate.onBrowserUrlDropped(this,
d)},dragEnter:function(a){a.preventDefault()},dragLeave:function(a){},dragOver:function(a){a.preventDefault();if(this.row){var d=this;a=this.row(a);var e=this.__currentDragOverRow,g=e?e.data:null;this.__currentDragOverRow&&$(this.__currentDragOverRow.element).removeClass("dgrid-focus");a&&a.element&&a.data&&!0===a.data.directory?(this.__currentDragOverTimer||(d.__currentDragOverTimeRow=a,d.__currentDragOverTimer=setTimeout(function(){var a=d.__currentDragOverTimeRow.data;a&&g&&a==g?(d.__currentDragOverTimeRow=
null,d.__currentDragOverTimer=null,d.openFolder(a)):d.__currentDragOverTimer=null},1550)),this.__currentDragOverRow=a,$(a.element).addClass("dgrid-focus")):this.__currentDragOverRow=null}},drop:function(a){a.preventDefault();var d=a.dataTransfer;if(d)if((d=d.files)&&d.length){if(this.onBrowserFilesDropped)this.onBrowserFilesDropped(this,d)}else try{var e=a.dataTransfer.getData("text/plain");if(e&&e.length)this.delegate.onBrowserUrlDropped(this,e)}catch(g){console.error("dropping url failed "+g)}},
initDND:function(){var a=this,d=this.domNode;d?(d.addEventListener("dragover",function(d){a.dragOver(d)},!1),d.addEventListener("drop",function(d){d.preventDefault();a.drop(d)},!1)):console.error("have not drop destination")},startup:function(){if(!this._started){var a=this.inherited(arguments);this.initDND();return a}}})})},"xfile/FolderSize":function(){define("xdojo/declare xide/types xide/utils xfile/Breadcrumb xide/layout/_TabContainer xfile/views/FileSize".split(" "),function(r,k,g,e,a,d){return r("xfile.FolderSize",
null,{__sizeDisplay:null,__bottomTabContainer:null,__bottomPanel:null,__sizesTab:null,showStats:function(e){var k=this.getBottomTabContainer(),m=this.__sizesTab,q=this.__sizeDisplay,p=this,b=this._getBottom(),n=b&&b.isExpanded();if(1==n&&b)e=!1;else if(!n&&b)return b.expand();if(e){b||(b=this.getBottomPanel(!1,.2));if(b&&q)return b.expand();k||(this.__bottomTabContainer=k=e=g.addWidget(a,{direction:"below"},null,b,!0),b._tabs=e);m||(m=this.__sizesTab=k.createTab("Sizes","fa-bar-chart"));q||(q=this.__sizeDisplay=
m.add(d,{owner:p},null,!1),q.startup(),this._on("openedFolder",function(a){g.destroy(p.__sizeDisplay);m.resize();p.resize();p.__sizeDisplay=null;p.__sizeDisplay=g.addWidget(d,{owner:p},null,m,!1);g.resizeTo(p.__sizeDisplay,m,!0,!0);p.__sizeDisplay.startup()}))}else b&&b.collapse()},_runAction:function(a){var d=this.getAction(a);return d&&d.command==k.ACTION.SIZE_STATS?this.showStats(this.__sizeDisplay?!1:!0):this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this._on("onAddActions",
function(a){})}})})},"xfile/views/FileSize":function(){define(["dcl/dcl","xide/_base/_Widget"],function(r,k){return r(k,{_find:function(g,e){var a=_.find(e,{path:g}),d=this;if(a&&a.children&&a.children){var k=d._find(g,a.children);k&&(a=k)}a||_.each(e,function(e){var k=null;e.children&&e.children.length&&(k=d._find(g,e.children))&&(a=k)});return a},select:function(g){(g=this._find(g,this.d3Nodes))&&this.highlight(g)},direction:"left",templateString:'\x3cdiv class\x3d"sizeDisplay tabbable tabs-${!direction}" attachTo\x3d"containerNode" style\x3d"width: inherit;height: 100%;padding: 4px"\x3e\x3cul class\x3d"nav nav-tabs tabs-right" role\x3d"tablist"\x3e\x3cli class\x3d"active"\x3e\x3ca href\x3d"#_tab-content2_${!id}" data-toggle\x3d"tab"\x3eOverall\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"#_tab-content1_${!id}" data-toggle\x3d"tab"\x3eBy Type\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d"body tab-content"\x3e\x3cdiv attachTo\x3d"tab2" id\x3d"_tab-content2_${!id}" class\x3d"tab-pane active clearfix"\x3e\x3cdiv class\x3d"chart1" attachTo\x3d"chart1" style\x3d"width: 100%;height: inherit;min-height:250px"\x3e\x3cdiv class\x3d"" style\x3d"" id\x3d"detailInfo"\x3e\x3c/div\x3e\x3cdiv class\x3d"widget" id\x3d"explanation" \x3e\x3cspan id\x3d"percentage"\x3e\x3c/span\x3e\x3cbr/\x3e\x3cspan id\x3d"percentageDetail"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv attachTo\x3d"tab1" id\x3d"_tab-content1_${!id}" class\x3d"tab-pane"\x3e\x3csvg class\x3d"chart2" style\x3d"width: 100%;height: inherit;min-height:250px"\x3e\x3c/svg\x3e\x3cdiv id\x3d"tooltip" class\x3d"hidden"\x3e\x3cspan id\x3d"chart2Per1"\x3eA\x3c/span\x3e \x3cbr\x3e\x3cspan id\x3d"chart2Per2"\x3e100\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
data:null,owner:self,vis:null,d3Nodes:null,colors:{dir:"#5687d1",jpeg:"#9b59b6",jpg:"#9b59b6",png:"#9b59b6",gif:"#9b59b6",psd:"#9b59b6",mp3:"#3498db",wav:"#3498db",wma:"#3498db",wmv:"#2ecc71","3gp":"#2ecc71",mp4:"#2ecc71",plv:"#2ecc71",mpg:"#2ecc71",mpeg:"#2ecc71",mkv:"#2ecc71",rm:"#2ecc71",rmvb:"#2ecc71",mov:"#2ecc71",doc:"#1abc9c",xls:"#1abc9c",ppt:"#1abc9c",docx:"#1abc9c",xlsx:"#1abc9c",pptx:"#1abc9c",pages:"#e74c3c",key:"#e74c3c",numbers:"#e74c3c",pdf:"#7b615c",epub:"#7b615c",c:"#f1c40f",cpp:"#f1c40f",
h:"#f1c40f",html:"#f1c40f",js:"#f1c40f",css:"#f1c40f",pl:"#f1c40f",py:"#f1c40f",php:"#f1c40f",sql:"#f1c40f",csv:"#de783b",odp:"#de783b",gz:"#6ab975",tar:"#6ab975",rar:"#6ab975",zip:"#6ab975","7z":"#6ab975","default":"#34495e"},totalSize:0,result:{},overallSize:0,buildHierarchy:function(g){for(var e={name:"root",children:[]},a=0;a<g.length;a++){var d=g[a][0],k=+g[a][1];if(!isNaN(k))for(var v=d.split("/"),m=e,q=0;q<v.length;q++){var p=m.children,b=v[q],n;if(q+1<v.length){for(var m=!1,t=0;t<p.length;t++)if(p[t].name==
b){n=p[t];m=!0;break}m||(n={name:b,type:"dir",children:[],path:d},p.push(n));m=n}else n=b.split(".").pop(),7>n.length&&(this.result[n]=n in this.result?this.result[n]+k:k),n={name:b,type:n,size:k,path:d},this.overallSize+=k,p.push(n)}}return e},bytesToSize:function(g){var e=["Bytes","KB","MB","GB","TB"];if(0==g)return"n/a";var a=parseInt(Math.floor(Math.log(g)/Math.log(1024)));return 0==a?g+" "+e[a]:(g/Math.pow(1024,a)).toFixed(1)+" "+e[a]},getAncestors:function(g){for(var e=[];g.parent;)e.unshift(g),
g=g.parent;return e},highlight:function(g){if(g){var e=(100*g.value/this.totalSize).toPrecision(3),a=e+"%";.1>e&&(a="\x3c 0.1%");var d=this.bytesToSize(g.value)+"/"+this.bytesToSize(this.totalSize),e=this.colors;d3.select("#percentage").text(a);d3.select("#percentageDetail").text(d);d3.select("#explanation").style("visibility","");var k=this.getAncestors(g);g=k.length;a="";for(d=0;d<g;d++)var v=k[d].type,a="dir"==v?a+('\x3cspan style\x3d"color:'+e[v]+'"\x3e'+k[d].name+"/\x3c/span\x3e"):a+('\x3cspan style\x3d"color:'+
e[v]+'"\x3e'+k[d].name+"\x3c/span\x3e");$("#detailInfo").html(a);d3.selectAll("path").style("opacity",.3);this.vis.selectAll("path").filter(function(a){return 0<=k.indexOf(a)}).style("opacity",1)}else console.error("cant find "+path)},createChart1:function(g,e,a,d,k){function v(a){var b=(100*a.value/q.totalSize).toPrecision(3),d=b+"%";.1>b&&(d="\x3c 0.1%");b=q.bytesToSize(a.value)+"/"+q.bytesToSize(q.totalSize);d3.select("#percentage").text(d);d3.select("#percentageDetail").text(b);d3.select("#explanation").style("visibility",
"");var g=q.getAncestors(a);a=g.length;d="";for(b=0;b<a;b++)var h=g[b].type,d="dir"==h?d+('\x3cspan style\x3d"color:'+m[h]+'"\x3e'+g[b].name+"/\x3c/span\x3e"):d+('\x3cspan style\x3d"color:'+m[h]+'"\x3e'+g[b].name+"\x3c/span\x3e");$("#detailInfo").html(d);d3.selectAll("path").style("opacity",.3);e.selectAll("path").filter(function(a){return 0<=g.indexOf(a)}).style("opacity",1)}e.append("svg:circle").attr("r",k).style("opacity",0);var m=this.colors,q=this;a=d3.layout.partition(k).size([2*Math.PI,k*
k]).value(function(a){return a.size}).nodes(g,k).filter(function(a){return.005<a.dx});d=d3.svg.arc().startAngle(function(a){return a.x}).endAngle(function(a){return a.x+a.dx}).innerRadius(function(a){return Math.sqrt(a.y)}).outerRadius(function(a){return Math.sqrt(a.y+a.dy)});g=e.data([g]).selectAll("path").data(a).enter().append("svg:path").attr("display",function(a){return a.depth?null:"none"}).attr("d",d).attr("fill-rule","evenodd").style("fill",function(a){return m[a.type]?m[a.type]:m["default"]}).style("opacity",
1).on("mouseover",v);d3.select("#container").on("mouseleave",function(a){d3.select("#trail").style("visibility","hidden");d3.selectAll("path").on("mouseover",null);d3.selectAll("path").transition().duration(1E3).style("opacity",1).each("end",function(){d3.select(this).on("mouseover",v)});d3.select("#explanation").transition().duration(1E3).style("visibility","hidden");$("#detailInfo").html("")});this.totalSize=g.node().__data__.value;return a},render:function(g){var e=$(this.tab2),a=e.height()-50,
e=e.height()-50;400>a&&(a=400);300>e&&(e=300);var d=e,k=d3.select(this.chart1).append("svg:svg").attr("width",a).attr("height",e).append("svg:g").attr("id","container").attr("transform","translate("+e/2+","+e/2+")"),a=this.createChart1(g,k,a,e,d/4,k);g=[];for(var v in this.result)if(d=this.result[v]/this.overallSize,!(.001>d)){var m=this.bytesToSize(this.result[v])+"/"+this.bytesToSize(this.overallSize);g.push({filetype:v,usage:d,detail:m})}this.vis=k;this.d3Nodes=a;a=$(this.tab1).width();400>a&&
(a=400);this.createChart2(g,a,e-100)},createChart2:function(g,e,a){var d=d3.scale.ordinal().rangeRoundBands([0,e],.1),k=d3.scale.linear().range([a,0]),v=d3.svg.axis().scale(d).orient("bottom"),m=d3.svg.axis().scale(k).orient("left"),q=this.colors;e=d3.select(this.tab1.children[0]).attr("width",e+40+30).attr("height",a+20+30).append("g").attr("transform","translate(40,20)");d.domain(g.map(function(a){return a.filetype}));k.domain([0,d3.max(g,function(a){return a.usage})]);e.append("g").attr("class",
"x axis").attr("transform","translate(0,"+a+")").call(v);e.append("g").attr("class","y axis").call(m);e.selectAll(".bar").data(g).enter().append("rect").attr("class","bar").attr("id",function(a){return"bar"+a.filetype}).attr("x",function(a){return d(a.filetype)}).attr("y",function(a){return k(a.usage)}).attr("height",function(d){return a-k(d.usage)}).attr("width",d.rangeBand()).attr("fill",function(a){return q[a.filetype]?q[a.filetype]:q["default"]}).on("mouseover",function(e){d3.select(this).transition().duration(50).attr("fill",
"#7f8c8d");var b=parseFloat(d3.select(this).attr("x"))+d.rangeBand()/2,g=parseFloat(d3.select(this).attr("y"))/2+a/2,k=parseFloat(100*e.usage).toFixed(2)+"%("+e.filetype+")";d3.select("#tooltip").style("left",b+"px").style("top",g+"px").select("#chart2Per2").text(e.detail);d3.select("#chart2Per1").text(k);d3.select("#tooltip").classed("hidden",!1)}).on("mouseout",function(){d3.select(this).transition().delay(100).duration(250).attr("fill",function(a){return q[a.filetype]?q[a.filetype]:q["default"]});
d3.select("#tooltip").classed("hidden",!0)})},startup:function(){if(this.owner){var g=this.owner,e=g.getRows(),a=[];_.each(e,function(d){a.push([d.path.replace("./",""),""+d.sizeBytes])});e=this.buildHierarchy(a);this.render(e);var d=this;g._on("selectionChanged",function(a){if("clear"!=a.why){a=(a=a.selection)?a[0]:null;var e=g.row(a),e=e?e.element:null;a&&e&&(a=a.path.replace("./",""),d.d3Nodes&&d.select(a))}})}}})})},"xfile/views/FileGrid":function(){define("xdojo/declare dojo/dom-class dojo/Deferred xide/types xide/utils xide/views/History xaction/DefaultActions xfile/views/Grid xfile/factory/Store xide/model/Path xfile/model/File xfile/types xlang/i18".split(" "),
function(r,k,g,e,a,d,w,v,m,q,p,b,n){q=b.DEFAULT_FILE_GRID_PERMISSIONS;var t=r("xfile.views.FileGrid",v,{resizeAfterStartup:!0,menuOrder:{File:110,Edit:100,View:50,Settings:20,Navigation:10,Window:5},groupOrder:{Clipboard:110,File:100,Step:80,Open:70,Organize:60,Insert:10,Navigation:5,Select:0},tabOrder:{Home:100,View:50,Settings:20,Navigation:10},noDataMessage:"\x3cspan/\x3e",_history:null,options:a.clone(e.DEFAULT_GRID_OPTIONS),_columns:{},toolbarInitiallyHidden:!0,itemType:e.ITEM_TYPE.FILE,permissions:q,
contextMenuArgs:{limitTo:null,actionFilter:{quick:!0}},setState:function(a){this.inherited(arguments);var f=this,c=f.collection,b=a.store.path;c.getSync(b);var d=f.refresh();try{d.then(function(){c.getItem(b,!0).then(function(c){f.openFolder(c)})})}catch(e){console.error("error restoring folder state")}return d},postMixInProperties:function(){var a=this.state;a&&a._columns&&(this._columns=a._columns);this.columns||(this.columns=this.getColumns());!this.collection&&this.state&&(a=this.state.store,
this.collection=m.createFileStore(a.mount,a.storeOptions,this.ctx.config).getDefaultCollection());return this.inherited(arguments)},getState:function(a){a=this.inherited(arguments)||{};a.store={mount:this.collection.mount,path:this.getCurrentFolder().path,storeOptions:this.collection.options};a._columns={};_.each(this._columns,function(f){a._columns[f.label]=!this.isColumnHidden(f.id)},this);return a},onSaveLayout:function(a){a=a.data;var f=this.getState();a.widgets.push({widget:this.declaredClass,
state:f});return a},formatColumn:function(b,f,c){var d=this.selectedRenderer?this.selectedRenderer.prototype:this;if(d.formatColumn&&(d=d.formatColumn.apply(arguments))||c.renderColumn&&(d=c.renderColumn.apply(this,arguments)))return d;switch(b){case "fileType":if("folder"==f)return n.localize("kindFolder");if(c.mime){var d="kind"+(c.mime.split("/")[1]||"unknown").toUpperCase(),e=n.localize(d);return d!==e?e:f}case "name":var e=c&&null!=c.directory&&!0===c.directory,g=!1===c.read&&!1===c.write,k=
".."==c.name,d="",d=e?k?"fa fa-level-up itemFolderList":g?"fa fa-lock itemFolderList":"fa fa-folder itemFolderList":g?"fa fa-lock itemFolderList":"itemFolderList fa "+a.getIconClass(c.path),e=!0===c.showPath?c.path:f;return'\x3cspan class\x3d"'+d+'""\x3e\x3c/span\x3e\x3cspan class\x3d"name fileGridNameNode" style\x3d"vertical-align: middle;padding-top: 0px"\x3e'+e+"\x3c/span\x3e";case "sizeBytes":return c.size;case "fileType":return a.capitalize(c.fileType||"unknown");case "mediaInfo":return c.mediaInfo||
"unknown";case "owner":return c&&(d=c.owner)&&d.user?d.user.name:"";case "modified":if(""===f)break;e=null==!c.directory;return!e&&n.translations.dateFormat?n.formatDate(f).replace("ms",""):""}return f},getColumns:function(){function a(c,b,d,h){null!=f._columns[c]&&(h=!f._columns[c]);f.columns.push({renderExpando:"Name"===c,label:c,field:b,sortable:d,formatter:function(c,a){return f.formatColumn(b,c,a)},hidden:h})}var f=this;this.columns=[];a("Name","name",!0,!1);a("Type","fileType",!0,!0);a("Path",
"path",!0,!0);a("Size","sizeBytes",!0,!1);a("Modified","modified",!0,!1);a("Owner","owner",!0,!0);a("Media","mediaInfo",!0,!0);return this.columns},_focus:function(){var a=this.getRows();a[0]&&(a=this.row(a[0]),this.focus(a.data))},setQueryEx:function(a,f){if(!a)return console.error("bad, no item!"),!1;if(!a.directory)return!1;this._lastPath=a.getPath();var c=this,b=new g;if(c){var d=this.collection;"."===a.path?(d.resetQueryLog(),c.set("collection",d.getDefaultCollection(a.getPath())),b.resolve&&
b.resolve()):d.open(a).then(function(f){d.resetQueryLog();c.set("collection",d.getDefaultCollection(a.getPath()));b.resolve&&b.resolve(f)});return b}console.error("have no grid")},getCurrentFolder:function(){var a=this.getSelectedRenderer();if(a&&a.getCurrentFolder&&(a=a.getCurrentFolder.apply(this))){if(a.isBack){var b=this.collection.getSync(a.rPath);b&&(a=b)}return a}if((a=this.getRows()[0])&&(a._S||a._store)){if(!0===a.isBack&&(b=this.getHistory().getNow()))return this.collection.getSync(b);if(a=
a._S.getParent(a))return a}return null},getClass:function(){return t},getHistory:function(){this._history||(this._history=new d);return this._history},renderArray:function(a,b){_.find(arguments[0],{isBack:!0});return this.inherited(arguments)},startup:function(){if(!this._started){var a=this.inherited(arguments);k.add(this.domNode,"xfileGrid");this.set("loading",!0);if(this.permissions){var b=w.getDefaultActions(this.permissions,this,this),b=b.concat(this.getFileActions(this.permissions));this.addActions(b)}this._history=
new d;var c=this;this.subscribe(e.EVENTS.ON_CLIPBOARD_COPY,function(a){a.type===c.itemType&&(c.currentCopySelection=a.selection,c.refreshActions())});c._on("noData",function(){c.getRows();if(!(0<c._total)){var a=c._history.getNow();a&&"./."!==a&&c.renderArray([{name:"..",path:"..",rPath:a,sizeBytes:0,size:"",icon:"fa-level-up",isBack:!0,modified:"",_S:c.collection,directory:!0,_EX:!0,children:[],mayHaveChildren:!1}])}});this.on("dgrid-refresh-complete",function(){var a=c.getRows();a&&1<a.length&&
(a=_.find(a,{isBack:!0}))&&(c.removeRow(a),c.refresh())});this._on("openFolder",function(a){c.set("title",a.item.name)});c.selectedRenderer&&(a=this.refresh())&&a.then(function(){c.set("loading",!1);c.setRenderer(c.selectedRenderer,!1)});this._on("onChangeRenderer",function(){c.refresh()});setTimeout(function(){c.resize()},500);this._emit("startup");return a}}});t.prototype.Module=t;t.Module=t;t.createDefault=function(b,f,c,d,e,g){f=a.mixin({collection:g.getDefaultCollection(),_parent:c,Module:t,
ctx:b},f||{});f=a.addWidget(t,f,null,c,e,null,null,!0,null);d&&b.getWindowManager().registerView(f,!1);return f};t.DEFAULT_PERMISSIONS=q;return t})},"xfile/factory/Store":function(){define(["xide/types","xide/factory","xide/utils","xfile/data/Store"],function(r,k,g,e){k.createFileStore=function(a,d,k,v,m){d=d||{fields:r.FIELDS.SHOW_ISDIR|r.FIELDS.SHOW_OWNER|r.FIELDS.SHOW_SIZE|r.FIELDS.SHOW_MIME|r.FIELDS.SHOW_PERMISSIONS|r.FIELDS.SHOW_TIME|r.FIELDS.SHOW_MEDIA_INFO};g.mixin(d,v);a=new e({data:[],ctx:m,
config:k,url:k.FILE_SERVICE,serviceUrl:k.serviceUrl,serviceClass:k.FILES_STORE_SERVICE_CLASS,mount:a,options:d});a._state={initiated:!1,filter:null,filterDef:null};a.reset();a.setData([]);a.init();m&&m.getFileManager().addStore(a);return a};return k})},"xfile/data/Store":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred xide/mixins/ReloadMixin xide/manager/ServerActionBase dstore/Cache dstore/QueryResults xide/types xide/utils dojo/when xide/data/TreeMemory dstore/Trackable xide/data/ObservableStore xfile/model/File xide/lodash".split(" "),
function(r,k,g,e,a,d,w,v,m,q,p,b,n,t,h){function f(){return{addDot:!0,recursive:!1,rootSegment:".",Model:t,idProperty:"path",parentField:"parent",mount:"path",options:{fields:1663,includeList:"*",excludeList:"*"},serviceUrl:null,serviceClass:null,singleton:!0,queryAccessors:!0,autoEmitEvents:!1,mayHaveChildren:function(c){return 0==c.mayHaveChildren?!1:!0===c.directory},_lastFilter:null,_lastFilterDef:null,_lastFilterItem:null,_initiated:{value:!1},id:null,_state:{initiated:!1,filter:null,filterDef:null},
isInitiated:function(){return this._state.initiated},setInitiated:function(c){this._state.initiated=c},_extraSortProperties:{name:{ignoreCase:!0}},constructor:function(){this.id=m.createUUID()},onSorted:function(c,a){if(1==c.length&&"name"===c[0].property){var b=c[0].descending,f=function(c){return c.name},d=h.groupBy(a,function(c){return!0===c.directory},this);a=h.sortBy(d["true"],f);a=a.concat(h.sortBy(d["false"],f));b&&a.reverse()}if(b=h.find(a,{name:".."}))a.remove(b),a.unshift(b);return a=this.onAfterSort(a)},
onAfterSort:function(c){var a=this.micromatch;if("undefined"!==typeof mm&&a&&c&&c[0]){var b=c[0].realPath?"realPath":"path",b="name",f=h.pluck(c,b),d=mm(f,a);c=c.filter(function(c){return-1===d.indexOf(c[b])?null:c});this._onAfterSort&&(c=this._onAfterSort(c))}return c},_createSortQuerier:function(c){var a=this;return function(b){b=b.slice();b.sort("function"==typeof c?c:function(b,f){for(var d=0;d<c.length;d++){var e;if("function"==typeof c[d])e=c[d](b,f);else{var h=c[d].property;a._extraSortProperties[h]&&
m.mixin(c[d],a._extraSortProperties[h]);e=c[d].descending;var g=b.get?b.get(h):b[h],h=f.get?f.get(h):f[h],u=!!c[d].ignoreCase;null!=g&&(g=g.valueOf());null!=h&&(h=h.valueOf());u&&(g.toUpperCase&&(g=g.toUpperCase()),h.toUpperCase&&(h=h.toUpperCase()));e=g===h?0:!!e===(null===g||g>h)?-1:1}if(0!==e)return e}return 0});return a.onSorted(c,b)}},_getItem:function(c,a){var b=this.getSync(c)||this.getSync("./"+c);return b&&(this.isItemLoaded(b)||1==a)?b:"."===c?this.getRootItem():null},getItem:function(c,
a){if(0==a)return this._getItem(c);if(1==a){var b=c.split("/"),f=this,d=[],e=f.getSync(c);e||(e=f.getSync(c.replace("./","")));if(e&&this.isItemLoaded(e))return e;for(var k=new g,n=function(){if(h.find(d,{loaded:!1}))for(var a=0;a<d.length;a++){if(!d[a].loaded){var b=f.getSync(d[a].path);if(b)if(!0===b.directory&&f.isItemLoaded(b)){d[a].loaded=!0;continue}else if(null==b.directory){k.resolve(b);break}f._loadPath(d[a].path).then(function(c){d[a].loaded=!0;n()},function(c){var b=Math.abs(Math.min(0,
a-1));c=d[b];c||(b=d.length-1,c=d[b]);f.getItem(c.path);q(f.getItem(d[b].path,!1),function(a){k.resolve(a,d[b].path)})});break}}else k.resolve(f.getItem(c,!1))},e=".",m=0;m<b.length;m++)"."!=b[m]&&(0<b.length&&(e+="/"),e+=b[m],d.push({path:e,loaded:!1}));n();return k}return"."===c?this.getRootItem():null},getRootItem:function(){return{_EX:!0,path:".",name:".",mount:this.mount,directory:!0,virtual:!0,_S:this,getPath:function(){return this.path}}},getItemByPath:function(){},getParents:function(){return null},
getParent:function(a){if(!a)return null;var b=a,f=null;k.isString(b)&&(b=this.getSync(a));b&&b.parent&&(f=this.getSync(b.parent));return f||this.getRootItem()},isItemLoaded:function(a){return a&&(!a.directory||this._isLoaded(a))},loadItem:function(a,b){return this._loadItem(a,b)},_parse:function(a){a._S=this;h.isEmpty(a.children)||(h.each(a.children,function(b){b.parent=a.path;this._parse(b)},this),a._EX=!0,a.children=this.addItems(a.children));a.getPath=function(){return this.path}},_loadPath:function(a,
b){var f=this;return this._request(a).then(function(d){var e=f._getItem(a,!0);if(e)return b&&(h.isEmpty(e.children)||f.removeItems(e.children)),e._EX=!0,f.addItems(d,b),e.children=d;throw Error("cant get item at "+a);}.bind(this),function(a){console.error("error in load")})},addSync:function(a,b){(b=b||{}).overwrite=!1;return this.putSync(a,b)},_loadItem:function(a,b){var f=new g,d=this;if(!a)return f.reject("need item"),f;b&&("."===a.path?(d.setInitiated(!1),d.fetchRange().then(function(b){f.resolve({store:d,
items:b,item:a})})):this._loadPath(a.path,!0).then(function(b){f.resolve(a)},function(a){console.error("error occured whilst loading items");f.reject(a)}));return f},_normalize:function(a){return a&&a.items?a.items[0]:[]},_isLoaded:function(a){return a&&!0===a._EX},fetch:function(){},put:function(){},add:function(a){var b=this.getSync(a.path);b||(b=this.addSync(a),b._S=this,b.getPath=function(){return this.path});return b},removeItems:function(a){h.each(a,function(a){this.getSync(a.path)&&this.removeSync(a.path)},
this)},addItems:function(a){var b=[];h.each(a,function(a){this.getSync(a.path)&&this.removeSync(a.path);b.push(this.add(a))},this);return b},open:function(a){var b=this;if(this._isLoaded(a)){var f=new g;b.resetQueryLog();f.resolve(a.children);return f}a.isLoading=!0;return b._request(a.path).then(function(f){a.isLoading=!1;a._EX=!0;b.addItems(f);return a.children=f})},getDefaultSort:function(){return[{property:"name",descending:!1,ignoreCase:!0}]},filter:function(a){a.parent&&(this._state.path=a.parent);
var b=this.getSync(a.parent);b&&(this.isItemLoaded(b)?this._state.filterDef=null:this._state.filterDef=this._loadPath(b.path));delete this._state.filter;this._state.filter=a;return this.inherited(arguments)},_request:function(a){var b=this;return this.runDeferred(null,"ls",{path:a,mount:this.mount,options:this.options,recursive:this.recursive},{checkErrors:!1,displayError:!0}).then(function(a){a=b._normalize(a);b._parse(a);return a=a.children||a},function(a){logError(a,"error in FileStore : "+this.mount+
" :"+a)})},fetchRangeSync:function(){var a=this.fetchSync(),b=new g;b.resolve(a.length);return new w(a,{totalLength:b})},reset:function(){this._state.filter=null;this._state.filterDef=null;this.resetQueryLog()},resetQueryLog:function(){this.queryLog=[]},fetchRange:function(){var a=this._fetchRange();return new w(a.then(function(a){return a}),{totalLength:a.then(function(a){return a.length})})},initRoot:function(){var a=this;if(!this.isInitiated())return a._request(".").then(function(b){a.isInitiated()||
(h.each(b,a._parse,a),a.setData(b),a.setInitiated(!0),a.emit("loaded"));return a.fetchRangeSync(arguments)}.bind(this));var b=new g;b.resolve();return b},_fetchRange:function(){if(this._state.filter){var a=this._state.filterDef;if(a)return a.then(function(b){this.reset();a&&a.resolve&&a.resolve(b)}.bind(this)),a}var b=this;if(this.isInitiated()){var f=b.fetchRangeSync(arguments),d=new g,e=new g;d.resolve(f);e.resolve(f.length);b.emit("loaded");return new w(d,{totalLength:f.totalLength})}return b._request(".").then(function(a){b.isInitiated()||
(h.each(a,b._parse,b),b.setData(a),b.setInitiated(!0),b.emit("loaded"));return b.fetchRangeSync(arguments)}.bind(this))},getDefaultCollection:function(a){var b=this.getDefaultSort();return a?this.filter({parent:a}).sort(b):this.sort(b)}}}r=r("xfile/data/Store",[p,d,b,n,a.declare,e],f());r.Implementation=f;return r})},"xfile/model/File":function(){define(["xdojo/declare","xide/data/Model","xide/utils","xide/types"],function(r,k,g,e){return r("xfile.model.File",[k],{getFolder:function(){var a=this.getPath();
return this.directory?a:g.pathinfo(a,e.PATH_PARTS.ALL).dirname},getChildren:function(){return this.children},getParent:function(){return(this.getStore()||this._S).getParent(this)},getStore:function(){return this._store||this._S}})})},"xfile/config":function(){define(["dojo/_base/declare","xide/types"],function(r,k){k.config={ROOT_NODE:"xapp",FILE_SERVICE:"",START_PATH:"./",FILES_STORE_SERVICE_CLASS:"XCOM_Directory_Service",IS_MEDIA_PICKER:null,EDITOR_NODE:null,EDITOR_AFTER_NODE:null,ACTION_TOOLBAR:null,
ALLOWED_DISPLAY_MODES:{TREE:1,LIST:1,THUMB:1,IMAGE_GRID:1},LAYOUT_PRESET:null,beanContextName:null};return k})},"xfile/manager/FileManager":function(){define("dcl/dcl dojo/_base/kernel xide/manager/ServerActionBase xide/types xfile/types xide/utils xide/encoding/SHA1 xide/manager/RPCService dojo/Deferred xdojo/has xfile/manager/FileManagerActions require xfile/factory/Store xide/lodash xdojo/has!electron?xfile/manager/Electron".split(" "),function(r,k,g,e,a,d,w,v,m,q,p,b,n,t,h){g=[g,p];q("electronx")&&
h&&g.push(h);return r(g,{declaredClass:"xfile.manager.FileManager",getNewName:function(a,c){for(var b=a.name.replace(".meta.json",""),d=!1,e=1,h=null;!d;)h=b+"-"+e+".meta.json",t.find(c,{name:h})?e++:d=!0;return h},_uploadXHR:null,store:null,config:null,filesToUpload:null,serviceUrl:"index.php",serviceClass:"XCOM_Directory_Service",settingsStore:null,stores:[],getStore:function(a,c){var b=t.find(this.stores,{mount:a});return b?b:n.createFileStore(a,null,this.config,null,this.ctx)},addStore:function(a){this.stores.push(a);
a._on("destroy",this.removeStore.bind(this))},removeStore:function(a){this.stores.indexOf(a)&&this.stores.remove(a)},download:function(a){[].push(a.path);var c=decodeURIComponent(this.serviceUrl),c=c.replace("view\x3drpc","view\x3dsmdCall"),c=-1!=c.indexOf("?")?c+"\x26":c+"?",b=this.serviceClass||"XCOM_Directory_Service";a=d.buildPath(a.mount,a.path,!0);a=this.serviceObject.base64_encode(a);c+="service\x3d"+b+".get\x26path\x3d"+a+"\x26callback\x3dasdf";this.config.DOWNLOAD_URL&&(c=""+this.config.DOWNLOAD_URL,
c+="\x26path\x3d"+a+"\x26callback\x3dasdf");var c=c+"\x26raw\x3dhtml\x26attachment\x3d1",e=d.getUrlArgs(location.href);d.mixin(e,{service:b+".get",path:a,callback:"asdf",raw:"html",attachment:"1",send:"1"});delete e.theme;delete e.debug;delete e.width;delete e.attachment;delete e.send;b=k.toJson(JSON.string(e));b=w._hmac(b,this.config.RPC_PARAMS.rpcSignatureToken,1);c+="\x26"+this.config.RPC_PARAMS.rpcUserField+"\x3d"+this.config.RPC_PARAMS.rpcUserValue;c+="\x26"+this.config.RPC_PARAMS.rpcSignatureField+
"\x3d"+b;window.open(c)},getImageUrl:function(a,c,b){c=-1!=location.href.indexOf("noImageCache")||!0===c||!0===a.dirty;var e=decodeURIComponent(this.serviceUrl),e=e.replace("view\x3drpc","view\x3dsmdCall");a=d.buildPath(a.mount,a.path,!0);a=this.serviceObject.base64_encode(a);var h=this.ctx.getFileManager().serviceClass||"XCOM_Directory_Service",e=-1!=e.indexOf("?")?e+"\x26":e+"?",e=e+("service\x3d"+h+".get\x26path\x3d"+a+"\x26callback\x3dasdf");this.config.DOWNLOAD_URL&&(e=""+this.config.DOWNLOAD_URL,
e+="\x26path\x3d"+a+"\x26callback\x3dasdf");var e=e+"\x26raw\x3dhtml\x26attachment\x3d0",e=e+"\x26send\x3d1",g=d.getUrlArgs(location.href);d.mixin(g,{service:h+".get",path:a,callback:"asdf",raw:"html"});d.mixin(g,b);delete g.theme;delete g.debug;delete g.width;a=k.toJson(g);a=w._hmac(a,this.config.RPC_PARAMS.rpcSignatureToken,1);e+="\x26"+this.config.RPC_PARAMS.rpcUserField+"\x3d"+this.config.RPC_PARAMS.rpcUserValue;e+="\x26"+this.config.RPC_PARAMS.rpcSignatureField+"\x3d"+a;c&&(e+="\x26time\x3d"+
(new Date).getTime());if(b)for(var m in b)e+="\x26"+m+"\x3d"+b[m];return e},onFileUploadFailed:function(a){var c=e.EVENTS;a.dfd&&a.dfd.reject(a);this.filesToUpload.remove(a);this.publish(c.ON_UPLOAD_FAILED,{item:a},this)},onFileUploaded:function(a){var c=this,b=e.EVENTS;setTimeout(function(){c.publish(b.STATUS,{message:""+a.file.name+" uploaded to "+a.dstDir,messageArgs:{}},c);a.dfd&&a.dfd.resolve(a);c.filesToUpload.remove(a);c.publish(b.ON_UPLOAD_FINISH,{item:a})},500)},getUploadUrl:function(){var a=
""+decodeURIComponent(this.serviceUrl),a=a.replace("view\x3drpc","view\x3dupload"),a=a.replace("../../../../","./"),a=a+"\x26service\x3d"+this.serviceClass;return a+=".put\x26callback\x3dnada"},initXHRUpload:function(a,c,b,h){var g=new XMLHttpRequest;c=""+this.getUploadUrl();c+="\x26mount\x3d"+encodeURIComponent(h);c+="\x26dstDir\x3d"+encodeURIComponent(b);var k=this;b=g.upload;b.addEventListener("progress",function(c){if(c.lengthComputable)c={item:a,progress:c},a.isLoading=!0,a.dfd.progress(c);else k.onFileUploaded(a)}.bind(this),
!1);g.onreadystatechange=function(){if(4==g.readyState){if(g.responseText&&"OK"!=g.responseText){var c=d.getJson(g.responseText);!c&&g.responseText.indexOf("Fata Error")&&(c={result:[g.responseText],code:1});if(c&&c.result&&t.isArray(c.result)&&0<c.result.length){for(var b=null,h=0;h<c.result.length;h++)k.publish(e.EVENTS.ERROR,"Error uploading : "+a.name+" "+c.result[h],k),b=c.result[h];b&&(a.error=b);k.onFileUploadFailed(a);k.submitNext();return}c&&c.error&&(k.publish(e.EVENTS.ERROR,"Error uploading : "+
a.name+" "+c.error.message,k),k.onFileUploadFailed(a))}k.onFileUploaded(a);k.submitNext()}}.bind(this);b.onerror=function(){k.publish(e.EVENTS.ERROR,"Error uploading : "+a.name,k)};g.open("POST",c,!0);return g},hasLoadingItem:function(){for(var a=0;a<this.filesToUpload.length;a++)if("loading"==this.filesToUpload[a].status)return this.filesToUpload[a];return!1},upload:function(a,c,b,d,e){e=[];for(var h=0;h<a.length;h++){var g={file:a[h],dstDir:""+b,mount:""+c,callee:d,view:d,dfd:new m};e.push(g.dfd);
this.filesToUpload.push(g)}this.submitNext();return e},sendFileUsingFormData:function(a,c){var b=new FormData;b.append("userfile_0",c.file);a.send(b)},sendFileMultipart:function(a){a.status="loading";var c=this.initXHRUpload(a,"",a.dstDir,a.mount);this.publish(e.EVENTS.ON_UPLOAD_BEGIN,{item:a,name:a.name},this);window.FormData&&this.sendFileUsingFormData(c,a)},submitNext:function(){var a=this.getNextUploadItem();a&&this.sendFileMultipart(a)},getNextUploadItem:function(){for(var a=0;a<this.filesToUpload.length;a++)if(!this.filesToUpload[a].status)return this.filesToUpload[a];
return!1},onError:function(a){if(a)if(1===a.code){if(a.message&&t.isArray(a.message)){this.publish(e.EVENTS.ERROR,a.message.join("\x3cbr/\x3e"),this);return}}else 0===a.code&&this.publish(e.EVENTS.STATUS,"Ok",this);this.publish(e.EVENTS.ERROR,{error:a},this)},addError:function(a){var c=this;a.addCallback(function(){c.onError()})},downloadItem:function(a,c){return this.callMethod(e.OPERATION.DOWNLOAD,[a],c,!0)},downloadTo:function(a,c,b,d,h){if(h){var g=this,k=function(a){var c=!1;a&&a.error&&1==a.error.code&&
(c=!0);g.publish(e.EVENTS.ON_DOWNLOAD_TO_END,{terminatorItem:h,failed:c},this);d(arguments)};g.publish(e.EVENTS.ON_DOWNLOAD_TO_BEGIN,{dst:h,url:a,items:[h]},this)}return this.callMethod(e.OPERATION.DOWNLOAD_TO,[a,c,b],k,!0)},find:function(a,c,b){try{return this.callMethod(e.OPERATION.FIND,[a,c],b,!0)}catch(d){logError(d,"find")}},getContent:function(a,c,h,g){if(this.getContentE){var k=this.getContentE.apply(this,arguments);if(k)return k}return q("php")?(k=this.serviceObject.base64_encode(d.buildPath(a,
c,!0)),this.callMethod(e.OPERATION.GET_CONTENT,[k,!1,!1],h,!1)):this._getText(b.toUrl(a).replace("main.js","")+"/"+c,{sync:!1,handleAs:"text"}).then(function(a){try{h&&h(a)}catch(c){logError(c,"error running RPC")}})},setContent:function(a,c,b,d){this.publish(e.EVENTS.ON_CHANGED_CONTENT,{mount:a,path:c,content:b});this.publish(e.EVENTS.ON_STATUS_MESSAGE,{text:"Did save file : "+a+"://"+c});if(this.setContentE){var h=this.setContentE.apply(this,arguments);if(h)return h}return this.callMethod(e.OPERATION.SET_CONTENT,
[a,c,b],d,!0)},onMessages:function(a){if((a=d.getJson(a.events))&&t.isArray(a))for(var c=0;c<a.length;c++){var b={path:a[c].relPath};d.mixin(b,a[c]);this.publish(a[c].clientEvent,b,this)}},onErrors:function(a){},init:function(){this.stores=[]},callMethodEx:function(a,c,b,h,g){var k=a||this.serviceClass,m=this;if(!this.serviceObject[k][c]){if(!0===g)this.onError({code:1,message:["Sorry, server doesnt know "+c]});return null}a={};a=d.mixin(a,this.config.RPC_PARAMS.rpcFixedParams);a[this.config.RPC_PARAMS.rpcUserField]=
this.config.RPC_PARAMS.rpcUserValue;this.serviceObject.extraArgs=a;this.serviceObject.signatureField=this.config.RPC_PARAMS.rpcSignatureField;this.serviceObject.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken;this.serviceObject[k][c](b).then(function(a){try{h&&h(a)}catch(b){console.error("bad news : callback for method "+c+" caused a crash in service class "+k)}a&&a.error&&3==a.error.code&&setTimeout(function(){m.onMessages(a.error)},50);if(a&&a.error&&a.error&&0!==a.error.code)m.onError(a.error);
else m.publish(e.EVENTS.STATUS,{message:"Ok!"},this)},function(a){m.onError(a)})},callMethod:function(a,c,b,h){var g=this,k=this.serviceClass;try{if(!this.serviceObject[k][a]){if(!0===h)this.onError({code:1,message:["Sorry, server doesnt know "+a]});return null}k={};k=d.mixin(k,this.config.RPC_PARAMS.rpcFixedParams);k[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue;this.serviceObject.extraArgs=k;this.serviceObject.signatureField=this.config.RPC_PARAMS.rpcSignatureField;this.serviceObject.signatureToken=
this.config.RPC_PARAMS.rpcSignatureToken;var m=this.serviceObject[this.serviceClass][a](c);m.then(function(c){try{b&&b(c)}catch(d){console.error("crashed in "+a),logError(d,"error running RPC")}c&&c.error&&3==c.error.code&&setTimeout(function(){g.onMessages(c.error)},50);if(c&&c.error&&c.error&&1==c.error.code)g.onError(c.error);else!1!==h&&g.publish(e.EVENTS.STATUS,{message:"Ok!"},this)},function(a){g.onError(a)});return m}catch(n){console.error("crash calling method"+n,arguments),g.onError(n),logError(n,
"error ")}},_initService:function(){this.filesToUpload=[];!this.serviceObject&&this.serviceUrl&&(this.serviceObject=new v(decodeURIComponent(this.serviceUrl)),this.serviceObject.config=this.config)}})})},"xfile/manager/FileManagerActions":function(){define(["dcl/dcl","xide/types","xide/utils"],function(r,k,g){return r(null,{declaredClass:"xfile/manager/FileManagerActions",_publishProgress:function(e,a,d,k,v){a={terminatorItem:a,failed:k,items:d||a};g.mixin(a,v);this.publish(e,a,this)},doOperation:function(e,
a,d,g,k,m){var q=this,p=e.substring(0,1).toUpperCase()+e.substring(1),b="on"+p+"End";q._publishProgress("on"+p+"Begin",d,g,!1,k);return this.runDeferred(null,e,a,m).then(function(){q._publishProgress(b,d,g,!1,k)},function(a){q._publishProgress(b,d,g,!0,k)})},deleteItems:function(e,a,d){return this.doOperation(k.OPERATION.DELETE,[e,a,!0],e,e,null,d)},copyItem:function(e,a,d,g){return this.doOperation(k.OPERATION.COPY,[e,a,d,!1],e,e,{dst:a},g)},mkdir:function(e,a,d){return this.doOperation(k.OPERATION.NEW_DIRECTORY,
[e,a],a,null,null,d)},mkfile:function(e,a,d){return this.doOperation(k.OPERATION.NEW_FILE,[e,a],a)},rename:function(e,a,d){return this.doOperation(k.OPERATION.RENAME,[e,a,d],a)},moveItem:function(e,a,d,g,v,m){return this.doOperation(k.OPERATION.MOVE,[e,a,d,g,v],e,null,null,m)},compressItem:function(e,a,d,g){return this.doOperation(k.OPERATION.COMPRESS,[e,a,d],a)},extractItem:function(e,a,d){return this.doOperation(k.OPERATION.EXTRACT,[e,a],a)}})})},"xfile/manager/MountManager":function(){define("dcl/dcl dojo/_base/lang xide/manager/ResourceManager xide/mixins/ReloadMixin xide/mixins/EventedMixin xide/types xide/utils".split(" "),
function(r,k,g,e,a,d,w){return r([g,a.dcl,e.dcl],{declaredClass:"xfile.manager.MountManager",serviceClass:"XApp_Resource_Service",mountData:null,didReload:!1,editMount:function(a){},removeMount:function(a){},getMounts:function(){return this.mountData},_onDialogOk:function(a,d,e){var g=w.toOptions(d),b=this;a=null!=e.name;d={"class":"cmx.types.Resource",enabled:!0};for(var n=0;n<g.length;n++){var t=g[n];null==t.user?d[t.name]=t.value:(d.config||(d.config={}),d.config[t.name]=t.value)}g="";d.label?
g=d.label:d.config.label&&(g=d.config.label);d.name=""+(null!=e.name?e.name:g.toLowerCase());"FILE_PROXY"===d.config.type?(d.path=""+d.path+"",k.mixin(d,d.config)):"REMOTE_FILE_PROXY"===d.config.type&&(d.path=d.name+"://");e=function(){b.ls(function(a){b.onMountDataReady(a)})};a?this.updateResource(d,!1,e):this.createResource(d,!1,e)},registerLocalMount:function(a){},registerFTP:function(a){},registerSFTP:function(a){},registerDropbox:function(a){},registerWebDav:function(){},onMountDataReady:function(a){this.mountData=
a;this.publish(d.EVENTS.ON_MOUNT_DATA_READY,{data:a});var e=this;setTimeout(function(){e.publish(d.EVENTS.ON_MOUNT_DATA_READY,{data:a})},4E3)},check:function(){this.serviceObject||this._initService()},init:function(){this.ctx.getFileManager()&&(this.serviceObject=this.ctx.getFileManager().serviceObject)},createResource:function(a,d,e){return this.callMethodEx(null,"createResource",[a,d],e,!0)},removeResource:function(a,d,e){return this.callMethodEx(null,"removeResource",[a,!0],e,!0)},updateResource:function(a,
d,e){return this.callMethodEx(null,"updateResource",[a,!0],e,!0)},ls:function(a){return this.runDeferred(null,"ls",[]).then(function(d){this.mountData=d;this.onMountDataReady(d);a&&a(d)}.bind(this))}})})},"xfile/manager/BlockManager":function(){define(["dcl/dcl","xide/manager/ManagerBase","xide/mixins/ReloadMixin","xblox/manager/BlockManager"],function(r,k,g,e){return r([k,e,g.dcl],{declaredClass:"xfile/manager/BlockManager",currentItem:null,setScriptFunctions:function(a,d,e){this.inherited(arguments)}})})},
"xfile/views/FileConsole":function(){define("xdojo/declare dcl/dcl xide/types xide/utils xide/mixins/PersistenceMixin xide/layout/_TabContainer xide/views/_Console xide/views/_ConsoleWidget xfile/views/FileSize xide/views/ConsoleView xide/lodash dojo/has!xace?xace/views/Editor".split(" "),function(r,k,g,e,a,d,w,v,m,q,p,b){function n(){return k(null,{owner:null,onServerResponse:function(a,b,c){if(a&&b&&a.owner&&a.owner.onServerResponse)return a.owner.onServerResponse(b,c)},runBash:function(a,b,c,d){var e=
this,g=e.ctx.fileManager;b=g.serviceObject.base64_encode(b);g.runDeferred("XShell","run",["sh",b,c]).then(function(c){d&&$(d).find(".consoleRunningCommand").remove();e.onServerResponse(a,c,!1)})},runPHP:function(a,b,c){var d=this,e=d.ctx.fileManager;b=e.serviceObject.base64_encode(b);e.runDeferred("XShell","run",["php",b,c]).then(function(c){d.onServerResponse(a,c,!1)})},runJavascript:function(a,b,c,d){c=(new Function("{"+b+"; }")).call(c,d);return null!=c?(this.onServerResponse(a,c),c):b},onConsoleCommand:function(a,
b){var c=a.console;if("sh"===c.type){var d=this.onServerResponse(c,"\x3cspan class\x3d'consoleRunningCommand fa-spinner fa-spin'\x3e\x3c/span\x3e\x3cpre style\x3d'font-weight: bold'\x3e# "+b+"\x3c/pre\x3e",!0),g=null;if(this.owner&&this.owner.getCurrentFolder){var k=this.owner.getCurrentFolder();k&&(g=e.buildPath(k.mount,k.path,!1))}return this.runBash(c,b,g,d)}if("php"===c.type)return g=null,c.isLinked()&&(g=this.getCurrentPath()),this.runPHP(c,b,g);if("javascript"===c.type)return this.runJavascript(c,
b)},onConsoleEnter:function(a,b){return this.onConsoleCommand(a,b)}})}function t(){var a=k(q.Editor,{didAddMCompleter:!1,multiFileCompleter:null,blockScope:null,driverInstance:null,onACEReady:function(a){},onEditorCreated:function(a,c){this.inherited(arguments);this.onACEReady(a)}});return k(q,{EditorClass:a,onAddEditorActions:k.superCall(function(a){return function(c){a.call(this,c);c=c.actions;p.find(c,{command:"File/Save"});c.remove(p.find(c,{command:"File/Save"}));c.remove(p.find(c,{command:"File/Reload"}))}}),
logTemplate:'\x3cpre style\x3d"font-size:100%;padding: 0px;" class\x3d""\x3e    ${time} - ${result}\x3c/pre\x3e',_parse:function(a,c,b){var d=""+c;0<d.indexOf("{{")||0<d.indexOf("}}")?d=_parser.parse(g.EXPRESSION_PARSER.FILTREX,d,this,{variables:a.getVariablesAsObject(),delimiters:{begin:"{{",end:"}}"}}):(a=a.parseExpression(c,null,null,null,b))&&(d=a);return d},parse:function(a,c){var b=this.driverInstance;return b&&b.blockScope?this._parse(b.blockScope,a,c):a}})}r=r("xfile.views.FileConsole",null,
{isStatusbarOpen:!1,resizeToParent:!0,__bottomTabContainer:null,onCloseStatusPanel:function(a){},onOpenStatusPanel:function(a){if(!a._tabs){var b=this,c=this.__bottomTabContainer||e.addWidget(d,{direction:"below"},null,a,!0);this.__bottomTabContainer=a._tabs=c;var g=t(),k=new (n());k.ctx=b.ctx;k.owner=this;var q=c.createTab("Bash","fa-terminal");q.add(g,{type:"sh",title:"Bash",icon:"fa-terminal",ctx:b.ctx,owner:b,value:"ls -l --color\x3dalways"},null,!0).delegate=k;q._onShown();q=c.createTab("Javascript",
"fa-code").add(g,{type:"javascript",title:"Javascript",ctx:b.ctx,value:"return 2+2;",owner:b},null,!1);q.delegate=k;var q=c.createTab("PHP","fa-terminal").add(g,{type:"php",title:"PHP",ctx:b.ctx,value:"\x3c?php \n\n\x3e",owner:b},null,!1),p=c.createTab("Sizes","fa-bar-chart");this.__fileSize=p.add(m,{owner:this,ctx:b.ctx},null,!1);this._on("openedFolder",function(a){e.destroy(b.__fileSize);p.resize();b.resize();b.__fileSize=null;b.__fileSize=p.add(m,{owner:b,ctx:b.ctx},null,!1);e.resizeTo(b.__fileSize,
p,!0,!0);b.__fileSize.startup()});a.add(c,null,!1)}return this.inherited(arguments)},onStatusbarCollapse:function(a){var b=null;this.isStatusbarOpen?(b=this.getBottomPanel(!1,.2),b.collapse(),this.onCloseStatusPanel(a),a&&a.removeClass("fa-caret-down"),a&&a.addClass("fa-caret-up")):((b=this._getBottom())?b.expand():b=this.getBottomPanel(!1,.2),this.onOpenStatusPanel(b),a&&a.removeClass("fa-caret-up"),a&&a.addClass("fa-caret-down"));this.isStatusbarOpen=!this.isStatusbarOpen;b.resize()}});r.createEditor=
function(a,d,c,g){var k={filePath:"",fileName:""};d={_permissions:[],item:k,value:d,style:"padding:0px;top:0 !important",iconClass:"fa-code",options:e.mixin(g,{filePath:k.path,fileName:k.name}),storeDelegate:{},title:"No Title"};e.mixin(d,g);a=e.addWidget(b,d,c,a,!0,null,null,!1);a.resize();return a};r.createShellViewDelegate=n;return r})},"xfile/data/DriverStore":function(){define("dojo/_base/declare dojo/Deferred xide/data/ObservableStore xide/data/TreeMemory xfile/data/Store xide/manager/ServerActionBase xide/utils".split(" "),
function(r,k,g,e,a,d,w){a=a.Implementation;return r("driverFileStore",[e,g,d.declare],w.mixin(a(),{driver:null,addDot:!1,rootSegment:"/",getRootItem:function(){var a=this._root;return a?a:this._root={_EX:!1,path:"/",name:"/",mount:this.mount,directory:!0,virtual:!0,_S:this,getPath:function(){return this.path}}},_filter:function(a){return a},_request:function(a){var d=this,e=this;if("."===a||"/"===a){var g=new k,b=e.driver.callCommand("LSProg",{override:{args:["/*"]}});b.then(function(a){a=a.files;
_.each(a,function(a){a.parent="."});a=e._filter(a);a=d._normalize({items:[{mount:"root",path:"/",children:a,name:"/",isDir:!0}]});e._parse(a);a=a.children||a;g.resolve(a)})}else g=new k,b=e.driver.callCommand("LSProg",{override:{args:[a+(e.glob||"/*")]}}),b.then(function(b){b=b.files;_.each(b,function(b){b.parent=a});b=e._filter(b);b=d._normalize({items:[{mount:"root",path:a,children:b,isDir:!0}]});e._parse(b);b=b.children||b;g.resolve(b)});return g}}))})},"xfile/views/FileGridLight":function(){define("xdojo/declare dojo/dom-class dojo/Deferred xide/types xide/utils xide/views/History xaction/DefaultActions xfile/views/GridLight xfile/factory/Store xide/model/Path xfile/model/File xfile/types xlang/i18".split(" "),
function(r,k,g,e,a,d,w,v,m,q,p,b,n){q=b.DEFAULT_FILE_GRID_PERMISSIONS;var t=r("xfile.views.FileGrid",v,{resizeAfterStartup:!0,menuOrder:{File:110,Edit:100,View:50,Settings:20,Navigation:10,Window:5},groupOrder:{Clipboard:110,File:100,Step:80,Open:70,Organize:60,Insert:10,Navigation:5,Select:0},tabOrder:{Home:100,View:50,Settings:20,Navigation:10},noDataMessage:"\x3cspan/\x3e",_history:null,options:a.clone(e.DEFAULT_GRID_OPTIONS),_columns:{},toolbarInitiallyHidden:!0,itemType:e.ITEM_TYPE.FILE,permissions:q,
contextMenuArgs:{limitTo:null},setState:function(a){this.inherited(arguments);var b=this,c=b.collection,d=a.store.path;c.getSync(d);var e=b.refresh();try{e.then(function(){c.getItem(d,!0).then(function(a){b.openFolder(a)})})}catch(g){console.error("error restoring folder state")}return e},postMixInProperties:function(){var a=this.state;a&&a._columns&&(this._columns=a._columns);this.columns||(this.columns=this.getColumns());!this.collection&&this.state&&(a=this.state.store,this.collection=m.createFileStore(a.mount,
a.storeOptions,this.ctx.config).getDefaultCollection());return this.inherited(arguments)},getState:function(a){a=this.inherited(arguments)||{};a.store={mount:this.collection.mount,path:this.getCurrentFolder().path,storeOptions:this.collection.options};a._columns={};_.each(this._columns,function(b){a._columns[b.label]=!this.isColumnHidden(b.id)},this);return a},onSaveLayout:function(a){a=a.data;var b=this.getState();a.widgets.push({widget:this.declaredClass,state:b});return a},formatColumn:function(b,
d,c){var e=this.selectedRenderer?this.selectedRenderer.prototype:this;if(e.formatColumn&&(e=e.formatColumn.apply(arguments))||c.renderColumn&&(e=c.renderColumn.apply(this,arguments)))return e;switch(b){case "fileType":if("folder"==d)return n.localize("kindFolder");if(c.mime){var e="kind"+(c.mime.split("/")[1]||"unknown").toUpperCase(),g=n.localize(e);return e!==g?g:d}case "name":var g=c&&null!=c.directory&&!0===c.directory,k=!1===c.read&&!1===c.write,m=".."==c.name,e="",e=g?m?"fa fa-level-up itemFolderList":
k?"fa fa-lock itemFolderList":"fa fa-folder itemFolderList":k?"fa fa-lock itemFolderList":"itemFolderList fa "+a.getIconClass(c.path),g=!0===c.showPath?c.path:d;return'\x3cspan class\x3d"'+e+'""\x3e\x3c/span\x3e\x3cspan class\x3d"name fileGridNameNode" style\x3d"vertical-align: middle;padding-top: 0px"\x3e'+g+"\x3c/span\x3e";case "sizeBytes":return c.size;case "fileType":return a.capitalize(c.fileType||"unknown");case "mediaInfo":return c.mediaInfo||"unknown";case "owner":return c&&(e=c.owner)&&e.user?
e.user.name:"";case "modified":if(""===d)break;g=null==!c.directory;return!g&&n.translations.dateFormat?n.formatDate(d).replace("ms",""):""}return d},getColumns:function(){function a(c,d,e,g){null!=b._columns[c]&&(g=!b._columns[c]);b.columns.push({renderExpando:"Name"===c,label:c,field:d,sortable:e,formatter:function(a,c){return b.formatColumn(d,a,c)},hidden:g})}var b=this;this.columns=[];a("Name","name",!0,!1);a("Type","fileType",!0,!0);a("Path","path",!0,!0);a("Size","sizeBytes",!0,!1);a("Modified",
"modified",!0,!1);a("Owner","owner",!0,!0);a("Media","mediaInfo",!0,!0);return this.columns},_focus:function(){var a=this.getRows();a[0]&&(a=this.row(a[0]),this.focus(a.data))},setQueryEx:function(a,b){if(!a)return console.error("bad, no item!"),!1;if(!a.directory)return!1;this._lastPath=a.getPath();var c=this,d=new g;if(c){var e=this.collection;"."===a.path?(e.resetQueryLog(),c.set("collection",e.getDefaultCollection(a.getPath())),d.resolve&&d.resolve()):e.open(a).then(function(b){e.resetQueryLog();
c.set("collection",e.getDefaultCollection(a.getPath()));d.resolve&&d.resolve(b)});return d}console.error("have no grid")},getCurrentFolder:function(){var a=this.getSelectedRenderer();if(a&&a.getCurrentFolder&&(a=a.getCurrentFolder.apply(this))){if(a.isBack){var b=this.collection.getSync(a.rPath);b&&(a=b)}return a}if((a=this.getRows()[0])&&(a._S||a._store)){if(1==a.isBack&&(b=this.getHistory().getNow()))return this.collection.getSync(b);if(a=a._S.getParent(a))return a}return null},getClass:function(){return t},
getHistory:function(){this._history||(this._history=new d);return this._history},renderArray:function(a,b){_.find(arguments[0],{isBack:!0});return this.inherited(arguments)},startup:function(){if(!this._started){var a=this.inherited(arguments);k.add(this.domNode,"xfileGrid");this.set("loading",!0);if(this.permissions){var b=w.getDefaultActions(this.permissions,this,this),b=b.concat(this.getFileActions(this.permissions));this.addActions(b)}this._history=new d;var c=this;this.subscribe(e.EVENTS.ON_CLIPBOARD_COPY,
function(a){a.type===c.itemType&&(c.currentCopySelection=a.selection,c.refreshActions())});c._on("noData",function(){c.getRows();if(!(0<c._total)){var a=c._history.getNow();a&&"./."!==a&&c.renderArray([{name:"..",path:"..",rPath:a,sizeBytes:0,size:"",icon:"fa-level-up",isBack:!0,modified:"",_S:c.collection,directory:!0,_EX:!0,children:[],mayHaveChildren:!1}])}});this.on("dgrid-refresh-complete",function(){var a=c.getRows();a&&1<a.length&&(a=_.find(a,{isBack:!0}))&&(c.removeRow(a),c.refresh())});this._on("openFolder",
function(a){c.set("title",a.item.name)});c.selectedRenderer&&(a=this.refresh())&&a.then(function(){c.set("loading",!1);c.setRenderer(c.selectedRenderer,!1)});this._on("onChangeRenderer",function(){c.refresh()});setTimeout(function(){c.resize()},500);return a}}});t.prototype.Module=t;t.Module=t;t.createDefault=function(b,d,c,e,g,k){d=a.mixin({collection:k.getDefaultCollection(),_parent:c,Module:t,ctx:b},d||{});d=a.addWidget(t,d,null,c,g,null,null,!0,null);e&&b.getWindowManager().registerView(d,!1);
return d};t.DEFAULT_PERMISSIONS=q;return t})},"xfile/views/GridLight":function(){define("xdojo/declare xide/types xgrid/ListRenderer xfile/ThumbRenderer xgrid/TreeRenderer xgrid/Grid xgrid/MultiRenderer xfile/FileActions xide/views/_LayoutMixin xgrid/KeyboardNavigation xgrid/Selection xide/mixins/_State xide/widgets/_Widget".split(" "),function(r,k,g,e,a,d,w,v,m,q,p,b,n){g=[g,e,a];r=r.classFactory("multiRenderer",{},g,w.Implementation);k=d.createGridClass("xfile.views.GridLight",{},{SELECTION:{CLASS:p},
KEYBOARD_SELECTION:!0,COLUMN_HIDER:!0,COLUMN_REORDER:!1,CONTEXT_MENU:k.GRID_FEATURES.CONTEXT_MENU,CLIPBOARD:k.GRID_FEATURES.CLIPBOARD,ACTIONS:k.GRID_FEATURES.ACTIONS,ITEM_ACTIONS:{CLASS:v},SPLIT:{CLASS:m},KEYBOARD_NAVIGATION:{CLASS:q},STATE:{CLASS:b},WIDGET:{CLASS:n}},{RENDERER:r},{renderers:g,selectedRenderer:a});k.DEFAULT_RENDERERS=g;k.DEFAULT_MULTI_RENDERER=r;return k})}}});
//# sourceMappingURL=xfile.js.map