<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Documentation Source: manager/BeanManager.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.simplex.css">
	<link type="text/css" rel="stylesheet" href="styles/override.css">
	<link type="text/css" rel="stylesheet" href="styles/theme.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Documentation</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-xcf_driver_DriverBase.html">xcf/driver/DriverBase</a></li><li><a href="module-xcf_manager_BeanManager.html">xcf/manager/BeanManager</a></li><li><a href="module-xcf_manager_DeviceManager.html">xcf/manager/DeviceManager</a></li><li><a href="module-xcf_manager_DeviceManager_DeviceServer.html">xcf/manager/DeviceManager_DeviceServer</a></li><li><a href="module-xide_manager_DeviceManager.html">xide/manager/DeviceManager</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-xcf.driver.DriverBase.html">xcf.driver.DriverBase</a></li><li><a href="module-xcf.manager.DeviceManager_DeviceServer.html">xcf.manager.DeviceManager_DeviceServer</a></li><li><a href="module-xcf_manager_Context.html">xcf/manager/Context</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#addDeviceInstance">addDeviceInstance</a></li><li><a href="global.html#appScope">appScope</a></li><li><a href="global.html#beanIconClass">beanIconClass</a></li><li><a href="global.html#completeDriver">completeDriver</a></li><li><a href="global.html#createDriverInstance">createDriverInstance</a></li><li><a href="global.html#createLeftView">createLeftView</a></li><li><a href="global.html#createRightView">createRightView</a></li><li><a href="global.html#defaultScope">defaultScope</a></li><li><a href="global.html#driverScopes">driverScopes</a></li><li><a href="global.html#editDriver">editDriver</a></li><li><a href="global.html#groupType">groupType</a></li><li><a href="global.html#insertIfMatch">insertIfMatch</a></li><li><a href="global.html#itemMetaPath">itemMetaPath</a></li><li><a href="global.html#itemMetaStorePath">itemMetaStorePath</a></li><li><a href="global.html#itemMetaTitleField">itemMetaTitleField</a></li><li><a href="global.html#itemType">itemType</a></li><li><a href="global.html#match">match</a></li><li><a href="global.html#newGroup">newGroup</a></li><li><a href="global.html#newItem">newItem</a></li><li><a href="global.html#nodeValuePath">nodeValuePath</a></li><li><a href="global.html#nodeValueTransform">nodeValueTransform</a></li><li><a href="global.html#onCreateVariableCI">onCreateVariableCI</a></li><li><a href="global.html#onDeviceMessage">onDeviceMessage</a></li><li><a href="global.html#onDeviceReady">onDeviceReady</a></li><li><a href="global.html#onMainViewReady">onMainViewReady</a></li><li><a href="global.html#onNewDriverScopeCreated">onNewDriverScopeCreated</a></li><li><a href="global.html#onReloaded">onReloaded</a></li><li><a href="global.html#onStoreReady">onStoreReady</a></li><li><a href="global.html#onWidgetReady">onWidgetReady</a></li><li><a href="global.html#registerEditorExtensions">registerEditorExtensions</a></li><li><a href="global.html#replaceWith">replaceWith</a></li><li><a href="global.html#setScriptFunctions">setScriptFunctions</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#systemScope">systemScope</a></li><li><a href="global.html#toPreferenceId">toPreferenceId</a></li><li><a href="global.html#updateItemMetaData">updateItemMetaData</a></li><li><a href="global.html#userScope">userScope</a></li><li><a href="global.html#variables">variables</a></li>
				</ul>
			</li>
			
		</ul>
		<div class="col-sm-3 col-md-3">
            <form class="navbar-form" role="search">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                    <div class="input-group-btn">
                        <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                    </div>
                </div>
            </form>
        </div>
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			

		<h1 class="page-title">Source: manager/BeanManager.js</h1>
    
<section>
    <article>
        <pre
            class="sunlight-highlight-javascript linenums">/** @module xcf/manager/BeanManager **/
define([
    'dcl/dcl',
    "xdojo/declare",
    "dojo/_base/lang",
    'xide/types',
    'xide/utils',
    'xide/manager/BeanManager',
    'xdojo/has!xcf-ui?xide/views/ActionDialog',
    'xdojo/has!xcf-ui?xide/views/CIActionDialog',
    'xdojo/has!xcf-ui?xide/views/CIGroupedSettingsView'
], function (dcl,declare,lang,types, utils, BeanManager,registry,ActionDialog, CIActionDialog, CIGroupedSettingsView){
    /**
     * @class module:xcf/manager/BeanManager
     * @extends module:xide/manager/BeanManager
     */
    return dcl(BeanManager, {
        declaredClass:"xcf.manager.BeanManager",
        /**
         * Url generator for device/driver/[command|block|variable]
         *
         * @param device
         * @param driver
         * @param block
         * @param prefix
         * @returns {*}
         */
        toUrl:function(device, driver, block, prefix) {

            prefix = prefix || '';
            var pattern = prefix + "deviceScope={deviceScope}&amp;device={deviceId}&amp;driver={driverId}&amp;driverScope={driverScope}&amp;block={block}";
            var url = lang.replace(
                pattern,
                {
                    deviceId: device.id,
                    deviceScope: device.scope,
                    driverId: driver.id,
                    driverScope: driver.scope,
                    block: block.id
                });
            return url;
        },
        /////////////////////////////////////////////////////////////////////////////////////
        //
        //  Bean Editing
        //
        /////////////////////////////////////////////////////////////////////////////////////
        /***
         * openItemSettings creates a new settings view for a protocol
         * @param item
         * @returns {xide.views.CIGroupedSettingsView|null}
         */
        openItemSettings: function (item,device) {

            //1. sanity check
            var userData = item.user;


            if (!userData || !userData.inputs) {
                return null;
            }

            //2. check its not open already
            var viewId = this.getViewId(item);
            var view = registry.byId(viewId);
            try {
                if (view) {
                    if (view.parentContainer) {
                        view.parentContainer.selectChild(view);
                    }
                    return null;
                }
            } catch (e) {
                utils.destroy(view);
            }

            var docker = this.ctx.mainView.getDocker(),
                title = this.getMetaValue(item, this.itemMetaTitleField),
                devinfo = device ? this.ctx.getDeviceManager().toDeviceControlInfo(device) : null;

            var parent = docker.addTab(null, {
                title: (title || item.name) + '' + (device ? ':' + device.name + ':' + devinfo.host + ':' : ''),
                icon: this.beanIconClass
            });


            //@Todo:driver, store device temporarly in Commands CI
            var commandsCI = utils.getCIByChainAndName(userData, 0, types.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);
            if(commandsCI){
                commandsCI.device = device;
            }

            if(item.blockScope &amp;&amp; !item.blockScope.serviceObject){
                item.blockScope.serviceObject = this.serviceObject;

            }
            return utils.addWidget(CIGroupedSettingsView,{
                cis: userData.inputs,
                storeItem: item,
                iconClass: this.beanIconClass,
                id: viewId,
                delegate: this,
                storeDelegate: this,
                blockManager: this.ctx.getBlockManager(),
                options:{
                    groupOrder: {
                        'General': 1,
                        'Settings': 2,
                        'Visual':3
                    }
                }
            }, this, parent, true);

        },
        /////////////////////////////////////////////////////////////////////////////////////
        //
        //  Bean Management
        //
        /////////////////////////////////////////////////////////////////////////////////////
        /**
         * Creates new group item dialog
         */
        newGroup: function () {

            var thiz = this,
                currentItem = this.getItem(),
                parent = currentItem ? currentItem.isDir === true ? currentItem.path : '' : '';

            var actionDialog = new CIActionDialog({
                title: 'New '  + this.groupType,
                delegate: {
                    onOk: function (dlg, data) {

                        var title = utils.getCIInputValueByName(data, 'Title');
                        var scope = utils.getCIInputValueByName(data, 'Scope');
                        var _final = parent + '/' + title;

                        thiz.createGroup(scope, _final, function (response) {

                            var newItem = thiz.createNewGroupItem(title, scope, parent);
                            thiz.store.putSync(newItem);
                            thiz.publish(types.EVENTS.ON_STORE_CHANGED, {
                                owner: thiz,
                                store: thiz.store,
                                action: types.NEW_DIRECTORY,
                                item: newItem
                            });
                        });
                    }
                },
                cis: [
                    utils.createCI('Title', 13, ''),
                    utils.createCI('Scope', 3, this.defaultScope, {
                        "options": [
                            {
                                label: 'System',
                                value: this.defaultScope
                            },
                            {
                                label: 'User',
                                value: this.userScope
                            },
                            {
                                label: 'App',
                                value: this.appScope
                            }
                        ]
                    })
                ]
            });
            actionDialog.startup();
            actionDialog.show();
        },
        onDeleteItem: function (item) {

            var isDir = utils.toBoolean(item.isDir) === true;
            //pick the right service function
            var removeFn = isDir ? 'removeGroup' : 'removeItem';
            var thiz = this;
            var actionDialog = new ActionDialog({
                title: 'Remove ' + this.beanName +   (isDir ? ' Group' : '') + ' ' + "\"" + item.name + "\"  ",
                style: 'max-width:400px',
                titleBarClass: 'text-danger',
                delegate: {
                    isRemoving: false,
                    onOk: function (dlg) {
                        thiz[removeFn](
                            utils.toString(item.scope),
                            utils.toString(item.path),
                            utils.toString(item.name),
                            function () {

                                thiz.onItemDeleted(item);

                                thiz.publish(types.EVENTS.ON_STORE_CHANGED, {
                                    owner: thiz,
                                    store: thiz.store,
                                    action: types.DELETE,
                                    item: item
                                });
                            });
                    }
                }
            });
            actionDialog.show();
        },
        /////////////////////////////////////////////////////////////////////////////////////
        //
        //  Bean protocol
        //
        /////////////////////////////////////////////////////////////////////////////////////
        hasItemActions: function () {
            return true;
        },
        onItemDeleted: function (item) {

            //delete subs
            this.store.removeSync(item.path);

            if(item == this.currentItem) {
                this.currentItem = null;
            }
            if (item) {
                var view = this.getView(item);
                if (view) {
                    utils.destroyWidget(view);
                }
            }
        },
        onItemSelected: function (item) {
            this.currentItem = item;
        },
        /////////////////////////////////////////////////////////////////////////////////////
        //
        //  UI-Callbacks
        //
        /////////////////////////////////////////////////////////////////////////////////////
        onCIUpdate: function (evt) {
            if (evt['owner'] === this) {
                this.updateCI(evt.ci, evt.newValue, evt.oldValue, evt.storeItem);
            }
        },
        /////////////////////////////////////////////////////////////////////////////////////
        //
        //  Bean utils
        //
        /////////////////////////////////////////////////////////////////////////////////////
        createNewGroupItem: function (title, scope, parent) {
            return this.createItemStruct(title, scope, parent, title, true, this.groupType);
        },
        createNewItem: function (title, scope, parent) {
            return this.createItemStruct(title, scope, parent, parent + "/" + title, false, this.itemType);
        },
        /////////////////////////////////////////////////////////////////////////////////////
        //
        // main
        //
        /////////////////////////////////////////////////////////////////////////////////////
        init: function () {
            this.subscribe(types.EVENTS.ON_CI_UPDATE);
        },
        /////////////////////////////////////////////////////////////////////////////////////
        //
        //  Server methods (PHP)
        //
        /////////////////////////////////////////////////////////////////////////////////////
        createItem: function (scope, path, title, meta,code) {
            return this.runDeferred(null, 'createItem', [scope, path, title, meta, code]);
        },
        /***
         * ls is enumerating all drivers in a given scope
         * @param scope{string}
         * @returns {Deferred}
         */
        ls: function (scope) {

            return this.runDeferred(null, 'ls', [scope]).then(function (data) {
                try {
                    this.rawData = data;
                    this.initStore(data);
                    this.publish(types.EVENTS.ON_STORE_CREATED, {
                        data: data,
                        owner: this,
                        store: this.store,
                        type: this.itemType
                    });
                }catch(e){
                    logError(e,'error ls');
                }
            }.bind(this));
        },
        /**
         *
         * @param title
         * @param scope
         * @param parent
         * @returns {*|{name, isDir, parentId, path, beanType, scope}|{name: *, isDir: *, parentId: *, path: *, beanType: *, scope: *}}
         */
        _getText: function (url) {
            var result;
            var def = dojo.xhrGet({
                url: url,
                sync: true,
                handleAs: 'text',
                load: function (text) {
                    result = text;
                }
            });
            return '' + result + '';
        }
    });
});
</pre>
    </article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>

<div class="modal fade" id="searchResults">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Search results</h4>
      </div>
      <div class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>

<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a>
	
		on 2016-06-02T17:42:36+02:00
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>
<script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>

<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			var id = $( heading ).attr( "id" );
			return id && id.replace(/\~/g, '-inner-').replace(/\./g, '-static-') || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->


<script type="text/javascript">
	$(document).ready(function() {
		SearcherDisplay.init();
	});
</script>

</body>
</html>
