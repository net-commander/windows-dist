//>>built
require({cache:{"xide/types":function(){define(["dcl/dcl"],function(e){e=new e(null,{declaredClass:"xide/types"});e.test=22;return e})},"dcl/dcl":function(){(function(e){"undefined"!=typeof define?define(["./mini"],e):"undefined"!=typeof module?module.exports=e(require("./mini")):dcl=e(dcl)})(function(e){function p(){}function m(b,a,d){var c=b||p,g=a||p,r=d||p,q=function(){var a,d;c.apply(this,arguments);try{a=r.apply(this,arguments)}catch(k){a=k,d=!0}g.call(this,arguments,a);if(d)throw a;return a};
q.advices={before:b,after:a,around:d};return q}function n(b){return function(a,d){var c=a._meta,g;c&&((g=+c.weaver[d]||0)&&g!=b&&e._error("set chaining",d,a,b,g),c.weaver[d]=b)}}var f=e(e.Super,{constructor:function(){this.before=this.around.before;this.after=this.around.after;this.around=this.around.around}});e.mix(e,{Advice:f,advise:function(b){return e._makeSuper(b,f)},before:function(b){return e.advise({before:b})},after:function(b){return e.advise({after:b})},around:e.superCall,chainBefore:n(1),
chainAfter:n(2),isInstanceOf:function(b,a){if(b instanceof a)return!0;var d=b.constructor._meta,c;if(d)for(d=d.bases,c=d.length-1;0<=c;--c)if(d[c]===a)return!0;return!1},_stub:function(b,a,d,c){c=c[d]=e._extractChain(a,d,"around");var g=e._extractChain(a,d,"before").reverse();a=e._extractChain(a,d,"after");c=b?e._stubChainSuper(c,1==b?function(g){return e._stubChain(g.reverse())}:e._stubChain,d):e._stubSuper(c,d);return g.length||a.length?m(e._stubChain(g),e._stubChain(a),c):c||function(){}}});return e})},
"dcl/mini":function(){(function(e){"undefined"!=typeof define?define([],e):"undefined"!=typeof module?module.exports=e():dcl=e()})(function(){function e(d,c){var g=[0],b,q,h,l,k,t,f,u,z=0,v;if(d)if(d instanceof Array){k={};f=d.slice(0).reverse();for(u=f.length-1;0<=u;--u)if(q=f[u],q._uniqueId=q._uniqueId||n++,b=q._meta){t=b.bases;for(z=t.length-1;0<z;--z)v=t[z]._uniqueId,k[v]=(k[v]||0)+1;f[u]=t.slice(0)}else f[u]=[q];b={};a:for(;f.length;){for(u=0;u<f.length;++u)if(t=f[u],q=t[0],v=q._uniqueId,!k[v]){b[v]||
(g.push(q),b[v]=1);t.shift();t.length?--k[t[0]._uniqueId]:f.splice(u,1);continue a}e._error("cycle",c,f)}d=d[0];z=g.length-((l=d._meta)&&d===g[g.length-(z=l.bases.length)]?z:1)-1}else d._uniqueId=d._uniqueId||n++,g=g.concat((l=d._meta)?l.bases:d);b=d?e.delegate(d.prototype):{};for(t=d&&(l=d._meta)?e.delegate(l.weaver):{constructor:2};0<z;--z)if(q=g[z],l=q._meta,e.mix(b,l&&l.ownProps||q.prototype),l)for(v in f=l.weaver)t[v]=(+t[v]||0)|f[v];for(v in c)m(l=c[v])?t[v]=+t[v]||0:b[v]=l;l={bases:g,ownProps:c,
weaver:t,chains:{}};g[0]={_meta:l,prototype:b};q=b;k=l.weaver;t=l.bases;f=l.chains;for(h in k)q[h]=e._stub(k[h],t,h,f);h=b.constructor;h._meta=l;h.prototype=b;g[0]=h;g=e._postprocess(h);c.declaredClass&&!a[c.declaredClass]&&(a[c.declaredClass]=g);return g}function p(a){this.around=a}function m(a){return a&&a.spr instanceof p}var n=0,f={},b,a={};(b=function(a,c){for(var g in c)a[g]=c[g]})(e,{mix:b,delegate:function(a){return Object.create(a)},allKeys:function(a){var c=[],g;for(g in a)c.push(g);return c},
Super:p,superCall:function(a){return e._makeSuper(a)},_makeSuper:function(a,c){var g=function(){};g.spr=new (c||p)(a);return g},_postprocess:function(a){return a},_error:function(a){throw Error("dcl: "+a);},_instantiate:function(a,c,g){c=a.spr.around(c);c.ctr=a.ctr;return c},_extractChain:function(a,c,g){for(var b=a.length-1,q=[],h,l,k="around"==g;h=a[b];--b)if((l=h._meta)?(l=l.ownProps).hasOwnProperty(c)&&(m(l=l[c])?k?l.spr.around:l=l.spr[g]:k):k&&(l="constructor"==c?h:h.prototype[c])&&l!==f[c])"function"==
typeof l?(l.ctr=h,q.push(l)):e._error("wrong super",h,c);return q},_stubChain:function(a){var c=a.length,g;return c?1==c?(g=a[0],function(){g.apply(this,arguments)}):function(){for(var g=0;g<c;++g)a[g].apply(this,arguments)}:0},_stubSuper:function(a,c){for(var g=0,b,q=f[c];b=a[g];++g)q=m(b)?a[g]=e._instantiate(b,q,c):b;return"constructor"!=c?q:function(){q.apply(this,arguments)}},_stubChainSuper:function(a,c,g){for(var b=0,q,h,l=0;q=a[b];++b)m(q)&&(h=b-l,a[b]=e._instantiate(q,h?1==h?a[l]:c(a.slice(l,
b)):0,g),l=b);return(h=b-l)?1==h&&"constructor"!=g?a[l]:c(l?a.slice(l):a):0},_stub:function(a,c,g,b){c=b[g]=e._extractChain(c,g,"around");return(a?e._stubChainSuper(c,e._stubChain,g):e._stubSuper(c,g))||function(){}}});e.getObject=function(b){return a[b]};e.setObject=function(b,c){return a[b]=c};return e})},"xide/types/Types":function(){define(["dojo/_base/lang","xide/types","dojo/_base/json","dojo/_base/kernel","xide/utils"],function(e,p,m,n,f){null==p.customTypes&&(p.customTypes={});null==p.customEnumerations&&
(p.customEnumerations={});null==p.widgetMappings&&(p.widgetMappings={});null==p.customMimeIcons&&(p.customMimeIcons={});null==p.CICallbacks&&(p.CICallbacks={});p.resolveType=function(b){return p.customTypes[b]?p.customTypes[b]:null};p.registerType=function(b,a){p.customTypes[b]=a};p.registerWidgetMapping=function(b,a){p.widgetMappings[b]=a};p.registerEnumeration=function(b,a){p.customEnumerations[b]=a};p.resolveEnumeration=function(b){return p.customEnumerations[b]?p.customEnumerations[b]:null};p.resolveWidgetMapping=
function(b){return p.widgetMappings[b]?p.widgetMappings[b]:null};p.registerCICallbacks=function(b,a){p.CICallbacks[b]||(p.CICallbacks[b]={});f.mixin(p.CICallbacks[b],a);return null};p.getCICallbacks=function(b){return p.CICallbacks[b]?p.CICallbacks[b]:null};p.GRID_FEATURE={KEYBOARD_NAVIGATION:"KEYBOARD_NAVIGATION",KEYBOARD_SELECT:"KEYBOARD_SELECT",SELECTION:"SELECTION",ACTIONS:"ACTIONS",CONTEXT_MENU:"CONTEXT_MENU"};p.VIEW_FEATURE={KEYBOARD_NAVIGATION:"KEYBOARD_NAVIGATION",KEYBOARD_SELECT:"KEYBOARD_SELECT",
SELECTION:"SELECTION",ACTIONS:"ACTIONS",CONTEXT_MENU:"CONTEXT_MENU"};p.KEYBOARD_PROFILE={DEFAULT:{prevent_default:!0,prevent_repeat:!1},PASS_THROUGH:{prevent_default:!1,prevent_repeat:!1},SEQUENCE:{prevent_default:!0,is_sequence:!0,prevent_repeat:!0}};p.CI_STATE={NONE:0,PENDING:1,PROCESSING:2,FAILED:4,SUCCESSED:8,PROCESSED:16,DEQUEUED:32,SOLVED:64,END:128};p.CIFLAG={NONE:0,BASE_64:1,USE_FUNCTION:2,REPLACE_VARIABLES:4,REPLACE_VARIABLES_EVALUATED:8,ESCAPE:16,REPLACE_BLOCK_CALLS:32,REMOVE_DELIMTTERS:64,
ESCAPE_SPECIAL_CHARS:128,USE_REGEX:256,USE_FILTREX:512,CASCADE:1024,EXPRESSION:2048,DONT_PARSE:4096,TO_HEX:8192,REPLACE_HEX:16384,WAIT:32768,DONT_ESCAPE:65536,END:131072};p.CI_CORDER={};p.ECIType={BOOL:0,BOX:1,COLOUR:2,ENUMERATION:3,FILE:4,FLAGS:5,FLOAT:6,INTEGER:7,MATRIX:8,OBJECT:9,REFERENCE:10,QUATERNION:11,RECTANGLE:12,STRING:13,VECTOR:14,VECTOR2D:15,VECTOR4D:16,ICON:17,IMAGE:18,BANNER:19,LOGO:20,STRUCTURE:21,BANNER2:22,ICON_SET:23,SCRIPT:24,EXPRESSION:25,RICHTEXT:26,ARGUMENT:27,JSON_DATA:28,EXPRESSION_EDITOR:29,
WIDGET_REFERENCE:30,DOM_PROPERTIES:31,BLOCK_REFERENCE:32,BLOCK_SETTINGS:33,FILE_EDITOR:34,END:35,UNKNOWN:-1};p.ITEM_TYPE={FILE:"BTFILE",WIDGET:"WIDGET",BLOCK:"BLOCK",TEXT:"TEXT",EXPRESSION:"EXPRESSION"};p.EXPRESSION_PARSER||(p.EXPRESSION_PARSER={});p.COMPONENT_NAMES={XIDEVE:"xideve",XNODE:"xnode",XBLOX:"xblox",XFILE:"xfile",XACE:"xace",XEXPRESSION:"xexpression",XCONSOLE:"xconsole",XTRACK:"xtrack"};p.WIDGET_REFERENCE_MODE={BY_ID:"byid",BY_CLASS:"byclass",BY_CSS:"bycss",BY_EXPRESSION:"expression"};
p.VIEW_SPLIT_MODE={DESIGN:1,SOURCE:2,SPLIT_VERTICAL:6,SPLIT_HORIZONTAL:7};p.RESOURCE_VARIABLES={ACE:"ACE",APP_URL:"APP_URL",SITE_URL:"SITE_URL"};p.EVENTS={ERROR:"onError",STATUS:"onStatus",ON_CREATED_MANAGER:"onCreatedManager",ON_ITEM_SELECTED:"onItemSelected",ON_ITEM_REMOVED:"onItemRemoved",ON_ITEM_CLOSED:"onItemClosed",ON_ITEM_ADDED:"onItemAdded",ON_ITEM_MODIFIED:"onItemModified",ON_NODE_SERVICE_STORE_READY:"onNodeServiceStoreReady",ON_FILE_STORE_READY:"onFileStoreReady",ON_CONTEXT_MENU_OPEN:"onContextMenuOpen",
ON_CI_UPDATE:"onCIUpdate",ON_WIDGET_READY:"onWidgetReady",ON_CREATED_WIDGET:"onWidgetCreated",RESIZE:"onResize",ON_MODULE_RELOADED:"onModuleReloaded",ON_MODULE_UPDATED:"onModuleUpdated",ON_DID_OPEN_ITEM:"onDidOpenItem",ON_DID_RENDER_COLLECTION:"onDidRenderCollection",ON_PLUGIN_LOADED:"onPluginLoaded",ON_PLUGIN_READY:"onPluginReady",ALL_PLUGINS_READY:"onAllPluginsReady",ON_CREATE_EDITOR_BEGIN:"onCreateEditorBegin",ON_CREATE_EDITOR_END:"onCreateEditorEnd",REGISTER_EDITOR:"registerEditor",ON_EXPRESSION_EDITOR_ADD_FUNCTIONS:"onExpressionEditorAddFunctions",
ON_ACE_READY:"onACEReady",ON_UNSAVED_CONTENT:"onUnSavedContent",ON_FILE_CHANGED:"fileChanged",ON_FILE_DELETED:"fileDeleted",IMAGE_LOADED:"imageLoaded",IMAGE_ERROR:"imageError",UPLOAD_BEGIN:"uploadBegin",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_FINISH:"uploadFinish",UPLOAD_FAILED:"uploadFailed",ON_FILE_CONTENT_CHANGED:"onFileContentChanged",ON_COPY_BEGIN:"onCopyBegin",ON_COPY_END:"onCopyEnd",ON_DELETE_BEGIN:"onDeleteBegin",ON_DELETE_END:"onDeleteEnd",ON_MOVE_BEGIN:"onMoveBegin",ON_MOVE_END:"onMoveEnd",
ON_CHANGED_CONTENT:"onChangedContent",ON_COMPRESS_BEGIN:"onCompressBegin",ON_COMPRESS_END:"onCompressEnd",ON_COMPONENT_READY:"onComponentReady",ON_ALL_COMPONENTS_LOADED:"onAllComponentsLoaded",ON_APP_READY:"onAppReady",ON_CREATE_STORE:"onCreateStore",ON_STORE_CREATED:"onStoreCreated",ON_STORE_CHANGED:"onStoreChanged",ON_STATUS_MESSAGE:"onStatusMessage",SAVE_LAYOUT:"layoutSave",RESTORE_LAYOUT:"layoutRestore",ON_SHOW_PANEL:"onShowPanel",ON_PANEL_CLOSED:"onPanelClosed",ON_PANEL_CREATED:"onPanelCreated",
ON_MAIN_VIEW_READY:"onMainViewReady",ON_MAIN_MENU_READY:"onMainMenuReady",ON_MAIN_MENU_OPEN:"onMainMenuOpen",ON_VIEW_REMOVED:"onViewRemoved",ON_VIEW_SHOW:"onViewShow",ON_VIEW_HIDE:"onViewHide",ON_VIEW_ADDED:"onViewAdded",ON_OPEN_VIEW:"onOpenView",ON_VIEW_MAXIMIZE_START:"onViewMaximizeStart",ON_VIEW_MAXIMIZE_END:"onViewMaximizeEnd",ON_CONTAINER_ADDED:"onContainerAdded",ON_CONTAINER_REMOVED:"onContainerRemoved",ON_REMOVE_CONTAINER:"onRemoveContainer",ON_CONTAINER_REPLACED:"onContainerReplaced",ON_CONTAINER_SPLIT:"onContainerSplit",
ON_RENDER_WELCOME_GRID_GROUP:"onRenderWelcomeGridGroup",ON_DND_SOURCE_OVER:"/dnd/source/over",ON_DND_START:"/dnd/start",ON_DND_DROP_BEFORE:"/dnd/drop/before",ON_DND_DROP:"/dnd/drop",ON_DND_CANCEL:"/dnd/cancel"};p.DIALOG_SIZE={SIZE_NORMAL:"size-normal",SIZE_SMALL:"size-small",SIZE_WIDE:"size-wide",SIZE_LARGE:"size-large"};p.DIALOG_TYPE={DEFAULT:"type-default",INFO:"type-info",PRIMARY:"type-primary",SUCCESS:"type-success",WARNING:"type-warning",DANGER:"type-danger"};e.mixin(p,{LAYOUT_RIGHT_CENTER_BOTTOM:"LAYOUT_RIGHT_CENTER_BOTTOM",
LAYOUT_CENTER_BOTTOM:"LAYOUT_CENTER_BOTTOM",LAYOUT_CENTER_RIGHT:"LAYOUT_CENTER_RIGHT",LAYOUT_LEFT_CENTER_RIGHT:"LAYOUT_LEFT_CENTER_RIGHT",LAYOUT_LEFT_CENTER_RIGHT_BOTTOM:"LAYOUT_LEFT_CENTER_RIGHT_BOTTOM"});n.fromJson=function(b,a){var d=null,c=!1;a=!0;try{d=eval("("+b+")")}catch(g){c=!0}if(c){c=b.substring(b.indexOf("{"),b.lastIndexOf("}")+1);try{c&&(d=eval("("+c+")"))}catch(r){!1!==a&&console.error("error in json parsing! "+b);if(-1!==b.indexOf("error"))return{jsonrpc:"2.0",result:{error:{code:1,
message:b,data:null}},id:0};throw Error(b);}}return d};return p})},"xide/utils":function(){define(["dcl/dcl"],function(e){return e(null,{declaredClass:"xide.utils"})})},"xide/utils/ObjectUtils":function(){define(["xide/utils","require","dojo/Deferred","xide/lodash"],function(e,p,m,n){function f(a){var c=parseInt(a,10);return c.toString()===a?c:a}function b(a,c,d,h){n.isNumber(c)&&(c=[c]);if(n.isEmpty(c))return a;if(n.isString(c))return b(a,c.split(".").map(f),d,h);var l=c[0];if(1===c.length)return c=
a[l],void 0!==c&&h||(a[l]=d),c;void 0===a[l]&&(n.isNumber(c[1])?a[l]=[]:a[l]={});return b(a[l],c.slice(1),d,h)}function a(c,b){n.isNumber(b)&&(b=[b]);if(!n.isEmpty(c)){if(n.isEmpty(b))return c;if(n.isString(b))return a(c,b.split("."));var d=f(b[0]),h=c[d];if(1===b.length)void 0!==h&&(n.isArray(c)?c.splice(d,1):delete c[d]);else if(void 0!==c[d])return a(c[d],b.slice(1));return c}}"use strict";e.delegate=function(){function a(){}return function(c,b){a.prototype=c;var d=new a;a.prototype=null;b&&lang._mixin(d,
b);return d}}();e.debounce=function(a,c,b,d,l,k,t){var f=a[c+"_debounced"];f||(f=a[c+"_debounced"]=n.debounce(b,d,l));!0!==k||a[c+"_debouncedFirst"]||(a[c+"_debouncedFirst"]=!0,b.apply(a,t));return f()};e.pluck=function(a,c){return n.map(a,c)};e.download=function(a,c){var b=document.createElement("a");c=n.isString(c)?c:JSON.stringify(c,null,2);b.setAttribute("href","data:text/plain;charset\x3dutf-8,"+encodeURIComponent(c));b.setAttribute("download",a);b.style.display="none";document.body.appendChild(b);
b.click();document.body.removeChild(b)};e.hasObject=function(a){var c=null;try{c=p(a)}catch(b){console.error("error in utils.hasObject ",b)}return c};e.toUrl=function(a){p({cacheBust:null,waitSeconds:5});return p.toUrl(a)};e.getObject=function(a,c){var b=null;if(e.isString(a)){try{b=p(a)}catch(d){}try{if(!b){var l=new m,b=p([a],function(k){l.resolve(k)});return l.promise}}catch(k){}return b}return e.isObject(a)?a:null!==b?b:c};e.toArray=function(a){var c=[],b;for(b in a)c.push({name:b,value:a[b]});
return c};e.toObject=function(a,c){if(!a)return{};if(!1!==c)return c.object(c.map(a,c.values));if(e.isObject(a)&&a[0])return a[0];for(var b={},d=0;d<a.length;++d)b[d]=a[d];return b};e.byString=function(a,c,b){c=c.replace(/\[(\w+)\]/g,".$1");c=c.replace(/^\./,"");for(c=c.split(".");c.length;)if(b=c.shift(),b in a)a=a[b];else return;return a};var d=Object.prototype.hasOwnProperty,c={has:function(a,c){if(n.isEmpty(a))return!1;n.isNumber(c)?c=[c]:n.isString(c)&&(c=c.split("."));if(n.isEmpty(c)||0===c.length)return!1;
for(var b=0;b<c.length;b++){var h=c[b];if((n.isObject(a)||n.isArray(a))&&d.call(a,h))a=a[h];else return!1}return!0},ensureExists:function(a,c,d){return b(a,c,d,!0)},set:function(a,c,d,h){return b(a,c,d,h)},insert:function(a,b,d,h){var l=c.get(a,b);h=~~h;n.isArray(l)||(l=[],c.set(a,b,l));l.splice(h,0,d)},empty:function(a,b){if(n.isEmpty(b))return a;if(!n.isEmpty(a)){var q,h;if(!(q=c.get(a,b)))return a;if(n.isString(q))return c.set(a,b,"");if(n.isBoolean(q))return c.set(a,b,!1);if(n.isNumber(q))return c.set(a,
b,0);if(n.isArray(q))q.length=0;else if(n.isObject(q))for(h in q)d.call(q,h)&&delete q[h];else return c.set(a,b,null)}},push:function(a,b){var d=c.get(a,b);n.isArray(d)||(d=[],c.set(a,b,d));d.push.apply(d,Array.prototype.slice.call(arguments,2))},coalesce:function(a,b,d){for(var h,l=0,k=b.length;l<k;l++)if(void 0!==(h=c.get(a,b[l])))return h;return d},get:function(a,b,d){n.isNumber(b)&&(b=[b]);if(n.isEmpty(b))return a;if(n.isEmpty(a)&&a&&null===a.innerHTML)return d;if(n.isString(b))return c.get(a,
b.split("."),d);var h=f(b[0]);if(1===b.length){if(a&&void 0===a[h])return d;if(a)return a[h]}return a?c.get(a[h],b.slice(1),d):d},del:function(c,b){return a(c,b)}};e.getAt=function(a,b,d){return c.get(a,b,d)};e.setAt=function(a,b,d){return c.set(a,b,d)};e.hasAt=function(a,b){return c.has(a,b)};e.ensureAt=function(a,b,d){return c.ensureExists(a,b,d)};e.deleteAt=function(a,b){return c.del(a,b)};e.merge=function(a,c){for(var b in c)"object"!=typeof a[b]?a[b]=c[b]:"object"==typeof c[b]&&(a[b]=e.merge(a[b],
c[b]));return a};e.clone=function(a){if(!a||"object"!=typeof a||e.isFunction(a))return a;if(a.nodeType&&"cloneNode"in a)return a.cloneNode(!0);if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return new RegExp(a);var c,b,d;if(e.isArray(a))for(c=[],b=0,d=a.length;b<d;++b)b in a&&c.push(e.clone(a[b]));else c=a.constructor?new a.constructor:{};return e._mixin(c,a,e.clone)};e._mixin=function(a,c,b){var d,l,k={};for(d in c)l=c[d],d in a&&(a[d]===l||d in k&&k[d]===l)||(a[d]=b?b(l):
l);return a};e.mixin=function(a,c){if(c){a||(a={});for(var b=arguments.length,d=1;d<b;d++)e._mixin(a,arguments[d])}return a};e.cloneKeys=function(a,c){var b={},d;for(d in a)if(!0!==c||d in a)b[d]=a[d];return b};e.isArray=function(a){return n.isArray(a)};e.isObject=function(a){return n.isObject(a)};e.isString=function(a){return n.isString(a)};e.isNumber=function(a){return n.isNumber(a)};e.isFunction=function(a){return n.isFunction(a)};return e})},"xide/lodash":function(){define([],function(){if("undefined"!==
typeof _)return _;console.error("error loading lodash",global._)})},"xlog/Server":function(){define(["dcl/dcl","xide/types","xide/factory","dojo/node!winston"],function(e,p,m,n){return e(null,{declaredClass:"xlog.Server",fileLogger:null,loggly:null,delegate:null,publishLog:!0,loggers:{},constructor:function(f){for(var b in arguments)arguments.hasOwnProperty(b)&&(this[b]=f[b])},createLogger:function(f){var b=new n.Logger({transports:[new n.transports.File(f)]});if(this.publishLog)b.on("logging",function(a,
b,c,g){g.logId=f.filename;a={level:b,message:c,data:g,time:(new Date).getTime()};m.publish(p.EVENTS.ON_SERVER_LOG_MESSAGE,a)});return b},start:function(f){this.loggers={};this.options=f;if(f.fileLogger&&(this.fileLogger=n.add(n.transports.File,f.fileLogger),this.publishLog))this.fileLogger.on("logging",function(b,a,d,c){b={level:a,message:d,data:c,time:(new Date).getTime()};m.publish(p.EVENTS.ON_SERVER_LOG_MESSAGE,b)});f.loggly&&(this.loggly=n.add(n.transports.Loggly,f.loggly));null===f.console&&
n.remove(n.transports.Console)}})})},"xide/factory":function(){define(["dcl/dcl"],function(e){return new e(null,{declaredClass:"xide/factory"})})},"nxapp/types":function(){define(["dojo/_base/declare"],function(e){return e("nxapp.types",null,{})})},"nxapp/utils/FileUtils":function(){define("dojo/_base/json dojo/node!path dojo/node!fs dojo/node!util nxapp/utils xdojo/has!host-node?dojo/node!glob-fs xdojo/has!host-node?dojo/node!glob-base xdojo/has!host-node?dojo/node!glob".split(" "),function(e,p,
m,n,f,b,a,d){f.list=function(c){try{var d={},r=a(c);r.base&&(d.cwd=r.base,r.isGlob&&(c=r.glob));var q=(new b).readdirSync(c,d),h=[];_.each(q,function(a){h.push((d.cwd?d.cwd+p.sep:"")+a)})}catch(l){return null}return h};f.__toObject=function(a){try{var b=m.statSync(a,function(a){}),d=b.isDirectory();return{path:a,sizeBytes:b.size,size:d?"Folder":"",owner:b.uid,group:b.gid,mode:b.mode,isDir:d,directory:d,name:p.win32.basename(a),fileType:d?"folder":"file",modified:b.mtime.getTime()/1E3}}catch(q){return{path:a,
sizeBytes:0,size:0,owner:0,group:0,mode:0,directory:!1,mime:"unknown",name:p.win32.basename(a),fileType:"file",modified:0}}};f.ls=function(a){function b(k,d){return k?k=!q||d&&"/"!==d?a.join(d,k):""+k:""}var r={},q="win32"===process.platform;if("/*"===a&&q){var h=[];flop.read("/",function(a,k){_.each(k.files,function(a){h.push({path:"/"+a.name+":",sizeBytes:0,size:0,owner:0,group:0,mode:0,directory:!0,mime:"unknown",name:a.name,fileType:"folder",modified:0,drive:!0})})})}else{var l="";if(q)if(5===
a.length){var k=a.split(":/");2==k.length&&(l=k[0][1]+":/",r={root:l},a="/*")}else k=a.split(":/"),2==k.length&&(l=k[0][1]+":/",r={root:l},a=""+k[1]);r=d.sync(a,r);_.isArray(r)||(r=[r]);h=[];_.each(r,function(a){a=f.__toObject(a);q&&a&&a.path&&(a.path=p.resolve(b(a.path)));a.realPath=p.resolve(a.path);a&&h.push(a)});return h}};f.resolve=function(a){var b=p.resolve(a);try{if(m.statSync(b))return b}catch(d){return b}try{if(m.statSync(a))return a;var q=process.cwd()+p.sep+a;if(m.statSync(q))return q}catch(h){}return null};
f.isDirectory=function(a){return(a=f.resolve(a))&&(a=m.statSync(a))&&a.isDirectory()?!0:!1};f.getExtension=function(a){a=p.extname(a||"").split(".");return a[a.length-1]};f.readFile=function(a){var b=m.statSync(a).size,d=new Buffer(b);a=m.openSync(a,"r");if(!b)return"";m.readSync(a,d,0,b,0);m.closeSync(a);return d.toString()};f.writeFile=function(a,b){m.writeFile(a,b,function(a){a&&console.log(a)})};f.writeJSONFile=function(a,b){var d=JSON.stringify(b,null,4);m.writeFile(a,d,function(a){a&&console.log(a)})};
return f})},"nxapp/utils":function(){define(["dojo/_base/declare"],function(e){return e("nxapp.utils",null,{})})},"xdojo/has":function(){define(["dojo/has"],function(e){return e})},"nxapp/utils/TCPUtils":function(){define(["dojo/node!net","nxapp/utils","nxapp/server/WebSocket","nxapp/server/DeviceServer","nxapp/server/FileServer"],function(e,p,m,n,f){p.checkPort=function(b,a,d){var c=new e.Socket,g=null;c.on("connect",function(){g="open";c.end()});c.setTimeout(1500);c.on("timeout",function(){g="closed";
c.destroy()});c.on("error",function(a){g="closed"});c.on("close",function(c){d(null,g,a,b)});c.connect(b,a)};p.createSocketServer=function(b,a){var d=new m;d.init({options:{port:b.socket_server.port,context:a,host:b.socket_server.host}});d.ctx=a;d.start(null,b);return m};p.createDeviceServer=function(b,a){var d=new n;d.init({options:{port:b.socket_server.port,context:a,host:b.socket_server.host}});d.ctx=a;d.start(null,b);return d};p.createFileServer=function(b,a){var d=new f;d.init({options:{port:b.socket_server.port,
context:a,host:b.socket_server.host}});d.ctx=a;console.error("create file server "+b.socket_server.host);d.start(null,b);return m};p.connect=function(b,a){};return p})},"nxapp/server/WebSocket":function(){define("dcl/dcl dojo/_base/lang xide/types xide/factory nxapp/server/ServerBase nxapp/utils/_LogMixin nxapp/server/_CommandsParserMixin dojo/node!http dojo/node!sockjs dojo/node!colors xide/utils".split(" "),function(e,p,m,n,f,b,a,d,c,g,r){var q=!1;return e([f,b,a],{declaredClass:"nxapp.server.WebSocket",
_io_socket:null,clients:null,handleManagerCommand:function(a,b){switch(a.manager_command){case m.SOCKET_SERVER_COMMANDS.MANAGER_TEST:console.dir("Test Manager command");break;case m.SOCKET_SERVER_COMMANDS.WATCH:var k=this.ctx.getFileManager();k&&k.watch(a.path,a.watch);break;case m.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH:return this.sendMQTTMessage(a,b);case m.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER:return this.startDriver(a,b);case m.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES:return this.getVariables(a,
b);case m.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE:this.logClientMessage(a);break;case m.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER:this.stopDriver(a);break;case m.SOCKET_SERVER_COMMANDS.MANAGER_STATUS:a={message:"returning status",deviceConnections:this.options.context.getConnectionManager().getNumberOfConnections()};this.emit(m.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,JSON.stringify(a));break;case m.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL:this.options.context.getConnectionManager().closeAll()}},
handleDeviceCommand:function(a,b){var k=a.device_command,c=this.options.context,d=this;q=!1;this.showDebugMsg("socket_server")&&q&&console.log("Handle device command: "+k+" | "+m.SOCKET_SERVER_COMMANDS.CALL_METHOD);console.error("handle device command",a);var g=c.getConnectionManager().connect(a.host,a.protocol,a.port,null,null,b);b||q&&console.error("---have no client connect");try{c.getConnectionManager().registerFeedBack(g,function(b,k){d.profile.debug.debugDevices&&q&&console.log("Data received from "+
b.host);if(_.isString(k))a.lastResponse=""+k;else if(_.isObject(k))try{a.lastResponse=JSON.stringify(k)}catch(c){q&&console.error("error serializing data")}d.onDeviceMessage(b,k)})}catch(r){console.error("-register feed back function failed",r),console.trace()}try{switch(k){case m.SOCKET_SERVER_COMMANDS.CALL_METHOD:this.options.context.getConnectionManager().callMethod(g,a,b);break;case m.SOCKET_SERVER_COMMANDS.DEVICE_SEND:this.options.context.getConnectionManager().send(g,a.command,a.options)}}catch(f){console.error("error command parser "+
k,f)}},broadCastMessage:function(a,b){for(var k=this.clients.length;k--;)if(void 0!==this.clients[k]){var c={event:a,data:_.isString(b)?JSON.parse(b):b};3===this.clients[k].readyState?(this.clients[k].close(),this.clients.remove(this.clients[k])):(q&&console.log(g.green("writing broadcast message "+c.event+" have "+this.clients.length+" clients  readystate : "+this.clients[k].readyState)),c=JSON.stringify(c),this.clients[k].write(c))}},onFileChanged:function(a){this.broadCastMessage(m.EVENTS.ON_FILE_CHANGED,
{path:a.path,type:a.type})},start:function(a,b){this.profile=b;this.options=p.mixin(this.options,a);this.clients=[];var k=this,g=this.options.port,r=this.options.host;if(g){this.initLogger(b.debug);this.log("Socket server running in "+g,"socket_server");var f={};this.showDebugMsg("socket_server")||(f.log=function(){});var f=c.createServer(f),e=d.createServer(this._handler);f.installHandlers(e);e.listen(g,r);this._handleSocketEmits(f);n.publish(m.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:g,socket_handler:f}},
this);f.on("connection",function(a){var b=k.clients.push(a);a.on("close",function(){q&&console.error("close connection :  "+b);delete k.clients[b]})});return!0}console.error("Port must be provided into options");return!1},emit:function(a,b){console.log("emit + "+this.id+"#"+a,b);this.showDebugMsg("socket_server")&&!_.isString(b)&&_.isObject(b)&&(b=JSON.stringify(b));this.socket?this.socket.write(b):q&&console.error("-------- WebSocket::emit failed. Have no socket! "+a+" id "+this.id)},_handleSocketEmits:function(a){var b=
this.options.port,k=this;a.on("connection",function(a){k.socket=a;q&&console.log("client connected");n.publish(m.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:b,socket_handler:a}},this);a.on("data",function(b){p.isString(b)&&(b=dojo.fromJson(b));b.manager_command?k.handleManagerCommand(b,a):k.handleDeviceCommand(b,a)});a.on("close",function(){console.error("closed!")})})},constructor:function(){this.id=r.createUUID()}})})},"nxapp/server/ServerBase":function(){define(["dcl/dcl","xide/model/Base",
"xide/utils","xide/mixins/EventedMixin"],function(e,p,m,n){return e([p.dcl,n.dcl],{options:null,delegate:null,ctx:null,declaredClass:"nxapp.server.ServerBase",_defaultOptions:function(){return{delegate:this}},init:function(f){this.options=m.mixin(this._defaultOptions(),f.options)}})})},"xide/model/Base":function(){define(["dcl/dcl","dojo/_base/declare","xide/utils"],function(e,p,m){var n={declaredClass:"xide/model/Base",constructor:function(f){m.mixin(this,f)},getLabel:function(){return null},getID:function(){return null}};
p=p("xide/model/Base",null,n);p.dcl=e(null,n);return p})},"xide/mixins/EventedMixin":function(){define("dojo/_base/array dcl/dcl xdojo/declare xdojo/has xide/types xide/factory".split(" "),function(e,p,m,n,f,b){n={_didRegisterSubscribers:!1,subscribers:null,subscribes:{},emits:{},__events:null,addPublishFilter:function(a,b){a&&(null!=b?this.emits[a]=b:a in this.emits&&delete this.emits[a])},filterSubscribe:function(a){return this.subscribes?!1!==this.subscribes[a]:!0},filterPublish:function(a){return this.emits?
!1!==this.emits[a]:!0},subscribe:function(a,d,c){this.__events||(this.__events={});a=b.subscribe(a,d,c||this,this.filterSubscribe.bind(this));d=this.__events;c=0;for(var g=a.length;c<g;c++){var r=a[c].type;d[r]||(d[r]=[]);d[r].push(a[c])}return a},publish:function(a,d,c,g){var r=this;0<g?setTimeout(function(){b.publish(a,d,c||r,r.filterPublish.bind(r))}.bind(r),g):b.publish(a,d,c||r,r.filterPublish.bind(r))},_destroyHandle:function(a){},_destroyHandles:function(){if(this.__events){for(var a in this.__events)e.forEach(this.__events[a],
function(a){a&&a.remove&&a.remove()});delete this.__events}},destroy:function(){this._emit("destroy");this.inherited&&this.inherited(arguments);this._destroyHandles()},once:function(a,b){function c(){g.unsubscribe(a,b);return b.apply(g,arguments)}var g=this;c.listener=b;g._on(a,c);return this},_emit:function(a){if(this.__events){if(!this._didRegisterSubscribers&&this.subscribers){for(var b=0;b<this.subscribers.length;b++){var c=this.subscribers[b];this._on(c.event,c.handler,c.owner)}this._didRegisterSubscribers=
!0}if(!0===arguments[2])throw Error("Please use emit.sticky() instead of passing sticky\x3dtrue for event: "+a);b=this.__events[a];c=1<arguments.length?arguments[2]:null;if(b){var g;if("function"==typeof b)switch(arguments.length){case 1:return b.call(this);case 2:return b.call(this,arguments[1]);case 3:return b.call(this,arguments[1],arguments[2]);default:var r=Array.prototype.slice.call(arguments,1);g=b.apply(this,r)}else if(_.isArray(b))for(var r=Array.prototype.slice.call(arguments,1),q=b.slice(),
h,l=null,k=null,b=0,t=q.length;b<t;b++)l=q[b],k=l.owner||this,r&&r[0]&&(r[0].owner=r[0]?r[0].owner||k:null),l.handler&&(h=l.handler.apply(k,r)),void 0!==h&&(g=h),r&&r[0]&&r[0].owner&&(r[0].owner=null);c&&!0===c["public"]&&this.publish(a,r);return g}}},unsubscribe:function(a,b){if(!this.__events||!this.__events[a])return this;if("function"!==typeof b||!b)return e.forEach(this.__events[a],dojo.unsubscribe),delete this.__events[a],this.__events[a]=[],this;var c=this.__events[a];if(_.isArray(c)){var g=
[];_.each(c,function(a,c,h){(a.handler==b?a.handler:a.handler.listener==b&&a.handler.listener)&&g.push(a)});_.each(g,function(a){a.remove()});0===c.length&&delete this.__events[a]}else(this.__events[a].listener||this.__events[a])===b&&delete this.__events[a];return this},listeners:function(a){this.__events||(this.__events={});this.__events[a]||(this.__events[a]=[]);isArray(this.__events[a])||(this.__events[a]=[this.__events[a]]);return this.__events[a]},addHandle:function(a,b){this.__events||(this.__events=
{});this.__events[a]||(this.__events[a]=[]);b.type=a;this.__events[a].push(b);return b},__on:function(a,b,c,g){var r=g;"function"!=typeof c||g||(g=c,c=null);a=a.jquery?a:$(a);a.on(b,c,g);this.__events||(this.__events={});this.__events[b]||(this.__events[b]=[]);var q=this.__events[b];a={handler:r,owner:this,type:b,element:a,selector:c,remove:function(){q.remove(this);this.element.off(this.type,this.selector,this.handler)}};q.push(a);return a},_on:function(a,b,c){try{this.__events||(this.__events={});
this.__events[a]||(this.__events[a]=[]);var g=this.__events[a];if(!g)this.__events[a]=b;else if(_.isArray(g)){if(-1!=g.indexOf(b))return console.warn("adding same listener twice",a);b={handler:b,owner:c||this,type:a,remove:function(){g.remove(this);c&&c.__events&&c.__events[a]&&c.__events[a].remove(this);this.handler=this.owner=null;delete this.type}};g.push(b);return b}}catch(r){logError(r)}return this}};m=m(null,n);m.Impl=n;m.dcl=p(null,n);p.chainAfter(m.dcl,"destroy");return m})},"xdojo/declare":function(){define(["dojo/_base/declare"],
function(e){return e})},"nxapp/utils/_LogMixin":function(){define(["dcl/dcl"],function(e){return e(null,{declaredClass:"nxapp.utils._LogMixin",debug_conf:null,logger:null,initLogger:function(e){this.debug_conf=e},log:function(e,m,n,f){m||(m=this._debugContext().main);m&&!this.showDebugMsg(m)||!this.logger||(n=n||"info",f.time=(new Date).getTime(),this.logger.log(n,e,f))},logEx:function(e,m,n,f){this.logger?(m=m||"info",f=f||{},f.type=n||"Unknown",f.time=f.time||(new Date).getTime(),this.logger.log(m,
e,f)):console.error("have no logger!")},showDebugMsg:function(e){if(null!=this.debug_conf)return this.debug_conf.all?!0:this.debug_conf[e]?!0:!1;this.debug_conf={all:!0};return!0}})})},"nxapp/server/_CommandsParserMixin":function(){define(["dcl/dcl","nxapp/types/Types","nxapp/utils/_console"],function(e,p,m){var n=!1;return e(null,{declaredClass:"nxapp.server._CommandsParserMixin",handleManagerCommand:function(f,b){switch(f.manager_command){case p.SOCKET_SERVER_COMMANDS.MANAGER_TEST:console.dir("Test Manager command");
break;case p.SOCKET_SERVER_COMMANDS.WATCH:var a=this.ctx.getFileManager();a&&a.watch(f.path,f.watch);break;case p.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH:return this.sendMQTTMessage(f,b);case p.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER:return this.startDriver(f,b);case p.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES:return this.getVariables(f,b);case p.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE:this.logClientMessage(f);break;case p.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER:this.stopDriver(f);break;case p.SOCKET_SERVER_COMMANDS.MANAGER_STATUS:f=
{message:"returning status",deviceConnections:this.options.context.getConnectionManager().getNumberOfConnections()};this.emit(p.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,JSON.stringify(f));break;case p.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL:this.options.context.getConnectionManager().closeAll()}},handleDeviceCommand:function(f,b){var a=f.device_command,d=this.options.context,c=this;n=!1;this.showDebugMsg("socket_server")&&n&&console.log("Handle device command: "+a+" | "+p.SOCKET_SERVER_COMMANDS.CALL_METHOD);
console.error("handle device command",f);var g=d.getConnectionManager().connect(f.host,f.protocol,f.port,null,null,b);b||n&&console.error("---have no client connect");try{d.getConnectionManager().registerFeedBack(g,function(a,b){c.profile.debug.debugDevices&&n&&console.log("Data received from "+a.host);if(_.isString(b))f.lastResponse=""+b;else if(_.isObject(b))try{f.lastResponse=JSON.stringify(b)}catch(k){n&&console.error("error serializing data")}c.onDeviceMessage(a,b)})}catch(r){console.error("-register feed back function failed",
r),console.trace()}try{switch(a){case p.SOCKET_SERVER_COMMANDS.CALL_METHOD:this.options.context.getConnectionManager().callMethod(g,f,b);break;case p.SOCKET_SERVER_COMMANDS.DEVICE_SEND:this.options.context.getConnectionManager().send(g,f.command,f.options)}}catch(q){console.error("error command parser "+a,q)}}})})},"nxapp/types/Types":function(){define(["dojo/_base/lang","xide/types/Types","xcf/types/Types"],function(e,p){e.mixin(p.EVENTS,{ON_FILE_CHANGED:"fileChanged",ON_CONNECTION_CREATED:"connectionCreated",
ON_CONNECTION_ERROR:"connectionError",ON_WEBSOCKET_START:"webSocketStart",ON_WEBSOCKET_CONNECTION:"webSocketConnection",ON_MQTT_MESSAGE:"onMQTTMessage",ON_DEVICE_MESSAGE:"onDeviceMessage",ON_COMMAND_FINISH:"onCommandFinish",ON_COMMAND_ERROR:"onCommandError",ON_DEVICE_DISCONNECTED:"onDeviceDisconnected",ON_DEVICE_CONNECTED:"onDeviceConnected",STORE_CHANGED:"storeChange",BEFORE_STORE_CHANGE:"beforeStoreChange",STORE_REFRESHED:"storeRefreshed",ON_DID_OPEN_ITEM:"onDidOpenItem",ON_SHOW_PANEL:"onShowPanel",
ITEM_SELECTED:"itemSelected",ERROR:"fileOperationError",STATUS:"fileOperationStatus",IMAGE_LOADED:"imageLoaded",IMAGE_ERROR:"imageError",RESIZE:"resize",UPLOAD_BEGIN:"uploadBegin",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_FINISH:"uploadFinish",ON_CLIPBOARD_COPY:"onClipboardCopy",ON_CLIPBOARD_PASTE:"onClipboardPaste",ON_CLIPBOARD_CUT:"onClipboardCut",ON_CONTEXT_MENU_OPEN:"onContextMenuOpen",ON_PLUGIN_LOADED:"onPluginLoaded",ON_PLUGIN_READY:"onPluginReady",ON_MAIN_VIEW_READY:"onMainViewReady2",REGISTER_EDITOR:"registerEditor",
REGISTER_ACTION:"registerAction",ON_FILE_CONTENT_CHANGED:"onFileContentChanged",ON_PANEL_CLOSED:"onPanelClosed",ON_PANEL_CREATED:"onPanelCreated",SET_DEVICE_VARIABLES:"setDeviceVariables"});p.LOG_CONTEXT={DEVICE:"Device"};p.test=2;return p})},"xcf/types/Types":function(){define("xaction/types xide/types/Types xide/types xide/utils/ObjectUtils xide/utils xide/utils/HexUtils".split(" "),function(e,p,m,n,f,b){String.prototype.setBytes||(String.prototype.setBytes=function(a){this.bytes=a});String.prototype.getBytes||
(String.prototype.getBytes=function(){return this.bytes?this.bytes:b.stringToBuffer(this)});String.prototype.getString||(String.prototype.getString=function(){return this.string});String.prototype.setString||(String.prototype.setString=function(a){this.string=a});String.prototype.hexString||(String.prototype.hexString=function(){var a=this.getBytes();return b.bufferToHexString(a)});m.VARIABLE_FLAGS={PUBLISH:2,PUBLISH_IF_SERVER:4};m.LOGGING_FLAGS={NONE:0,GLOBAL_CONSOLE:1,STATUS_BAR:2,POPUP:4,FILE:8,
DEV_CONSOLE:16,DEVICE_CONSOLE:32};f.mixin(m.ITEM_TYPE,{DEVICE:"Device",DEVICE_GROUP:"Device Group",DRIVER:"Driver",DRIVER_GROUP:"Driver Group",PROTOCOL:"Protocol",PROTOCOL_GROUP:"Protocol Group"});m.SERVICE_STATUS={OFFLINE:"offline",ONLINE:"online",TIMEOUT:"timeout"};m.PROTOCOL={TCP:"tcp",UDP:"udp",SERIAL:"serial",DRIVER:"driver",SSH:"ssh",MQTT:"mqtt"};f.mixin(m.EVENTS,{ON_DEBUGGER_READY:"onDebuggerReady",ON_DEVICE_SELECTED:"onDeviceSelected",ON_DEVICE_GROUP_SELECTED:"onDeviceGroupSelected",ON_PROTOCOL_SELECTED:"onProtocolSelected",
ON_PROTOCOL_GROUP_SELECTED:"onProtocolGroupSelected",ON_PROTOCOL_CHANGED:"onProtocolChanged",ON_MQTT_MESSAGE:"onMQTTMessage",ON_DEVICE_MESSAGE:"onDeviceMessage",ON_DEVICE_MESSAGE_EXT:"onDeviceMessageExt",ON_COMMAND_FINISH:"onCommandFinish",ON_COMMAND_PROGRESS:"onCommandProgress",ON_COMMAND_PAUSED:"onCommandPaused",ON_COMMAND_STOPPED:"onCommandStopped",ON_COMMAND_ERROR:"onCommandError",ON_DEVICE_DISCONNECTED:"onDeviceDisconnected",ON_DEVICE_CONNECTED:"onDeviceConnected",ON_DEVICE_COMMAND:"onDeviceCommand",
ON_DEVICE_STATE_CHANGED:"onDeviceStateChanged",ON_DEVICE_DRIVER_INSTANCE_READY:"onDeviceDriveInstanceReady",ON_DRIVER_SELECTED:"onDriverSelected",ON_DRIVER_GROUP_SELECTED:"onDriverGroupSelected",ON_DRIVER_VARIABLE_ADDED:"onDriverVariableAdded",ON_DRIVER_VARIABLE_REMOVED:"onDriverVariableRemoved",ON_DRIVER_VARIABLE_CHANGED:"onDriverVariableChanged",ON_DRIVER_COMMAND_ADDED:"onDriverCommandAdded",ON_DRIVER_COMMAND_REMOVED:"onDriverCommandRemoved",ON_DRIVER_COMMAND_CHANGE:"onDriverVariableChanged",ON_SCOPE_CREATED:"onScopeCreated",
ON_DRIVER_MODIFIED:"onDriverModified",SET_DEVICE_VARIABLES:"setDeviceVariables",ON_SERVER_LOG_MESSAGE:"onServerLogMessage",ON_CLIENT_LOG_MESSAGE:"onClientLogMessage",ON_DEVICE_SERVER_CONNECTED:"onDeviceServerConnected",ON_RUN_CLASS_EVENT:"onRunClassEvent"});m.MESSAGE_SOURCE={DEVICE:"DEVICE",GUI:"GUI",BLOX:"BLOX",CODE:"CODE"};m.DEVICE_STATE={CONNECTING:"DeviceIsConnecting",CONNECTED:"DeviceIsConnected",SYNCHRONIZING:"DeviceIsSynchronizing",READY:"DeviceIsReady",DISCONNECTED:"DeviceIsDisconnected",
DISABLED:"DeviceIsDisabled",LOST_DEVICE_SERVER:"LostDeviceServerConnection"};m.DRIVER_PROPERTY={CF_DRIVER_NAME:"CF_DRIVER_NAME",CF_DRIVER_ICON:"CF_DRIVER_ICON",CF_DRIVER_CLASS:"CF_DRIVER_CLASS",CF_DRIVER_ID:"CF_DRIVER_ID",CF_DRIVER_COMMANDS:"CF_DRIVER_COMMANDS",CF_DRIVER_VARIABLES:"CF_DRIVER_VARIABLES",CF_DRIVER_RESPONSES:"CF_DRIVER_RESPONSES"};m.PROTOCOL_PROPERTY={CF_PROTOCOL_TITLE:"Title",CF_PROTOCOL_ICON:"CF_PROTOCOL_ICON",CF_PROTOCOL_CLASS:"CF_PROTOCOL_CLASS",CF_PROTOCOL_ID:"CF_PROTOCOL_ID",CF_PROTOCOL_COMMANDS:"CF_PROTOCOL_COMMANDS",
CF_PROTOCOL_VARIABLES:"CF_PROTOCOL_VARIABLES",CF_PROTOCOL_RESPONSES:"CF_PROTOCOL_RESPONSES"};m.DEVICE_PROPERTY={CF_DEVICE_DRIVER:"Driver",CF_DEVICE_HOST:"Host",CF_DEVICE_PORT:"Port",CF_DEVICE_PROTOCOL:"Protocol",CF_DEVICE_TITLE:"Title",CF_DEVICE_ID:"Id",CF_DEVICE_ENABLED:"Enabled",CF_DEVICE_OPTIONS:"Options",CF_DEVICE_DRIVER_OPTIONS:"DriverOptions",CF_DEVICE_LOGGING_FLAGS:"Logging Flags"};m.LOG_OUTPUT={DEVICE_CONNECTED:"Device Connected",DEVICE_DISCONNECTED:"Device Disonnected",RESPONSE:"Response",
SEND_COMMAND:"Send Command",DEVICE_ERROR:"Device Error"};m.DEFAULT_DEVICE_LOGGING_FLAGS={};e=m.LOGGING_FLAGS;m.DEFAULT_DEVICE_LOGGING_FLAGS[m.LOG_OUTPUT.DEVICE_CONNECTED]=e.GLOBAL_CONSOLE|e.POPUP|e.STATUS_BAR|e.DEVICE_CONSOLE;m.DEFAULT_DEVICE_LOGGING_FLAGS[m.LOG_OUTPUT.DEVICE_DISCONNECTED]=e.GLOBAL_CONSOLE|e.POPUP|e.STATUS_BAR|e.DEVICE_CONSOLE;m.DEFAULT_DEVICE_LOGGING_FLAGS[m.LOG_OUTPUT.RESPONSE]=e.DEVICE_CONSOLE|e.GLOBAL_CONSOLE;m.DEFAULT_DEVICE_LOGGING_FLAGS[m.LOG_OUTPUT.SEND_COMMAND]=e.DEVICE_CONSOLE|
e.GLOBAL_CONSOLE;m.DEFAULT_DEVICE_LOGGING_FLAGS[m.LOG_OUTPUT.DEVICE_ERROR]=e.GLOBAL_CONSOLE|e.POPUP|e.STATUS_BAR|e.DEV_CONSOLE|e.DEVICE_CONSOLE;m.DRIVER_FLAGS={RUNS_ON_SERVER:2,DEBUG:4,SERVER:16};f.mixin(m.ITEM_TYPE,{CF_DRIVER_VARIABLE:"DriverVariable",CF_DRIVER_BASIC_COMMAND:"DriverBasicCommand",CF_DRIVER_CONDITIONAL_COMMAND:"DriverConditionalCommand",CF_DRIVER_RESPONSE_VARIABLE:"DriverResponseVariable"});m.BLOCK_GROUPS={CF_DRIVER_VARIABLE:"DriverVariable",CF_DRIVER_BASIC_COMMAND:"DriverBasicCommand",
CF_DRIVER_CONDITIONAL_COMMAND:"DriverConditionalCommand",CF_DRIVER_RESPONSE_VARIABLE:"DriverResponseVariable",CF_DRIVER_RESPONSE_BLOCKS:"conditionalProcess",CF_DRIVER_RESPONSE_VARIABLES:"processVariables",CF_DRIVER_BASIC_VARIABLES:"basicVariables"};m.COMMAND_TYPES={BASIC_COMMAND:"basic",CONDITIONAL_COMMAND:"conditional",INIT_COMMAND:"init"};f.mixin(m.ECIType,{DEVICE_NETWORK_SETTINGS:m.ECIType.END+1,DRIVER_COMMAND_SETTINGS:"CommandSettings"});m.VFS_ROOTS={SYSTEM_DRIVERS:"system_drivers",USER_DRIVERS:"user_drivers"};
m.SOCKET_SERVER_COMMANDS={SIGNAL_MANAGER:"Manager_command",RUN_FILE:"Run_File",RUN_CLASS:"Run_Class",RUN_APP_SERVER_CLASS:"Run_App_Server_Class",RUN_APP_SERVER_CLASS_METHOD:"Run_App_Server_Class_Method",RUN_APP_SERVER_COMPONENT_METHOD:"Run_App_Server_Component_Method",CANCEL_APP_SERVER_COMPONENT_METHOD:"Cancel_App_Server_Component_Method",ANSWER_APP_SERVER_COMPONENT_METHOD_INTERRUPT:"Answer_App_Server_Component_Method_Interrupt",SIGNAL_DEVICE:"Device_command",SIGNAL_RESPONSE:"WebSocket_response",
MANAGER_TEST:"Manager_Test",MANAGER_CLOSE_ALL:"Close_All_Connections",MANAGER_STATUS:"status",MANAGER_START_DRIVER:"startDriver",START_DEVICE:"startDevice",STOP_DEVICE:"stopDevice",CREATE_CONNECTION:"createConnection",MANAGER_STOP_DRIVER:"stopDriver",DEVICE_SEND:"Device_Send",CALL_METHOD:"Call_Method",RUN_SHELL:"Run_Shell",WATCH:"Watch_Directory",MQTT_PUBLISH:"MQTT_PUBLISH",MQTT_SUBSCRIBE:"MQTT_SUBSCRIBE",GET_DEVICE_VARIABLES:"getVariables",WRITE_LOG_MESSAGE:"Write_Log_Message",INIT_DEVICES:"INIT_DEVICES",
PROTOCOL_METHOD:"PROTOCOL_METHOD"};return m})},"xaction/types":function(){define(["xide/types","dojo/_base/lang"],function(e,p){p.mixin(e.EVENTS,{ON_ACTION_CHANGE_CONTEXT:"onChangeActionContext",ON_ACTION_CONTEXT_CHANGED:"onActionContextChanged",REGISTER_ACTION:"registerAction",SET_ITEM_ACTIONS:"onSetItemsActions",ON_CLIPBOARD_COPY:"onClipboardCopy",ON_CLIPBOARD_PASTE:"onClipboardPaste",ON_CLIPBOARD_CUT:"onClipboardCut",ON_RENDER_ACTIONS:"onRenderActions",ON_DID_ACTION:"onDidAction",ON_AFTER_ACTION:"onAfterAction"});
e.ACTION={LAYOUT:"View/Layout",COLUMNS:"View/Columns",SELECTION:"File/Select",CLIPBOARD:"Edit/Clipboard",UNDO:"Edit/Undo",REDO:"Edit/Redo",CLIPBOARD_COPY:"Edit/Clipboard/Copy",CLIPBOARD_PASTE:"Edit/Clipboard/Paste",CLIPBOARD_CUT:"Edit/Clipboard/Cut",COPY:"File/Copy",MOVE:"File/Move",RENAME:"File/Rename",DELETE:"File/Delete",OPEN:"File/Open",EDIT:"File/Edit",SAVE:"File/Save",SEARCH:"File/Search",TOOLBAR:"View/Show/Toolbar",STATUSBAR:"View/Show/Statusbar",BREADCRUMB:"View/Show/Breadcrumb",HEADER:"View/Show/Header",
DOWNLOAD:"File/Download",DOWNLOAD_TO:"File/downloadTo",INFO:"File/Info",COMPRESS:"File/Compress",RELOAD:"File/Reload",UPLOAD:"File/Upload",PREVIEW:"File/Preview",OPEN_IN:"File/Open In",INSERT_IMAGE:"insertImage",COPY_PASTE:"copypaste",DND:"dnd",OPTIONS:"options",NEW_FILE:"File/New/New File",NEW_DIRECTORY:"File/New/New Folder",GET_CONTENT:"get",SET_CONTENT:"set",FIND:"File/Find",CUSTOM:"custom",PERMA_LINK:"permaLink",ADD_MOUNT:"ADD_MOUNT",REMOVE_MOUNT:"REMOVE_MOUNT",EDIT_MOUNT:"EDIT_MOUNT",PERSPECTIVE:"PERSPECTIVE",
RUN:"File/Run",GO_UP:"Navigation/Go Up",STOP:"File/Stop",CLOSE:"View/Close",FULLSCREEN:"View/Fullscreen",OPEN_IN_TAB:"File/OpenInNewTab",SOURCE:"Navigation/Source",RIBBON:"View/Show/Ribbon",MAIN_MENU:"View/Show/MainMenu",NAVIGATION:"View/Show/Navigation",BASH_CONSOLE:"File/Console/Bash",JS_CONSOLE:"File/Console/JS",PHP_CONSOLE:"File/Console/PHP",CONSOLE:"File/Console/PHP",SIZE_STATS:"View/Show/SizeStats",WELCOME:"Window/Welcome",CONTEXT_MENU:"File/ContextMenu"};e.ACTION_TYPE={MULTI_TOGGLE:"multiToggle",
SINGLE_TOGGLE:"singleToggle"};e.ACTION_ICON={CLIPBOARD_COPY:"fa-copy",CLIPBOARD_PASTE:"fa-paste",UPLOAD:"fa-upload",RENAME:"el-icon-edit",DELETE:"text-danger fa-remove",RELOAD:"fa-refresh",EDIT:"fa-pencil",SAVE:"fa-floppy-o",SEARCH:"fa-search",NEW_DIRECTORY:"fa-magic",NEW_FILE:"fa-magic",RUN:"text-success el-icon-play",COMPRESS:"fa-file-archive-o",EXTRACT:"fa-folder-open",DOWNLOAD:"fa-download",GO_UP:"fa-level-up",TOOLBAR:"fa-bars",STATUSBAR:"fa-terminal",PREVIEW:"fa-eye",MAXIMIZE:"fa-arrows-alt",
UNDO:"fa-undo",REDO:"fa-repeat"};return e})},"xide/utils/HexUtils":function(){define(["xide/utils","xide/types","dojo/json","xide/lodash"],function(e,p,m,n){function f(b){var k="";b=parseInt(b,16);65535>=b?k+=String.fromCharCode(b):1114111>=b?(b-=65536,k+=String.fromCharCode(55296|b>>10)+String.fromCharCode(56320|b&1023)):k+="hex2Char error: Code point out of range: "+a(b);return k}function b(b){var k="";65535>=b?k+=String.fromCharCode(b):1114111>=b?(b-=65536,k+=String.fromCharCode(55296|b>>10)+String.fromCharCode(56320|
b&1023)):k+="dec2char error: Code point out of range: "+a(b);return k}function a(a){return(a+0).toString(16).toUpperCase()}function d(a){return x[a>>4&15]+x[a&15]}function c(a){return a=a.replace(/0x([A-Fa-f0-9]{1,4})(\s)?/g,function(a,b){f(b);return f(b)})}function g(a){a=a.replace(/[Uu]\+10([A-Fa-f0-9]{4})/g,function(a,b){return f("10"+b)});return a=a.replace(/[Uu]\+([A-Fa-f0-9]{1,5})/g,function(a,b){return f(b)})}function r(a){return a=a.replace(/&#x([A-Fa-f0-9]{1,6});/g,function(a,b){return f(b)})}
function q(a){return a=a.replace(/&#([0-9]{1,7});/g,function(a,k){return b(k)})}function h(a){return a=a.replace(/0x([A-Fa-f0-9]{1,6})/g,function(a,b){return f(b)})}function l(a,b){b?(a=a.replace(/\\([A-Fa-f0-9]{1,6})(\s)?/g,function(a,b){return f(b)}),a=a.replace(/\\/g,"")):a=a.replace(/\\([A-Fa-f0-9]{2,6})(\s)?/g,function(a,b){return f(b)});return a}function k(a,b){a=a.replace(/\\u\{([A-Fa-f0-9]{1,})\}/g,function(a,b){return f(b)});a=a.replace(/\\U([A-Fa-f0-9]{8})/g,function(a,b){return f(b)});
a=a.replace(/\\u([A-Fa-f0-9]{4})/g,function(a,b){return f(b)});b&&(a=a.replace(/\\b/g,"\b"),a=a.replace(/\\t/g,"\t"),a=a.replace(/\\n/g,"\n"),a=a.replace(/\\v/g,"\v"),a=a.replace(/\\f/g,"\f"),a=a.replace(/\\r/g,"\r"),a=a.replace(/\\\'/g,"'"),a=a.replace(/\\\"/g,'"'),a=a.replace(/\\\\/g,"\\"));return a}function t(k){return k=k.replace(/((%[A-Fa-f0-9]{2})+)/g,function(k,c){for(var d="",h=0,g=0,l=c.split("%"),q=1;q<l.length;q++){var r=parseInt(l[q],16);switch(h){case 0:0<=r&&127>=r?d+=b(r):192<=r&&223>=
r?(h=1,g=r&31):224<=r&&239>=r?(h=2,g=r&15):240<=r&&247>=r?(h=3,g=r&7):d+="convertpEsc2Char: error "+a(r)+"! ";break;case 1:if(128>r||191<r)d+="convertpEsc2Char: error "+a(r)+"! ";h--;d+=b(g<<6|r-128);g=0;break;case 2:case 3:if(128>r||191<r)d+="convertpEsc2Char: error "+a(r)+"! ";g=g<<6|r-128;h--}}return d})}function w(a){var b={};return a=a.replace(/&([A-Za-z0-9]+);/g,function(a,k){return k in b?b[k]:a})}function u(a,k){"hex"==k?a=a.replace(/(\b[A-Fa-f0-9]{2,6}\b)/g,function(a,b){return f(b)}):"dec"==
k?a=a.replace(/(\b[0-9]+\b)/g,function(a,k){return b(k)}):"utf8"==k?a=a.replace(/(( [A-Fa-f0-9]{2})+)/g,function(a,b){return z(b)}):"utf16"==k&&(a=a.replace(/(( [A-Fa-f0-9]{1,6})+)/g,function(a,b){return v(b)}));return a}function z(k){var c="",d=0,h=0;k=k.replace(/^\s+/,"");k=k.replace(/\s+$/,"");if(0==k.length)return"";k=k.replace(/\s+/g," ");k=k.split(" ");for(var g=0;g<k.length;g++){var l=parseInt(k[g],16);switch(d){case 0:0<=l&&127>=l?c+=b(l):192<=l&&223>=l?(d=1,h=l&31):224<=l&&239>=l?(d=2,h=
l&15):240<=l&&247>=l?(d=3,h=l&7):c+="convertUTF82Char: error1 "+a(l)+"! ";break;case 1:if(128>l||191<l)c+="convertUTF82Char: error2 "+a(l)+"! ";d--;c+=b(h<<6|l-128);h=0;break;case 2:case 3:if(128>l||191<l)c+="convertUTF82Char: error3 "+a(l)+"! ";h=h<<6|l-128;d--}}return c.replace(/ $/,"")}function v(k){var c=0,d="";k=k.replace(/^\s+/,"");k=k.replace(/\s+$/,"");if(0==k.length)return null;k=k.replace(/\s+/g," ");k=k.split(" ");for(var h=0;h<k.length;h++){var l=parseInt(k[h],16);if(0>l||65535<l)d+="!Error in convertUTF162Char: unexpected value, b\x3d"+
a(l)+"!";if(0!=c)if(56320<=l&&57343>=l){d+=b(65536+(c-55296<<10)+(l-56320));c=0;continue}else d+="Error in convertUTF162Char: low surrogate expected, b\x3d"+a(l)+"!",c=0;55296<=l&&56319>=l?c=l:d+=b(l)}return d}var x="0123456789ABCDEF".split("");e.dec2hex4=function(a){return x[a>>12&15]+x[a>>8&15]+x[a>>4&15]+x[a&15]};e.dec2hex=a;e.dec2char=b;e.dec2hex2=d;e.convertUTF82Char=z;e.convertUTF162Char=v;e.convertUnicode2Char=g;e.convertCharStr2pEsc=function(b){var k="",c;c=0;for(var h="",l=0;l<b.length;l++){var g=
b.charCodeAt(l);if(0>g||65535<g)h+="Error in convertChar2CP: byte out of range "+a(g)+"!";if(0!=c)if(56320<=g&&57343>=g){h+=a(65536+(c-55296<<10)+(g-56320))+" ";c=0;continue}else h+="Error in convertChar2CP: surrogate out of range "+a(c)+"!",c=0;55296<=g&&56319>=g?c=g:h+=a(g)+" "}c=h.substring(0,h.length-1);if(0==b.length)return"";b=c.split(" ");for(c=0;c<b.length;c++)h=parseInt(b[c],16),k=32==h?k+"%20":65<=h&&90>=h?k+String.fromCharCode(h):97<=h&&122>=h?k+String.fromCharCode(h):48<=h&&57>=h?k+String.fromCharCode(h):
45==h||46==h||95==h||126==h?k+String.fromCharCode(h):127>=h?k+("%"+d(h)):2047>=h?k+("%"+d(192|h>>6&31)+"%"+d(128|h&63)):65535>=h?k+("%"+d(224|h>>12&15)+"%"+d(128|h>>6&63)+"%"+d(128|h&63)):1114111>=h?k+("%"+d(240|h>>18&7)+"%"+d(128|h>>12&63)+"%"+d(128|h>>6&63)+"%"+d(128|h&63)):k+("!Error "+a(h)+"!");return k};e.convertAllEscapes=function(a,b){a=g(a);a=c(a);a=h(a);a=r(a);a=q(a);a=k(a,!1);a=l(a,!1);a=t(a);a=w(a);return a=u(a,b)};var D="0123456789abcdef".split("");e.to_hex=function(a){for(var b="",k=
!0,c=32;0<c;){var c=c-4,d=a>>c&15;k&&0==d||(k=!1,b+=D[d])}return"0x"+(""==b?"0":b)};e.replaceHex=function(a){return n.isString(a)?a.replace(/x([0-9A-Fa-f]{2})/gmi,function(a,b){return String.fromCharCode(parseInt(b,16))}):a};var A=function(a,b){for(a=a.toString(16).toUpperCase();a.length<b;)a="0"+a;return a};e.stringToHex=function(a){for(var b="",k=0,c=a.length,d;k<c;k+=1)d=a.charCodeAt(k),b+=A(d.toString(16),2)+" ";return b};e.stringToBufferStr=function(a){for(var b=0,k=a.length,c,d=[];b<k;b+=1)c=
a.charCodeAt(b),d.push(c);return d.join(",")};e.stringToBuffer=function(a){for(var b=0,k=a.length,c,d=[];b<k;b+=1)c=a.charCodeAt(b),d.push(c);return d};e.bufferToHexString=function(a){a=-1!==a.indexOf(",")?a.split(","):[a];for(var b=[],k=0;k<a.length;k++)b.push(e.dec2hex2(a[k]));return b.join(" ")};e.bufferFromDecString=function(a){a=-1!==a.indexOf(",")?a.split(","):[a];for(var b=0;b<a.length;b++)a[b]=parseInt(a[b],10);return a};e.stringFromDecString=function(a){a=e.bufferFromDecString(a);for(var b=
"",k=0;k<a.length;k++)b+=String.fromCharCode(a[k]);return b};e.stringToHex2=function(a){for(var b="",k=0,c=a.length,d;k<c;k+=1)d=a.charCodeAt(k),b+=A(d.toString(16),2)+" ";return b};e.hexToString=function(a){a=a.split(" ");for(var b="",k=0,c=a.length,d;k<c;k+=1)d=String.fromCharCode(parseInt(a[k],16)),b+=d;return b};e.prettyHex=function(a){var b=Math.ceil(a.length/16),k=a.length%16||16,c=a.length.toString(16).length;6>c&&(c=6);for(var d="Offset";d.length<c;)d+=" ";var d="\u001b[36m"+d+"  ",h;for(h=
0;16>h;h++)d+=" "+A(h,2);d+="\u001b[0m\n";a.length&&(d+="\n");var l=0,g,q;for(h=0;h<b;h++){d+="\u001b[36m"+A(l,c)+"\u001b[0m  ";g=h===b-1?k:16;q=16-g;var r;for(r=0;r<g;r++)d+=" "+A(a[l],2),l++;for(r=0;r<q;r++)d+="   ";l-=g;d+="   ";for(r=0;r<g;r++)q=a[l],d+=31<q&&127>q||159<q?String.fromCharCode(q):".",l++;d+="\n"}return d};e.hexEncode=function(a,b){var k,c,d="";for(c=0;c<a.length;c++)k=a.charCodeAt(c).toString(16),d+=((null!==b?b:"000")+k).slice(-4);return d};e.markHex=function(a,b,k,c){b=b||"";
k=k||"";var d=""+a;a=/[^\x20-\x7E]/gim;a.exec(d);d.match(a);d.replace(a,function(a,c){var h=e.hexEncode(a,"$");2==h.length&&(h=h.replace("$","$0"));h=h.toUpperCase();d=d.replace(a,b+h+k)});return d};return e})},"nxapp/utils/_console":function(){define(["dojo/has!host-node?dojo/node!tracer","dojo/has!host-node?dojo/node!util","nxapp/utils"],function(e,p,m){var n=n;e&&(n=e.colorConsole({format:"\x3c{{title}}\x3e {{message}} (in {{file}}:{{line}})",dateformat:"HH:MM:ss.L"}));"undefined"==typeof logError&&
(global.logError=function(f,b){n.error("Error "+b,f)});m.stack=function(){n.log(Error().stack)};n.clear=function(){p.print("\u001b[2J\u001b[0;0H")};return n})},"nxapp/server/DeviceServer":function(){define("dcl/dcl dojo/_base/lang xide/types xide/factory nxapp/server/WebSocket dojo/node!http dojo/node!sockjs dojo/node!path dojo/node!fs-jetpack dojo/node!server-destroy nxapp/utils/_console xide/utils nxapp/model/Connection".split(" "),function(e,p,m,n,f,b,a,d,c,g,r,q,h){var l=!1;return e([f],{destroy:function(){this.socketServer&&
this.socketServer.destroy()},mqttManager:null,declaredClass:"nxapp.server.DeviceServer",protocolMethod:function(a,b){var c=this.ctx.getConnectionManager().protocolMethod(a.protocol,a.method,a.options);if(c&&c.then){var d=this;c.then(function(c){d.sendClientMessage(b,null,m.SOCKET_SERVER_COMMANDS.PROTOCOL_METHOD,{options:a.options,result:c})})}else r.error("calling protocol method failed! method returned nothing",c)},handleManagerCommand:function(a,b){switch(a.manager_command){case m.SOCKET_SERVER_COMMANDS.MANAGER_TEST:r.dir("Test Manager command");
break;case m.SOCKET_SERVER_COMMANDS.PROTOCOL_METHOD:return this.protocolMethod(a,b);case m.SOCKET_SERVER_COMMANDS.RUN_SHELL:return this.ctx.getDeviceManager().runShell(a.cmd,a.args,a.options);case m.SOCKET_SERVER_COMMANDS.RUN_FILE:return this.ctx.runFile(a);case m.SOCKET_SERVER_COMMANDS.INIT_DEVICES:return this.ctx.loadDevices(a);case m.SOCKET_SERVER_COMMANDS.RUN_CLASS:return this.ctx.runClass(a);case m.SOCKET_SERVER_COMMANDS.RUN_APP_SERVER_CLASS:return this.ctx.runAppServerClass(a);case m.SOCKET_SERVER_COMMANDS.RUN_APP_SERVER_CLASS_METHOD:return this.ctx.runAppServerClassMethod(a,
b);case m.SOCKET_SERVER_COMMANDS.RUN_APP_SERVER_COMPONENT_METHOD:return this.ctx.runAppServerComponentMethod(a,b);case m.SOCKET_SERVER_COMMANDS.CANCEL_APP_SERVER_COMPONENT_METHOD:return this.ctx.cancelAppServerComponentMethod(a,b);case m.SOCKET_SERVER_COMMANDS.ANSWER_APP_SERVER_COMPONENT_METHOD_INTERRUPT:return this.ctx.answerAppServerComponentMethodInterrupt(a,b);case m.SOCKET_SERVER_COMMANDS.WATCH:var c=this.ctx.getFileManager();c&&c.watch(a.path,a.watch);break;case m.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH:return this.sendMQTTMessage(a,
b);case m.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER:return this.startDriver(a,b);case m.SOCKET_SERVER_COMMANDS.CREATE_CONNECTION:return this.createConnection(a,b);case m.SOCKET_SERVER_COMMANDS.START_DEVICE:return this.startDevice(a,b);case m.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES:return this.getVariables(a,b);case m.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE:this.logClientMessage(a);break;case m.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER:this.stopDriver(a);break;case m.SOCKET_SERVER_COMMANDS.MANAGER_STATUS:a=
{message:"returning status",deviceConnections:this.options.context.getConnectionManager().getNumberOfConnections()};this.emit(m.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,JSON.stringify(a));break;case m.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL:this.options.context.getConnectionManager().closeAll()}},handleDeviceCommand:function(a,b){var c=a.device_command,d=this.options.context,h=this;l=!1;var g=a.options,f=null;b||l&&r.error("---have no client ");g.host&&g.protocol?f=d.getConnectionManager().connect(g.host,
g.protocol,g.port||"",null,g,b):r.error("handle device command: invalid args. data.options is not xide/types/DeviceInfo",q.inspect(a));try{f&&(f.options=g,d.getConnectionManager().registerFeedBack2(f,function(b,c){if(_.isString(c))a.lastResponse=""+c;else if(_.isObject(c))try{a.lastResponse=JSON.stringify(c)}catch(d){l&&r.error("error serializing data")}h.onDeviceMessage(b,c)}))}catch(e){r.error("-register feed back function failed",e),r.trace(e)}try{switch(c){case m.SOCKET_SERVER_COMMANDS.CALL_METHOD:this.options.context.getConnectionManager().callMethod(f,
a,b);break;case m.SOCKET_SERVER_COMMANDS.DEVICE_SEND:this.options.context.getConnectionManager().send(f,a.command,a.options)}}catch(n){r.error("error command parser "+c,n.stack)}},sendMQTTMessage:function(a,b){var c=a.data.device;a.data.sourceHost=b.remoteAddress;a.data.sourcePort=b.remotePort;if(c){if((c=this.ctx.getConnectionManager().getConnection2(c))&&c.variables){var d=a.topic.split("/");if(4==d.length&&"Variable"==d[2]){d=d[3];if(!d)return;for(var h=0;h<c.variables.length;h++){var l=c.variables[h];
l.name===d&&(l.value=a.data.value)}}}}else r.error("cant find device");this.mqttManager&&this.mqttManager.publishTopic(a.topic,a.data)},updateDeviceState:function(a,b){this.mqttManager&&this.mqttManager.publishTopic(a,b)},sendClientMessage:function(a,b,c,d){b={data:q.mixin({device:b},d),event:c};a.write(JSON.stringify(b))},getVariables:function(a,b){var c=a.device,d=this.ctx.getConnectionManager().getConnection2(c),h=[];if(d){d.options=c;var l=d.variables;l?(h=l,this.sendClientMessage(b,c,m.EVENTS.SET_DEVICE_VARIABLES,
{variables:l})):(h=d.variables=a.variables,_.each(h,function(a){a.value=a.initial}),this.sendClientMessage(b,c,m.EVENTS.SET_DEVICE_VARIABLES,{variables:a.variables}))}else r.error("cant find device connection");if((d=b.mqtt)&&!d.didSubscribe)for(l=0;l<h.length;l++)d.subscribe(c.host+"/"+c.port+"/Variable/"+h[l].name)},logClientMessage:function(a){var b=a.data.device;a.data.device?this.logEx(a.message,a.level,a.type,{device:b,deviceMessage:"",time:a.time}):r.error("wrong log parameters, host missing",
a)},getLogger:function(a){var b=this.ctx.getLogManager(),h=b.options,l=q.replaceAll("/","_",a.host)+"_"+a.port+"_"+a.protocol+".json",g=b.loggers[l],h=(a=a[a.deviceScope])?c.dir(a+d.sep+"logs").path():h.fileLogger.dirname;g||(g=b.createLogger({filename:l,dirname:h,json:!0,console:null}),b.loggers[l]=g);return g},logEx:function(a,b,c,d){var h=this.getLogger(d.device);b=b||"info";d=d||{};d.type=c||"Unknown";d.time=d.time||(new Date).getTime();h.log(b,a,d)},stopDriver:function(a){var b=this.ctx.getConnectionManager(),
c=this.ctx.getDeviceManager(),d=b.getConnection2(a);d&&(d.options=a,d.client.close());b.removeConnection(d,null,!0);!d&&l&&r.log("have no such connection "+h.generateId(a));c.stopDevice(a.id)},sendClientEvent:function(a){},startDriver:function(a,b){var c=this.ctx.getConnectionManager(),d=this.ctx.getDeviceManager(),g=c.getConnection2(a),q=a.driverOptions&1<<m.DRIVER_FLAGS.RUNS_ON_SERVER,f=a.driverOptions&1<<m.DRIVER_FLAGS.SERVER;l&&r.log("start driver "+a.host+" : "+a.port+"@"+a.protocol+" server side \x3d "+
q+" device Scope "+a.deviceScope+" is server \x3d "+f+" found connection:"+(g?"true":"false")+" external client "+b.isExternal());if(q&&q&&!g)if(d&&d.startDevice||r.error("!deviceManager || !startDevice"),q=d.getItemById(a.id)){if(f=d.toDeviceControlInfo(q))return d.startDevice(q,!0),!0;f&&l&&r.log("driver runs server side, start device! "+f.toString())}else{r.warn("DeviceServer::startDriver : cant find device");return}if(!g)return l&&r.log("start driver: connection doesnt exists "+a.host+" : "+a.port+
"@"+a.protocol+" : "+a.deviceScope+" id : "+h.generateId(a)),a[a.driverScope]?c.connect(a.host,a.protocol,a.port,a.mqtt,a,b):(r.error("have no driver scope"),null);g.options=a;c.onConnect2(g,!0,!0);if(!a.deviceScope)throw r.error("has no device scope",a),Error("has no device scope",a);return"xxxx"},startDevice:function(a,b){var c=this.ctx.getDeviceManager(),d=this.ctx.getConnectionManager(),h=a.driverOptions&1<<m.DRIVER_FLAGS.RUNS_ON_SERVER,g=a.driverOptions&1<<m.DRIVER_FLAGS.SERVER;l&&r.log("start device "+
a.host+" : "+a.port+"@"+a.protocol+" server side \x3d "+h+" device Scope "+a.deviceScope+" is server \x3d "+g+" external client "+b.isExternal());if(h=c.getItemById(a.id)){c.updateDevice(a,h);if(g=c.toDeviceControlInfo(h))return c.startDevice(h,null,b).then(function(){var b=d.getConnection2(a);if(b)d.onConnect2(b,!0,!0);else r.error("DeviceServer::startDevice : cant find connection")}),!0;g&&l&&r.log("driver runs server side, start device! "+g.toString())}else r.warn("Cant find device ",a),r.warn("Cant find device ",
c.stores)},createConnection:function(a,b){var c=this.ctx.getConnectionManager(),d=c.getConnection2(a),g=a.driverOptions&1<<m.DRIVER_FLAGS.RUNS_ON_SERVER,q=a.driverOptions&1<<m.DRIVER_FLAGS.SERVER;l&&r.log("createConnection "+a.host+" : "+a.port+"@"+a.protocol+" server side \x3d "+g+" device Scope "+a.deviceScope+" is server \x3d "+q+" found connection:"+(d?"true":"false")+" | is external client:"+b.isExternal());if(!d)return l&&r.log("createConnection: connection doesnt exists "+a.host+" : "+a.port+
"@"+a.protocol+" : "+a.deviceScope+" id : "+h.generateId(a)),a[a.driverScope]?c.connect(a.host,a.protocol,a.port,a.mqtt,a,b):(r.error("have no driver scope"),null);d.options=a;c.onConnect2(d,!0,!0);if(!a.deviceScope)throw r.error("has no device scope",a),Error("has no device scope",a);return d},onFileChanged:function(a){this.broadCastMessage(m.EVENTS.ON_FILE_CHANGED,{path:a.path,event:a.event})},onDeviceMessage:function(a,b,c){if(a)if(null===b)l&&r.error("---onDeviceMessage:have no data "+a.options.id+
" server id \x3d "+h.generateId(a.options));else{c={device:a.options,deviceMessage:b,bytes:c&&c.join?c.join(","):""};var d=b.event||m.EVENTS.ON_DEVICE_MESSAGE;if(a&&a.isRunAsServer()&&d===m.EVENTS.ON_DEVICE_MESSAGE)this.ctx.getDeviceManager().onDeviceServerMessage({event:m.EVENTS.ON_DEVICE_MESSAGE,data:{data:c}});else this.broadCastMessage(b.event||m.EVENTS.ON_DEVICE_MESSAGE,c)}else r.error("---onDeviceMessage:have no connection object")},onLogMessage:function(a){this.broadCastMessage(m.EVENTS.ON_SERVER_LOG_MESSAGE,
a)},onClientDisconnect:function(a){a.mqtt&&(a.mqtt.end(),delete a.mqtt)},onClientConnection:function(a){if(this.mqttManager){var b=this;if(!a)l&&r.error("DeviceServer::onClientConnection connection null");else if(!a.mqtt){var c=this.mqttManager.createMQTTClient(a.remoteAddress,a.remotePort);c.client=a;a.mqtt=c;c.on("message",function(c,d){d.sourceHost!==a.remoteAddress&&d.sourcePort!==a.remotePort&&b.sendClientMessage(a,{},m.EVENTS.ON_MQTT_MESSAGE,{topic:c,message:d.toString(),host:a.remoteAddress,
port:a.remotePort})})}}},start:function(c,d){this.profile=d;this.options=p.mixin(this.options,c);this.clients=[];var h=this,q=this.options.port,f=this.options.host;this.subscribe(m.EVENTS.ON_SERVER_LOG_MESSAGE,this.onLogMessage,this);if(q){this.initLogger(d.debug);this.log("Socket server running in "+q,"socket_server");var e={heartbeat_delay:2E3};l||(e.log=function(){});var e=a.createServer(e),n=global.httpServer||b.createServer(this._handler);this.socket=n;e.installHandlers(n);n.listen(q,f);this._handleSocketEmits(e);
this.socketServer=n;g(this.socketServer);this.publish(m.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:q,socket_handler:e}},this);e.on("connection",function(a){var b=h.clients.push(a);l&&r.log("on device server client connection "+b);h.onClientConnection(a);a.isExternal=function(){return!0};a.on("close",function(){l&&r.info("close client connection "+b);h.onClientDisconnect(a);h.clients.remove(a)})});return!0}r.error("Port must be provided into options");return!1},_handleSocketEmits:function(a){var b=
this.options.port,c=this;a.on("connection",function(a){c.socket=a;n.publish(m.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:b,socket_handler:a}},this);a.on("data",function(b){_.isString(b)&&(b=q.fromJson(b));b.manager_command?c.handleManagerCommand(b,a):c.handleDeviceCommand(b,a)})})}})})},"nxapp/model/Connection":function(){define("dcl/dcl xide/model/Base xide/mixins/EventedMixin xide/encoding/MD5 xide/utils xide/types".split(" "),function(e,p,m,n,f,b){function a(a,c){var g=a[a.deviceScope],r=
a[a.driverScope];if(!g&&c){var q=c.ctx.getDeviceManager();if(q){var h=q.getDeviceById(a.id);h&&(r=q.toDeviceControlInfo(h),g=r[r.deviceScope],r=r[r.driverScope])}}g=f.replaceAll("/","",g+r);g=f.replaceAll("\\","",g);return n(JSON.stringify({protocol:a.protocol,port:a.port,host:a.host,hash:g,isServer:a.driverOptions&1<<b.DRIVER_FLAGS.SERVER,runAsServer:a.driverOptions&1<<b.DRIVER_FLAGS.RUNS_ON_SERVER}),1)}e=e([m.dcl],{connected:!1,__registered:!1,declaredClass:"nxapp/model/Connection",client:null,
options:null,socket:null,id:null,toString:function(){var a=this.options;return a.deviceScope+"://"+a.host+":"+a.port+"@"+a.protocol+"@"+(this.isServer()?"server":"")},constructor:function(b,c){this.client=b;this.options=c;f.mixin(this,{protocol:c.protocol,port:c.port,host:c.host});this.id=a(c);b.connection=this},isServer:function(){return this.options.driverOptions&1<<b.DRIVER_FLAGS.SERVER},isRunAsServer:function(){return this.options.driverOptions&1<<b.DRIVER_FLAGS.RUNS_ON_SERVER}});e.generateId=
a;e.generateHash=function(a){var c=f.replaceAll("/","",a[a.deviceScope]+a[a.driverScope]),c=f.replaceAll("\\","",c);return{protocol:a.protocol,port:a.port,host:a.host,hash:c,isServer:a.driverOptions&1<<b.DRIVER_FLAGS.SERVER,runAsServer:a.driverOptions&1<<b.DRIVER_FLAGS.RUNS_ON_SERVER}};return e})},"xide/encoding/MD5":function(){define(["./_base"],function(e){function p(a,b){return a<<b|a>>>32-b}function m(a,b,g,r,q,h){return e.addWords(p(e.addWords(e.addWords(b,a),e.addWords(r,h)),q),g)}function n(a,
b,g,r,q,h,l){return m(b&g|~b&r,a,b,q,h,l)}function f(a,b,g,r,q,h,l){return m(b&r|g&~r,a,b,q,h,l)}function b(a,b,g,r,q,h,l){return m(g^(b|~r),a,b,q,h,l)}function a(a,c){a[c>>5]|=128<<c%32;a[(c+64>>>9<<4)+14]=c;for(var g=1732584193,r=-271733879,q=-1732584194,h=271733878,l=0;l<a.length;l+=16)var k=g,t=r,w=q,u=h,g=n(g,r,q,h,a[l+0],7,-680876936),h=n(h,g,r,q,a[l+1],12,-389564586),q=n(q,h,g,r,a[l+2],17,606105819),r=n(r,q,h,g,a[l+3],22,-1044525330),g=n(g,r,q,h,a[l+4],7,-176418897),h=n(h,g,r,q,a[l+5],12,1200080426),
q=n(q,h,g,r,a[l+6],17,-1473231341),r=n(r,q,h,g,a[l+7],22,-45705983),g=n(g,r,q,h,a[l+8],7,1770035416),h=n(h,g,r,q,a[l+9],12,-1958414417),q=n(q,h,g,r,a[l+10],17,-42063),r=n(r,q,h,g,a[l+11],22,-1990404162),g=n(g,r,q,h,a[l+12],7,1804603682),h=n(h,g,r,q,a[l+13],12,-40341101),q=n(q,h,g,r,a[l+14],17,-1502002290),r=n(r,q,h,g,a[l+15],22,1236535329),g=f(g,r,q,h,a[l+1],5,-165796510),h=f(h,g,r,q,a[l+6],9,-1069501632),q=f(q,h,g,r,a[l+11],14,643717713),r=f(r,q,h,g,a[l+0],20,-373897302),g=f(g,r,q,h,a[l+5],5,-701558691),
h=f(h,g,r,q,a[l+10],9,38016083),q=f(q,h,g,r,a[l+15],14,-660478335),r=f(r,q,h,g,a[l+4],20,-405537848),g=f(g,r,q,h,a[l+9],5,568446438),h=f(h,g,r,q,a[l+14],9,-1019803690),q=f(q,h,g,r,a[l+3],14,-187363961),r=f(r,q,h,g,a[l+8],20,1163531501),g=f(g,r,q,h,a[l+13],5,-1444681467),h=f(h,g,r,q,a[l+2],9,-51403784),q=f(q,h,g,r,a[l+7],14,1735328473),r=f(r,q,h,g,a[l+12],20,-1926607734),g=m(r^q^h,g,r,a[l+5],4,-378558),h=m(g^r^q,h,g,a[l+8],11,-2022574463),q=m(h^g^r,q,h,a[l+11],16,1839030562),r=m(q^h^g,r,q,a[l+14],
23,-35309556),g=m(r^q^h,g,r,a[l+1],4,-1530992060),h=m(g^r^q,h,g,a[l+4],11,1272893353),q=m(h^g^r,q,h,a[l+7],16,-155497632),r=m(q^h^g,r,q,a[l+10],23,-1094730640),g=m(r^q^h,g,r,a[l+13],4,681279174),h=m(g^r^q,h,g,a[l+0],11,-358537222),q=m(h^g^r,q,h,a[l+3],16,-722521979),r=m(q^h^g,r,q,a[l+6],23,76029189),g=m(r^q^h,g,r,a[l+9],4,-640364487),h=m(g^r^q,h,g,a[l+12],11,-421815835),q=m(h^g^r,q,h,a[l+15],16,530742520),r=m(q^h^g,r,q,a[l+2],23,-995338651),g=b(g,r,q,h,a[l+0],6,-198630844),h=b(h,g,r,q,a[l+7],10,1126891415),
q=b(q,h,g,r,a[l+14],15,-1416354905),r=b(r,q,h,g,a[l+5],21,-57434055),g=b(g,r,q,h,a[l+12],6,1700485571),h=b(h,g,r,q,a[l+3],10,-1894986606),q=b(q,h,g,r,a[l+10],15,-1051523),r=b(r,q,h,g,a[l+1],21,-2054922799),g=b(g,r,q,h,a[l+8],6,1873313359),h=b(h,g,r,q,a[l+15],10,-30611744),q=b(q,h,g,r,a[l+6],15,-1560198380),r=b(r,q,h,g,a[l+13],21,1309151649),g=b(g,r,q,h,a[l+4],6,-145523070),h=b(h,g,r,q,a[l+11],10,-1120210379),q=b(q,h,g,r,a[l+2],15,718787259),r=b(r,q,h,g,a[l+9],21,-343485551),g=e.addWords(g,k),r=e.addWords(r,
t),q=e.addWords(q,w),h=e.addWords(h,u);return[g,r,q,h]}e.MD5=function(b,c){var g=c||e.outputTypes.Base64,r=a(e.stringToWord(b),8*b.length);switch(g){case e.outputTypes.Raw:return r;case e.outputTypes.Hex:return e.wordToHex(r);case e.outputTypes.String:return e.wordToString(r);default:return e.wordToBase64(r)}};e.MD5._hmac=function(b,c,g){g=g||e.outputTypes.Base64;var r=e.stringToWord(c);16<r.length&&(r=a(r,8*c.length));var q=[];c=[];for(var h=0;16>h;h++)q[h]=r[h]^909522486,c[h]=r[h]^1549556828;b=
a(q.concat(e.stringToWord(b)),512+8*b.length);b=a(c.concat(b),640);switch(g){case e.outputTypes.Raw:return b;case e.outputTypes.Hex:return e.wordToHex(b);case e.outputTypes.String:return e.wordToString(b);default:return e.wordToBase64(b)}};return e.MD5})},"xide/encoding/_base":function(){define(["dojo/_base/lang"],function(e){return{outputTypes:{Base64:0,Hex:1,String:2,Raw:3},addWords:function(e,m){var n=(e&65535)+(m&65535);return(e>>16)+(m>>16)+(n>>16)<<16|n&65535},stringToWord:function(e){for(var m=
[],n=0,f=8*e.length;n<f;n+=8)m[n>>5]|=(e.charCodeAt(n/8)&255)<<n%32;return m},wordToString:function(e){for(var m=[],n=0,f=32*e.length;n<f;n+=8)m.push(String.fromCharCode(e[n>>5]>>>n%32&255));return m.join("")},wordToHex:function(e){for(var m=[],n=0,f=4*e.length;n<f;n++)m.push("0123456789abcdef".charAt(e[n>>2]>>n%4*8+4&15)+"0123456789abcdef".charAt(e[n>>2]>>n%4*8&15));return m.join("")},wordToBase64:function(e){for(var m=[],n=0,f=4*e.length;n<f;n+=3)for(var b=(e[n>>2]>>n%4*8&255)<<16|(e[n+1>>2]>>(n+
1)%4*8&255)<<8|e[n+2>>2]>>(n+2)%4*8&255,a=0;4>a;a++)8*n+6*a>32*e.length?m.push("\x3d"):m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(b>>6*(3-a)&63));return m.join("")},stringToUtf8:function(e){for(var m="",n=-1,f,b;++n<e.length;)f=e.charCodeAt(n),b=n+1<e.length?e.charCodeAt(n+1):0,55296<=f&&56319>=f&&56320<=b&&57343>=b&&(f=65536+((f&1023)<<10)+(b&1023),n++),127>=f?m+=String.fromCharCode(f):2047>=f?m+=String.fromCharCode(192|f>>>6&31,128|f&63):65535>=f?m+=String.fromCharCode(224|
f>>>12&15,128|f>>>6&63,128|f&63):2097151>=f&&(m+=String.fromCharCode(240|f>>>18&7,128|f>>>12&63,128|f>>>6&63,128|f&63));return m}}})},"nxapp/server/FileServer":function(){define("dojo/_base/declare dojo/_base/lang xide/types xide/factory nxapp/server/WebSocket nxapp/utils/_LogMixin dojo/node!http dojo/node!sockjs".split(" "),function(e,p,m,n,f,b,a,d){return e("nxapp.server.WebSocket",[f,b],{onFileChanged:function(a){this.broadCastMessage(m.EVENTS.ON_FILE_CHANGED,{path:a.path,modulePath:a.modulePath,
mask:a.mask,type:a.type})},start:function(b,g){this.profile=g;this.options=p.mixin(this.options,b);this.clients=[];var r=this;n.subscribe(m.EVENTS.ON_FILE_CHANGED,this.onFileChanged,this);var q=this.options.port,h=this.options.host;if(q){this.initLogger(g.debug);this.log("File Socket server running in "+q,"socket_server");var l={};this.showDebugMsg("socket_server")||(l.log=function(){});var l=d.createServer(l),k=a.createServer(this._handler);l.installHandlers(k);k.listen(q,h);this._handleSocketEmits(l);
n.publish(m.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:q,socket_handler:l}},this);l.on("connection",function(a){var b=r.clients.push(a);a.on("close",function(){delete r.clients[b]})});return!0}console.error("Port must be provided into options");return!1},_handleSocketEmits:function(a){var b=this.options.port,d=this;a.on("connection",function(a){d.socket=a;n.publish(m.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:b,socket_handler:a}},this);a.on("close",function(){})})}})})},"nxappmain/nxAppBase":function(){define("dcl/dcl nxapp/utils/FileUtils dojo/node!commander dojo/node!fs dojo/node!os dojo/node!path dojo/node!util xide/factory/Events dojo/has xide/model/Base xide/utils".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r){c.add("windows",function(){return"win32"===f.platform()});c.add("osx",function(){return"darwin"===f.platform()});c.add("linux",function(){return"linux"===f.platform()});c.add("arm",function(){return"arm"===f.arch()});return e(g.dcl,{declaredClass:"nxappmain.nxAppBase",profile:null,commander:null,profilePath:"/nxappmain/profile_device_server.json",getDefaultProfilePath:function(){return dojoConfig.cwd+this.profilePath},getProfile:function(a){var b={};a||(a=this.commander.profile&&
0<this.commander.profile.length?this.commander.profile:this.getDefaultProfilePath());var c=dojoConfig.cwd;try{n.existsSync(a)||(a=c+"/"+this.profilePath)}catch(k){console.error("error reading profile path ")}(c=p.readFile(a))?b=dojo.fromJson(c):console.error("have no profile at : "+a);if(c=(c=this.commander.system)?p.resolve(c):null)b.data=c,b.watchr.paths=[c+a.sep+"system",c+a.sep+"workspace"];return b},init:function(){try{this.commander||(m.version("0.0.1").option("-i, --info","return service profile").option("-f, --file \x3cpath\x3e",
"run a file").option("-u, --user \x3cpath\x3e","user directory").option("--diagnose \x3cboolean\x3e","do some diagnose").option("--modules","list all modules").option("--start \x3cboolean\x3e","start devices").option("--serverSide \x3cboolean\x3e","make devices server side").option("-s, --system \x3cname\x3e","path to system scope").option("-j, --jhelp","output options as json").option("-t, --test","enable test mode").option("--mqtt \x3cboolean\x3e","enable or disable MQTT functionality"),this.commander=
m,this.commander.allowUnknownOption(!0),this.commander.parse(process.argv));if(m.jhelp){var a=[];m.options.map(function(b){a.push(b)});console.log(JSON.stringify(a));process.exit()}this.profile=this.getProfile(this.profilePath);r.mixin(this.profile,this.commander);var c=dojoConfig.cwd;this.profile.system=b.join(c,this.profile.system);var d=b.resolve(this.profile.system);n.existsSync(d)||(d=process.cwd()+"/data/system",this.profile.system=d,m.system=d);if(this.profile.user){this.profile.user=b.join(c,
this.profile.user);var k=b.resolve(this.profile.user);n.existsSync(k)&&(this.profile.user=k)}this.commander.start&&(this.profile.start="true"===this.commander.start);this.commander.serverSide&&(this.profile.serverSide="true"===this.commander.serverSide)}catch(g){console.error("error init ",g)}}})})},"xide/factory/Events":function(){define("xide/factory dojo/_base/connect dojo/_base/lang dojo/on dojo/has xide/lodash".split(" "),function(e,p,m,n,f){var b={click:null,dblclick:null,mousedown:null,mouseup:null,
mouseover:null,mousemove:null,mouseout:null,keypress:null,keydown:null,keyup:null,focus:null,blur:null,change:null};e.publish=function(a,b,c,g){b=b?_.isString(b)?{message:b}:b:{};c=a;var r=p.publish,q=[];_.isArray(a)||(c=[a]);a=0;for(var h=c.length;a<h;a++){var l=c[a];if(!g||g(l))q=r(l,b)}return q};e.subscribe=function(a,d,c,g){var r=a,q=p.subscribe,h=[];_.isArray(a)||(r=[a]);a=0;for(var l=r.length;a<l;a++)if(r[a]&&(!g||g(e))){var k=r[a],f=_.isString(k),e=f?k:k.key,k=f?d:k.handler,f=e in b;null!=
c?(k=null!=k?k:c[e],f=f?n(c,e,m.hitch(c,k)):q(e,m.hitch(c,k)),f.handler=m.hitch(c,k)):(f=p.subscribe(e,k),f.handler=k);f.type=e;h.push(f)}return h};return e})},"nxapp/manager/Context":function(){define("dcl/dcl ./ConnectionManager xide/manager/ContextBase require nxapp/utils/_console xide/types xide/utils dojo/node!path".split(" "),function(e,p,m,n,f,b,a,d){return e(m,{declaredClass:"nxapp.manager.Context",connectionManager:null,blockManager:null,deviceServer:null,logManager:null,loadDevices:function(a){f.log("load devices",
a);var b=this.getDeviceManager(),r=this.getDriverManager();b.debug();var q=b.getStores()[a.scope],h=a.path;q?q.connected?f.warn("store "+q.scope+" is already connected"):f.info("connecting store "+q.scope):(f.info("connecting store "+a.scope),r.createStore({items:this.getDrivers(d.resolve(h+"/drivers"),"user_drivers")},"user_drivers",!0),b.initStore({items:this.getDevices(d.resolve(h+"/devices"),"user_devices")},"user_devices",!0))},runFile:function(a){f.log("run file",a)},broadCastMessage:function(c,
d){this.getDeviceServer().broadCastMessage(b.EVENTS.ON_RUN_CLASS_EVENT,a.mixin({event:b.EVENTS.ON_RUN_CLASS_EVENT},d))},runClass:function(a){var b=a["class"],d=this;try{n([b],function(h){h=new h(a.args);try{h.run({data:a,clear:function(){this.data.progress=null;this.data.finish=null;this.data.error=null;this.data.data=null},onProgress:function(a,b){this.clear();this.data.progress=a;this.data.data=b;d.broadCastMessage(null,this.data)},onFinish:function(a,b){this.clear();this.data.finish=a;this.data.data=
b;d.broadCastMessage(null,this.data)},onError:function(a,b){this.clear();this.data.error=a;this.data.data=b;d.broadCastMessage(null,this.data)}})}catch(l){f.error("error running class "+b,l),a.error=l.message,d.broadCastMessage(null,a)}})}catch(q){f.error("error loading class "+b,q)}},runAppServerClass:function(a){return this.appServer.runClass(a,this)},runAppServerComponentMethod:function(a,b){return this.appServer.runComponentMethod(a,this,b)},cancelAppServerComponentMethod:function(a,b){return this.appServer.cancelComponentMethod(a,
this,b)},answerAppServerComponentMethodInterrupt:function(a,b){return this.appServer.answerAppServerComponentMethodInterrupt(a,this,b)},runAppServerClassMethod:function(a,b){return this.appServer.runClassMethod(a,this,b)},getDeviceServer:function(){return this.deviceServer},getConnectionManager:function(){return this.connectionManager},initManagers:function(a){this.connectionManager.init(a)},constructManagers:function(){this.connectionManager=new p({ctx:this})},getLogManager:function(){return this.logManager}})})},
"nxapp/manager/ConnectionManager":function(){define("dcl/dcl nxapp/manager/ManagerBase nxapp/utils/_LogMixin nxapp/protocols/Tcp nxapp/protocols/Udp nxapp/protocols/Driver nxapp/protocols/SSH nxapp/protocols/Serial nxapp/protocols/MQTT nxapp/protocols/ProtocolBase nxapp/types/Types xide/factory xide/utils nxapp/utils/_console xide/data/_Base nxapp/model/Connection xide/data/TreeMemory xide/data/ObservableStore dstore/Trackable dojo/_base/declare dojo/Deferred dojo/node!path require".split(" "),function(e,
p,m,n,f,b,a,d,c,g,r,q,h,l,k,t,w,u,z,v,x,D,A){return e([p,m],{declaredClass:"nxapp.manager.ConnectionManager",options:null,profile:null,lastUpTime:null,mqttManager:null,pool:[],poolNotFound:-1,store:null,getDriverModule:function(a){var b=new x;if(!a||!a.driver)return l.error("cant get driver module. options invalid or no driver specified"),b.resolve(null),b;try{var c=a[a.driverScope],k=c+"/"+a.driver,k=h.replaceAll("/",D.sep,k);try{A.undef(k),A([k],function(a){b.resolve(a)})}catch(d){l.error("-----error loading driver module at drivers root "+
c+" and module "+a.driver+" :: "+d.message,d.stack),b.resolve()}}catch(g){l.error("Error connecting driver "+g.message),b.resolve()}return b},protocolMethod:function(a,b,c){c=c||{};var k=new x,d=this;this.getDriverModule(c.device).then(function(h){(h=d._protocolMethod(a,b,c,h))&&h.then?h.then(function(a){k.resolve(a)}):k.resolve([])},function(a){l.error("cant get driver : "+c.device)});return k},_protocolMethod:function(b,k,h,g){h=h||{};h=h.args;b===r.PROTOCOL.DRIVER&&g&&(b=g.is?g.is()||b:b);var q=
{};switch(b){case r.PROTOCOL.DRIVER:if(g&&g[k]){q=g[k](h);break}case r.PROTOCOL.UDP:if(k in f){q=f[k].apply(this,h);break}case r.PROTOCOL.MQTT:if(k in c){q=c[k].apply(this,h);break}case r.PROTOCOL.SSH:if(k in a){q=a[k].apply(this,h);break}case r.PROTOCOL.TCP:if(k in n){q=n[k].apply(this,h);break}case r.PROTOCOL.SERIAL:if(k in d)return d[k].apply(this,h);l.error("no such protcol method "+k+" in "+b);break;default:return b=new x,b.resolve([]),b}return q},onWakeup:function(){this.lastUpTime=(new Date).getTime();
for(var a=0;a<this.pool.length;a++){var b=this.pool[a];b.socket&&b.socket.close&&b.socket.close();b.socket&&b.socket._socket&&b.socket._socket.close&&b.socket._socket.close()}this.pool=[]},init:function(a){this.profile=a;this.initLogger(a.debug);this.lastUpTime=(new Date).getTime();this.store=new (v("nxapp.data.Store",[w,z,u],{}))({idProperty:"id",Model:t});var b=this;setInterval(function(){var a=(new Date).getTime();if(3E3<a-b.lastUpTime)b.onWakeup();b.lastUpTime=a},1E3)},connect:function(k,h,g,
e,u,v){if(!k)return l.error("ConnectionManager::connect : have no host"),null;if(!h)return l.error("ConnectionManager::connect : have no protocol"),null;if(!u)return l.error("ConnectionManager::connect : have no options"),null;v=t.generateId(u,this);if(v=this.store.getSync(v)){if(!v.isServer()&&!v.isRunAsServer())this.onConnect2(v,!0,!0);return v}var w=v=null;switch(h){case r.PROTOCOL.TCP:v=new n({owner:this,options:u,delegate:this});break;case r.PROTOCOL.UDP:v=new f({owner:this,options:u,delegate:this});
break;case r.PROTOCOL.DRIVER:v=new b({owner:this,options:u,delegate:this});break;case r.PROTOCOL.SSH:v=new a({owner:this,options:u,delegate:this});break;case r.PROTOCOL.SERIAL:v=new d({owner:this,options:u,delegate:this});break;case r.PROTOCOL.MQTT:v=new c({owner:this,options:u,delegate:this})}if(v){k=this.addConnection2(v,u);v.init();v.connection=k;w=v.connect();k.socket=w;q.publish(r.EVENTS.ON_CONNECTION_CREATED,{connection:k},this);if(this.mqttManager)this.mqttManager.onConnectedToDevice(u,v,e);
return k}q.publish(r.EVENTS.ON_CONNECTION_ERROR,{connection:{port:g,host:k,protocol:h}},this);return!1},send:function(a,b,c){if(a){var k=a.client;if(k){var d=k._socket;a.client||l.error("connection has no client");if(d){if(!d.writable)return l.error("socket not writable, closing connection"+a.lastError),this.close(a,!0),!1}else return l.error("have no socket"),!1;a&&a.options&&this.logEx(r.LOG_OUTPUT.SEND_COMMAND+" : "+b,"info","server",r.LOG_OUTPUT.SEND_COMMAND,a);return k.send(b,c)}l.error("send "+
b+" have no client")}else l.error("send "+b+" have no connection")},callMethod:function(a,b){b=h.getJson(b);var c=b.method,k=b.args;if(a)if(a.client){if(a.client[c])return a.client[c].apply(a.client,[k,b]);l.error("no such method "+c)}else l.error("call method : connection has no client object");else l.error("call method : invalid connection")},close:function(a){if(a){a._destroyed=!0;var b=a.client._socket;a.client=null;b&&b._socket&&b._socket.close&&b._socket.close()}},closeAll:function(){var a=
this;this.forEachPool(function(b,c){a.close(c)});this.clearPool()},onTimeout:function(a){},onClose:function(a,b){a&&a.options&&(this.logEx(r.LOG_OUTPUT.DEVICE_DISCONNECTED,"info","server",r.LOG_OUTPUT.DEVICE_DISCONNECTED,a),this.publish(r.EVENTS.ON_DEVICE_DISCONNECTED,{device:a.options,connection:a}));a._destroyed=!0;this.removeConnection(a,b)},onDrain:function(a){},onError:function(a,b,c){c&&l.log(" Error: "+c.host+":"+c.port+"@"+c.protocol,b);a&&(a.lastError=b);this.removeConnection(a,c)},onFinish:function(a,
b,c){b=this.connectionExists(a.host,a.port,a.protocol);b!=this.poolNotFound?this.callFeedBack(b,data):l.error("ConnectionManager::onData : cant find pool - reference:"+b+":"+a.host+":"+a.port+":"+a.protocol)},onData:function(a,b,c){try{this.callFeedBack2(a,b,c)}catch(k){l.error("call feedback error : "+k.message),l.log(k.stack)}a&&a.options&&this.logEx(r.LOG_OUTPUT.RESPONSE+":"+b,"info","server",r.LOG_OUTPUT.RESPONSE,a)},hasFlag:function(a,b){var c=r.LOGGING_FLAGS,k=a.loggingFlags,k=_.isString(k)?
h.fromJson(k):k||{},k=k[b];return null!=k&&k&c.FILE?!0:!1},onConnect2:function(a,b,c){if(a.connected){b={device:a.options,isReplay:c};var k=this.ctx.getDeviceServer();this.getConnection2(a.options);k.broadCastMessage(r.EVENTS.ON_DEVICE_CONNECTED,b);this.publish(r.EVENTS.ON_DEVICE_CONNECTED,{device:a.options,isReplay:c,connection:a});a&&!a.__registered&&(this.registerFeedBack2(a,function(a,b,c){b&&(b.lastResponse=_.isString(b)?b:JSON.stringify(b,null,2));k.onDeviceMessage(a,b,c)}),a.__registered=!0);
a&&a.options&&!c&&this.logEx(r.LOG_OUTPUT.ON_DEVICE_CONNECTED,"info","server",r.LOG_OUTPUT.ON_DEVICE_CONNECTED,a);if(a.client&&a.client.onConnect)a.client.onConnect();return a}},logEx:function(a,b,c,k,d){var h=this.ctx.getDeviceServer();if(d&&d.options){var g=d.options;this.hasFlag(g,k)&&h.logEx(a+" "+d.toString(),b||"info",c||"server",{device:g})}},_onConnect:function(a,b,c,k){l.log("Connected to "+k.declaredClass+":"+a+":"+b+" via "+c+" : ",k.options);if(!k.options)throw l.error("have no options: ",
k),Error("Asdf");a={device:{host:a,port:b,protocol:c,options:k?k.options:null}};this.ctx.getDeviceServer().broadCastMessage(r.EVENTS.ON_DEVICE_CONNECTED,a);var d=this.ctx.getDeviceServer();k&&(k.__registered?l.error("already registered"):(this.registerFeedBack2(k,function(a,b,c){b.lastResponse=""+b;d.onDeviceMessage(a,b)}),k.__registered=!0))},onHandle:function(a,b){},getNumberOfConnections:function(){return this.pool.length},getDeviceConnection:function(){if(this.getNumberOfConnections())for(var a=
0;a<this.pool.length;a++);},addConnection:function(a,b,c,k,d,h,g,l){g=new t(g,a,l);this.store.putSync(g);this.pool.push({socket:a,host:b,port:c,protocol:k,user:d,customFields:h,feedbackTo:[]});return g},addConnection2:function(a,b){var c=new t(a,b);return this.store.putSync(c)},removeConnection:function(a,b,c){var k=this;a&&(a=this.getConnection2(a.options));a&&(a=this.getConnection2(a.options),this.ctx.getDeviceServer()&&setTimeout(function(){var b={device:a.options,error:a.lastError,stopped:c};
k.ctx.getDeviceServer().broadCastMessage(r.EVENTS.ON_DEVICE_DISCONNECTED,b)},1E3),this.store.removeSync(a.id),a._destroyed=!0)},clearPool:function(){this.pool=[]},getConnection:function(a){if(3==arguments.length){for(var b=arguments[0],c=arguments[1],k=arguments[2],d=0;d<this.pool.length;d++){var h=this.pool[d];if(h.host==b&&h.port==k&&h.protocol==c)return h}return null}return this.pool[a]},getConnection2:function(a){return this.store.getSync(t.generateId(a,this))},getConnectionById:function(a){return this.store.getSync(a)},
registerFeedBack2:function(a,b){a&&(a.feedbackTo||(a.feedbackTo=[]),a&&0<a.feedbackTo.length||a.feedbackTo.push(b))},_registerFeedBack:function(a,b){var c=this.getConnection(a);null==c?l.error("cant find connection for pool ref:"+a):c&&0<c.feedbackTo.length||c.feedbackTo.push(b)},callFeedBack:function(a,b){throw Error();},callFeedBack2:function(a,b,c){if(a)if(a.feedbackTo&&0!=a.feedbackTo.length)for(var k=0;k<a.feedbackTo.length;k++)a.feedbackTo[k](a,b,c);else l.error("-- call feed back: have no feedback targets",
a.options.host);else l.error("-- call feed back: have no connection")},connectionExists:function(a,b,c){var k=this.poolNotFound;_.each(this.pool,function(d,h){d&&d.host===a&&d.port===b&&d.protocol===c&&(k=h)});return k},forEachPool:function(a){_.each(this.pool,function(b,c){a(b,c)})}})})},"nxapp/manager/ManagerBase":function(){define(["dcl/dcl","xide/model/Base","xide/mixins/EventedMixin"],function(e,p,m){p=e([p.dcl,m.dcl],{declaredClass:"nxapp.manager.ManagerBase",ctx:null,profile:null,init:function(e){this.profile=
e}});e.chainAfter(p,"init");return p})},"nxapp/protocols/Tcp":function(){define("dcl/dcl nxapp/utils nxapp/protocols/ProtocolBase dojo/node!net dojo/node!child_process dojo/node!util dojo/node!path xide/mixins/EventedMixin xide/mixins/ReloadMixin xide/types dojo/Deferred dojo/node!evilscan dojo/node!ipaddr.js dojo/node!os".split(" "),function(e,p,m,n,f,b,a,d,c,g,r,q,h,l){e=e(m,{declaredClass:"nxapp.protocols.Tcp",_socket:null,protocolName:"tcp",delegate:null,driverInstance:null,_handleSocketEmits:function(a){var b=
this;b.clients=[];var c=this.blockScope,d=c.getVariable("value"),h=c.getVariables({group:g.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES}),l=c.getBlocks({group:g.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS});a.on("connection",function(a){b.socket=a;b.clients.push(a);a.on("data",function(a){a=[{string:a.toString(),bytes:a.join(",")}];for(var b=0;b<a.length;b++)if(0!==a[b].length){d.value=new String(a[b].string);d.value.setBytes(a[b].bytes);for(var k=0;k<h.length;k++){var q=h[k];if("value"!=h[k].title){var r=
null,r=d.value;"number"!=typeof r&&(r=""+r,r="'"+r+"'");q.target&&"None"!=q.target&&null!==r&&"null"!=r&&"'null'"!=r&&(q=c.getVariable(q.target))&&(q.value=r,this.publish(g.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:q,scope:c,owner:this,save:!1,source:g.MESSAGE_SOURCE.BLOX}))}}for(q=0;q<a.length;q++)if(r=a[q],_.isObject(r)&&r.src&&(k=c.getBlockById(r.src))&&k.onData)k.onData(r);for(q=0;q<l.length;q++)if(k=l[q],!1!==k.enabled){k.override={args:[d.value]};try{c.solveBlock(l[q],{highlight:!1})}catch(f){console.log("----solving response block crashed ",
f),console.trace()}}}});a.on("close",function(){})})},_creatingServer:!1,makeServer:function(){if(!this._creatingServer){this._creatingServer=!0;try{var a=this.options,b=a.port,c=a.host,d=this;this.owner.ctx.getDriverManager().createDriverInstance(a).then(function(a){d.blockScope=a.blockScope;d.driverInstance=a.driverInstance});var h=new n.Server;h.listen(b,c);d._socket=h;h.writable=!0;d._handleSocketEmits(h);d.connection.connected=!0;d.delegate.onConnect2(d.connection);this.subscribe(g.EVENTS.ON_DEVICE_CONNECTED,
this.onDeviceConnected);this.subscribe(g.EVENTS.ON_DEVICE_DISCONNECTED,this.onDeviceDisconnected)}catch(l){console.error("error creating server",l)}return this}},connections:null,onDeviceConnected:function(a){if(a=a.connection){var b=a.options,c=this.options;this.connections||(this.connections=[]);a.id!==this.connection.id&&this.delegate.getConnectionById(a.id)&&c.host===b.host&&c.port===b.port&&c.protocol===b.protocol&&!a.isServer()&&-1===this.connections.indexOf(a)&&this.connections.push(a)}},onDeviceDisconnected:function(a){if(a=
a.connection)this.connections||(this.connections=[]),-1!==this.connections.indexOf(a)&&this.connections.remove(a)},connect:function(){if(this.isServer())return this.makeServer();var a=this.options,b=this.options.port,c=this.options.host;this.clients=[];this._socket=new n.Socket(p.mixin({allowHalfOpen:!0,writable:!0,readable:!0},a.options));var d=this;this.isDebug()&&console.log("TCP-Client-\x3eConnect to "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this._socket.connect(b,c,
function(){d.connection.connected=!0;d.delegate.onConnect2(d.connection)});this._socket.setNoDelay(!0);this._socket.setKeepAlive(!0,0);this._socket.owner=this;this._setupEventListeners(this._socket,this.delegate);return this},broadCastMessage:function(a,b){var c=this;this.connections&&_.each(this.connections,function(a){a&&a._destroyed&&c.connections.remove(a);if(a)if(a.client)a.client.delegate.onData(a,b.toString(),b);else console.error("not at a real connection",a);else console.error("invalid connection",
a)})},send:function(a){null==a?console.error("TCP : invalid command"):(a=p.bufferFromDecString(a),a=new Buffer(a),this.isServer()?this.broadCastMessage(g.EVENTS.ON_DEVICE_MESSAGE,a):this._socket.write(a))},destroy:function(){this.blockScope&&this.blockScope.destroy();this.driverInstance&&this.driverInstance.destroy();delete this.blockScope;delete this.driverInstance;delete this.connections;delete this.clients;delete this._socket;this._destroyed=!0},close:function(){this.isServer()?(this._socket.close(),
this.destroy()):this._socket.end()}});e.net=n;e.ls=function(a){try{var b=function(){var a=!0;_.each(f,function(b){b.done||(a=!1)});if(a){var b=[];f=_.filter(f,function(a){return 0<a.list.length});_.each(f,function(a){b=b.concat(a.list)});c.resolve(b)}},c=new r,d=l.networkInterfaces(),g=[];Object.keys(d).forEach(function(a){var b=0;d[a].forEach(function(c){"IPv4"===c.family&&!1===c.internal&&(1<=b?g.push({face:a+b,ip:c.address}):g.push({face:a,ip:c.address}),++b)})});var f={};_.each(g,function(d){var g=
h.parse(d.ip).octets;g[g.length-1]=0;var l=g.join(".")+"-254",g=new q({target:l,port:""+(a.ports||"80"),status:"Open",timeout:500,banner:!1});f[l]||(f[l]={done:!1},f[l].list=[]);g.on("result",function(a){"open"===a.status&&f[l].list.push({host:a.ip,port:a.port,description:d.face+" "+d.ip,"interface":d.face})});g.on("error",function(a){c.reject("error scanning tcp")});g.on("done",function(){f[l].done=!0;b()});g.run()})}catch(e){console.error("error",e)}return c};e.options=function(a){a=new r;var b=
g.ECIType,b=[p.createCI("allowHalfOpen",b.BOOL,!0,{group:"Network"}),p.createCI("readable",b.BOOL,!0,{group:"Network"}),p.createCI("writable",b.BOOL,!0,{group:"Network"})];a.resolve(b);return a};return e})},"nxapp/protocols/ProtocolBase":function(){define("dcl/dcl xide/model/Base xide/types xide/utils nxapp/utils/_LogMixin xide/mixins/ReloadMixin dojo/Deferred".split(" "),function(e,p,m,n,f,b,a){p=e([p.dcl,f,b.dcl],{onReloaded:function(){console.error("on reloaded")},options:null,declaredClass:"nxapp.protocols.ProtocolBase",
protocolName:"undefined",debug_connection:"protocol_connection",debug_messages:"protocol_messages",getModule:function(b){var c=new a;try{require(["dojo/node!"+b],function(a){c.resolve(a)})}catch(g){c.reject(g)}return c},delegate:null,connection:null,_setupEventListeners:function(a,b){var g=this,r=g.connection;a.handle=function(a){b.onHandle(r,a)};a.on("data",function(a){b.onData(r,a.toString(),a);for(var d=0;d<a.length;d++);});b||(console.error("have no handler"),n.stack());r||(console.error("have no connection"),
n.stack());a.on("error",function(a){g.isDebug()&&console.error("socket error : ",a);b.onError(r,a)});a.on("drain",function(){b.onDrain(r)});a.on("timeout",function(){b.onTimeout(r)});a.on("close",function(a){b.onClose(r,a)})},isDebug:function(){var a=this.connection;return a&&(a=a.options)&&(a=a.driverOptions)&&a&1<<m.DRIVER_FLAGS.DEBUG?!0:!1},isServer:function(){var a=this.connection;return a&&(a=a.options)&&(a=a.driverOptions)&&a&1<<m.DRIVER_FLAGS.SERVER?!0:!1},runAsServer:function(){var a=this.connection;
return a&&(a=a.options)&&(a=a.driverOptions)&&a&1<<m.DRIVER_FLAGS.RUNS_ON_SERVER?!0:!1},_defaultOptions:function(){return{port:23,text_encoding:"utf8",end_of_command:"\r"}},toString:function(a,b){var g=n.bufferFromDecString(a);return(new Buffer(g)).toString(b)},init:function(){this.initLogger(this.options.debug);this.initReload();var a=this;this.subscribe(m.EVENTS.ON_MODULE_RELOADED,function(b){a.modulePath&&b.module&&a.modulePath===b.module&&(a.mergeFunctions(a,b.newModule.prototype),a.onReloaded())})},
mergeFunctions:function(a,b){for(var g in b)"constructor"!==g&&"inherited"!==g&&_.isFunction(b[g])&&(a[g]=null,a[g]=b[g],console.log("update : "+g))},logConnection:function(a){this.log(a,this.debug_connection)},logMessages:function(a){this.log(a,this.debug_messages)},send:function(a){},onConnect:function(){},destroy:function(){}});e.chainAfter(p,"onConnect");e.chainAfter(p,"init");e.chainAfter(p,"close");e.chainAfter(p,"destroy");return p})},"xide/mixins/ReloadMixin":function(){define(["xdojo/declare",
"dcl/dcl","xide/types","xide/utils","xide/mixins/EventedMixin"],function(e,p,m,n,f){var b={_mergeFunctions:!0,_mergeMissingVariables:!0,isInstanceOf_:function(a){try{if(!!this instanceof a||this.isInstanceOf&&this.isInstanceOf(a))return!0;var b=n.getAt(this,"constructor._meta.bases",[]),c=a.prototype.declaredClass;return _.findWhere(b,function(b){return b==a||n.getAt(b,"superclass.declaredClass")===c||n.getAt(b,"prototype.declaredClass")===c})}catch(g){console.log("ReloadMixin :: this.isInstanceOf_ crashed "+
g)}return!1},mergeFunctions:function(a,b){for(var c in b)"constructor"!==c&&"inherited"!==c&&(_.isFunction(b[c])&&(a[c]=null,a[c]=b[c]),_.isArray(b[c])&&null==a[c]&&(a[c]=b[c]))},onModuleReloaded:function(a){var b=a.newModule;if(b&&b.prototype&&!a._processed){var c=b.prototype,g=c.declaredClass,r=!1,q=this.declaredClass;g&&(g&&q&&(r=n.replaceAll("/",".",q)===n.replaceAll("/",".",g)),r?(this.mergeFunctions(this,c),this.onReloaded&&(a._processed=!0,this.onReloaded(b))):a.module&&n.replaceAll("//","/",
a.module)===q&&this.mergeFunctions(this,c))}},initReload:function(){this.subscribe(m.EVENTS.ON_MODULE_RELOADED)}};e=e(null,b);e.Impl=b;e.dcl=p(f.dcl,b);return e})},"nxapp/protocols/Udp":function(){define("dcl/dcl nxapp/protocols/ProtocolBase dojo/node!dgram xide/utils dojo/Deferred xide/types".split(" "),function(e,p,m,n,f,b){e=e(p,{declaredClass:"nxapp.protocols.Udp",_socket:null,protocolName:"udp",port:null,host:null,onData:function(a){var b=this.delegate;this.isDebug()&&console.log("UDP: got data : "+
this.connection.toString(),a);b.onData(this.connection,a)},makeServer:function(a,b){var c=this;a.bind(b.port,b.ip);c.isDebug()&&console.log("UDP: Make server, bind socket to "+b.ip+" :: "+b.port);a.on("listening",function(){var b=a.address();c.isDebug()&&console.log("\t UDP Server listening on "+b.address+":"+b.port)});a.on("message",function(a,b){c.isDebug()&&console.log("UDP: on server message "+c.connection.toString()+" - "+b.address+":"+b.port+" - "+a);c.onData(a.toString())})},connect:function(){var a=
this.options;this.port=this.options.port;this.host=this.options.host;this.protocol=this.protocolName;this._socket=m.createSocket("udp4");a=n.getJson(a.options);this._setupEventListeners(this._socket,this.delegate);this._socket.writable=!0;this.connection.connected=!0;this.delegate.onConnect2(this.connection);a&&!0===a.server&&this.makeServer(this._socket,a);return this},send:function(a,b){try{var c=this,g=n.bufferFromDecString(a),r=new Buffer(g),q=r.toString();console.log("UDP - "+c.connection.toString()+
" Sending command: "+a+" \x3d "+q+" l\x3d "+q.length);this._socket.send(r,0,r.length,this.port,this.host,function(a,b){if(a)c.delegate.onError(a)})}catch(h){console.error("crash !")}},close:function(){try{this._socket.close()}catch(a){console.error("Error closing udp connection : ",a)}}});e.options=function(a){try{var d=new f,c=b.ECIType,g=[n.createCI("ip",c.STRING,"",{group:"Network",title:"IP",description:"The ip address to bind the server."}),n.createCI("port",c.STRING,"",{group:"Network",title:"Port",
description:"The port to use when its a server"}),n.createCI("server",c.BOOL,!1,{group:"Network",title:"Make this as server.",description:""})];d.resolve(g);return d}catch(r){console.error("error",r)}return d};return e})},"nxapp/protocols/Driver":function(){define("dcl/dcl nxapp/utils nxapp/protocols/ProtocolBase dojo/node!path require xide/types nxapp/utils/_console".split(" "),function(e,p,m,n,f,b,a){m=e(m,{declaredClass:"nxapp.protocols.Driver",_socket:null,protocolName:"driver",instance:null,
constructor:function(a){p.mixin(this,a)},onError:function(d,c,g){this.isDebug()&&a.info("Driver-\x3eonError "+d+" id "+c.params.id+" src "+c.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:d,event:b.EVENTS.ON_COMMAND_ERROR,result:g.toString()},c),g)}catch(r){a.error("onFinish-Error:",r)}},onConnected:function(){this.isDebug()&&a.log("# driver onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.connection.connected=!0;this.delegate.onConnect2(this.connection)},
onConnect:function(){this._socket.onConnect&&this._socket.onConnect()},onFinish:function(d,c,g){this.isDebug()&&a.info("Driver-\x3eonFinish "+d+" id "+c.params.id+" src "+c.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:d,event:b.EVENTS.ON_COMMAND_FINISH,result:g.toString()},c),g)}catch(r){a.error("onFinish-Error:",r)}},onProgress:function(d,c,g){this.isDebug()&&a.info("Driver-\x3eonProgress "+d+" id "+c.params.id+" src "+c.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:d,
event:b.EVENTS.ON_COMMAND_PROGRESS,result:g.toString()},c),g)}catch(r){a.error("onFinish-Progress:",r)}},onPaused:function(d,c,g){this.isDebug()&&a.info("Driver-\x3eonPaused "+d+" id "+c.params.id+" src "+c.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:d,event:b.EVENTS.ON_COMMAND_PAUSED,result:g.toString()},c),g)}catch(r){a.error("onFinish-Paused:",r)}},onStopped:function(d,c,g){this.isDebug()&&a.info("Driver-\x3eonStopped "+d+" id "+c.params.id+" src "+c.params.src);try{this.delegate.onData(this.connection,
p.mixin({cmd:d,event:b.EVENTS.ON_COMMAND_STOPPED,result:g.toString()},c),g)}catch(r){a.error("onFinish-Stopped:",r)}},_connect:function(b,c,g){b=new b(c);b.owner=this;b.options=this.options;b.delegate=this.delegate;b.connection=this.connection;this.modulePath=b.modulePath=g;b.connect||a.error("have no connect");this._socket=b;this._socket.writable=!0;b.connect()},onDeviceDisconnected:function(a){this.delegate.onClose(this.connection,this.options)},onData:function(b,c){this.isDebug()&&a.log("Driver on data : ");
c=c||new Buffer(b);this.delegate.onData(this.connection,b,c);this._socket&&this._socket.onData&&this._socket.onData(this.connection,b,c)},connect:function(){var b=this.options;this.isDebug()&&a.log("connect custom driver");if(!b||!b.driver)return a.error("no driver in options",b),this;try{var c=b[b.driverScope],g=c+"/"+b.driver,g=p.replaceAll("/",n.sep,g);this.isDebug()&&a.log("load driver : "+g+" drivers root : "+c+" from "+n.dirname(g));var r=this;try{f.undef||a.error("require has no undef"),f.undef&&
f.undef(g),f([g],function(c){if("function"!==typeof c)r.close(),r.onDeviceDisconnected();else try{r._connect?r._connect(c,b,g):a.error("have no _connect")}catch(k){a.error("error calling connect on "+g+" | Error "+k.message,k)}})}catch(q){a.error("-----error loading driver module at drivers root "+c+" and module "+b.driver+" :: "+q.message,q.stack)}}catch(h){a.error("Error connecting driver "+h.message)}return this},send:function(b,c){b?(this.isDebug()&&a.log("send : ",b),this._socket.write(b,c)):
a.error("TCP : invalid command")},close:function(){this._socket&&this._socket.destroy&&this._socket.destroy()}});e.chainAfter(m,"close");e.chainAfter(m,"destroy");return m})},"nxapp/protocols/SSH":function(){define("dcl/dcl xide/utils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!fs dojo/node!path dojo/node!ssh2 dojo/node!strip-ansi dojo/node!child_process dojo/node!util dojo/node!deferred dojo/node!ansi-to-html dojo/node!ansi_up nxapp/utils/_console xide/encoding/MD5 dojo/Deferred".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r,q,h,l,k,t,w){var u=!1;e=e(n,{declaredClass:"nxapp.protocols.SSH",_socket:null,protocolName:"ssh",instance:null,sshOptions:null,running:null,getOptions:function(c,h,d){var g=null;if(d.privateKeyPath){var l=a.resolve(d.privateKeyPath);l?g=b.readFileSync(l).toString():u||this.isDebug()&&k.warn("Sorry, cant resolve file "+d.privateKeyPath)}c={config:!1,host:c,username:d.username,password:d.password,agent:"",agentForward:!1,port:h,proxy:{port:h},ignoreErrors:!1,minimatch:{},
debug:u||this.isDebug()?function(a){k.log("SSH _ DEBUG : "+a)}:null,suppressRemoteErrors:!1,callback:function(){}};g&&(c.privateKey=g);return p.mixin(c,d)},onConnected:function(){u||this.isDebug()&&k.log("# "+this.protocolName+" - Protocol:: onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.connection.connected=!0;this.delegate.onConnect2(this.connection)},onError:function(a,b){this.delegate.onError(this.connection,p.mixin({code:a},b),this.options)},onClose:function(){this.delegate.onClose(this.connection,
this.options)},connect:function(){var a=this.options,b=this;if(!a||!a.driver)return u||b.isDebug()&&k.error("no driver in options",a),this;var c=a.host,h=a.port,a=p.getJson(a.options);!0===a.debug&&(u=!0);var g=this.getOptions(c,h,a),a=function(a){var b={host:a.host,port:a.port,username:a.username,readyTimeout:a.readyTimeout,agentForward:a.agentForward};a.privateKey?(b.privateKey=a.privateKey.trim(),a.passphrase&&(b.passphrase=a.passphrase.trim())):a.password?(b.password=a.password,a.agent&&(b.agent=
a.agent)):b.agent=a.agent;return b}(g);this.sshOptions=g;this.host=c;this.port=h;this.protocol=this.protocolName;u||b.isDebug()&&k.log("SSH-\x3econnecting SSH with");var l=new d;l.on("keyboard-interactive",function(a,b,c,k,h){k.forEach(function(a){-1!==a.prompt.toLowerCase().indexOf("password")&&h([g.password])})});l.on("connect",function(){u||b.isDebug()&&k.log("SSH-\x3eConnection :: connect")});l.on("ready",function(){u||b.isDebug()&&k.log("SSH-\x3eConnection :: ready");var a,c,h;l.once("session",
function(d,g){d().once("pty",function(b,d,g){a=g.rows;c=g.cols;h=g.term;b&&b();u&&k.log("SSH-\x3e pty "+a+" "+c+" "+h)}).once("shell",function(a,c){u||b.isDebug()&&k.log("SSH-\x3eshell")})});b.onConnected()});l.on("error",function(a){u||b.isDebug()&&k.warn("SSH-\x3eConnection - Error :: "+a);a=a.level+":"+a.message;b.onError(a);b.lastError=a});l.on("debug",function(a){u||b.isDebug()&&k.log("SSH-\x3eConnection :: debug :: "+a)});l.on("end",function(){u||b.isDebug()&&k.log("SSH-\x3eConnection :: end");
b.onClose()});l.on("close",function(a){if(a)u||b.isDebug()&&k.log("SSH - Connection :: Close, had Error ");else b.onClose()});try{l.connect(a)}catch(q){u||b.isDebug()&&k.warn("SSH-\x3eConnection - Error :: "+q);b.onError("fatal:"+q.message);return}this._socket=l;this._socket.writable=!0;return this},onData:function(a,b){this.isDebug()&&k.log("SSH-\x3eonData",a);this.delegate.onData(this.connection,a||"",b)},onProgress:function(a,b,c){this.isDebug()&&k.info("SSH-\x3eonProgress "+a+" id "+b.params.id+
" src "+b.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:m.EVENTS.ON_COMMAND_PROGRESS,result:c.toString()},b),c)}catch(h){k.error("onFinish-Progress:",h)}},onCommandError:function(a,b,c){u||this.isDebug()&&k.log("SSH-\x3eonCommandError "+a+" id "+b.params.id+" src "+b.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:m.EVENTS.ON_COMMAND_ERROR},b),c)}catch(h){k.error("---",h)}},onFinish:function(a,b,c){u||this.isDebug()&&k.info("SSH-\x3eonFinish "+
a+" id "+b.params.id+" src "+b.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:m.EVENTS.ON_COMMAND_FINISH},b),c)}catch(h){k.error("onFinish-Error:",h)}},_addCommand:function(a){t(JSON.stringify(a.join(",")),1)},execCommand:function(a,b){var c=this._socket,d=this,g=d.sshOptions,r=q(),f=b.params,t=f.id,e=f.wait,n=new h(g.ansiOptions||{}),w=1==g.waitForEOF,m="";if(0===a.length)d.isDebug()&&k.log("SSH-\x3eno more SSH commands, call Defered::resolve");else{var p=a.shift();d.isDebug()&&
k.log("SSH-\x3eExecuting :: "+p,b.params);c.exec(p,g,function(c,h){if(c)u||d.isDebug()&&k.log("---error in SSH ",c);else{var q;h.on("data",function(a,c){q=String(a);!0!==g.ansiUp&&1==g.html?q=n.toHtml(q):1==g.ansiUp&&1==g.html&&(q=l.ansi_to_html(q));d.isDebug()&&k.log("SSH DATA : signal \x3d "+c+" : "+q);if("stderr"!==c)if(w)m+=q,h.lastData=m;else{if(e)d.onProgress(p,b,a);else d.onData(q,a);h.lastData=q}});h.on("end",function(a){u||d.isDebug()&&k.log("SSH-\x3eStream :: EOF, had Error "+(1==h.hadError));
q&&"function"===typeof g.callback&&g.callback(q.trim());!0!==h.hadError?(w&&(u||d.isDebug()&&k.error("--------------release data on EOF"),d.onData(h.lastData)),r.resolve(t)):r.reject({id:t,error:h.lastData})});h.on("exit",function(){u||d.isDebug()&&k.log("SSH-\x3eStream :: exit")});h.on("close",function(c,l){u||d.isDebug()&&k.log("SSH-\x3eStream :: close :: code: "+c+", signal: "+l);127==c&&(h.hadError=!0,r.reject({id:t,error:h.lastData}));g.ignoreErrors||0===c?d.execCommand(a,b):(u||d.isDebug()&&
k.error("SSH-\x3eError executing task "+p+" _ code "+c),d.onCommandError(p,b))})}})}return r.promise},send:function(a,b){u||this.isDebug()&&k.log("send : "+a,b.params);if(null==a)k.error("SSH: invalid command");else{b=b||{id:p.createUUID()};a=this.toString(a);u||this.isDebug()&&k.log("SSH-\x3esend : "+a);var c=this.execCommand([a],b),h=this;c.then(function(c){h.onFinish(a,b)},function(c){b.error=c.error;h.onCommandError(a,b)});return c}},close:function(){this._socket&&this._socket.end()},init:function(){this.running=
{}}});e.options=function(a){try{var b=new w,c=m.ECIType,h=[p.createCI("username",c.STRING,"",{group:"Network",title:"User name"}),p.createCI("password",c.STRING,"",{group:"Network",title:"Password",password:!0}),p.createCI("localhostName",c.STRING,"",{group:"Network",title:"Local host name",description:"Along with localUsername and privateKey, set this to a non-empty string for hostbased user authentication"}),p.createCI("tryKeyboard",c.BOOL,!1,{group:"Network",title:"Try keyboard",description:"ry keyboard-interactive user authentication if primary user authentication method fails. If you set this to true"}),
p.createCI("keepaliveInterval",c.INTEGER,0,{group:"Network",title:" Keep alive interval",description:"How often (in milliseconds) to send SSH-level keepalive packets to the server (in a similar way as OpenSSH's ServerAliveInterval config option). Set to 0 to disable."}),p.createCI("keepaliveCountMax",c.INTEGER,3,{group:"Network",title:"Keep alive count maximum",description:" How many consecutive, unanswered SSH-level keepalive packets that can be sent to the server before disconnection (similar to OpenSSH's ServerAliveCountMax config option)."}),
p.createCI("readyTimeout",c.INTEGER,2E4,{group:"Network",title:"Ready timeout",description:"How long (in milliseconds) to wait for the SSH handshake to complete."}),p.createCI("strictVendor",c.BOOL,!0,{group:"Network",title:"Strict vendor",description:"Performs a strict server vendor check before sending vendor-specific requests, etc. (e.g. check for OpenSSH server when using openssh_noMoreSessions()"})];b.resolve(h);return b}catch(d){k.error("error",d)}return b};return e})},"nxapp/protocols/Serial":function(){define("dcl/dcl xide/utils xide/utils/StringUtils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!child_process dojo/node!util nxapp/utils/_console xdojo/has dojo/node!xcf-server-misc/serialport dojo/Deferred".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r){var q=!1;e=e(f,{declaredClass:"nxapp.protocols.Serial",_socket:null,protocolName:"serial",instance:null,client:null,sshOptions:null,getOptions:function(a,b,c,d){return p.mixin({baudrate:9600,parity:"none",rtscts:!1,xon:!1,xoff:!1,xany:!1,hupcl:!0,cts:!1,dtr:!0,dts:!1,brk:!1,rts:!1,databits:8,stopbits:1,bufferSize:65536},c)},onConnected:function(){this.connection.connected=!0;this.delegate.onConnect2(this.connection)},onError:function(a,b){this.delegate.onError(this.connection,
p.mixin({code:a},b),this.options)},onClose:function(){this.delegate.onClose(this.connection,this.options)},connect:function(){try{g||(d.warn("serial port was not loaded!"),g=global.nRequire("serialport"),d.warn("got serial port : "+(null!=g)))}catch(a){d.error("cant load serial port",a)}if(!g||!g.parsers)return d.error('----heavy error! It seems that node-js module "serial-port" has not been installed correctly '+c("serialport")),this.onError('----heavy error! It seems that node-js module "serial-port" has not been installed correctly '+
c("serialport"),g);if(!c("serialport"))return d.error("have no serial port flag enabled, abort!"),this.onError("have serial no port");try{var b=this.options;if(!c("serialport"))return this.onError("have serial port");if(!b||!b.driver)return this;var k=this,r=b.host,f=b.port,e=p.getJson(b.options||{});!0===e.debug&&(q=!0);var n=this.getOptions(r,f,e,(b.responseSettings||{}).delimiter);this.serialOptions=n;this.protocol=this.protocolName;var v=new g(r,n);this.client=v;v.on("error",function(a){k.onError(a.toString(),
a)});try{v.on("open",function(a){if(a){var b=a.level+":"+a.message;k.onError(b);k.lastError=b;k.isDebug()&&d.warn("Serial-\x3eConnection - Error :: "+r+":"+a)}else k.onConnected(),v.on("data",function(a){k.isDebug()&&d.log("Serial-\x3eonData "+a.toString());k.onData(a.toString(),a)})})}catch(m){this.isDebug()&&d.error("Serial-\x3econnect error :: code: ",m)}v.on("close",function(a){try{k.isDebug()&&d.log("Serial-\x3eclose :: code: ",a),k.onClose(),v.close()}catch(b){k.isDebug()&&d.error("Serial-\x3eclose :: code: ",
b)}});this._socket={};this._socket.writable=!0;return this}catch(D){return this.isDebug()&&d.error("error connection serial ",D),k.onError(D.message),d.trace(),this}},onData:function(a,b){this.delegate.onData(this.connection,a,b)},onCommandError:function(a,b){q||this.isDebug()&&d.log("SERIAL-\x3eCommandError "+a+" id "+b.id+" src "+b.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:n.EVENTS.ON_COMMAND_ERROR},b))}catch(c){d.error("---",c)}},onFinish:function(a,b){q||this.isDebug()&&
d.log("SERIAL-\x3eonFinish "+a+" id "+b.id+" src "+b.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:n.EVENTS.ON_COMMAND_FINISH},b))}catch(c){d.error("onFinish-Error:",c)}},send:function(a,b){if(null==a)d.error("SERIAL invalid command");else{b||p.createUUID();var c=p.bufferFromDecString(a),c=new Buffer(c),g=c.toString();this.isDebug()&&d.log("Serial - Sending command: "+a+" \x3d "+g+" l\x3d "+g.length);this.client.write(c)}},close:function(){this.client&&this.client.close()}});
e.ls=function(a){var b=new r;g?g.list(function(a,c){c=c.filter(function(a){return!0});c=_.map(c,function(a){return{host:a.comName,port:"",description:a.manufacturer,id:a.pnpId}});b.resolve(c)}):(d.error("have no serial port"),b.reject("serialport nodejs library not present"));return b};e.options=function(a){try{a=function(a,b){return{label:a,value:a||b}};var b=new r,c=n.ECIType,g=[p.createCI(n.DEVICE_PROPERTY.CF_DEVICE_PORT,c.STRING,"",{group:"Network",disabled:!0}),p.createCI("baudrate",c.ENUMERATION,
115200,{group:"Network",title:"Baud rate",options:[a(115200),a(115200),a(57600),a(38400),a(19200),a(9600),a(4800),a(2400),a(1800),a(1200),a(600),a(300),a(200),a(150),a(134),a(110),a(75),a(50)]}),p.createCI("databits",c.ENUMERATION,8,{group:"Network",title:"Data bits",options:[a(8),a(7),a(6),a(5)]}),p.createCI("stopbits",c.ENUMERATION,1,{group:"Network",title:"Stop bits",options:[a(1),a(2)]}),p.createCI("parity",c.ENUMERATION,"none",{group:"Network",title:"Parity",options:[a("none"),a("even"),a("mark"),
a("odd"),a("space")]}),p.createCI("rtscts",c.BOOL,!1,{group:"Network"}),p.createCI("xon",c.BOOL,!1,{group:"Network"}),p.createCI("xoff",c.BOOL,!1,{group:"Network"}),p.createCI("flowcontrol",c.BOOL,!0,{group:"Network"}),p.createCI("buffersize",c.INTEGER,65536,{group:"Network"})];b.resolve(g);return b}catch(q){d.error("error",q)}return b};return e})},"xide/utils/StringUtils":function(){define(["xide/utils","xide/types","dojo/json","xide/lodash"],function(e,p,m,n){function f(b,a){var d=[],c=[];null==
a&&(a=function(a,b){return d[0]===b?"[Circular ~]":"[Circular ~."+c.slice(0,d.indexOf(b)).join(".")+"]"});return function(g,r){if(0<d.length){var q=d.indexOf(this);~q?d.splice(q+1):d.push(this);~q?c.splice(q,Infinity,g):c.push(g);~d.indexOf(r)&&(r=a.call(this,g,r))}else d.push(r);return null==b?r:b.call(this,g,r)}}e.stringify=function(b){return JSON.stringify(b,f(),2)};e.round=function(b,a,d){if("number"!==typeof b||isNaN(b)||Infinity===b||-Infinity===b)return"";a="undefined"===typeof a?3:parseInt(a,
10)||0;var c=Math.pow(10,a);b=(Math.round(b*c)/c).toFixed(a);d||(b=""+ +b);return b};e.humanFileSize=function(b,a){var d=a?1E3:1024;if(Math.abs(b)<d)return b+" B";var c=a?"kB MB GB TB PB EB ZB YB".split(" "):"KiB MiB GiB TiB PiB EiB ZiB YiB".split(" "),g=-1;do b/=d,++g;while(Math.abs(b)>=d&&g<c.length-1);return b.toFixed(1)+" "+c[g]};"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(b){return 0===this.indexOf(b)});"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=
function(b){return this.substring(this.length-b.length,this.length)===b});e.isNativeEvent=function(b){var a={onclick:null,ondblclick:null,onmousedown:null,onmouseup:null,onmouseover:null,onmousemove:null,onmouseout:null,onkeypress:null,onkeydown:null,onkeyup:null,onfocus:null,onblur:null,onchange:null};if(b in a)return!0;a={click:null,dblclick:null,mousedown:null,mouseup:null,mouseover:null,mousemove:null,mouseout:null,keypress:null,keydown:null,keyup:null,focus:null,blur:null,change:null};return b in
a};e.isSystemEvent=function(b){for(var a in p.EVENTS)if(p.EVENTS[a]===b)return!0;return!1};e.contains=function(b,a){for(var d=0;d<b.length;d++)if(b[d]===a)return d;return-1};e.getObjectKeyByValue=function(b,a){if(b&&a)for(var d in b)if(b.hasOwnProperty(d)&&b[d]===a)return d;return null};e.removeURLParameter=function(b,a){var d=b.split("?");if(2<=d.length){for(var c=encodeURIComponent(a)+"\x3d",g=d[1].split(/[&;]/g),r=g.length;0<r--;)-1!==g[r].lastIndexOf(c,0)&&g.splice(r,1);b=d[0]+"?"+g.join("\x26")}return b};
e.replaceUrlParam=function(b,a,d){if(-1==b.indexOf(a))return b+=(0<b.indexOf("?")?"\x26":"?")+a+"\x3d"+d;var c=b.replace(new RegExp("("+a+"\x3d).*?(\x26|$)"),"$1"+d+"$2");c==b&&(c=c+(0<c.indexOf("?")?"\x26":"?")+a+"\x3d"+d);return c};e.buildPath=function(b,a,d){var c=""+b,c=e.replaceAll("/","",b);b=(""+a).replace("./","/").replace(/^\/|\/$/g,"");c=c+"://"+b;return!0===d?encodeURIComponent(c):c};e.isImage=function(b){return null!=b.toLowerCase().match(/\.(jpeg|jpg|gif|png)$/)};e.hasFlag3=function(b,
a){return 1<<a&b?!0:!1};e.hasFlag=function(b,a){return 1<<a&b?!0:!1};e.disableFlag=function(b,a){return b&~(1<<a)};e.cleanUrl=function(b){b&&(b=b.replace("//","/"),b=b.replace("./","/"),b=b.replace("http:/","http://"),b=b.replace("./","/"),b=b.replace("////","/"),b=b.replace("///","/"));return b};e.getJson=function(b,a,d){try{return n.isString(b)?m.parse(b,!1):!0===a?null:b}catch(c){!1!==d&&console.error("error parsing json data "+b+" error \x3d "+c)}return null};e.fromJson=function(b){if(!n.isString(b))return b;
var a=null,d=!1;try{a=eval("("+b+")",{})}catch(c){d=!0}if(d){b=b.substring(b.indexOf("{"),b.lastIndexOf("}")+1);try{a=eval("("+b+")",{})}catch(g){throw Error(b);}}return a};e.replaceAll=function(b,a,d){return d?d.split(b).join(a):""};e.isValidString=function(b){return null!=b&&null!=b.length&&0<b.length&&"undefined"!=b};e.substituteString=function(b,a){return b.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(b,c){return a[c]})};e.findOcurrences=function(b,a){var d=e.escapeRegExp(a.begin),
c=e.escapeRegExp(a.end);return b.match(new RegExp(d+"([^"+c+"]*)"+c,"g"))};e.escapeRegExp=function(b){for(var a="[ ] ( ) { } * + . | ||".split(" "),d=0;d<a.length;d++)b=b.replace(a[d],"\\"+a[d]);return b};e.multipleReplace=function(b,a){var d=[],c;for(c in a)d[d.length]=c;return b.replace(new RegExp(d.join("\\b|\\b"),"g"),function(b){return a[b]||a["\\"+b]})};e.replace=function(b,a,d,c){if(!b)return"";if(d&&n.isObject(d)||n.isArray(d)){if(c){a=e.findOcurrences(b,c);var g=e.replaceAll;if(a)for(var r=
0,q=a.length;r<q;r++){var h=a[r],l=g(c.begin,"",h),l=g(c.end,"",l);b=g(h,d[l],b)}}else return e.multipleReplace(b,d);return b}return e.replaceAll(a,d,b)};e.capitalize=function(b){return b.substring(0,1).toUpperCase()+b.substring(1)};e.vsprintf=function(b,a){return e.sprintf.apply(this,[b].concat(a))};e.sprintf=function(){var b=arguments,a=0,d=function(a,b,c,d){c||(c=" ");b=a.length>=b?"":Array(1+b-a.length>>>0).join(c);return d?a+b:b+a},c=function(a,b,c,g,k,f){var e=g-a.length;0<e&&(a=c||!k?d(a,g,
f,c):a.slice(0,b.length)+d("",e,"0",!0)+a.slice(b.length));return a},g=function(a,b,h,g,k,f,e){a>>>=0;h=h&&a&&{2:"0b",8:"0",16:"0x"}[b]||"";a=h+d(a.toString(b),f||0,"0",!1);return c(a,h,g,k,e)};return b[a++].replace(/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,function(f,q,h,l,k,t,e){var n,m;if("%%"===f)return"%";var v=!1;m="";var p=k=!1;n=" ";for(var D=h.length,A=0;h&&A<D;A++)switch(h.charAt(A)){case " ":m=" ";break;case "+":m="+";break;case "-":v=!0;break;
case "'":n=h.charAt(A+1);break;case "0":k=!0;break;case "#":p=!0}l=l?"*"===l?+b[a++]:"*"==l.charAt(0)?+b[l.slice(1,-1)]:+l:0;0>l&&(l=-l,v=!0);if(!isFinite(l))throw Error("sprintf: (minimum-)width must be finite");t=t?"*"===t?+b[a++]:"*"==t.charAt(0)?+b[t.slice(1,-1)]:+t:-1<"fFeE".indexOf(e)?6:"d"===e?0:void 0;q=q?b[q.slice(0,-1)]:b[a++];switch(e){case "s":return e=String(q),null!=t&&(e=e.slice(0,t)),c(e,"",v,l,k,n);case "c":return e=String.fromCharCode(+q),null!=t&&(e=e.slice(0,t)),c(e,"",v,l,k,void 0);
case "b":return g(q,2,p,v,l,t,k);case "o":return g(q,8,p,v,l,t,k);case "x":return g(q,16,p,v,l,t,k);case "X":return g(q,16,p,v,l,t,k).toUpperCase();case "u":return g(q,10,p,v,l,t,k);case "i":case "d":return n=+q||0,n=Math.round(n-n%1),f=0>n?"-":m,q=f+d(String(Math.abs(n)),t,"0",!1),c(q,f,v,l,k);case "e":case "E":case "f":case "F":case "g":case "G":return n=+q,f=0>n?"-":m,m=["toExponential","toFixed","toPrecision"]["efg".indexOf(e.toLowerCase())],e=["toString","toUpperCase"]["eEfFgG".indexOf(e)%2],
q=f+Math.abs(n)[m](t),c(q,f,v,l,k)[e]();default:return f}})};e.cleanString=function(b){return b?b=b.replace(/[\r]/g,"").replace(/[\b]/g,"").replace(/[\f]/g,"").replace(/[\n]/g,"").replace(/\\/g,""):null};e.normalizePath=function(b){if(!b)return null;b=e.cleanString(b);b=b.replace("./","");b=b.replace("/.","");return b=b.replace(/([^:]\/)\/+/g,"$1")};p.PATH_PARTS={DIRNAME:1,BASENAME:2,EXTENSION:4,FILENAME:8,PATHINFO_ALL:0};e.basename=function(b,a){var d=b,c=d.charAt(d.length-1);if("/"===c||"\\"===
c)d=d.slice(0,-1);d=d.replace(/^.*[\/\\]/g,"");"string"===typeof a&&d.substr(d.length-a.length)==a&&(d=d.substr(0,d.length-a.length));return d};e.pathinfo=function(b,a){var d="",c="",g="",f=0,q={},h=0,l=0,k=h=!1,t=!1;if(!b)return!1;a||(a="PATHINFO_ALL");var n={PATHINFO_DIRNAME:1,PATHINFO_BASENAME:2,PATHINFO_EXTENSION:4,PATHINFO_FILENAME:8,PATHINFO_ALL:0};for(g in n)n.hasOwnProperty(g)&&(n.PATHINFO_ALL|=n[g]);if("number"!==typeof a){a=[].concat(a);for(l=0;l<a.length;l++)n[a[l]]&&(f|=n[a[l]]);a=f}g=
function(a){a+="";var b=a.lastIndexOf(".")+1;return b?b!==a.length?a.substr(b):"":!1};a&n.PATHINFO_DIRNAME&&(f=b.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,""),q.dirname=f===b?".":f);a&n.PATHINFO_BASENAME&&(!1===h&&(h=e.basename(b)),q.basename=h);a&n.PATHINFO_EXTENSION&&(!1===h&&(h=e.basename(b)),!1===k&&(k=g(h)),!1!==k&&(q.extension=k));a&n.PATHINFO_FILENAME&&(!1===h&&(h=e.basename(b)),!1===k&&(k=g(h)),!1===t&&(t=h.slice(0,h.length-(k?k.length+1:!1===k?0:1))),q.filename=t);h=0;for(d in q)q.hasOwnProperty(d)&&
(h++,c=d);return 1===h?q[c]:q};e.parse_url=function(b,a){var d;d="source scheme authority userInfo user pass host port relative path directory file query fragment".split(" ");for(var c=this.php_js&&this.php_js.ini||{},g=c["phpjs.parse_url.mode"]&&c["phpjs.parse_url.mode"].local_value||"php",f={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,
loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},f=f[g].exec(b),q={},h=14;h--;)f[h]&&(q[d[h]]=f[h]);if(a)return q[a.replace("PHP_URL_","").toLowerCase()];if("php"!==g){var l=c["phpjs.parse_url.queryKey"]&&c["phpjs.parse_url.queryKey"].local_value||"queryKey",f=/(?:^|&)([^&=]*)=?([^&]*)/g;q[l]={};d=q[d[12]]||"";d.replace(f,function(a,b,c){b&&(q[l][b]=
c)})}delete q.source;return q};e.getMimeTable=function(){return{}};e.getMimeTable2=function(){return{mid:"fa-file-audio-o",txt:"fa-file-text-o",sql:"fa-cube",js:"fa-cube",gif:"fa-file-picture-o",jpg:"fa-file-picture-o",html:"fa-cube",htm:"fa-cube",rar:"fa-file-zip-o",gz:"fa-file-zip-o",tgz:"fa-file-zip-o",z:"fa-file-zip-o",ra:"fa-file-movie-o",ram:"fa-file-movie-o",rm:"fa-file-movie-o",pl:"source_pl.png",zip:"fa-file-zip-o",wav:"fa-file-audio-o",php:"fa-cube",php3:"fa-cube",phtml:"fa-cube",exe:"fa-file-o",
bmp:"fa-file-picture-o",png:"fa-file-picture-o",css:"fa-cube",mp3:"fa-file-audio-o",m4a:"fa-file-audio-o",aac:"fa-file-audio-o",xls:"fa-file-excel-o",xlsx:"fa-file-excel-o",ods:"fa-file-excel-o",sxc:"fa-file-excel-o",csv:"fa-file-excel-o",tsv:"fa-file-excel-o",doc:"fa-file-word-o",docx:"fa-file-word-o",odt:"fa-file-word-o",swx:"fa-file-word-o",rtf:"fa-file-word-o",md:"fa-file-word-o",ppt:"fa-file-powerpoint-o",pps:"fa-file-powerpoint-o",odp:"fa-file-powerpoint-o",sxi:"fa-file-powerpoint-o",pdf:"fa-file-pdf-o",
mov:"fa-file-movie-o",avi:"fa-file-movie-o",mpg:"fa-file-movie-o",mpeg:"fa-file-movie-o",mp4:"fa-file-movie-o",m4v:"fa-file-movie-o",ogv:"fa-file-movie-o",webm:"fa-file-movie-o",wmv:"fa-file-movie-o",swf:"fa-file-movie-o",flv:"fa-file-movie-o",tiff:"fa-file-picture-o",tif:"fa-file-picture-o",svg:"fa-file-picture-o",psd:"fa-file-picture-o",ers:"horo.png"}};e.getIconTable=function(){return{}};e.urlDecode=function(b,a){if(!b||!b.length)return{};for(var d={},c=b.split("\x26"),g,f,q=0,h=c.length;q<h;q++)g=
c[q].split("\x3d"),f=decodeURIComponent(g[0]),g=decodeURIComponent(g[1]),null!=g&&"true"===g?g=!0:"false"===g&&(g=!1),!0!==a?"undefined"==typeof d[f]?d[f]=g:("string"==typeof d[f]&&(d[f]=[d[f]]),d[f].push(g)):d[f]=g;return d};e.getUrlArgs=function(b){var a={};if(b&&(-1!=b.indexOf("?")||-1!=b.indexOf("\x26"))){b=(b.substr(b.indexOf("?")+1)||location.search.substring(1)).split("\x26");for(var d=0;d<b.length;d++){var c=b[d].indexOf("\x3d"),g=b[d].substring(0,c),c=b[d].substring(c+1),c=decodeURIComponent(c);
a[g]=c}}return a};e.urlArgs=function(b){b=e.getUrlArgs(b);var a={},d;for(d in b){var c=b[d],g=e.findOcurrences(c,{begin:"|",end:"|"}),f=null;if(g&&g.length)for(var c=c.replace(g[0],""),g=g[0].substr(1,g[0].length-2).split(","),f={},q=0;q<g.length;q++){var h=g[q].split(":");f[h[0]]=h[1]}c&&c.length&&(a[d]={value:c,options:f})}return a};e.getIcon=function(b){if(!b)return"txt2.png";if(b=e.getFileExtension(b)){var a=e.getMimeTable();if(null!=a[b])return a[b]}return"txt2.png"};e.getIconClass=function(b){if(!b)return"fa-file-o";
b=e.getFileExtension(b);if(p.customMimeIcons[b])return p.customMimeIcons[b];if(b){var a=e.getMimeTable2();if(null!=a[b])return a[b]}return"fa-file-o"};e.getFileExtension=function(b){if(!b||""==b)return"";b=e.getBaseName(b).split(".");return 1<b.length?b[b.length-1].toLowerCase():""};e.createUUID=function(){var b=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()};e.getBaseName=function(b){if(null==b)return null;var a="/";
-1!==b.indexOf("\\")&&(a="\\");return b.substr(b.lastIndexOf(a)+1,b.length)};e.basename=function(b,a){var d=b,c=d.charAt(d.length-1);if("/"===c||"\\"===c)d=d.slice(0,-1);d=d.replace(/^.*[\/\\]/g,"");"string"===typeof a&&d.substr(d.length-a.length)===a&&(d=d.substr(0,d.length-a.length));return d};e.pathinfo=function(b,a){var d=e.basename,c="",g="",f="",q=0,h={},l=0,k=0,t=l=!1,n=!1;if(!b)return!1;a||(a="PATHINFO_ALL");var u={PATHINFO_DIRNAME:1,PATHINFO_BASENAME:2,PATHINFO_EXTENSION:4,PATHINFO_FILENAME:8,
PATHINFO_ALL:0};for(f in u)u.hasOwnProperty(f)&&(u.PATHINFO_ALL|=u[f]);if("number"!==typeof a){a=[].concat(a);for(k=0;k<a.length;k++)u[a[k]]&&(q|=u[a[k]]);a=q}f=function(a){a+="";var b=a.lastIndexOf(".")+1;return b?b!==a.length?a.substr(b):"":!1};a&u.PATHINFO_DIRNAME&&(q=b.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,""),h.dirname=q===b?".":q);a&u.PATHINFO_BASENAME&&(!1===l&&(l=d(b)),h.basename=l);a&u.PATHINFO_EXTENSION&&(!1===l&&(l=d(b)),!1===t&&(t=f(l)),!1!==t&&(h.extension=t));a&u.PATHINFO_FILENAME&&
(!1===l&&(l=d(b)),!1===t&&(t=f(l)),!1===n&&(n=l.slice(0,l.length-(t?t.length+1:!1===t?0:1))),h.filename=n);l=0;for(c in h)h.hasOwnProperty(c)&&(l++,g=c);return 1===l?h[g]:h};e.strip_tags=function(b,a){a=(((a||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return b.replace(/\x3c!--[\s\S]*?--\x3e|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(b,c){return-1<a.indexOf("\x3c"+c.toLowerCase()+"\x3e")?b:""})};return e})},"nxapp/protocols/MQTT":function(){define("dcl/dcl xide/utils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!util nxapp/utils/_console dojo/node!mqtt dojo/Deferred".split(" "),
function(e,p,m,n,f,b,a,d){var c=!0;e=e(n,{declaredClass:"nxapp.protocols.MQTT",_socket:null,protocolName:"mqtt",instance:null,subscriptions:null,mqttClient:null,getOptions:function(a,b,c){return p.mixin({clean:!1,clientId:c.clientId||a+":"+b,port:b,protocol:""},c)},onConnected:function(){c&&b.log("# "+this.protocolName+" - Protocol:: onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.connection.connected=!0;this.delegate.onConnect2(this.connection)},onError:function(a,
b){this.delegate.onError(this.connection,p.mixin({code:a},b),this.options)},onClose:function(a){this.delegate.onClose(this.connection,a)},connect:function(){var d=this.options;if(!d||!d.driver)return c||this.isDebug()&&b.error("no driver in options",d),this;var f=this,q=d.host,h=d.port,d=p.getJson(d.options||{});!0===d.debug&&(c=!0);d=this.getOptions(q,h,d);this.host=q;this.port=h;this.protocol=this.protocolName;c||this.isDebug()&&b.log("MQTT-\x3econnecting to "+q+" with",d);var l=a.connect(q,d);
this.mqttClient=l;try{l.on("connect",function(a){f.onConnected()})}catch(k){c||this.isDebug()&&b.error("MQTT-\x3econnect error :: code: ",k)}l.on("close",function(a){c||f.isDebug()&&b.log("MQTT-\x3eclose :: code: ",a);f.onClose();l.end()});this._socket={};this._socket.writable=!0;return this},onData:function(a,b){this.delegate.onData(this.connection,a,b)},onCommandError:function(a,d){c||this.isDebug()&&b.log("MQTT-\x3eCommandError "+a+" id "+d.id+" src "+d.src);try{this.delegate.onData(this.connection,
p.mixin({cmd:a,event:m.EVENTS.ON_COMMAND_ERROR},d))}catch(f){b.error("---",f)}},onFinish:function(a,d,f){c||this.isDebug()&&b.log("MQTT onFinish "+a+" id "+d.id+" src "+d.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:m.EVENTS.ON_COMMAND_FINISH},d),f)}catch(h){b.error("onFinish-Error:",h)}},addSubscription:function(a,c,d){!this.subscriptions&&(this.subscriptions={});if(a){var h=this,l=""+a;if(!this.subscriptions[l]){c={qos:parseInt(c.qos)||0};this.mqttClient.subscribe(l,c);this.isDebug()&&
b.log("add subscription : "+a+" for ",f.inspect(d,{depth:null,colors:!0}));var k=this.subscriptions[l]={id:d.params.id,src:d.params.src,topic:l};this.mqttClient.on("message",function(a,c){if(a===l){var d=p.getJson(c.toString());if(_.isArray(d))h.onData(p.mixin({payload:d,topic:a},k));else if(_.isObject(d))d.topic||(d.topic=a),h.onData(p.mixin(d,k));else if(_.isString(d)||_.isNumber(d))h.onData(p.mixin({payload:d,topic:a},k));else b.error("-unknown "+a)}})}}else b.error("invalid topic")},unSubscribeTopic:function(a,
b,c){a=p.getJson(a);(a=""+a.topic)&&this.unsubscribe(a)},subscribeTopic:function(a,b,c){a=p.getJson(a);b=p.getJson(b);c=""+a.topic;delete a.topic;this.addSubscription(c,a,b)},publishTopic:function(a,d,f){try{a=p.getJson(a);p.getJson(d);var h=""+a.topic,l=a.qos,k=a.retain;delete a.topic;delete a.qos;delete a.retain;var e=a.payload||a;if(_.isObject(e))try{e=JSON.stringify(e)}catch(n){b.error("error generating payload",n);return}this.mqttClient.publish(h,e,{qos:l,retain:k})}catch(u){c||this.isDebug()&&
b.log("---error ",u)}},send:function(a,b){},unsubscribe:function(a){a&&this.mqttClient&&this.subscriptions&&this.subscriptions[a]&&(this.mqttClient.unsubscribe(a),delete this.subscriptions[a])},close:function(){this.mqttClient&&(_.each(this.subscriptions,this.unsubscribe,this),this.mqttClient.end(),this.mqttClient=null)}});e.options=function(a){try{var c=new d,f=m.ECIType,h=[p.createCI("clientId",f.STRING,"",{group:"Network",title:"Client id",description:"mqttjs_' + Math.random().toString(16).substr(2, 8)"}),
p.createCI("protocolVersion",f.INTEGER,4,{group:"Network",title:"Protocol id",description:""}),p.createCI("protocolId",f.STRING,"",{group:"Network",title:"Protocol id",description:""}),p.createCI("username",f.STRING,"",{group:"Network",title:"User name",description:"the username required by your broker, if any"}),p.createCI("password",f.STRING,"",{group:"Network",title:"Password",password:!0,description:"the password required by your broker, if any"}),p.createCI("keepalive",f.INTEGER,10,{group:"Network",
title:"Keep alive",description:"10 seconds, set to 0 to disable"}),p.createCI("reconnectPeriod",f.INTEGER,1E3,{group:"Network",title:"Reconnect period",description:"1000 milliseconds, interval between two re-connections"}),p.createCI("connectTimeout",f.INTEGER,3E4,{group:"Network",title:"Connect timeout",description:"30 * 1000 milliseconds, time to wait before a CONNACK is received"}),p.createCI("reschedulePings",f.BOOL,!0,{group:"Network",title:"Reschedule",description:"reschedule ping messages after sending packets"}),
p.createCI("queueQoSZero",f.BOOL,!0,{group:"Network",title:"Queue QoS Zero",description:" if connection is broken, queue outgoing QoS zero messages (default true)"}),p.createCI("clean",f.BOOL,!0,{group:"Network",title:"Clean",description:"set to false to receive QoS 1 and 2 messages while offline"})];c.resolve(h);return c}catch(l){b.error("error",l)}return c};return e})},"xide/data/_Base":function(){define("dojo/_base/declare dstore/QueryResults xide/mixins/EventedMixin xide/encoding/MD5 xdojo/has xide/lodash dojo/when dojo/Deferred".split(" "),
function(e,p,m,n,f,b,a,d){return e("xide/data/_Base",m,{__all:null,allowCache:!0,_find:function(a){a=b.filter(this.data,a);return b.isArray(a)?a:b.isObject(a)?[a]:[]},notify:function(){},_query:function(b){var g=new d;b=this.filter(b);a(b.fetch(),function(a){g.resolve(a)});return g},constructor:function(){var a=this;if(a._getQuerierFactory("filter")||a._getQuerierFactory("sort"))this.queryEngine=function(b,d){d=d||{};var h=a._getQuerierFactory("filter"),l=h?h(b):passthrough,h=a._getQuerierFactory("sort"),
k=passthrough;h&&(k=h(arrayUtil.map(d.sort,function(a){return{property:a.attribute,descending:a.descending}})));var g=passthrough;isNaN(d.start)&&isNaN(d.count)||(g=function(a){var b=d.start||0,b=a.slice(b,b+(d.count||Infinity));b.total=a.length;return b});return function(a){return g(k(l(a)))}};var b=this;a.on("add,update,delete",function(d){var f=d.type,h=d.target;b.notify("add"===f||"update"===f?h:void 0,"delete"===f||"update"===f?"id"in d?d.id:a.getIdentity(h):void 0)})},destroy:function(){this._emit("destroy",
this);_.each(this.query(),function(a){!0===a.destroyOnRemove&&a.destroy&&a.destroy()});delete this._queryCache;this._queryCache=null},refreshItem:function(a,b){this.emit("update",{target:a,property:b})},query:function(a,d,r){if(b.isEmpty(a)){var q=this;return _.map(this.data,function(a){return q.getSync(a[q.idProperty])},this)}_.some(a,function(a){return null==a});a&&n(JSON.stringify(a),1);f("xcf-ui");d=d||{};a=a||{};var h=this.filter(a),l;if(a=d.sort)if("[object Array]"===Object.prototype.toString.call(a))for(;r=
a.pop();)h=h.sort(r.attribute,r.descending);else h=h.sort(a);"start"in d&&(l=d.start||0,l=h[h.fetchRangeSync?"fetchRangeSync":"fetchRange"]({start:l,end:d.count?l+d.count:Infinity}),l.total=l.totalLength);l=l||new p(h[h.fetchSync?"fetchSync":"fetch"]());l.observe=function(a,b){var c=h.on("add",function(b){a(b.target,-1,b.index)}),d=h.on("update",function(c){!b&&c.previousIndex===c.index&&isFinite(c.index)||a(c.target,c.previousIndex,c.index)}),l=h.on("delete",function(b){a(b.target,b.previousIndex,
-1)}),g={remove:function(){c.remove();d.remove();l.remove()}};g.cancel=g.remove;return g};f("xcf-ui");return l}})})},"dstore/QueryResults":function(){define(["dojo/_base/lang","dojo/when"],function(e,p){function m(e,f){return p(this,function(b){for(var a=0,d=b.length;a<d;a++)e.call(f,b[a],a,b)})}return function(n,f){var b=f&&"totalLength"in f;if(n.then){n=e.delegate(n);var a=n.then(function(a){var c=b?f.totalLength:a.totalLength||a.length;a.totalLength=c;return!b&&c});n.totalLength=b?f.totalLength:
a;n.response=f&&f.response}else n.totalLength=b?f.totalLength:n.length;n.forEach=m;return n}})},"xide/data/TreeMemory":function(){define(["dojo/_base/declare","xide/data/Memory","dstore/Tree","dojo/Deferred","dstore/QueryResults"],function(e,p,m,n,f){return e("xide.data.TreeMemory",[p,m],{_state:{filter:null},parentProperty:"parentId",reset:function(){this._state.filter=null;this.resetQueryLog()},resetQueryLog:function(){this.queryLog=[]},fetchRange:function(){var b=this._fetchRange(arguments);return new f(b.then(function(a){return a}),
{totalLength:b.then(function(a){return a.length})})},filter:function(b){var a=this.inherited(arguments);this._state.filter=b;return a},_fetchRange:function(b){var a=new n;b=this.fetchRangeSync(b);if(this._state.filter){if(this._state.filter.parent){var d=this.getSync(this._state.filter[this.parentProperty]);d&&(this.reset(),b={},this.getChildrenSync?b=this.getChildrenSync(d):(b[this.parentProperty]=d[this.idProperty],b=this.root.query(b)))}this._state&&this._state.filter&&this._state.filter.group&&
(this.getSync(this._state.filter.parent),d&&(this.reset(),b=d.items))}a.resolve(b);return a},getChildren:function(b){var a={};a[this.parentProperty]=this.getIdentity(b);return this.root.filter(a)},children:function(b){for(var a=this.root.data,d=[],c=0;c<a.length;c++){var g=a[c];g[this.parentProperty]==b[this.idProperty]&&d.push(g)}return a},mayHaveChildren:function(b){return!1===b._mayHaveChildren?!1:!0}})})},"xide/data/Memory":function(){define(["dojo/_base/declare","dstore/Memory","xide/data/_Base"],
function(e,p,m){return e("xide.data.Memory",[p,m],{putSync:function(e){var f=this;(e=this.inherited(arguments))&&!e._store&&Object.defineProperty(e,"_store",{get:function(){return f}});return e}})})},"dstore/Memory":function(){define("dojo/_base/declare dojo/_base/array ./Store ./Promised ./SimpleQuery ./QueryResults".split(" "),function(e,p,m,n,f,b){return e([m,n,f],{constructor:function(){this.storage.version=0},postscript:function(){this.inherited(arguments);this.setData(this.data||[])},data:null,
autoEmitEvents:!1,getSync:function(a){return this.storage.fullData[this.storage.index[a]]},putSync:function(a,b){b=b||{};var c=this.storage,g=c.index,f=c.fullData,q=this.Model;!q||a instanceof q||(a=this._restore(a));var h=this.getIdentity(a);null==h&&(this._setIdentity(a,"id"in b?b.id:Math.random()),h=this.getIdentity(a));c.version++;var c=h in g?"update":"add",q={target:a},l;if("update"===c){if(!1===b.overwrite)throw Error("Object already exists");f.splice(l=g[h],1);h=l}else h=this.defaultNewToStart?
0:f.length;var k;if("beforeId"in b){var e=b.beforeId;null===e?k=f.length:(k=g[e],l<k&&--k);void 0!==k?q.beforeId=e:(console.error("options.beforeId was specified but no corresponding index was found"),k=h)}else k=h;f.splice(k,0,a);l=isFinite(l)?Math.min(l,k):k;for(h=f.length;l<h;++l)g[this.getIdentity(f[l])]=l;this.emit(c,q);return a},addSync:function(a,b){(b=b||{}).overwrite=!1;return this.putSync(a,b)},removeSync:function(a){var b=this.storage,c=b.index,b=b.fullData;if(a in c)return c=b.splice(c[a],
1)[0],this._reindex(),!0!==this._ignoreChangeEvents&&this.emit("delete",{id:a,target:c}),!0},setData:function(a){this.parse&&(a=this.parse(a));a.items&&(this.idProperty=a.identifier||this.idProperty,a=a.items);this.storage.fullData=this.data=a;this._reindex()},_reindex:function(){for(var a=this.storage,b=a.index={},c=a.fullData,g=this.Model,f=Object.prototype,q=0,h=c.length;q<h;q++){var l=c[q];if(g&&!(l instanceof g)){var k=this._restore(l,l.__proto__===f);l!==k&&(c[q]=l=k)}b[this.getIdentity(l)]=
q}a.version++},fetchSync:function(){var a=this.data;if(!a||a._version!==this.storage.version){for(var a=this.storage.fullData,d=this.queryLog,c=0,g=d.length;c<g;c++)a=d[c].querier(a);a._version=this.storage.version;this.data=a}return new b(a)},fetchRangeSync:function(a){var d=this.fetchSync();return new b(d.slice(a.start,a.end),{totalLength:d.length})},_includePropertyInSubCollection:function(a){return"data"!==a&&this.inherited(arguments)}})})},"dstore/Store":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/has dojo/when dojo/_base/declare dstore/QueryMethod dstore/Filter dojo/Evented".split(" "),
function(e,p,m,n,f,b,a,d,c){function g(a){return function(b,c){var k=this;f(b,function(b){b={target:b};var d=c[1]||{};"beforeId"in d&&(b.beforeId=d.beforeId);k.emit(a,b)});return b}}n.add("object-proto",!!{}.__proto__&&!{}.watch);var r=n("object-proto");return b(c,{constructor:function(a){a&&b.safeMixin(this,a);this.Model&&this.Model.createSubclass&&(this.Model=this.Model.createSubclass([],{}).extend({_store:this}));this.storage=new c;var d=this;this.autoEmitEvents&&(m.after(this,"add",g("add")),
m.after(this,"put",g("update")),m.after(this,"remove",function(a,b){f(a,function(){d.emit("delete",{id:b[0]})});return a}))},autoEmitEvents:!0,idProperty:"id",queryAccessors:!0,getIdentity:function(a){return a.get?a.get(this.idProperty):a[this.idProperty]},_setIdentity:function(a,b){a.set?a.set(this.idProperty,b):a[this.idProperty]=b},forEach:function(a,b){var c=this;return f(this.fetch(),function(k){for(var d=0,g;void 0!==(g=k[d]);d++)a.call(b,g,d,c);return k})},on:function(a,b){return this.storage.on(a,
b)},emit:function(a,b){b=b||{};b.type=a;try{return this.storage.emit(a,b)}finally{return b.cancelable}},parse:null,stringify:null,Model:null,_restore:function(a,b){var c=this.Model;if(c&&a){var k=c.prototype,d=k._restore;d?a=d.call(a,c,b):r&&b?a.__proto__=k:a=e.delegate(k,a)}return a},create:function(a){return new this.Model(a)},_createSubCollection:function(a){var c=e.delegate(this.constructor.prototype),d;for(d in this)this._includePropertyInSubCollection(d,c)&&(c[d]=this[d]);return b.safeMixin(c,
a)},_includePropertyInSubCollection:function(a,b){return!(a in b)||b[a]!==this[a]},queryLog:[],filter:new a({type:"filter",normalizeArguments:function(a){var b=this.Filter;return a instanceof b?[a]:[new b(a)]}}),Filter:d,sort:new a({type:"sort",normalizeArguments:function(a,b){var c;"function"===typeof a?c=[a]:(c=a instanceof Array?a.slice():"object"===typeof a?[].slice.call(arguments):[{property:a,descending:b}],c=p.map(c,function(a){a=e.mixin({},a);a.descending=!!a.descending;return a}),c=[c]);
return c}}),select:new a({type:"select"}),_getQuerierFactory:function(a){return this["_create"+(a[0].toUpperCase()+a.substr(1))+"Querier"]}})})},"dstore/QueryMethod":function(){define([],function(){return function(e){var p=e.type,m=e.normalizeArguments,n=e.applyQuery,f=e.querierFactory;return function(){var b=Array.prototype.slice.call(arguments),a=m?m.apply(this,b):b,b={type:p,arguments:b,normalizedArguments:a},d=this._getQuerierFactory(p)||f;d&&(b.querier=d.apply(this,a));a=this._createSubCollection({queryLog:this.queryLog.concat(b)});
return n?n.call(this,a,b):a}}})},"dstore/Filter":function(){define(["dojo/_base/declare"],function(e){function p(e){return function(){var f=this.constructor,b=new f;b.type=e;b.args=Array.prototype.slice.call(arguments);return this.type?p("and").call(f.prototype,this,b):b}}function m(e){return function(){for(var f=this.constructor,b=[],a=0;a<arguments.length;a++){var d=arguments[a];b.push(d instanceof f?d:new f(d))}f=new f;f.type=e;f.args=b;this.type===e?f.args=this.args.concat(b):this.type?b.unshift(this):
1===b.length&&(f.type=b[0].type,f.args=b[0].args.slice());return f}}e=e(null,{constructor:function(e){var f=typeof e;switch(f){case "object":var f=this,b;for(b in e)var a=e[b],f=a instanceof this.constructor?f[a.type](b,a.args[0]):a&&a.test?f.match(b,a):f.eq(b,a);this.type=f.type;this.args=f.args;break;case "function":case "string":this.type=f,this.args=[e]}},and:m("and"),or:m("or"),eq:p("eq"),ne:p("ne"),lt:p("lt"),lte:p("lte"),gt:p("gt"),gte:p("gte"),contains:p("contains"),"in":p("in"),match:p("match")});
e.filterCreator=p;e.logicalOperatorCreator=m;return e})},"dstore/Promised":function(){define(["dojo/_base/declare","dojo/Deferred","./QueryResults","dojo/when"],function(e,p,m,n){function f(b,a){return function(){var d=new p;try{d.resolve(this[b].apply(this,arguments))}catch(c){d.reject(c)}return a?(d=new m(d.promise),d.totalLength=n(d.totalLength),d):d.promise}}return e(null,{get:f("getSync"),put:f("putSync"),add:f("addSync"),remove:f("removeSync"),fetch:f("fetchSync",!0),fetchRange:f("fetchRangeSync",
!0)})})},"dstore/SimpleQuery":function(){define(["dojo/_base/declare","dojo/_base/array"],function(e,p){function m(f,b){if(-1<f.indexOf(".")){var a=f.split("."),d=a.length;return function(c){for(var g=0;g<d;g++)c=c&&(b&&c.get?c.get(a[g]):c[a[g]]);return c}}return function(a){return a.get?a.get(f):a[f]}}var n={eq:function(f,b){return f===b},"in":function(f,b){return-1<p.indexOf(b.data||b,f)},ne:function(f,b){return f!==b},lt:function(f,b){return f<b},lte:function(f,b){return f<=b},gt:function(f,b){return f>
b},gte:function(f,b){return f>=b},match:function(f,b,a){return b.test(f,a)},contains:function(f,b,a,d){var c=this;return p.every(b.data||b,function(b){if("object"===typeof b&&b.type){var r=c._getFilterComparator(b.type);return p.some(f,function(f){return r.call(c,f,b.args[1],a,d)})}return-1<p.indexOf(f,b)})}};return e(null,{_createFilterQuerier:function(f){function b(g){var f=g.type;g=g.args;var q=d._getFilterComparator(f);if(q){var h=g[0],l=m(h,a),k=g[1];k&&k.fetchSync&&(k=k.fetchSync());return function(a){return q.call(d,
l(a),k,a,h)}}switch(f){case "and":case "or":for(var e=0,n=g.length;e<n;e++){var u=b(g[e]);c=c?function(a,b){return"and"===f?function(c){return a(c)&&b(c)}:function(c){return a(c)||b(c)}}(c,u):u}return c;case "function":return g[0];case "string":e=d[g[0]];if(!e)throw Error("No filter function "+g[0]+" was found in the collection");return e;case void 0:return function(){return!0};default:throw Error('Unknown filter operation "'+f+'"');}}var a=this.queryAccessors,d=this,c=b(f);return function(a){return p.filter(a,
c)}},_getFilterComparator:function(f){return n[f]||this.inherited(arguments)},_createSelectQuerier:function(f){return function(b){var a=f.length;return p.map(b,f instanceof Array?function(b){for(var c={},g=0;g<a;g++){var r=f[g];c[r]=b[r]}return c}:function(a){return a[f]})}},_createSortQuerier:function(f){var b=this.queryAccessors;return function(a){a=a.slice();a.sort("function"==typeof f?f:function(a,c){for(var g=0;g<f.length;g++){var r,q=f[g];if("function"==typeof q)r=q(a,c);else{r=q.get||(q.get=
m(q.property,b));var q=q.descending,h=r(a);r=r(c);null!=h&&(h=h.valueOf());null!=r&&(r=r.valueOf());r=h===r?0:!!q===(null===h||h>r&&null!==r)?-1:1}if(0!==r)return r}return 0});return a}}})})},"dstore/Tree":function(){define(["dojo/_base/declare"],function(e){return e(null,{constructor:function(){this.root=this},mayHaveChildren:function(e){return"hasChildren"in e?e.hasChildren:!0},getRootCollection:function(){return this.root.filter({parent:null})},getChildren:function(e){return this.root.filter({parent:this.getIdentity(e)})}})})},
"xide/data/ObservableStore":function(){define(["dojo/_base/declare","xide/mixins/EventedMixin","xide/lodash"],function(e,p,m){return e("xide/data/Observable",p,{_ignoreChangeEvents:!0,observedProperties:[],silent:function(e){if(void 0===e)return this._ignoreChangeEvents;if(!0===e||!1===e&&e!==this._ignoreChangeEvents)this._ignoreChangeEvents=e},putSync:function(e,f){this.silent(!f);var b=this.inherited(arguments),a=this;!1!==f&&this.emit("added",b);b&&!b._store&&Object.defineProperty(b,"_store",{get:function(){return a}});
this._observe(b);this.silent(!1);return b},removeSync:function(e,f){this.silent(f);var b=this.getSync(e);b&&b.onRemove&&b.onRemove();b=this.inherited(arguments);this.silent(!1);return b},_onItemChanged:function(e,f,b,a){this._ignoreChangeEvents||(f={target:e,property:f,value:b,source:a},this.emit("update",f),e.onItemChanged&&e.onItemChanged(f))},_observe:function(e){var f=this.observedProperties;e.observed&&(f=f.concat(e.observed));m.each(f,function(b){e.property&&e.property(b).observe(function(a){this._onItemChanged(e,
b,a,this)}.bind(this))}.bind(this))},setData:function(e){var f=this.inherited(arguments);this.silent(!0);e&&m.each(e,this._observe,this);this.silent(!1);return f}})})},"dstore/Trackable":function(){define("dojo/_base/lang dojo/_base/declare dojo/aspect dojo/when dojo/promise/all dojo/_base/array dojo/on".split(" "),function(e,p,m,n,f,b,a){function d(a,b,c){for(var d=a.length-1;0<=d;--d){var k=a[d],g=k.start,k=g+k.count;if(b>k){a.splice(d+1,0,{start:b,count:c-b});return}c>=g&&(b=Math.min(b,g),c=Math.max(c,
k),a.splice(d,1))}a.unshift({start:b,count:c-b})}var c=0,g={track:function(){function g(){return function(){var a=this,b=this.inherited(arguments);n(b,function(b){b=a._results=b.slice();a._partialResults&&(a._partialResults=null);a._ranges=[];d(a._ranges,0,b.length)});return b}}function f(){return function(a){var b=this,c=a.start,k=a.end,h=this.inherited(arguments);this._results||n(h,function(a){return n(a.totalLength,function(h){var g=b._partialResults||(b._partialResults=[]);k=Math.min(k,c+a.length);
g.length=h;h=[c,k-c].concat(a);g.splice.apply(g,h);d(b._ranges,c,k);return a})});return h}}function h(a,k){c++;var d=k.target;k=e.delegate(k,v[a]);n(u._results||u._partialResults,function(c){if(c){var h,g,f,q=u._ranges,e,r="id"in k?k.id:l.getIdentity(d),t=-1,n=-1,v=-1,m=-1;if("delete"===a||"update"===a)for(h=0;-1===t&&h<q.length;++h)for(e=q[h],g=e.start,f=g+e.count;g<f;++g)if(l.getIdentity(c[g])==r){t=k.previousIndex=g;n=h;c.splice(t,1);e.count--;for(g=h+1;g<q.length;++g)q[g].start--;break}if("add"===
a||"update"===a){if(z){if(z([d]).length){var w=0;f=q.length-1;g=-1;for(var p;w<=f&&-1===v;)h=w+Math.round((f-w)/2),e=q[h],n=c.slice(e.start,e.start+e.count),"beforeId"in k&&(g=null===k.beforeId?n.length:x(n,k.beforeId)),-1===g&&(g=t>=Math.max(0,e.start-1)&&t<=e.start+e.count?t:l.defaultNewToStart?0:n.length),n.splice(g,0,d),r=b.indexOf(z(n),d),p=e.start+r,0===r&&0!==e.start?f=h-1:r>=n.length-1&&p<c.length?w=h+1:(v=p,m=h);if(-1===v&&0<w&&w<q.length)var O=!0}}else{g=-1;if("beforeId"in k)if(null===k.beforeId)v=
c.length,g=q.length-1;else for(h=0,f=q.length;-1===m&&h<f;++h)e=q[h],v=x(c,k.beforeId,e.start,e.start+e.count),-1!==v&&(m=h);else"update"===a?(v=t,m=n):l.defaultNewToStart?g=v=0:(v=c.length,g=q.length-1);-1!==g&&-1===m&&(e=q[g])&&e.start<=v&&v<=e.start+e.count&&(m=g)}if(-1<v&&-1<m)for(k.index=v,c.splice(v,0,d),q[m].count++,h=m+1;h<q.length;++h)q[h].start++;else if(O)for(k.beforeIndex=q[w].start,h=w;h<q.length;++h)q[h].start++}k.totalLength=c.length}(c=u["on_tracked"+a])&&c.call(u,k)})}var l=this.store||
this,k=[],t={add:1,update:1,"delete":1},w;for(w in t)k.push(this.on(w,function(a){return function(b){h(a,b)}}(w)));var u=p.safeMixin(e.delegate(this),{_ranges:[],fetch:g(),fetchRange:f(),releaseRange:function(a,b){if(this._partialResults){a:for(var c=this._ranges,k=0,d;d=c[k];++k){var h=d.start,g=h+d.count;if(a<=h)if(b>=g)c.splice(k,1);else{d.start=b;d.count=g-d.start;break a}else if(a<g)if(b>h){c.splice(k,1,{start:h,count:a-h},{start:b,count:g-b});break a}else d.count=a-d.start}for(c=a;c<b;++c)delete this._partialResults[c]}},
on:function(b,c){var k=this,d=this.getInherited(arguments);return a.parse(u,b,c,function(a,b){return b in t?m.after(u,"on_tracked"+b,c,!0):d.call(k,b,c)})},tracking:{remove:function(){for(;0<k.length;)k.pop().remove();this.remove=function(){}}},track:null});this.fetchSync&&(p.safeMixin(u,{fetchSync:g(),fetchRangeSync:f()}),u.fetchSync());var z;b.forEach(this.queryLog,function(a){var b=z,c=a.querier;c&&(z=b?function(a){return c(b(a))}:c)});var v={add:{index:void 0},update:{previousIndex:void 0,index:void 0},
"delete":{previousIndex:void 0}},x=function(a,b,c,k){k=void 0!==k?k:a.length;for(c=void 0!==c?c:0;c<k;++c)if(l.getIdentity(a[c])===b)return c;return-1};return u}};f=p(null,g);f.create=function(a,b){a=p.safeMixin(e.delegate(a),g);p.safeMixin(a,b);return a};return f})},"xide/manager/ContextBase":function(){define("dcl/dcl xide/factory xide/types xide/utils xide/mixins/EventedMixin dojo/_base/kernel dojo/_base/lang".split(" "),function(e,p,m,n,f,b,a){f=e(f.dcl,{declaredClass:"xide.manager.ContextBase",
language:"en",managers:[],mixins:null,_getModuleDojo:function(b){return a.getObject(n.replaceAll("/",".",b))||a.getObject(b)},_getModuleDcl:function(a){return e.getObject?e.getObject(a)||e.getObject(n.replaceAll("/",".",a)):null},getModule:function(a){return this._getModuleDojo(a)||this._getModuleDcl(a)},setModule:function(b,c){if(this._getModuleDojo(b))return a.setObject(n.replaceAll("/",".",b),c);if(this._getModuleDcl(b))return e.setObject(n.replaceAll("/",".",b),c)},createManager:function(a,c,
g){try{this.managers||(this.managers=[]);var f={ctx:this,config:c||this.config};n.mixin(f,g);if(_.isString(a)&&this.namespace){var q=null,q=-1==a.indexOf(".")?this.namespace+a:""+a;a=b.getObject(q)&&e.getObject(q)?q:this.defaultNamespace+a}else _.isObject(a);var h=p.createInstance(a,f);if(h)return this.managers.push(h),p.publish(m.EVENTS.ON_CREATED_MANAGER,{instance:h,className:a,ctx:this,config:c||this.config}),h}catch(l){console.error("error creating manager "+l,arguments)}},constructManagers:function(){},
initManagers:function(){},doMixins:function(a){this.mixins=a||this.mixins;for(var b=0;b<a.length;b++){var g=a[b],f=this.getModule(g.declaredClass);g.declaredClass===this.declaredClass&&(f=this);f&&n.mixin(f.prototype,g.mixin)}}});e.chainAfter(f,"constructManagers");e.chainAfter(f,"initManagers");return f})},"nxapp/Commons":function(){define("dojo/has dojo/_base/lang nxapp/types/Types xide/factory xide/factory/Events xide/factory/Objects xide/utils/StringUtils xide/utils/HexUtils xide/utils/CIUtils xide/utils/ObjectUtils xide/utils/StoreUtils nxapp/utils/FileUtils xide/utils nxapp/utils dojo/node!os dojo/node!util nxapp/utils/_console".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r,q,h,l,k,t,w){p="linux";"win32"===k.platform()?p="windows":"darwin"===k.platform()?p="osx":"linux"===k.platform()&&"arm"==k.arch()&&(p="arm");"arm"===p?e.add("serialport",function(){return!1}):e.add("serialport",function(){return!0});h.mixin(l,h);h.mixin(h,l);h.inspect=function(a){return t.inspect(a,{depth:null,colors:!0})};Array.prototype.remove=function(){for(var a,b=arguments,c=b.length,k;c&&this.length;)for(a=b[--c];-1!=(k=this.indexOf(a));)this.splice(k,1);return this};
Array.prototype.contains=function(a){for(var b=this.length;b--;)if(this[b]==a)return!0;return!1};Array.prototype.indexOfPropertyValue||(Array.prototype.indexOfPropertyValue=function(a,b){for(var c=0;c<this.length;c++)if(this[c][a]&&this[c][a]==b)return c;return-1});"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.substring(0,a.length)===a});"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.substring(this.length-
a.length,this.length)===a});return{utils:l,types:m}})},"xide/factory/Objects":function(){define(["dcl/dcl","xide/utils","xide/factory","xdojo/declare"],function(e,p,m,n){m.createInstance=function(f,b,a){var d={};p.mixin(d,b);b=f;if(_.isString(f)&&(b=dojo.getObject(b)||e.getObject(b),!b))return console.error("no such class : "+f),null;a&&(b=n(a,b.prototype));d.id||(d.id=(b.declaredClass||"no_class_").replace(/\//g,"_")+p.createUUID());(f=new b(d))&&(f.ctrArgs=d);return f};return m})},"xide/utils/CIUtils":function(){define(["xide/utils",
"xide/types","xide/factory","dojo/has","xide/lodash"],function(e,p,m,n,f){e.toOptions=function(b){b=e.flattenCIS(b);for(var a=[],d=0;d<b.length;d++){var c=b[d];a.push({name:e.toString(c.name),value:e.getCIValue(c),type:e.toInt(c.type),enumType:e.toString(c.enumType),visible:e.toBoolean(c.visible),active:e.toBoolean(c.active),changed:e.toBoolean(c.changed),group:e.toString(c.group),user:e.toObject(c.user),dst:e.toString(c.dst),id:e.toString(c.id),params:e.toString(c.params)})}return a};if(n("xideve")||
n("xblox-ui"))e.getEventsAsOptions=function(b){var a=[{label:"Select Event",value:""}],d;for(d in p.EVENTS)a.push({label:p.EVENTS[d],value:p.EVENTS[d]});a=a.concat([{label:"onclick",value:"onclick"},{label:"ondblclick",value:"dblclick"},{label:"onmousedown",value:"mousedown"},{label:"onmouseup",value:"mouseup"},{label:"onmouseover",value:"mouseover"},{label:"onmousemove",value:"mousemove"},{label:"onmouseout",value:"mouseout"},{label:"onkeypress",value:"keypress"},{label:"onkeydown",value:"keydown"},
{label:"onkeyup",value:"keyup"},{label:"onfocus",value:"focus"},{label:"onblur",value:"blur"},{label:"On Load",value:"Load"}]);for(d=0;d<a.length;d++){var c=a[d];if(c.value===b){c.selected=!0;break}}return a};e.flattenCIS=function(b){for(var a=[],d=[],c=0;c<b.length;c++){var g=b[c],f=e.toInt(g.type);f>p.ECIType.END&&(f=p.resolveType(f))&&(e.mixin(a,f),d.push(g))}0<a.length&&(b=b.concat(a));if(d)for(c in d)b.remove(d[c]);return b};e.arrayContains=function(b,a){for(var d=0;d<b.length;d++)if(b[d]===
a)return!0;return!1};e.setStoreCIValueByField=function(b,a,d){null==b[a]&&(b[a]=[]);b[a][0]=e.getStringValue(d);return b};e.createOption=function(b,a,d){return e.mixin({label:b,value:null!=a?a:b},d)};e.createCI=function(b,a,d,c,g){b={dataRef:null,dataSource:null,name:b,group:-1,id:b,title:b,type:a,uid:-1,value:null!=d?d:-1,visible:!0,enumType:-1,"class":"cmx.types.ConfigurableInformation"};e.mixin(b,c);g&&g.publish&&m.publish(g.publish,{CI:b,owner:g.owner},g.owner);return b};e.createCIAsArray=function(b,
a,d,c){return{chainType:[d?d:0],dataRef:[null],dataSource:[null],params:[],name:[b],group:[-1],id:[b],title:[b],type:[a],uid:[-1],value:[c?c:-1],visible:[!0],enumType:[-1],parentId:[-1],"class":["cmx.types.ConfigurableInformation"]}};e.hasValue=function(b){return b.value&&null!=b.value[0]&&0<b.value[0].length&&"0"!=b.value[0]&&"undefined"!=b.value[0]&&"Unset"!=b.value[0]};e.hasValueAndDataRef=function(b){return b.value&&null!=b.value[0]&&0<b.value[0].length&&"0"!=b.value[0]&&"undefined"!=b.value[0]&&
"Unset"!=b.value[0]&&b.dataRef&&null!=b.dataRef[0]&&0<b.dataRef[0].length&&"0"!=b.dataRef[0]&&"undefined"!=b.dataRef[0]};e.getInputCIByName=function(b,a){if(!b||!a)return null;var d=b.inputs;d||(d=b);if(null!=d)for(var c=0;c<d.length;c++){var g=d[c],f=e.getStringValue(g.name);if(null!=f&&f.toLowerCase()===a.toLowerCase())return g}return null};e.getInputCIById=function(b,a){if(!b)return null;var d=b.inputs;d||(d=b);if(null!=d)for(var c=0;c<d.length;c++){var g=d[c],f=e.getStringValue(g.id);if(null!=
f&&f.toLowerCase()===a.toLowerCase())return g}return null};e.getCIByChainAndName=function(b,a,d){if(!b)return null;(a=0==a?b.inputs:1==a?b.outputs:null)||(a=b);if(null!=a)for(b=0;b<a.length;b++){var c=a[b],g=e.getStringValue(c.name);if(null!=g&&g.toLowerCase()===d.toLowerCase())return c}return null};e.getCIByUid=function(b,a){if(null!=b)for(var d=0;d<b.length;d++){var c=b[d],g=e.getStringValue(c.uid);if(null!=g&&g===a)return c}return null};e.getCIById=function(b,a,d){b=0==a?b.inputs:1==a?b.outputs:
null;if(null!=b)for(a=0;a<b.length;a++){var c=b[a];if(c.id[0]==d[0])return c}return null};e.getCIInputValueByName=function(b,a){var d=e.getCIByChainAndName(b,0,a);return d?d.value:null};e.getCIValue=function(b){return e.getCIValueByField(b,"value")};e.getStringValue=function(b){return e.toString(b)};e.toString=function(b){return null!=b?f.isArray(b)?b&&1==b.length&&null==b[0]?null:""+(null!=b[0]?b[0]:b):""+b:null};e.setIntegerValue=function(b,a){null!=b&&dojo.isArray(b)&&(b[0]=a)};e.getCIValueByField=
function(b,a){return null!=b[a]?f.isArray(b[a])?b[a][0]?b[a][0]:b[a]:b[a]:null};e.setCIValueByField=function(b,a,d){if(!b)return b;null==b[a]&&(b[a]=[]);b[a]=d;return b};e.setCIValue=function(b,a,d){(b=e.getInputCIByName(b,a))&&e.setCIValueByField(b,"value",d);return b};e.getCIInputValueByNameAndField=function(b,a,d){return(b=e.getCIByChainAndName(b,0,a))?b[""+d]:null};e.getCIInputValueByNameAndFieldStr=function(b,a,d){return(b=e.getCIInputValueByNameAndField(b,a,d))?e.getStringValue(b):null};e.getCIInputValueByNameAndFieldBool=
function(b,a,d){return(b=e.getCIInputValueByNameAndField(b,a,d))?e.toBoolean(b):null};e.getCIWidgetByName=function(b,a){for(var d=0;d<b.length;d++){var c=b[d];if(c._widget&&c.name===a)return c._widget}return null};return e})},"xide/utils/StoreUtils":function(){define(["xide/utils","xide/data/Memory","dojo/_base/kernel","xide/lodash"],function(e,p,m,n){e.removeFromStore=function(f,b,a,d,c,g,r){if(null!=b&&f){b=n.isString(b)?f.getSync(b)||b:b;d=d||f.idProperty;c=c||f.parentProperty;b&&f.removeSync(b[d],
g);var q={};q[c]=b[d]?b[d]:b;!0===r&&n.isObject(b)&&e.destroy(b,!0);if(!0===a&&(b=f.query(q))&&b.length)for(q=0;q<b.length;q++)e.removeFromStore(f,b[q],a,d,c,g,r)}};e.toString=function(f){return null!=f?m.isArray(f)?f&&1==f.length&&null==f[0]?null:""+(null!=f[0]?f[0]:f):""+f:null};e.toBoolean=function(f){var b=!1;null!=f&&(f=f[0]?f[0]:f,null!=f&&(b=!(!0!==f&&"true"!==f&&"1"!==f)));return b};e.toObject=function(f){return null!=f?f[0]?f[0]:f:null};e.toInt=function(f){if(_.isNumber(f))return f;var b=
-1;null!=f&&(f=1<f.length?f:f[0]?f[0]:f,null!=f&&(b=parseInt(f,10)));return b};e.getStoreItemById=function(f,b){return e.queryStoreEx(f,{id:b},null,null)};e.getAppDataElementByIdAndType=function(f,b,a){return e.queryStore(f,{uid:b,type:a},null,null)};e.getElementsByType=function(f,b){return e.queryStoreEx(f,{type:b})};e.queryStoreEx=function(f,b,a,d){if(!f)return console.error("utils.queryStoreEx: store \x3d null"),null;if(f instanceof p)return f=e.queryMemoryStoreEx(f,b),d&&f&&f[0]?f[0]:f;var c=
null;f.query&&(c=f.query(b));return!0===a&&c&&0===c.length?null:!0===d&&c&&1==c.length?c[0]:c};e.queryStore=function(f,b,a){return(f=e.queryStoreEx(f,b,null,null))&&1==f.length?f[0]:!0===a&&f&&0===f.length?null:f};e.queryMemoryStoreEx=function(f,b){var a=[];f.query(b).forEach(function(b){a.push(b)});return a};e.queryMemoryStoreSingle=function(f,b){var a=e.queryMemoryStoreEx(f,b);return 1==a.length?a[0]:a};return e})},"nxapp/manager/FileManager":function(){define("dcl/dcl dojo/has nxapp/manager/ManagerBase nxapp/utils/_LogMixin xide/types xide/factory dojo/node!path dojo/node!fs dojo/node!child_process dojo/node!chokidar".split(" "),
function(e,p,m,n,f,b,a,d,c,g){p("windows");p("arm");return e([m,n],{declaredClass:"nxapp.manager.FileManager",watcher:null,resolve:function(b){var c="",h=a.resolve(dojoConfig.libRoot),g=a.resolve(dojoConfig.clientRoot);if(d.existsSync(a.resolve(b)))return b;"/"==b[0]?a.resolve(b):a.resolve(h+"/"+b)?c=a.resolve(h+"/"+b):d.existsSync(a.resolve(b))?c=a.resolve(b):a.resolve(g+"/"+b)&&(c=a.resolve(g+"/"+b));return c},watch:function(a,b){try{console.log("watch directory : "+this.resolve(a)),d.existsSync(a)&&
b&&this.watcher&&this.watcher.add&&this.watcher.add(a)}catch(c){}},initChokidar:function(c){function q(a){a=a.replace(dojoConfig.libRoot,"");a.startsWith("/")&&(a=a.replace("/",""));return a}for(var h=0;h<c.watchr.paths.length;h++){var l=c.watchr.paths[h],k=a.resolve(dojoConfig.libRoot),e=a.resolve(dojoConfig.clientRoot);"/"==l[0]?l=a.resolve(l):a.resolve(l)&&d.existsSync(l)?c.watchr.paths[h]=a.resolve(l):d.existsSync(a.resolve(k+"/"+l))?c.watchr.paths[h]=a.resolve(k+"/"+l):d.existsSync(a.resolve(l))?
c.watchr.paths[h]=a.resolve(l):a.resolve(e+"/"+l)&&(c.watchr.paths[h]=a.resolve(e+"/"+l))}var n=this,u=g.watch(c.watchr.paths,{ignored:function(a){return-1!==a.indexOf("metadata")?!0:!1},persistent:!0,ignoreInitial:!0,awaitWriteFinish:!0});u.on("addDir",function(a){u.add(a);b.publish(f.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:q(a)},n)});u.on("add",function(a){b.publish(f.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:q(a),type:"added"},n)});u.on("unlinkDir",function(a){u.unwatch(a);b.publish(f.EVENTS.ON_FILE_CHANGED,
{path:a,modulePath:q(a),type:"delete"},n)});u.on("change",function(a){n.publish(f.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:q(a),type:"changed"},n)});u.on("raw",function(a,c,k){if("rename"===a)try{var d=d.statSync(k.watchedPath)}catch(h){-1!==k.watchedPath.indexOf(c)&&b.publish(f.EVENTS.ON_FILE_CHANGED,{path:k.watchedPath,modulePath:k.watchedPath.replace(dojoConfig.libRoot,""),type:"delete"},n)}});this.watcher=u},initWindows_Watchr:function(c){for(var g=0;g<c.watchr.paths.length;g++){var h=c.watchr.paths[g],
l=a.resolve(dojoConfig.libRoot),k=a.resolve(dojoConfig.clientRoot);"/"==h[0]?h=a.resolve(h):a.resolve(l+"/"+h)?c.watchr.paths[g]=a.resolve(l+"/"+h):d.existsSync(a.resolve(h))?c.watchr.paths[g]=a.resolve(h):a.resolve(k+"/"+h)&&(c.watchr.paths[g]=a.resolve(k+"/"+h))}_.each(c.watchr.paths,function(a){});var e=this;watchr.watch({paths:c.watchr.paths,interval:500,listeners:{log:function(a){},error:function(a){console.log("an error occured:",a)},watching:function(a,b,c){},change:function(a,c,k,d){c&&b.publish(f.EVENTS.ON_FILE_CHANGED,
{path:c,modulePath:c.replace(dojoConfig.libRoot,"")},e)}},next:function(a,b){if(a)return console.log("watching everything failed with error",a);console.log("watching everything completed")}})},initWindows:function(b){for(var g=0;g<b.watchr.paths.length;g++){var h=b.watchr.paths[g],l=a.resolve(dojoConfig.libRoot),k=a.resolve(dojoConfig.clientRoot);"/"==h[0]?h=a.resolve(h):a.resolve(l+"/"+h)?b.watchr.paths[g]=a.resolve(l+"/"+h):d.existsSync(a.resolve(h))?b.watchr.paths[g]=a.resolve(h):a.resolve(k+"/"+
h)&&(b.watchr.paths[g]=a.resolve(k+"/"+h))}var f=new function(a,b,k,d){var h=c.spawn;a=h(a,b);var g=this;a.stdout.on("data",function(a){k(g,a)});a.stdout.on("end",d)}(a.resolve(global.cwd+"/inotifywait.exe"),["-r","-m","-q","--format\x3d%w|%e|%f",b.watchr.paths[0]],function(b,c){b.stdout="";for(var k=c.toString().split(/(\r?\n)/g),d=0;d<k.length;d++){var h=k[d];h&&5<h.length&&(h=h.split("|"),3==h.length&&a.resolve(h[0]+"/"+h[2]))}},function(){console.log("end : "+f.stdout)})},init:function(a){return this.initChokidar(a)},
initLinux:function(c,g){for(var h=0;h<c.watchr.paths.length;h++){var l=c.watchr.paths[h],k=a.resolve(dojoConfig.libRoot),e=a.resolve(dojoConfig.clientRoot);"/"==l[0]?l=a.resolve(l):a.resolve(k+"/"+l)?c.watchr.paths[h]=a.resolve(k+"/"+l):d.existsSync(a.resolve(l))?c.watchr.paths[h]=a.resolve(l):a.resolve(e+"/"+l)&&(c.watchr.paths[h]=a.resolve(e+"/"+l))}for(var n=this,u=function(a){var b=[];d.existsSync(a)&&d.readdirSync(a).forEach(function(c){c=a+"/"+c;var k=d.statSync(c);k&&k.isDirectory()&&(b.push(c),
b=b.concat(u(c)))});return b},l=function(){return{all_events:function(c){if(c&&c.name&&c.name.indexOf&&-1==c.name.indexOf(".git")&&-1==c.name.indexOf(".tmp")&&-1==c.name.indexOf("_jb_old_")&&-1==c.name.indexOf("_jb_bak_")&&-1==c.masks.toString().indexOf("access")){c.masks.toString().indexOf("moved_to");var k=a.resolve(c.watch+"/"+c.name),d="changed";-1!==c.masks.toString().replace("all_events,","").indexOf("delete")&&(d="deleted");k&&b.publish(f.EVENTS.ON_FILE_CHANGED,{path:k,modulePath:k.replace(dojoConfig.libRoot,
""),type:d},n)}},close_write:function(c){-1==c.name.indexOf(".git")&&-1==c.name.indexOf(".tmp")&&-1==c.name.indexOf("_jb_old_")&&-1==c.name.indexOf("_jb_bak_")&&-1==c.masks.toString().indexOf("access")&&-1==c.masks.toString().indexOf("moved_to")&&(c=a.resolve(c.watch+"/"+c.name))&&b.publish(f.EVENTS.ON_FILE_CHANGED,{path:c,modulePath:c.replace(dojoConfig.libRoot,"")},n)},access:!0,moved_to:!0,moved_from:!0,"delete":!0}}(),k=g.create(!1),e=0;e<c.watchr.paths.length;e++)if(h=c.watchr.paths[e],d.existsSync(h)){var m=
u(h);k.watch(l,h);for(h=0;h<m.length;h++)k.watch(l,m[h])}}})})},"nxapp/manager/ExportManager":function(){define("dcl/dcl nxapp/manager/ManagerBase nxapp/manager/_Drivers_Devices nxapp/utils/_LogMixin nxapp/utils/_console xide/utils nxapp/utils dojo/node!path dojo/node!fs-jetpack dojo/node!cheerio dojo/node!fs dojo/has".split(" "),function(e,p,m,n,f,b,a,d,c,g,r,q){return e([p,n,m],{declaredClass:"nxapp.manager.ExportManager",options:null,serverTemplates:null,linux32:!0,linux64:!0,osx:!0,arm:!0,windows:!0,
nginxOptions:null,mongoOptions:null,serverOptions:null,init:function(a){this.profile=a},run:function(a){this.delegate=a;this.initWithOptions(this.options)},onProgress:function(a){this.delegate&&this.delegate.onProgress(a);f.log("Progress:  "+a)},onError:function(a){this.delegate&&this.delegate.onError(a)},onFinish:function(a){this.delegate&&this.delegate.onFinish(a);f.log("Finish:  "+a)},initWithOptions:function(c){this.options=c;b.mixin(this,c);this.onProgress("Export Manager: begin export",{progress:0});
if(!this.root)throw this.onError("Export Manager: have no root"),Error("Export Manager: have no root");if(!this.data)throw this.onError("Export Manager: have no data"),Error("Export Manager: have no data");if(this.user){this.client||(this.client=a.resolve(this.root+"/Code/client/"));this.serverTemplates||(this.serverTemplates=a.resolve(this.root+"/server-template"));this.dist||(this.dist=a.resolve(this.root+"/dist/all/server/"));f.log("export with \n",b.inspect({"System Data":this.data,"User Data":this.user+
" \x3d "+d.resolve(this.user),Root:d.resolve(this.root),"Server-Templates":this.serverTemplates,Target:d.resolve(this.target),"Node Servers":d.resolve(this.dist),Client:this.client,"Export Windows":this.windows,"Export Linux - 32 ":this.linux32,"Export Linux - 64 ":this.linux64,"Export OSX":this.osx,"Export ARM":this.arm}));c=b.mixin({port:8889,templatePath:a.resolve(this.serverTemplates+"/nginx/all/conf/nginx.app.template.conf")},this.nginxOptions);var g=b.mixin({port:9997,mongo_port:27018,mqtt_port:1884},
this.serverOptions);this.exportNGINX(c);this.exportMongo(this.mongoOptions||{});this.createDirectoryLayout();this.exportServer();this.onProgress("Exported Servers",{progress:.2});this.exportUser();this.onProgress("Exported User",{progress:.3});this.exportSystem();this.onProgress("Exported System Data",{progress:.4});this.exportMisc(g);this.onProgress("Exported Misc Data",{progress:.5});this.exportHTML(g);this.onProgress("Exported User Workspace HTML",{progress:.6});this.exportDevices({serverSide:!0});
this.onProgress("Exported Devices",{progress:.7});this.exportDrivers({});this.onProgress("Exported Drivers",{progress:.8});this.client?this.exportClientEx():this.exportClientDist();this.onProgress("Exported Client Application Assets",{progress:.9});f.log("Export Done! Your application can be found at "+this.target);this.onProgress("Export Done",{progress:1.2});this.onFinish("Export Done! Your application can be found at "+this.target)}else this.onError("Export Manager: have no user")},exportHTML:function(a){function b(c,
d){var l=r.readdirSync(c);l.length&&_.each(l,function(b){if(-1!==b.indexOf(".dhtml")){var l=d.replace(k.path()+"/","");g.exportHTMLFile2(c+"/"+b,l,a)}})}var k=c.dir(this.target+"/www/user/workspace/"),g=this;(function(c){r.existsSync(c)?r.readdirSync(c).forEach(function(k){k=c+"/"+k;var e=r.statSync(k);if(e){var q=k.replace(d+"/","");e.isDirectory()?b(k,q):-1!==k.indexOf(".dhtml")&&(q=q.replace(c+"/",""),g.exportHTMLFile2(k,q,a))}else f.error("cant get stat for "+k)}):f.error("device path "+c+" doesnt exists");
return[]})(k.path())},exportHTMLFile2:function(a,l,k){var f=c.dir(this.root+"/export/"),f=b.readFile(d.resolve(f.path()+"/app.template.html")),e=b.pathinfo(a);l===e.basename&&(l="");l=b.mixin({libRoot:"/Code/client/src/lib",lodashUrl:"/Code/client/src/lib/external/lodash.min.js",requireBaseUrl:"/Code/client/src/lib/xibm/ibm",jQueryUrl:"/Code/client/src/lib/external/jquery-1.9.1.min.js",data:"",user:"/user",css:"./"+b.cleanUrl(e.filename+".css"),theme:"bootstrap",blox_file:"./"+l+"/"+e.filename+".xblox",
scene_file:"./"+l+"/"+e.filename+".dhtml",mount:"workspace",VFS_VARS:JSON.stringify({user_drivers:"./www/user/drivers",system_drivers:"./www/system/drivers"},null,2)},k);f=b.replace(f,null,l,{begin:"%",end:"%"});l=b.readFile(a);l=l.replace("\x3cviewHeaderTemplate/\x3e",f);l=l.replace(/\burl\s*\(\s*["']?([^"'\r\n\)\(]+)["']?\s*\)/gi,function(a,b){var c=b.split("://"),k=c[1];return c[0]&&k?"url('./"+k+"')":b});f=g.load(l);l='\n\x3cscript type\x3d"text/javascript"\x3e\n\tvar test \x3d 0;\n\x3c/script\x3e';
f("HEAD").append(f(l));b.writeFile(a.replace(".dhtml",".html"),f.html())},exportHTMLFile:function(a){var l=c.dir(this.root+"/export/"),k=c.dir(this.target+"/www/user/workspace/"),k=d.resolve(k.path()+"/ascene.dhtml"),l=b.readFile(d.resolve(l.path()+"/app.template.html"));a=b.mixin({libRoot:"/Code/client/src/lib",lodashUrl:"/Code/client/src/lib/external/lodash.min.js",requireBaseUrl:"/Code/client/src/lib/xibm/ibm",jQueryUrl:"/Code/client/src/lib/external/jquery-1.9.1.min.js",data:"",user:"/user",css:"./ascene.css",
theme:"bootstrap",blox_file:"./ascene.xblox",mount:"workspace",VFS_VARS:JSON.stringify({user_drivers:"./www/user/drivers",system_drivers:"./www/system/drivers"},null,2)},a);l=b.replace(l,null,a,{begin:"%",end:"%"});a=b.readFile(k);a=a.replace("\x3cviewHeaderTemplate/\x3e",l);a=a.replace(/\burl\s*\(\s*["']?([^"'\r\n\)\(]+)["']?\s*\)/gi,function(a,b){var c=b.split("://"),k=c[1];return c[0]&&k?(f.error("----"+k),"url('./"+k+"')"):b});a=g.load(a);l='\n\x3cscript type\x3d"text/javascript"\x3e\n\tvar test \x3d 0;\n\x3c/script\x3e';
a("HEAD").append(a(l));b.writeFile(k.replace(".dhtml",".html"),a.html())},exportDevices:function(a){var c=d.resolve(this.target+"/www/user/devices"),k=this.getDevices(c,"user_devices",a);b.writeFile(c+"/user_devices.json",JSON.stringify({items:k},null,2));c=d.resolve(this.target+"/www/system/devices");k=this.getDevices(c,"system_devices",a);b.writeFile(c+"/system_devices.json",JSON.stringify({items:k},null,2))},exportDrivers:function(a){var c=d.resolve(this.target+"/www/user/drivers");a=this.getDrivers(c,
"user_drivers");b.writeFile(c+"/user_drivers.json",JSON.stringify({items:a},null,2));c=d.resolve(this.target+"/www/system/drivers");a=this.getDrivers(c,"system_drivers");b.writeFile(c+"/system_drivers.json",JSON.stringify({items:a},null,2))},exportMisc:function(h){var g=c.dir(this.root+"/export"),k=c.dir(this.target);c.copy(g.path(),k.path(),{matching:["**"],overwrite:!0});var f=a.readFile(d.resolve(g.path()+"/profile_device_server.json")),f=b.replace(f,null,h,{begin:"%",end:"%"});"false"!==this.linux32&&
c.exists(k.path()+d.sep+"/server/linux_32/nxappmain/profile_device_server.json")&&b.writeFile(k.path()+d.sep+"/server/linux_32/nxappmain/profile_device_server.json",f);"false"!==this.linux64&&c.exists(k.path()+d.sep+"/server/linux_64/nxappmain/profile_device_server.json")&&b.writeFile(k.path()+d.sep+"/server/linux_64/nxappmain/profile_device_server.json",f);"false"!==this.windows&&c.exists(k.path()+d.sep+"/server/windows/nxappmain/profile_device_server.json")&&"false"!==this.windows&&b.writeFile(k.path()+
d.sep+"/server/windows/nxappmain/profile_device_server.json",f);"false"!==this.arm&&c.exists(k.path()+d.sep+"/server/arm/nxappmain/profile_device_server.json")&&b.writeFile(k.path()+d.sep+"/server/arm/nxappmain/profile_device_server.json",f);"false"!==this.osx&&c.exists(k.path()+d.sep+"/server/osx_64/nxappmain/profile_device_server.json")&&b.writeFile(k.path()+d.sep+"/server/osx_64/nxappmain/profile_device_server.json",f);f=a.readFile(d.resolve(g.path()+"/start.js"));f=b.replace(f,null,h,{begin:"%",
end:"%"});"false"!==this.linux32&&c.exists(k.path()+"/server/linux_32/start.js")&&b.writeFile(k.path()+"/server/linux_32/start.js",f);"false"!==this.linux64&&c.exists(k.path()+"/server/linux_64/start.js")&&b.writeFile(k.path()+"/server/linux_64/start.js",f);"false"!==this.windows&&b.writeFile(k.path()+"/server/windows/start.js",f);"false"!==this.arm&&c.exists(k.path()+"/server/arm/start.js")&&b.writeFile(k.path()+"/server/arm/start.js",f);"false"!==this.osx&&c.exists(k.path()+"/server/osx_64/start.js")&&
b.writeFile(k.path()+"/server/osx_64/start.js",f)},exportClientEx:function(){var a=c.dir(d.resolve(this.client)+""),b=c.dir(this.target+"/www/Code/client");c.copy(a.path(),b.path(),{matching:["**"],overwrite:!0})},exportClient:function(){var a=c.dir(this.root+"/Code/client"),b=c.dir(this.target+"/www/Code/client");c.copy(a.path(),b.path(),{matching:["**"],overwrite:!0})},exportClientDist:function(){var a=c.dir(this.root+"/dist/all/Code/client/"),b=c.dir(this.target+"/www/Code/client");c.copy(a.path(),
b.path(),{matching:["**"],overwrite:!0})},exportUser:function(){var a=c.dir(this.user),b=c.dir(this.target+"/www/user");f.log("export user from "+a.path()+" to "+b.path());try{c.copy(a.path(),b.path(),{matching:["**","!./.git/**/*","!**/**claycenter","!./claycenter","!**claycenter"],overwrite:!0})}catch(k){"EEXIST"===k.code&&f.error("Error copying, file exists!",k),"EACCES"===k.code&&f.error("Error copying, file access perrmissions!",k),f.error("error : ",k)}},exportSystem:function(){var a=c.dir(this.data+
"/system"),b=c.dir(this.target+"/www/system");c.copy(a.path(),b.path(),{matching:["**"],overwrite:!0})},clean:function(){},copyServer:function(a){var b=c.dir(this.target+"/server/"+a),k="";if(this.dist){if(!c.exists(this.dist+"/"+a))return;k=c.dir(this.dist+"/"+a)}else k=c.dir(this.root+"/server/"+a);if(c.exists(k.path())){f.info("export Device-Server "+a+" from : "+k.path());try{c.copy(k.path(),b.path(),{matching:["**"],overwrite:!0})}catch(d){"EEXIST"===d.code&&f.error("Error copying, file exists!",
d),"EACCES"===d.code&&f.error("Error copying, file access perrmissions!",d)}}},exportServer:function(a){"false"!==this.windows&&this.copyServer("windows");"false"!==this.linux32&&this.copyServer("linux_32");"false"!==this.linux64&&this.copyServer("linux_64");"false"!==this.arm&&this.copyServer("arm");"false"!==this.osx&&this.copyServer("osx_64")},createDirectoryLayout:function(){c.dir(this.target+"/data/_MONGO");c.dir(this.target+"/www/");c.dir(this.target+"/nginx/logs")},exportMongo:function(a){a=
c.dir(this.serverTemplates+"/mongo");var b=c.dir(this.target+"/mongo");c.copy(a.path(),b.path(),{matching:"mongod-arm mongod-linux_32 mongod-linux_64 mongod-windows.exe mongod-32.exe mongod-osx".split(" "),overwrite:!0})},exportNGINX:function(g){var l=c.dir(this.serverTemplates+"/nginx"),k=c.dir(this.target+"/nginx");try{c.copy(l.path(),k.path(),{matching:"nginx-arm nginx-linux_32 nginx-linux_64 nginx-windows.exe nginx-osx msvcr110.dll".split(" "),overwrite:!0})}catch(e){"EEXIST"===e.code&&f.error("Error copying, file exists!",
e),"EACCES"===e.code&&f.error("Error copying, file access perrmissions!",e),"ETXTBSY"===e.code&&f.error("Error copying, file is busy",e)}l=c.dir(this.serverTemplates+"/nginx/all/conf");k=c.dir(this.target+"/nginx");c.copy(l.path(),k.path(),{overwrite:!0});l=c.dir(this.serverTemplates+"/nginx/temp");k=c.dir(this.target+"/nginx/temp");c.copy(l.path(),k.path(),{overwrite:!0});k=a.readFile(g.templatePath);g=b.replace(k,null,g,{begin:"%%",end:"%%"});c.dir(this.serverTemplates+"/nginx/all/conf");k=c.dir(this.target+
"/nginx/");b.writeFile(k.path()+d.sep+"nginx.conf",g)}})})},"nxapp/manager/_Drivers_Devices":function(){define("dcl/dcl dojo/node!path dojo/node!fs nxapp/utils xide/utils/StringUtils xide/types nxapp/utils/_console".split(" "),function(e,p,m,n,f,b,a){return e(null,{declaredClass:"nxapp.manager._Drivers_Devices",profile:null,getDevices:function(d,c,g){function e(k,d){var g=m.readdirSync(k);g.length&&_.each(g,function(g){if(-1!=g.indexOf(".meta.json")){var e=f.getJson(n.readFile(k+p.sep+g),!0,!1);if(e){if(l){var q=
n.getCIByChainAndName(e,0,b.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);!q||q.value&1<<b.DRIVER_FLAGS.RUNS_ON_SERVER||(q.value|=1<<b.DRIVER_FLAGS.RUNS_ON_SERVER)}e?(g={isDir:!1,path:d+"/"+g,parentId:d,scope:c,user:e,id:n.getCIInputValueByName(e,b.DEVICE_PROPERTY.CF_DEVICE_ID)},h.push(g)):a.error("device has no meta "+k+p.sep+g)}else a.error("cant get device meta for "+g+" path \x3d "+k+p.sep+g)}})}function q(b){var c=[];m.existsSync(b)?m.readdirSync(b).forEach(function(g){g=b+"/"+g;var l=m.statSync(g);
if(l){var f=g.replace(d+"/","");l.isDirectory()&&(h.push({isDir:!0,parent:f,name:f,path:f}),e(g,f),c.push(g.replace(d+"/","")),c=c.concat(q(g)))}else a.error("cant get stat for "+g)}):a.error("device path "+b+" doesnt exists");return c}require({packages:[{name:c,location:d}]});var h=[];g=g||{};var l=g.serverSide;q(d);return h},getDrivers:function(d,c,g){function e(d,k){var g=m.readdirSync(d);g.length&&_.each(g,function(g){if(-1!=g.indexOf(".meta.json")){var e=f.getJson(n.readFile(d+p.sep+g),!0,!1);
if(e){var q=n.getCIInputValueByName(e,b.DRIVER_PROPERTY.CF_DRIVER_ID),r=d+"/"+g.replace(".meta.json",".xblox"),t=f.getJson(n.readFile(r),!0,!1);t||a.warn("invalid blocks file for driver "+k+"/"+g+" blox path \x3d "+r);h.push({isDir:!1,path:k+"/"+g,parentId:k,scope:c,user:e,id:q,blox:t||{},blockPath:r})}else a.error("cant get driver meta "+d+p.sep+g)}})}function q(b){var c=[];m.existsSync(b)?m.readdirSync(b).forEach(function(a){a=b+"/"+a;var g=m.statSync(a);if(g){var f=a.replace(p+"/","");g.isDirectory()&&
(h.push({isDir:!0,parent:f,name:f,path:f}),e(a,f),c.push(a.replace(d+"/","")),c=c.concat(q(a)))}}):a.error("driver path "+b+" doesnt exists");return c}require({packages:[{name:c,location:d}]});var h=[];q(d);return h}})})},"nxapp/client/WebSocket":function(){define(["dojo/_base/declare","dojo/_base/lang","nxapp/utils/_LogMixin","nxapp/client/ClientBase","dojo/node!sockjs-client"],function(e,p,m,n,f){return e("nxapp.client.WebSocket",[n,m],{_socket:null,debugConnect:!0,connect:function(b){this.options=
p.mixin(this.options,b);b=this.options.host;var a=this.options.port;this.options.debug&&this.initLogger(this.options.debug);this.log("Sock-JS-Client Connecting to "+b+":"+a,"socket_client");var d=f.create(b+":"+a),c=this;d.on("close",function(){console.log("on close!",c.options)});d.on("connection",function(){c.log("socket client connected","socket_client");d.on("error",function(a){console.error("Socket client error ")});d.on("end",function(){c.log("socket client connection end","socket_client")})});
this._socket=d},emit:function(b,a){this.showDebugMsg("socket_client")&&(console.log("Emiting: "+b+" with: "),console.dir(a));this._socket.write(a)},onSignal:function(b,a){this._socket.on("data",a)}})})},"nxapp/client/ClientBase":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/_base/lang"],function(e,p,m){return e("nxapp.server.ClientBase",[p],{options:null,_defaultOptions:function(){return{}},init:function(e){this.options=m.mixin(this._defaultOptions(),e.options)}})})},"dcl/inherited":function(){(function(e){"undefined"!=
typeof define?define(["./mini","./advise"],e):"undefined"!=typeof module?module.exports=e(require("./mini"),require("./advise")):e(dcl,advise)})(function(e,p){function m(b,a,d){var c=3>arguments.length&&b.callee,g=n.call(this,c?c.ctr:b,c?c.nom:a);if(g)return g.apply(this,c?b||a:d)}function n(b,a){var d=this.constructor._meta,c,g,e,q;if(!+d.weaver[a]){if(d){if(d.chains.hasOwnProperty(a)){if(c=d.chains[a])for(e=c.length-1;0<=e;--e)if(g=c[e],g.ctr===b)return 0<e?c[e-1]:0;return}c=d.bases;for(e=c.length-
1;0<=e&&c[e]!==b;--e);if(0<=e)for(++e,q=c.length;e<q;++e)if(d=(g=c[e])._meta){if((d=d.ownProps).hasOwnProperty(a))return d[a]}else return g.prototype[a]}return f[a]}}var f={};p.after(e,"_postprocess",function(b,a){for(var d=a._meta.bases,c=d.length-1,g,f,q;0<=c;--c)if(g=d[c],f=g._meta)f=f.ownProps,e.allKeys(f).some(function(a){q=f[a];if("function"==typeof q){if(q.nom===a)return 1;q.nom=a;q.ctr=g}});a.prototype.inherited=m;a.prototype.getInherited=n});e.getInherited=m.get=n;return e.inherited=m})},
"dcl/advise":function(){(function(e){"undefined"!=typeof define?define([],e):"undefined"!=typeof module?module.exports=e():advise=e()})(function(){function e(f,b){this.next_before=this.prev_before=this.next_after=this.prev_after=this.next_around=this.prev_around=this;this.instance=f;this.name=b}function p(f){var b=function(){var a,b,c=arguments,g;for(a=f.prev_before;a!==f;a=a.prev_before)a.before.apply(this,c);try{f.prev_around!==f&&(b=f.prev_around.around.apply(this,c))}catch(e){b=e,g=!0}for(a=f.next_after;a!==
f;a=a.next_after)a.after.call(this,c,b);if(g)throw b;return b};b.adviceNode=f;return b}function m(f,b,a){var d=f[b],c;d&&d.adviceNode&&d.adviceNode instanceof e?c=d.adviceNode:(c=new e(f,b),d&&d.advices?(d=d.advices,c.add(d.before,d.after,d.around)):c.add(0,0,d),f[b]=p(c));"function"==typeof a&&(a=a(b,f));return c.add(a.before,a.after,0,a.around)}var n=e.prototype={add:function(f,b,a,d){var c=new e(this.instance,this.name);c.parent=this;c.before=f;this._add("before",c);c.after=b;this._add("after",
c);c.around=a;this._add("around",c,d);if(c.original=d)c.around=m._instantiate(d,c.prev_around.around,this);return c},_add:function(f,b,a){if(b[f]||a)a="next_"+f,f="prev_"+f,(b[f]=this[f])[a]=(b[a]=this)[f]=b},remove:function(f){this._remove("before",f);this._remove("after",f);this._remove("around",f)},_remove:function(f,b){var a="next_"+f,d="prev_"+f;b[a][d]=b[d];b[d][a]=b[a]},destroy:function(){var f=this.prev_around.around,b=this.next_around,a=this.parent;this.remove(this);if(b!==this)for(;b!==
a;f=b.around,b=b.next_around)b.original&&(b.around=m._instantiate(b.original,f,this));this.instance=0}};n.unadvise=n.destroy;m.before=function(f,b,a){return m(f,b,{before:a})};m.after=function(f,b,a){return m(f,b,{after:a})};m.around=function(f,b,a){return m(f,b,{around:a})};m.Node=e;m._instantiate=function(f,b,a){return f(b)};return m})},"nxapp/manager/DeviceServerContext":function(){define("dcl/dcl nxapp/manager/Context nxapp/Commons xcf/types/Types dojo/node!path dojo/node!fs nxapp/utils xide/types nxapp/manager/DriverManager xcf/manager/DeviceManager nxapp/manager/FileManager xcf/manager/Context nxapp/manager/DeviceManager xcf/manager/BlockManager xide/manager/ResourceManager xblox/factory/Blocks dojo/node!tracer nxapp/utils/_console nxapp/manager/_Drivers_Devices dojo/_base/lang dojo/promise/all require dojo/has nxapp/manager/TestManager".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r,q,h,l,k,t,w,u,z,v,x,D,A,J,H){var G=e(null,{declaredClass:"DeviceServerClientClass",write:function(a){u.error("device server client write",a)},emit:function(a){u.error("device server client emit",a)}}),y=null,C=e(null,{owner:null,remoteAddress:"fake - address",remotePort:"fake - port",isExternal:function(){return!1},constructor:function(b){a.mixin(this,b)},write:function(b){var c=this.owner.getDeviceManager(),k=a.getJson(b),k=k||{};if(k.data&&k.data.device){var g=c.getDeviceStoreItem(k.data.device);
if(g)if(g=c.toDeviceControlInfo(g)){if(!g.serverSide)return}else u.error("no info")}if(k&&k.data&&k.data.deviceMessage&&k.data.deviceMessage.event===d.EVENTS.ON_COMMAND_FINISH)c.onCommandFinish(k.data.device,k.data.deviceMessage);else if(k.data&&k.data.deviceMessage&&k.data.deviceMessage.event===d.EVENTS.ON_COMMAND_ERROR)c.onCommandError(k.data.device,k.data.deviceMessage);else if(k.event===d.EVENTS.ON_DEVICE_DISCONNECTED)c.publish(d.EVENTS.ON_DEVICE_DISCONNECTED,k.data);else{if(k.event===d.EVENTS.SET_DEVICE_VARIABLES)return c.onSetDeviceServerVariables(k.data);
if(k.event===d.EVENTS.ON_DEVICE_CONNECTED)c.publish(d.EVENTS.ON_DEVICE_CONNECTED,k.data);else if(k.event!==d.EVENTS.ON_SERVER_LOG_MESSAGE)if(k.event===d.EVENTS.ON_MQTT_MESSAGE)c.publish(d.EVENTS.ON_MQTT_MESSAGE,k.data),c.onMQTTMessage(k.data);else if(k.event!==d.EVENTS.ON_FILE_CHANGED)c.onDeviceServerMessage({data:b})}},emit:function(){u.error("device server client emit",arguments)}});return e([p,q,z],{setAppServer:function(a){this.appServer=a},declaredClass:"nxapp.manager.DeviceServerContext",profile:null,
appServer:null,testManager:null,getTestManager:function(){return this.testManager},doTests:function(){return this.getTestManager().doTests()},initManagers:function(a){a&&(this.profile=a);this.testManager&&this.testManager.init(a);this.deviceManager.init();this.driverManager.init();this.blockManager.init();this.fileManager.init(a);this.blockManager.onReady();var b=this;this.subscribe(d.EVENTS.ON_FILE_CHANGED,function(a){b.onXIDEMessage({event:d.EVENTS.ON_FILE_CHANGED,data:a,type:a.type},!1);b.fileChanged(a);
b.deviceManager.onFileChanged(a);b.driverManager.onFileChanged(a);b.getDeviceServer().broadCastMessage(d.EVENTS.ON_FILE_CHANGED,{path:a.path,modulePath:a.modulePath,mask:a.mask,type:a.type})})},getModule:function(b){return v.getObject(a.replaceAll("/",".",b))||v.getObject(b)||(e.getObject?e.getObject(b)||e.getObject(a.replaceAll("/",".",b)):null)},_reloadModule:function(b,c){function k(a){u.log(a.src,a.id);u.error("require error "+b,a);g.remove()}if(D.undef){var g=null;if(-1===b.indexOf(".json")&&
-1===b.indexOf("nxapp")&&-1!=b.indexOf(".js")&&-1===b.indexOf("/build/")){b=b.replace("0/8","0.8");var h=v.getObject(a.replaceAll("/",".",b))||v.getObject(b);if(h&&h.prototype&&h.prototype.reloadModule)h.prototype.reloadModule();else{var g=D.on("error",k),f=this.getModule(b);if(!f&&(f="undefined"!==typeof b?f:null,!f&&"undefined"!==typeof window))if(f=a.getAt(window,a.replaceAll("/",".",b),null))h=f;else try{f=D(a.replaceAll(".","/",b))}catch(l){}f&&(h=f);D.undef(b);var e=this;c&&setTimeout(function(){D({waitSeconds:5});
try{D([b],function(a){u.log("reloaded module : "+b+(null!==f?" have obj":"have no obj"));D({cacheBust:"time\x3d"+(new Date).getTime()});_.isString(a)?u.error("module reloaded failed : "+a+" for module : "+b):(a.modulePath=b,h&&(e.mergeFunctions(h.prototype,a.prototype),h.prototype&&h.prototype._onReloaded&&h.prototype._onReloaded(a)),e.publish(d.EVENTS.ON_MODULE_RELOADED,{module:b,newModule:a}),a.prototype&&a.prototype.declaredClass&&e.publish(d.EVENTS.ON_MODULE_UPDATED,{moduleClass:a.prototype.declaredClass,
moduleProto:a.prototype}))})}catch(a){u.error("error reloading module "+b,a.stack),logError(a,"error reloading module "+b)}},10)}}}},fileChanged:function(a){var b=a.path;"changed"===a.type&&this._reloadModule(b,!0)},onAllDevicesStarted:function(){this.profile.test&&this.doTests()},onReady:function(){var a=this.getDeviceServer();if(a){var b=this.connection;a.clients||(a.clients=[]);b&&(a.clients.push(b),a.onClientConnection(b));global.process.emit("device-server-ready",this);this.initDevices();y=this;
global.sctx=y}else u.error("have no device server")},getUserDirectory:function(){return this.profile.user},destroy:function(){this.deviceServer.destroy();this.mqttManager&&this.mqttManager.destroy()},constructManagers:function(){g=e([g,h],{});this.driverManager=this.createManager(c,null);this.fileManager=this.createManager(r,null);this.blockManager=this.createManager(l,null);J&&(this.testManager=this.createManager(J,null));this.connection=new C({owner:this});this.deviceManager=this.createManager(g,
null,{deviceServerClient:new G({}),connection:this.connection});if(this.profile){var a=f.resolve(this.profile.system),a={system_drivers:f.resolve(a+"/system/drivers"),system_devices:f.resolve(a+"/system/devices")};if(this.profile.user){var b=f.resolve(this.profile.user);a.user_drivers=f.resolve(b+"/drivers");a.user_devices=f.resolve(b+"/devices");this.userDirectory=b}this.resourceManager=this.createManager(k);this.resourceManager.resourceVariables={VFS_CONFIG:a}}},onLoaded:function(){},initDevices:function(){var a=
this.profile,b=f.resolve(a.system),c=this.getDeviceManager(),k=this.getDriverManager(),d=a.serverSide;k.createStore({items:this.getDrivers(f.resolve(b+"/system/drivers"),"system_drivers")},"system_drivers",!0);c.initStore({items:this.getDevices(f.resolve(b+"/system/devices"),"system_devices",{serverSide:d})},"system_devices",!0);a.user&&(k.createStore({items:this.getDrivers(f.resolve(a.user+"/drivers"),"user_drivers")},"user_drivers",!0),c.initStore({items:this.getDevices(f.resolve(a.user+"/devices"),
"user_devices",{serverSide:d})},"user_devices",!0));x(c.connectToAllDevices()).then(function(){this.onAllDevicesStarted()}.bind(this))}})})},"nxapp/manager/DriverManager":function(){define("dcl/dcl nxapp/utils/_LogMixin xide/types xcf/manager/DriverManager nxapp/utils/_console dojo/node!path xide/mixins/EventedMixin xide/mixins/ReloadMixin dojo/Deferred xcf/model/Variable nxapp/utils".split(" "),function(e,p,m,n,f,b,a,d,c,g,r){return e([n,p],{declaredClass:"nxapp.manager.DriverManager",createDriverInstance:function(g){var h=
this.ctx,l=h.getDeviceManager(),k=h.getDriverManager(),n=g.driverScope,p=g.deviceScope,u=new c,z=g.system_drivers+"/DriverBase.js",v=g[n]+"/"+g.driver,x=g.driverId,D=g.deviceId||g.id,A=g[n],J=g[p],H=g.hash,G=k.getDriverById(x),y=l.getDeviceById(D,l.stores[p]);if(!G){if(!A)return f.error("invalid drivers path "+A,g),u.reject("invalid drivers path "+A),u;D=h.getDrivers(b.resolve(A),n);if(!D||!D.length)return u.reject("have no devices at "+A),u;A=this.createStore({items:D},n,!1);G=k.getDriverById(x,
A);if(!G)return u.reject("cant find driver "+x),u}if(!y){k=h.getDevices(b.resolve(J),p);if(!k||!k.length)return u.reject("have no devices at "+J),u;y=l.initStore({items:k},p,!1).getSync(g.devicePath);if(!y)return u.reject("cant find device "+g.devicePath),u}y.info=g;var C=this;require(["system_drivers/DriverBase"],function(b){b.prototype.declaredClass=z;require([n+"/"+g.driver.replace(".js","")],function(c){c=new (e([b,a.dcl,d.dcl,c],{}));c.declaredClass=v;c.options=g;c.baseClass=b.prototype.declaredClass;
c.modulePath=v;c.delegate=l;c.driver=G;c.serverSide=g.serverSide;c.utils=r;c.types=m;c.device=y;c.id=r.createUUID();c.getDevice=function(){return this.device};c.getDeviceInfo=function(){return this.getDevice().info};var k=G.user,n=r.getCIByChainAndName(k,0,m.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);n&&n.params&&(c.sendSettings=r.getJson(n.params));(k=r.getCIByChainAndName(k,0,m.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&k.params&&(c.responseSettings=r.getJson(k.params));try{c.start(),c.initReload()}catch(t){f.error("crash in driver instance startup! "+
y.toString())}C.driverInstance=c;k=x+"_"+H+"_"+y.path;G.blox&&G.blox.blocks||(f.error("Attention : INVALID driver",y.toString()),G.blox={blocks:[]});G.blockPath&&(r.getJson(r.readFile(G.blockPath)),G.blox=r.getJson(r.readFile(G.blockPath)));l.deviceInstances||(l.deviceInstances={});l.deviceInstances[H]=c;k=h.getBlockManager().createScope({id:k,device:y,driver:G,instance:c,ctx:h,serverSide:g.serverSide,uuid:r.createUUID(),getContext:function(){return this.instance}},dojo.clone(G.blox.blocks));c.blockScope=
k;y.blockScope=k;y.driverInstance=c;C.blockScope=k;u.resolve({driverInstance:c,blockScope:k})})});u.then(function(a){a.blockScope.start()});return u}})})},"xcf/manager/DriverManager":function(){define("dcl/dcl dojo/_base/declare dojo/_base/lang dojo/_base/json xide/types xcf/types/Types xide/utils xcf/manager/BeanManager xcf/model/Variable xcf/manager/DriverManager_Server xide/data/TreeMemory xide/data/ObservableStore dstore/Trackable xdojo/has xcf/model/Driver xide/manager/ServerActionBase xide/data/Reference dojo/Deferred xide/mixins/ReloadMixin xide/mixins/EventedMixin xdojo/has!xcf-ui?./DriverManager_UI xdojo/has!xcf-ui?xide/views/_CIDialog".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r,q,h,l,k,t,w,u,z,v,x,D){m=[t,d,g];l("runDrivers");l("xcf-ui")&&m.push(x);return e(m,{beanName:"Driver",beanUrlPattern:"{id}",breanScheme:"driver://",onStoreCreated:function(a){var b=a.type;a=a.store;var c=a.query({isDir:!1});if(b===f.ITEM_TYPE.DRIVER)for(b=0;b<c.length;b++){var k=c[b];null==k._completed&&"Default"!==k.name&&(k._completed=!0,l("xcf-ui")&&this.completeDriver(a,k,k))}},removeDriverInstance:function(a,b){try{this.getContext().getDeviceManager().toDeviceControlInfo(b);
var c=this.getDriverById(a.device.info.driverId),k=c._store,d=c.path,g=d+"_instances_instance_"+b.path,h=k.getSync(g);h&&k.removeSync(g);var f=_.find(c.instances,{path:g});f&&c.instances.remove(f);b.removeReference(h);h&&(h.refresh(),k.getSync(d+"_instances").refresh())}catch(l){logError(l,"error removing driver instance")}},createDriverBlockScope:function(b){var c=a.clone(b.blox&&b.blox.blocks?b.blox.blocks:[]);return b.blockScope=this.ctx.getBlockManager().createScope({id:b.id,device:null,driver:b,
instance:null,ctx:this.ctx,getContext:function(){return this.instance}},c,function(a){a&&console.error(a+" : in "+b.name+" , re-save driver!")})},addDeviceInstance:function(a,b){},declaredClass:"xcf.manager.DriverManager",beanNamespace:"driver",beanName:"Driver",beanIconClass:"fa-exchange",groupType:f.ITEM_TYPE.DRIVER_GROUP,itemType:f.ITEM_TYPE.DRIVER,itemMetaTitleField:f.DRIVER_PROPERTY.CF_DRIVER_NAME,defaultScope:"system_drivers",serviceClass:"XCF_Driver_Service",rawData:null,store:null,treeView:null,
driverScopes:null,_isLoading:!1,getDriverModule:function(b){var c=new u,k=a.getCIInputValueByName(b.user,f.DRIVER_PROPERTY.CF_DRIVER_CLASS);b=b.scope;k=k?k.replace("./",""):"";b=require.toUrl(b);b=a.removeURLParameter(b,"bust");b=a.removeURLParameter(b,"time");b=b.replace("/main.js","");require.cache||(b=b.replace("/.js","/"));var d;d=(b+"/"+k).replace("?","");try{require([d],function(a){c.resolve(a)})}catch(g){console.error("error loading driver module from  "+b+"---"+k,g),logError(g,"error loading driver module"),
c.reject(g.message)}return c},loadDriverModule:function(b){var c=this.driverScopes.system_drivers+"DriverBase";require.toUrl(this.driverScopes.system_drivers);var k=this,d=new u,g=require;g([c],function(c){var h=k.driverScopes[b.scope],l=!require.cache;l?require({config:{urlArgs:null}}):require({cacheBust:null});h=require.toUrl(h);l&&(h=h.replace("/.js","/"));var q=a.getCIInputValueByName(b.user,f.DRIVER_PROPERTY.CF_DRIVER_CLASS),q=q.replace("./",""),q=q.replace(".js",""),q=b.scope+"/"+q,q=q.replace("",
"").trim();try{g.undef(q),g([q],function(a){function b(c,k){a.getFields=c.getFields;c.onReloaded=b;k.onReloaded=b}a.declaredClass=q;e([c,v.dcl,z.dcl,a],{}).getFields=a.getFields;a.onReloaded=b;d.resolve(a)})}catch(r){}});return d},getBlock:function(b){b=a.parse_url(b);b=a.urlArgs(b.host);var c=this.getItemById(b.driver.value),k=null;c&&c.blockScope&&(k=c.blockScope.getBlockById(b.block.value));return k},getDriverByUrl:function(b){b=a.parse_url(b);b=a.urlArgs(b.host);return this.getItemById(b.driver.value)},
_driverQueryCache:null,_getDriverById:function(b,c){if(c&&c.getSync){var k=c.query();_.isArray(k)||(k=[k]);for(var d=0;d<k.length;d++){var g=k[d];if(!g.isDir){var h=a.getInputCIByName(g.user,f.DRIVER_PROPERTY.CF_DRIVER_ID);if(h&&h.value==b)return c.getSync(g.path)}}return null}},getDriverById:function(a,b){if(b)return this._getDriverById(a,b);var c=null,k=null;l("xcf-ui");for(var d in this.stores)if(b=this.stores[d],c=this._getDriverById(a,b)){k=c;break}l("xcf-ui");return k},getDriverByPath:function(b){var c=
null,k;for(k in this.stores){a:{c=a.queryStore(this.stores[k],{isDir:!1});_.isArray(c)||(c=[c]);for(var d=0;d<c.length;d++){var g=c[d];if(g.path==b){c=g;break a}}c=null}if(c)return c}return null},getItemById:function(a){return this.getDriverById(a)},onNewDriverScopeCreated:function(a){},onScopeCreated:function(a){},onDeviceDisconnected:function(a){},onDriverCreated:function(a){l("xcf-ui")&&f.registerEnumeration("Driver",this.getDriversAsEnumeration(a))},onDriverRemoved:function(a,b){l("xcf-ui")&&
f.registerEnumeration("Driver",this.getDriversAsEnumeration(a))},onStoreReady:function(a){l("xcf-ui")&&f.registerEnumeration("Driver",this.getDriversAsEnumeration(a));console.log("driver store: ",a)},createStore:function(b,c,d){b&&!b.items&&b["0"]&&(b={items:b["0"].items});var g=new (p("driverStore",[r,h,q],{}))({data:[],Model:k,idProperty:"path",scope:c,id:a.createUUID(),observedProperties:["name","enabled"]});b&&b.items&&(g.setData(b.items),_.each(b.items,function(a){a._store=g}));c&&!1!==d&&this.setStore(c,
g);return g},initStore:function(a,b,c){return this.createStore(a,b,c)},getStore:function(a){a=a||"system_drivers";var b=this.stores[a];return b?b:this.ls(a)},ls:function(a,b){function c(d){try{var g=this.createStore(d,a,b);this.onStoreReady(g);!1!==b&&this.publish(f.EVENTS.ON_STORE_CREATED,{data:d,owner:this,store:g,type:this.itemType});k.resolve(g)}catch(h){logError(h,"error ls drivers")}}var k=new u;if(this.prefetch&&this.prefetch[a])return c.apply(this,[this.prefetch[a]]),delete this.prefetch[a],
k;l("php")?this.runDeferred(null,"ls",[a]).then(c.bind(this)):k.resolve({items:[]});return k},init:function(){var a=this,b=f.EVENTS;this.subscribe([b.ON_SCOPE_CREATED,b.ON_STORE_CREATED]);this.subscribe(b.ON_BLOCK_EXPRESSION_FAILED,function(c){a.publish(b.ON_SERVER_LOG_MESSAGE,{data:{type:"Expression",device:c.deviceInfo},level:"error",message:"Expression Failed: "+c.item.title+" : "+c.item.value})});this.driverScopes={system_drivers:"system_drivers/",user_drivers:"user_drivers/"}}})})},"xcf/manager/BeanManager":function(){define("dcl/dcl xdojo/has dojo/_base/lang xide/types xide/utils xide/manager/BeanManager dojo/Deferred xide/noob xdojo/has!xtrack?xide/interface/Track xdojo/has!xcf-ui?xide/views/ActionDialog xdojo/has!xcf-ui?xide/views/CIActionDialog xdojo/has!xcf-ui?xide/views/CIGroupedSettingsView".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r,q){b=e(b,{getItemByPath:function(a){for(var b in this.stores){var c=this.stores[b].getSync(a);if(c)return c}},setStore:function(a,b){var c=this.stores[a];c&&(console.error("setting existing store "+a),c.destroy(),delete this.stores[a]);return this.stores[a]=b},onCIUpdate:function(a){a.owner===this&&this.updateCI(a.ci,a.newValue,a.oldValue,a.storeItem)},init:function(){this.stores={};this.subscribe(n.EVENTS.ON_CI_UPDATE)}});return p("xcf-ui")?e(b,{declaredClass:"xcf.manager.BeanManager",
getViewClass:function(a,b){a=a||{};f.mixin(a,{startup:function(){c&&this.getContext().getTrackingManager().track(this.getTrackingCategory(),this.getTrackingLabel(this.item),this.getTrackingUrl(this.item),n.ACTION.OPEN,this.getContext().getUserDirectory());if(this.inherited)return this.inherited(arguments)}});return e([b||q,c?c.dcl:d.dcl],a)},getFile:function(b){var c=new a,k=this.getContext().getFileManager().getStore(b.scope);k.initRoot().then(function(){k._loadPath(".",!0).then(function(){k.getItem(b.path,
!0).then(function(a){c.resolve(a)})})});return c},toUrl:function(a,b,c,d){return m.replace((d||"")+"deviceScope\x3d{deviceScope}\x26device\x3d{deviceId}\x26driver\x3d{driverId}\x26driverScope\x3d{driverScope}\x26block\x3d{block}",{deviceId:a.id,deviceScope:a.scope,driverId:b.id,driverScope:b.scope,block:c?c.id:""})},newGroup:function(){var a=this,b=this.getItem(),c=b?!0===b.isDir?b.path:"":"",b=new r({title:"New "+this.groupType,delegate:{onOk:function(b,d){var g=f.getCIInputValueByName(d,"Title"),
l=f.getCIInputValueByName(d,"Scope");a.createGroup(l,c+"/"+g,function(){var b=a.createNewGroupItem(g,l,c);a.store.putSync(b);a.publish(n.EVENTS.ON_STORE_CHANGED,{owner:a,store:a.store,action:n.NEW_DIRECTORY,item:b})})}},cis:[f.createCI("Title",13,""),f.createCI("Scope",3,this.defaultScope,{options:[{label:"System",value:this.defaultScope},{label:"User",value:this.userScope}]})]});b.startup();b.show()},onDeleteItem:function(a){var b=!0===f.toBoolean(a.isDir),c=b?"removeGroup":"removeItem",d=this;(new g({title:"Remove "+
this.beanName+(b?" Group":"")+' "'+a.name+'"  ',style:"max-width:400px",titleBarClass:"text-danger",delegate:{isRemoving:!1,onOk:function(){d[c](f.toString(a.scope),f.toString(a.path),f.toString(a.name),function(){d.onItemDeleted(a);d.publish(n.EVENTS.ON_STORE_CHANGED,{owner:d,store:d.store,action:n.DELETE,item:a})})}}})).show()},createNewGroupItem:function(a,b,c){return this.createItemStruct(a,b,c,a,!0,this.groupType)},createNewItem:function(a,b,c){return this.createItemStruct(a,b,c,c+"/"+a,!1,this.itemType)},
createItem:function(a,b,c,d,g){return this.runDeferred(null,"createItem",[a,b,c,d,g])},ls:function(a,b){return this.runDeferred(null,"ls",[a]).then(function(a){try{this.rawData=a,this.initStore(a),this.publish(n.EVENTS.ON_STORE_CREATED,{data:a,owner:this,store:this.store,type:this.itemType})}catch(b){logError(b,"error ls")}}.bind(this))}}):b})},"xide/manager/BeanManager":function(){define("dcl/dcl dojo/_base/lang xdojo/has xide/utils xide/encoding/MD5 xide/registry xide/data/TreeMemory".split(" "),
function(e,p,m,n,f,b,a){return e(null,{declaredClass:"xide.manager.BeanManager",beanNamespace:"beanNS",beanName:"beanName",beanPriority:-1,createItemStruct:function(a,b,g,f,e,h){return{name:a,isDir:e,parentId:g,path:f,beanType:h,scope:b}},getMetaValue:function(a,b){return n.getCIInputValueByName(n.getAt(a,this.itemMetaPath||"user"),b)},getStore:function(){return this.store},isValid:function(){return null!=this.store},initStore:function(b){this.store=new a({data:b.items,idProperty:"path"});this.onStoreReady(this.store);
return this.store},onStoreReady:function(){},_onReloaded:function(a){this.mergeNewModule(a.prototype);a=this.declaredClass;(a=p.getObject(n.replaceAll("/",".",a))||p.getObject(a))&&a.prototype&&a.prototype.solve&&this.mergeNewModule(a.prototype)}})})},"xide/registry":function(){define(["dojo/_base/array","dojo/_base/window","xdojo/has"],function(e,p,m){var n={},f={},b={length:0,add:function(a){this._hash[a.id]&&(this.remove(a.id),this.add(a));f[a.id]=a;this.length++},remove:function(a){f[a]&&(delete f[a],
this.length--)},byId:function(a){return"string"==typeof a?f[a]:a},byNode:function(a){return f[a.getAttribute("widgetId")]},toArray:function(){return _.values(_.mapKeys(f,function(a,b){a.id=b;return a}))},getUniqueId:function(a){var b;do b=a+"_"+(a in n?++n[a]:n[a]=0);while(f[b]);return b},findWidgets:function(a,b){function c(a){for(a=a.firstChild;a;a=a.nextSibling)if(1==a.nodeType){var e=a.getAttribute("widgetId");e?(e=f[e])&&g.push(e):a!==b&&c(a)}}var g=[];c(a);return g},_destroyAll:function(){_.each(b.findWidgets(p.body()),
function(a){a._destroyed||(a.destroyRecursive?a.destroyRecursive():a.destroy&&a.destroy())})},getEnclosingWidget:function(a){for(;a;){var b=1==a.nodeType&&a.getAttribute("widgetId");if(b)return f[b];a=a.parentNode}return null},_hash:f};return b})},"xide/noob":function(){define(["xdojo/declare","dcl/dcl"],function(e,p){var m=e("noob",null,{});m.dcl=p(null,{});return m})},"xcf/model/Variable":function(){define(["dcl/dcl","xide/types","xblox/model/variables/Variable"],function(e,p,m){return e(m,{declaredClass:"xcf.model.Variable",
hasInlineEdits:!0,gui:"off",cmd:"off",save:!1,target:"None",name:"No Title",value:-1,observed:["value","initial","name"],solve:function(){var e="";if("processVariables"===this.group){var f=this.scope.getVariable("value");f&&(f=f.value,this.isNumber(f)||(f="'"+f+"'"),e="var value \x3d "+f+";\n")}return this.scope.parseExpression(e+this.getValue(),!0)},canEdit:function(){return!0},canDisable:function(){return!1},getFields:function(){var e=this.getDefaultFields();e.push(this.utils.createCI("title",13,
this.name,{group:"General",title:"Name",dst:"name"}));var f=this;e.push(this.utils.createCI("value",this.types.ECIType.EXPRESSION,this.value,{group:"General",title:"Value",dst:"value",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!1,autoFocus:!1,hasConsole:!1},aceOptions:{hasEmmet:!1,hasLinking:!1,hasMultiDocs:!1},item:this},delegate:{runExpression:function(b,a,d){if("processVariables"==f.group){var c=f.scope.getVariable("value"),g="";c&&(c=c.value,f.isNumber(c)||
(c="'"+c+"'"),g="var value \x3d "+c+";\n")}return f.scope.expressionModel.parse(f.scope,g+b,!1,a,d)}}}));e.push(this.utils.createCI("flags",5,this.flags,{group:"General",title:"Flags",dst:"flags",data:[{value:4096,label:"Dont parse",title:"Do not parse the string and use it as is"},{value:2048,label:"Expression",title:"Parse it as Javascript"}],widget:{hex:!0}}));return e},onChangeField:function(e,f,b){"value"===e&&this.publish(p.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:this,scope:this.scope,save:!1,
source:p.MESSAGE_SOURCE.GUI})}})})},"xblox/model/variables/Variable":function(){define(["dcl/dcl","xide/types","xblox/model/Block"],function(e,p,m){return e(m,{declaredClass:"xblox.model.variables.Variable",name:null,value:null,register:!0,readOnly:!1,initial:null,isVariable:!0,flags:4096,getValue:function(){return this.value},canDisable:function(){return!1},canMove:function(){return!1},getIconClass:function(){return"el-icon-quotes-alt"},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+
'"\x3e\x3c/span\x3e '},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon()+this.makeEditable("name","right","text","Enter a unique name","inline")+"\x3c/span\x3e"},solve:function(){this.scope.parseExpression(this.getValue(),!0);return[]},getFields:function(){var e=this.getDefaultFields(),f=this;e.push(this.utils.createCI("title",p.ECIType.STRING,this.name,{group:"General",title:"Name",dst:"name"}));e.push(this.utils.createCI("value",p.ECIType.EXPRESSION,this.value,{group:"General",
title:"Value",dst:"value",delegate:{runExpression:function(b,a,d){return f.scope.expressionModel.parse(f.scope,b,!1,a,d)}}}));return e}})})},"xblox/model/Block":function(){define("dcl/dcl dojo/Deferred dojo/_base/lang dojo/has xblox/model/ModelBase xide/factory xide/utils xide/types xide/utils/ObjectUtils xide/lodash xdojo/has!xblox-ui?xblox/model/Block_UI".split(" "),function(e,p,m,n,f,b,a,d,c,g,r){function q(a,b){for(var c=0;c<b.length;c++)if(a.id===b[c].id)return c}n=[f];n.push(e(null,{getStatusIcon:function(){},
getStatusClass:function(){},setStatusClass:function(){},onActivity:function(){},onRun:function(){},onFailed:function(){},onSuccess:function(){},getIconClass:function(){}}));r&&n.push(r);a.mixin(d,{BLOCK_FLAGS:{NONE:0,ACTIVE:1,SCRIPT:2,RESERVED1:4,USEFUNCTION:8,RESERVED2:16,SINGLE:32,WAITSFORMESSAGE:64,VARIABLEINPUTS:128,VARIABLEOUTPUTS:256,VARIABLEPARAMETERINPUTS:512,VARIABLEPARAMETEROUTPUTS:1024,TOPMOST:16384,BUILDINGBLOCK:32768,MESSAGESENDER:65536,MESSAGERECEIVER:131072,TARGETABLE:262144,CUSTOMEDITDIALOG:524288,
RESERVED0:1048576,EXECUTEDLASTFRAME:2097152,DEACTIVATENEXTFRAME:4194304,RESETNEXTFRAME:8388608,INTERNALLYCREATEDINPUTS:16777216,INTERNALLYCREATEDOUTPUTS:33554432,INTERNALLYCREATEDINPUTPARAMS:67108864,INTERNALLYCREATEDOUTPUTPARAMS:134217728,INTERNALLYCREATEDLOCALPARAMS:1073741824,ACTIVATENEXTFRAME:268435456,LOCKED:536870912,LAUNCHEDONCE:2147483648},BLOCK_CALLBACKMASK:{PRESAVE:1,DELETE:2,ATTACH:4,DETACH:8,PAUSE:16,RESUME:32,CREATE:64,RESET:4096,POSTSAVE:256,LOAD:512,EDITED:1024,SETTINGSEDITED:2048,
READSTATE:4096,NEWSCENE:8192,ACTIVATESCRIPT:16384,DEACTIVATESCRIPT:32768,RESETINBREAKPOINT:65536,RENAME:131072,BASE:14,SAVELOAD:769,PPR:304,EDITIONS:3072,ALL:4294967295}});r=e(n,{declaredClass:"xblox.model.Block",scopeId:null,isCommand:!1,outlet:0,_destroyed:!1,enabled:!0,serializeMe:!0,name:null,shareTitle:"",sharable:!1,items:null,parent:null,_return:null,_lastResult:null,_deferredObject:null,_currentIndex:0,_lastRunSettings:null,_onLoaded:!1,beanType:"BLOCK",override:{},ignoreSerialize:"_didSubscribe _currentIndex _deferredObject _destroyed _return parent __started ignoreSerialize _lastRunSettings _onLoaded beanType sharable override virtual _scenario _didRegisterSubscribers additionalProperties renderBlockIcon serializeMe _statusIcon _statusClass hasInlineEdits _loop help owner _lastCommand allowActionOverride canDelete isCommand lastCommand autoCreateElse _postCreated _counter".split(" "),
_parseString:function(b,c,k,g){try{c=c||this._lastSettings||{};g=g||c.flags||d.CIFLAG.EXPRESSION;var f=this.scope,e=!(g&d.CIFLAG.DONT_PARSE),q=g&d.CIFLAG.EXPRESSION;g&d.CIFLAG.TO_HEX&&(b=a.to_hex(b));!1!==e&&(b=a.convertAllEscapes(b,"none"));var r=c.override||this.override||{},n=r&&r.variables?r.variables:null,m="",m=q&&!1!==e?f.parseExpression(b,null,n,null,null,null,r.args,g):""+b}catch(p){console.error(p)}return m},postCreate:function(){},childrenByClass:function(a){for(var b=this.getChildren(),
c=[],d=0;d<b.length;d++){var g=b[d];g.isInstanceOf(a)&&c.push(g)}return c},childrenByNotClass:function(a){for(var b=this.getChildren(),c=[],d=0;d<b.length;d++){var g=b[d];g.isInstanceOf(a)||c.push(g)}return c},getInstance:function(){var a=this.scope.instance;return a?a:null},pause:function(){},mergeNewModule:function(a){for(var b in a){var c=a[b];c&&g.isFunction(c)&&(this[b]=c)}},__onReloaded:function(b){this.mergeNewModule(b.prototype);b=this.declaredClass;(b=m.getObject(a.replaceAll("/",".",b))||
m.getObject(b))&&b.prototype&&b.prototype.solve&&this.mergeNewModule(b.prototype)},reparent:function(){if(!this)return!1;if(!this.getParent()){var a=this.next(null,1)||this.next(null,-1);a&&(this.group=null,a._add(this))}},unparent:function(a,b){if(!this)return!1;var c=this.getParent();c&&c.removeBlock&&c.removeBlock(this,!1);this.group=a;this.parent=this.parentId=null;!1!==b&&(this._place(null,-1,null),this._place(null,-1,null))},move:function(a){if(!this)return!1;var b=this.getParent(),c=null;if(b){c=
b[b._getContainer(this)];if(!c||2>c.length||!this.containsItem(c,this))return!1;b=this.indexOf(c,this);if(0>b+a)return!1;var d=c[b+a];if(!d)return!1;c[b+a]=this;c[b]=d}else this._place(null,a);return!0},_place:function(a,b,c){var d=this._store,f=this;(a=a||f.next(null,b))?(a=g.isString(a)?d.getSync(a):a,f=g.isString(f)?d.getSync(f):f,c=c||d.storage.fullData,b=-1==b?0:1,c.remove(f),-1==b&&(b=0),c.splice(Math.max(q(a,c)+b,0),0,f),d._reindex()):console.error("have no next",this)},index:function(){var a=
this.getParent(),b=null,c=this.group,b=this._store;if(a)return b=a[a._getContainer(this)]||[],b=b.filter(function(a){return a.group===c}),!b||2>b.length||!this.containsItem(b,this)?!1:this.indexOf(b,this);b=b.storage.fullData;b=b.filter(function(a){return a.group===c});return this.indexOf(b,this)},numberOfParents:function(){var a=0,b=this.getParent();b&&(a++,a+=b.numberOfParents());return a},getTopRoot:function(){var a=this.getParent();if(a){var b=a.getParent();b&&(a=b)}return a},next:function(a,
b){function c(a,b,d,g,f){var h=a.indexOf(b,a);if(h=b[h+d*g]){if(!h.parentId&&h.group&&h.group===a.group)return h;g++;return c(a,b,d,g,f)}return null}a=a||this._store.storage.fullData;return c(this,a,b,1,0)},getParent:function(a){if(this.parentId)return this.scope.getBlockById(this.parentId)},getScope:function(){var a=this.scope;if(this.scopeId&&0<this.scopeId.length){var b=a.owner;b&&b.hasScope&&(b.hasScope(this.scopeId)?a=b.getScope(this.scopeId):console.error("have scope id but cant resolve it",
this))}return a},canAdd:function(){return null},getTarget:function(){var a=this._targetReference;if(a)return a;var b=this.getParent();b&&b.getTarget&&(a=b.getTarget());return a},addToEnd:function(a,b){b&&null!=a.length&&null!=b.length&&a.push.apply(a,b);return a},removeBlock:function(a,b){a&&(!1!==b&&a.empty&&a.empty(),!1!==b&&delete a.items,a.parent=null,a.parentId=null,this.items&&this.items.remove(a))},_getContainer:function(a){return"items"},empty:function(a){try{this._empty(a)}catch(b){debugger}},
_empty:function(a){if(a=a||this.items)for(var b=0;b<a.length;b++){var c=a[b];c&&c.empty&&c.empty();c&&this.scope&&this.scope.blockStore&&this.scope.blockStore.remove(c.id)}},containsItem:function(a,b){for(var c=a.length;c--;)if(a[c].id===b.id)return!0;return!1},indexOf:function(a,b){for(var c=a.length;c--;)if(a[c].id===b.id)return c;return-1},_getBlock:function(a){if(!this||!this.parentId)return!1;var b=this.scope.getBlockById(this.parentId);if(!b)return null;b=b[b._getContainer(this)];if(!b||2>b.length||
!this.containsItem(b,this))return null;var c=this.indexOf(b,this);return 0>c+a?!1:(a=b[c+a])?a:null},getPreviousBlock:function(){return this._getBlock(-1)},getNextBlock:function(){return this._getBlock(1)},_getPreviousResult:function(){var a=this.getPreviousBlock()||this.getParent();return a&&null!=a._lastResult?this.isArray(a._lastResult)?a._lastResult:[a._lastResult]:null},getPreviousResult:function(){var a=null;if((a=(a=this.getPreviousBlock())&&a._lastResult&&a.enabled?a:this.getParent())&&!a._lastResult){var b=
a.getParent();b&&(a=b)}return a&&null!=a._lastResult?(this.isArray(a._lastResult),a._lastResult):null},_getArg:function(a,b){var c=parseFloat(a);return isNaN(c)?"true"===a||"false"===a?"true"===a:a&&b&&g.isString(a)?"'"+a+"'":a:c},getArgs:function(b){var c=[];b=b||{};var k=b.args||this._get("args");b.override&&b.override.args&&(k=b.override.args);k&&(c=a.getJson(k,null,!1));if(c&&0==c.length&&k&&k.length&&g.isString(k)){if(-1!==k.indexOf(",")){k=k.split(",");for(b=0;b<k.length;b++){var d=parseFloat(k[b]);
isNaN(d)?"true"===k[b]||"false"===k[b]?c.push(a.toBoolean(k[b])):c.push(k[b]):c.push(d)}return c}c=[this._getArg(k)]}!g.isArray(c)&&(c=[]);b=this.getPreviousResult();null!=b&&(g.isArray(b)&&1==b.length?c.push(b[0]):c.push(b));return c||[k]},remove:function(a){this._destroyed=!0;null!=this.parentId&&null==this.parent&&(this.parent=this.scope.getBlockById(this.parentId));if(this.parent&&this.parent.removeBlock)this.parent.removeBlock(this);else if(a=a||this)a.empty&&a.empty(),delete a.items,a.parent=
null,this.items&&this.items.remove(a)},prepareArgs:function(a){a||(a={});a.id||(a.id=this.createUUID());a.items||(a.items=[])},_add:function(a,c,k,d){var g=null;try{c?(this.prepareArgs(c),g=b.createBlock(a,c,null,d)):null==c&&(g=a);(g.scope=this.scope)&&(g=this.scope.registerBlock(g,d));g.parent=this;g.parentId=this.id;g.scope=this.scope;var f=k||this._getContainer();if(f)if(this[f]||(this[f]=[]),-1!==this.indexOf(this[f],g))console.error(" have already "+g.id+" in "+f);else{if(this.id==g.id){console.error("tried to add our self to "+
f);return}this[f].push(g)}g.group=null;return g}catch(e){logError(e,"_add")}return null},getStore:function(){return this.getScope().getStore()},add:function(a,b,c){a=this._add(a,b,c);return a.getStore().getSync(a.id)},getContext:function(){return this.scope.instance&&this.scope.instance?this.scope.instance:null},resolved:function(){this._deferredObject&&(this._deferredObject.resolve(),delete this._deferredObject)},_solve:function(a,b){b=b||{highlight:!1};for(var c=[],d=0;d<this.items.length;d++)this.addToEnd(c,
this.items[d].solve(a,b));return c},solve:function(a,b){b=b||{highlight:!1};for(var c=[],d=0;d<this.items.length;d++)this.addToEnd(c,this.items[d].solve(a,b));return c},solveMany:function(a,b){!this._lastRunSettings&&b&&(this._lastRunSettings=b);b=this._lastRunSettings||b;this._currentIndex=0;this._return=[];var c=this[this._getContainer()];if(c.length)return c=this.runFrom(c,0,b),this.onSuccess(this,b),c;this.onSuccess(this,b);return[]},runFrom:function(a,b,c){var d=this;a=a||this.items;this._return||
(this._return=[]);var g=function(b){b._deferredObject.then(function(g){b._lastResult=b._lastResult||g;d._currentIndex++;d.runFrom(a,d._currentIndex,c)})};if(a.length)for(;b<a.length;b++){var f=a[b];if(!0===f.deferred){f._deferredObject=new p;this._currentIndex=b;g(f);this.addToEnd(this._return,f.solve(this.scope,c));break}else this.addToEnd(this._return,f.solve(this.scope,c))}else this.onSuccess(this,c);return this._return},serializeField:function(a){return-1==this.ignoreSerialize.indexOf(a)},onLoad:function(){},
activate:function(){},deactivate:function(){},_get:function(a){if(this.override)return a in this.override?this.override[a]:this[a]},onDidRun:function(){this.override&&(this.override.args&&delete this.override.args,delete this.override)},destroy:function(){this.stop(!0);this.reset();this._destroyed=!0},reset:function(){this._lastSettings={};clearTimeout(this._loop);this._loop=null;delete this.override;this.override=null;delete this._lastResult;this.override={}},stop:function(){this.reset();this.getItems&&
g.invoke(this.getItems(),"stop")}});r.FLAGS=d.BLOCK_FLAGS;r.EMITS=d.BLOCK_CALLBACKMASK;r.prototype.onSuccess||(r.prototype.onSuccess=function(){},r.prototype.onRun=function(){},r.prototype.onFailed=function(){});e.chainAfter(r,"stop");e.chainAfter(r,"destroy");e.chainAfter(r,"onDidRun");return r})},"xblox/model/ModelBase":function(){define(["dcl/dcl","xide/utils","xide/types","xide/mixins/EventedMixin","xide/lodash"],function(e,p,m,n,f){n=e(n.dcl,{declaredClass:"xblox.model.ModelBase",id:null,description:"",
parent:null,parentId:null,group:null,order:0,_store:null,outputs:function(){return[]},takes:function(){return[]},needs:function(){return[]},constructor:function(b){for(var a in b)b.hasOwnProperty(a)&&(this[a]=b[a]);this.id||(this.id=this.createUUID());this.utils=p;this.types=m},keys:function(b){var a=[],d;for(d in b)a.push(d);return a},values:function(b){var a=[],d;for(d in b)a.push(b[d]);return a},toArray:function(){return this.map()},size:function(){return this.toArray().length},createUUID:p.createUUID,
canEdit:function(){return!0},getFields:function(){return null},isString:function(b){return"string"==typeof b},isNumber:function(b){return"number"==typeof b},isBoolean:function(b){return"boolean"==typeof b},isObject:f.isObject,isArray:f.isArray,getValue:function(b){var a=parseFloat(b);return isNaN(a)?"true"===b||!0===b?!0:"false"===b||!1===b?!1:b:a},isScript:function(b){return this.isString(b)&&(-1!=b.indexOf("return")||-1!=b.indexOf(";")||-1!=b.indexOf("(")||-1!=b.indexOf("+")||-1!=b.indexOf("-")||
-1!=b.indexOf("\x3c")||-1!=b.indexOf("*")||-1!=b.indexOf("/")||-1!=b.indexOf("%")||-1!=b.indexOf("\x3d")||-1!=b.indexOf("\x3d\x3d")||-1!=b.indexOf("\x3e")||-1!=b.indexOf("[")||-1!=b.indexOf("{")||-1!=b.indexOf("}"))},replaceAll:function(b,a,d){return this.isString(d)?d.split(b).join(a):d},isInValidState:function(){return!0},destroy:function(){}});e.chainAfter(n,"destroy");return n})},"xcf/manager/DriverManager_Server":function(){define(["dcl/dcl","dojo/_base/declare","xide/types","xide/utils"],function(e,
p,m,n){return e(null,{declaredClass:"xcf.manager.DriverManager_Server",onDriverBlocksChanged:function(f,b){},onFileChanged:function(f){if("changed"===f.type&&!f._didb){f._didb=!0;var b=n.replaceAll("\\","/",f.path),b=n.replaceAll("//","/",b),b=b.replace(/\\/g,"/"),a;a=b;a=-1!=a.indexOf("system/driver")?a.substr(a.indexOf("system/driver")+14,a.length):null;a&&-1!==a.indexOf(".xblox")&&(console.log("driver blocks changed "+a+" @ "+b,f),this.onDriverBlocksChanged(b,a))}},createDriverInstance:function(f,
b){var a=this,d=this.driverScopes.system_drivers+"DriverBase";require([d],function(c){c.prototype.declaredClass=d;var g=a.driverScopes[f.scope],e=n.getCIInputValueByName(f.user,m.DRIVER_PROPERTY.CF_DRIVER_CLASS);if(e){var q=g+e,q=q.replace(".js",""),q=q.replace("./","");require([q],function(d){d=new (p([c],d.prototype));d.baseClass=c.prototype.declaredClass;d.modulePath=n.replaceAll("//","/",q);d.delegate=a;f.instance=d;b&&b(d);try{d.start()}catch(g){}return d})}else console.error("cant find driver class in meta")})}})})},
"xcf/model/Driver":function(){define(["dcl/dcl","xide/data/Model","xide/data/Source","xide/mixins/EventedMixin","xide/utils"],function(e,p,m,n,f){return e([p,m.dcl,n.dcl],{itemMetaPath:"user.meta",getStore:function(){return this._store},getScope:function(){var b=this.getStore();return b?b.scope:this.scope},getMetaValue:function(b){return f.getCIInputValueByName(this.user,b)},setMetaValue:function(b,a,d){var c=f.getCIByChainAndName(this.user,0,b);if(c){var g=this.getMetaValue(b);f.setCIValueByField(c,
"value",a);this[b]=a;!1!==d&&this.publish(types.EVENTS.ON_CI_UPDATE,{owner:this.owner,ci:c,newValue:a,oldValue:g})}},getParent:function(){return this._store.getSync(this.parentId)}})})},"xide/data/Model":function(){define(["dcl/dcl","dojo/Deferred","dojo/aspect","dojo/when","xide/utils"],function(e,p,m,n,f){function b(a,b){var c=a.schema[b];void 0===c||c instanceof w||(c=new w(c),c._parent=a);c&&(c.name=b);return c}function a(a){var b,c=1;a(function(a,d,k){a&&a.then?(c++,b||(b=new p),a.then(function(a){d(a,
k);c--;c||b.resolve()}).then(null,b.reject)):d(a,k)});if(b)return c--,c||b.resolve(),b.promise}function d(){2>q&&l&&(l(),l=null);q--}function c(){return c}var g=[].slice,r=e(null,{declaredClass:"xide/data/Model",schema:{},additionalProperties:!0,_scenario:"update",constructor:function(a){this.init(a)},refresh:function(a,b){var c=this._store;c&&c.refreshItem(this,a,b)},getStore:function(){return this._store},getParent:function(){return this._store.getSync(this[this._store.parentProperty])},init:function(a){this._scenario=
"insert";a=this._setValues(a);for(var b in this.schema){var c=this.schema[b];c&&"object"===typeof c&&"default"in c&&!a.hasOwnProperty(b)&&(c=c["default"],a[b]="function"===typeof c?c.call(this):c)}},_setValues:function(a){return f.mixin(this,a)},_getValues:function(){return this._values||this},save:function(a){var b=this;return n(a&&a.skipValidation?!0:this.validate(),function(a){if(!a)throw b.createValidationError(b.errors);a=b._scenario;b.prepareForSerialization();return b._store&&n(b._store["insert"===
a?"add":"put"](b),function(a){b.set(a);b._scenario="update";return b})})},remove:function(){var a=this._store;return a.remove(a.getIdentity(this))},prepareForSerialization:function(){this._scenario=void 0;this._inherited&&(this._inherited.toJSON=c)},createValidationError:function(a){return Error("Validation error")},property:function(a,c){var d=this.hasOwnProperty("_properties")?this._properties:this._properties=new t,k=d[a];k||(k=b(this,a),k=d[a]=k?f.delegate(k):new w,k.name=a,k._parent=this);return c?
k.property.apply(k,g.call(arguments,1)):k},get:function(a){var c,d=this.schema[a];return(d=c||this.schema[a])&&d.valueOf&&(d.valueOf!==u||d.hasCustomGet)?((c=c||this.hasOwnProperty("_properties")&&this._properties[a])||(c=f.delegate(b(this,a),{name:a,_parent:this})),c.valueOf()):this._getValues()[a]},set:function(a,b){if("object"===typeof a){q++;try{for(var k in a)b=a[k],!a.hasOwnProperty(k)||b&&b.toJSON===c||this.set(k,b)}finally{d()}}else{k=this.schema[a];if(!k&&!this.additionalProperties)return console.warn("Schema does not contain a definition for",
a);var g=this.hasOwnProperty("_properties")&&this._properties[a];!g&&(b&&"object"===typeof b||k&&k.put!==z)&&(g=this.property(a));g?g.put(b):(k&&k.coerce&&(b=k.coerce(b)),this._getValues()[a]=b);return b}},observe:function(a,b,c){return this.property(a).observe(b,c)},validate:function(a){},isValid:function(){var a=!0,b;for(b in this.schema){var c=this.hasOwnProperty("_properties")&&this._properties[b];c&&c.errors&&c.errors.length&&(a=!1)}return a}});r.createSubclass=function(a,b){var c=e([this].concat(a),
b||{});c.extend=function(a){f.mixin(this.prototype,a);return this};return c};var q=0,h,l;(r.nextTurn=function(a){l=a}).atEnd=!0;var k=e(r,{observe:function(a,b){var c;if("string"===typeof a)return console.error("fff"),this.inherited(arguments);b&&b.onlyFutureUpdates||(c=new k,this._has()&&(c.value=a(this.valueOf())));var d=this._addListener(function(b){b=a(b);c&&c.put(b)});return c?(c.remove=d.remove,c):d},validateOnSet:!1,validators:null,_addListener:function(a){return m.after(this,"onchange",a,
!0)},valueOf:function(){return this._get()},_get:function(){return this.value},_has:function(){return this.hasOwnProperty("value")},setValue:function(a){this.value=a},put:function(a){var b=this._get();a=this.coerce(a);this.errors&&this.set("errors",void 0);var c=this;q++;return n(this.setValue(a,this._parent),function(k){void 0!==k&&(a=k);c.onchange&&c._queueChange(c.onchange,b);var g,f=b&&"object"===typeof b&&!(b instanceof Array),h=a&&"object"===typeof a&&!(a instanceof Array);if(f||h){k={};if(f)for(g in b=
b._getValues?b._getValues():b,b)k[g]={old:b[g]};if(h)for(g in a=a._getValues?a._getValues():a,a)(k[g]=k[g]||{}).value=a[g];c._values=h&&a;for(g in k)f=k[g],(h=c._properties&&c._properties[g])&&h.onchange&&h._queueChange(h.onchange,f.old)}c.validateOnSet&&c.validate();d()})},coerce:function(a){var b=this.type;b&&("string"===b?a=""+a:"number"===b?a=+a:"boolean"===b?a="false"===a||"0"===a||a instanceof Array&&!a.length?!1:!!a:"function"!==typeof b||a instanceof b||(a=new b(a)));return a},addError:function(a){this.set("errors",
(this.errors||[]).concat([a]))},checkForErrors:function(a){var b=[];this.type&&!("function"===typeof this.type?a instanceof this.type:this.type===typeof a)&&b.push(a+" is not a "+this.type);!this.required||null!=a&&""!==a||b.push("required, and it was not present");return b},validate:function(){var b=this,c=this._parent,d=this.validators,k=this.valueOf(),g=[];return n(a(function(a){function f(a){a&&g.push.apply(g,a)}if(d)for(var h=0;h<d.length;h++)a(d[h].checkForErrors(k,b,c),f);a(b.checkForErrors(k,
b,c),f)}),function(){if(g.length)return b.set("errors",g),!1;void 0!==b.get("errors")&&b.set("errors",void 0);return!0})},_queueChange:function(a,b){if(!a._queued){a._queued=!0;var c=this,d=function(){a._queued=!1;a.call(c,c._get(),b)};h&&h.push(d);h||(!r.nextTurn.atEnd||0<q?(h=[d],r.nextTurn(function(){for(var a=0;a<h.length;a++)h[a]();h=null})):d())}},toJSON:function(){return this._values||this}}),t=function(){};t.prototype.toJSON=c;var w=r.Property=e(k,{init:function(a){if("string"===typeof a||
"function"===typeof a)a={type:a};a&&f.mixin(this,a)},_get:function(){return this._parent._getValues()[this.name]},_has:function(){return this.name in this._parent._getValues()},setValue:function(a,b){b._getValues()[this.name]=a}}),u=w.prototype.valueOf,z=w.prototype.put;return r})},"xide/data/Source":function(){define(["dcl/dcl","dojo/_base/declare","xide/utils","xide/lodash"],function(e,p,m,n){var f={_references:null,_originReference:null,_store:null,onReferenceUpdate:function(){},onReferenceRemoved:function(){},
onReferenceDelete:function(){},updateReference:function(){},destroy:function(){this._references=null},getReferences:function(){return this._references?m.pluck(this._references,"item"):[]},hasReference:function(b){return n.find(this._references,{item:b})},addReference:function(b,a,d){!this._references&&(this._references=[]);if(this.hasReference(b))console.warn("already have reference");else{this._references.push({item:b,settings:a});if(a&&a.onDelete&&b._store)b._store.on("delete",function(a){a.target==
b&&(this._store.removeSync(this[this._store.idProperty]),this._references.remove(a.target))}.bind(this));d&&b.addSource&&b.addSource(this,a)}},removeReference:function(b){this._references&&n.each(this._references,function(a){if(a&&a.item==b)return this._references&&this._references.remove(a),!0},this)},updateReferences:function(b){var a=b.property,d=b.value;this._references||(this._references=[]);for(var c=0;c<this._references.length;c++){var g=this._references[c],f=g.item,g=g.settings,e=f._store;
if(this._originReference!=f&&b.property&&g.properties&&g.properties[b.property]){e&&e.silent(!0);try{if(f.onSourceChanged)f.onSourceChanged(a,d,b.type);else f.set(a,d)}catch(h){console.error("error updating reference! "+h,h)}e&&(e.silent(!1),e.emit("update",{target:f}))}}},constructor:function(b){this._references=[];m.mixin(this,b)},onItemChanged:function(b){this.updateReferences(b)}};p=p("xgrid.data.Source",null,f);p.dcl=e(null,f);p.Implementation=f;return p})},"xide/manager/ServerActionBase":function(){define("dcl/dcl dojo/_base/declare xdojo/has dojo/Deferred xide/manager/RPCService xide/manager/ManagerBase xide/types xide/utils".split(" "),
function(e,p,m,n,f,b,a,d){m={declaredClass:"xide.manager.ServerActionBase",serviceObject:null,serviceUrl:null,singleton:!0,serviceClass:null,defaultOptions:{omit:!0,checkMessages:!0,checkErrors:!0},base64_encode:function(a){var b,d,f,h,e=0,k=0,n="",n=[];if(!a)return a;do b=a.charCodeAt(e++),d=a.charCodeAt(e++),f=a.charCodeAt(e++),h=b<<16|d<<8|f,b=h>>18&63,d=h>>12&63,f=h>>6&63,h&=63,n[k++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(d)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(h);while(e<a.length);n=n.join("");a=a.length%3;return(a?n.slice(0,a-3):n)+"\x3d\x3d\x3d".slice(a||3)},runDeferred:function(a,b,d,f){var h=this;if(this.serviceObject.__init){if(this.serviceObject.__init.isResolved())return h._runDeferred(a,b,d,f);var e=new n;this.serviceObject.__init.then(function(){h._runDeferred(a,b,d,f).then(function(){e.resolve(arguments)})});
return e}return h._runDeferred(a,b,d,f)},_runDeferred:function(b,d,f,e){var h=new n,l;e=e||this.defaultOptions;this.check();if(!this.checkCall(b,d,e.omit))return h.reject("method doesnt exists: "+d+" for service class:"+this.serviceClass+" in "+this.declaredClass);this.prepareCall();var k=this.getService(),t=this.getServiceClass(b),m=this,u=function(a,b){var c=h;e.returnProm&&(c=l);c._data=a;if(b&&e.onError)return e.onError(b);c.resolve(a)};l=k[t][d](f);l.then(function(b){b=b||{};var c=b.error||{};
if(e.checkMessages&&c&&3==c.code)m.onMessages(c);if(e.checkErrors){if(1==c.code){e.displayError&&m.onError(c,t+"::"+d);h.reject(c);return}}else{if(1==c.code&&e.displayError)m.onError(c,t+"::"+d);if(c&&c.code&&0!==c.code){u(b,c);return}}e.omit&&m.publish(a.EVENTS.STATUS,{message:"Ok!",what:arguments},this);u(b)},function(a){m.onError(a)});return e.returnProm?l:h},getService:function(){return this.serviceObject},getServiceClass:function(a){return a||this.serviceClass},hasMethod:function(a,b){var d=
this.getService(),f=b||this.getServiceClass();return d&&f&&null!=d[f]&&null!=d[f][a]},findServiceUrl:function(a){var b=window.xFileConfig;if(b&&b.mixins)for(var d=0;d<b.mixins.length;d++){var f=b.mixins[d];if(f.declaredClass===a&&f.mixin&&f.mixin.serviceUrl)return decodeURIComponent(f.mixin.serviceUrl)}return null},init:function(){this.check()},_initService:function(){return!1},check:function(){this.serviceObject||this._initService()},onError:function(b,d){if(b)if(1===b.code){if(b.message&&_.isArray(b.message)){this.publish(a.EVENTS.ERROR,
{message:b.message.join("\x3cbr/\x3e")});return}}else 0===b.code&&this.publish(a.EVENTS.STATUS,"Ok");d&&(b.message=d+" -\x3e "+b.message);this.publish(a.EVENTS.ERROR,{error:b},this)},checkCall:function(a,b,d){a=this.getServiceClass(a);return this.getService()?this.hasMethod(b,a)||!0!==d?!0:(this.onError({code:1,message:["Sorry, server doesnt know "+b]}),!1):!1},prepareCall:function(){var a={};this.config&&this.config.RPC_PARAMS&&(a=d.mixin(a,this.config.RPC_PARAMS.rpcFixedParams),this.serviceObject.extraArgs=
a,this.config.RPC_PARAMS.rpcUserField&&(a[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.serviceObject.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.serviceObject.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken))},callMethodEx:function(b,d,f,e,h){(b=b||this.serviceClass)||console.error("have no service class! "+this.declaredClass,this);this.check();if(this.checkCall(b,d,h)){this.prepareCall();var l=this;return this.serviceObject[this.getServiceClass(b)][d](f).then(function(k){try{e&&
e(k)}catch(f){console.error("bad news : callback for method "+d+" caused a crash in service class "+b),logError(f,"server method failed "+f)}if(k&&k.error&&3==k.error.code)l.onMessages(k.error);if(k&&k.error&&k.error&&0!=k.error.code)l.onError(k.error);else 1==h&&l.publish(a.EVENTS.STATUS,{message:"Ok!"},this)},function(a){l.onError(a)})}},callMethodEx2:function(a,b,d,f,h){this.check();if(this.checkCall(a,b,h))return this.prepareCall(),this.serviceObject[this.getServiceClass(a)][b](d)},callMethod:function(b,
g,f,e){g=g||[[]];var h=this.serviceClass;try{var l=this;if(null==this.serviceObject[h][b]){if(!0===e)this.onError({code:1,message:["Sorry, server doesnt know "+b]});return null}h={};h=d.mixin(h,this.config.RPC_PARAMS.rpcFixedParams);h[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue;this.serviceObject.extraArgs=h;this.serviceObject.signatureField=this.config.RPC_PARAMS.rpcSignatureField;this.serviceObject.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken;this.serviceObject[this.serviceClass][b](g).then(function(b){try{f&&
f(b)}catch(c){logError(c,"Error calling RPC method")}if(b&&b.error&&3==b.error.code)this.onMessages(b.error);if(b&&b.error&&b.error&&1==b.error.code)this.onError(b.error);else!1!==e&&this.publish(a.EVENTS.STATUS,{message:"Ok!"},this)}.bind(this),function(a){this.onError(a)}.bind(this))}catch(k){l.onError(k),logError(k,"Error calling RPC method")}}};e=e(b,m);e.declare=p(null,m);return e})},"xide/manager/RPCService":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang xide/rpc/Service xide/rpc/JsonRPC dojo/has dojo/Deferred xide/utils xide/types xide/mixins/EventedMixin xide/encoding/SHA1".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r){return e("xide.manager.RPCService",[n,g],{extraArgs:null,signatureField:"sig",signatureToken:null,correctTarget:!0,sync:!1,defaultOptions:{omit:!0,checkMessages:!0,checkErrors:!0},onError:function(a){if(a)if(1===a.code){if(a.message&&_.isArray(a.message)){this.publish(c.EVENTS.ERROR,{message:a.message.join("\x3cbr/\x3e")});return}}else 0===a.code&&this.publish(c.EVENTS.STATUS,"Ok");this.publish(c.EVENTS.ERROR,{error:a},this)},prepareCall:function(){var a={};this.config&&
this.config.RPC_PARAMS&&(this.extraArgs=a=d.mixin(a,this.config.RPC_PARAMS.rpcFixedParams),this.config.RPC_PARAMS.rpcUserField&&(a[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken))},runDeferred:function(b,d,g,k){var f=new a;k=k||this.defaultOptions;if(!this.checkCall(b,d,k.omit))return f.reject("method doesnt exists: "+d+" for service class:"+this.serviceClass+
" in "+this.declaredClass);this.prepareCall();var e=this;this[this.getServiceClass(b)][d](g).then(function(a){if(k.checkMessages&&a&&a.error&&3==a.error.code)e.onMessages(a.error);k.checkErrors&&a&&a.error&&a.error&&0!=a.error.code?(e.onError(a.error),f.reject(a.error)):(k.omit&&e.publish(c.EVENTS.STATUS,{message:"Ok!",what:arguments},this),f.resolve(a))},function(a){e.onError(a)});return f},getParameterMap:function(a,b){var c=this._smd.services[a+"."+b];return c&&c.parameters?c.parameters:[]},_getRequest:function(a,
b){var c=this._smd,d=n.envelopeRegistry.match(a.envelope||c.envelope||"NONE"),g=(a.parameters||a.params||[]).concat(c.parameters||[]);if(d.namedParams){if(1==b.length&&m.isObject(b[0]))b=b[0];else{for(var f={},e=a.parameters||a.params,r=0;r<e.length;r++)"undefined"==typeof b[r]&&e[r].optional||(f[e[r].name]=b[r]);b=f}if(a.strictParameters||c.strictParameters)for(r in b){f=!1;for(e=0;e<g.length;e++)g[r].name==r&&(f=!0);f||delete b[r]}for(r=0;r<g.length;r++)if(f=g[r],!f.optional&&f.name&&null!=b&&!b[f.name])if(f["default"])b[f.name]=
f["default"];else if(!(f.name in b))throw Error("Required parameter "+f.name+" was omitted");}else g&&g[0]&&g[0].name&&1==b.length&&p.isObject(b[0])&&(b=!1===d.namedParams?n.toOrdered(g,b):b[0]);m.isObject(this._options)&&(b=p.mixin(b,this._options));g=a._schema||a.returns;r=d.serialize.apply(this,[c,a,b]);r._envDef=d;return p.mixin(r,{sync:this.sync,contentType:a.contentType||c.contentType||r.contentType,headers:a.headers||c.headers||r.headers||{},target:r.target||n.getTarget(c,a),transport:a.transport||
c.transport||r.transport,envelope:a.envelope||c.envelope||r.envelope,timeout:a.timeout||c.timeout,callbackParamName:a.callbackParamName||c.callbackParamName,rpcObjectParamName:a.rpcObjectParamName||c.rpcObjectParamName,schema:g,handleAs:r.handleAs||"auto",preventCache:a.preventCache||c.preventCache,frameDoc:this._options.frameDoc||void 0})},_executeMethod:function(a){var b=[],c;if(2==arguments.length&&m.isArray(arguments[1]))b=arguments[1];else for(c=1;c<arguments.length;c++)b.push(arguments[c]);
var d=this._getRequest(a,b);this.correctTarget&&(d.target=this._smd.target);if(this.extraArgs)for(var g in this.extraArgs)d.target+=-1!=d.target.indexOf("?")?"\x26":"?",d.target+=g+"\x3d"+this.extraArgs[g];this.signatureToken&&(d.target+=-1!=d.target.indexOf("?")?"\x26":"?",b=r._hmac(d.data,this.signatureToken,1),b=r._hmac(d.data,this.signatureToken,1),d.target+=this.signatureField+"\x3d"+b);b=n.transportRegistry.match(d.transport).fire(d);b.addBoth(function(a){return d._envDef.deserialize.call(this,
a)});return b},getServiceClass:function(a){return a||this.serviceClass},hasMethod:function(a,b){var c=b||this.getServiceClass();return this&&c&&null!=this[c]&&null!=this[c][a]},checkCall:function(a,b,c){a=this.getServiceClass(a);if(!this.hasMethod(b,a)&&!0===c){debugger;this.onError({code:1,message:["Sorry, server doesnt know "+b]});return!1}return!0},base64_encode:function(a){var b,c,d,g,f=0,e=0,r="",r=[];if(!a)return a;do b=a.charCodeAt(f++),c=a.charCodeAt(f++),d=a.charCodeAt(f++),g=b<<16|c<<8|
d,b=g>>18&63,c=g>>12&63,d=g>>6&63,g&=63,r[e++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(g);while(f<a.length);r=r.join("");a=a.length%3;return(a?r.slice(0,a-3):r)+"\x3d\x3d\x3d".slice(a||3)},callMethodEx:function(a,b,c,d,g,
f){if(!this[a]||null==this[a][b])return!0===f&&g&&g({code:1,message:["Sorry, server doesnt know "+b+" in class"+a]}),null;f={};this.config&&this.config.RPC_PARAMS&&(f=m.mixin(f,this.config.RPC_PARAMS.rpcFixedParams),f[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.extraArgs=f,this.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken);this[a][b](c).then(function(c){try{d&&d(c)}catch(f){console.error("bad news : callback for method "+
b+" caused a crash in service class "+a)}c&&c.error&&c.error&&0!=c.error.code&&g&&g(c.error)},function(a){g(a)})},callMethod:function(a,b,c,d,g,f){try{var e=this;if(null==this[a][b]){if(!0===f&&g){debugger;g({code:1,message:["Sorry, server doesnt know "+b]})}return null}f={};f=m.mixin(f,this.config.RPC_PARAMS.rpcFixedParams);this[a][b](c).then(function(a){try{d&&d(a)}catch(c){console.error("crashed in "+b),console.dir(c)}a&&a.error&&a.error&&1==a.error.code&&g&&g(a.error)},function(a){e.onError(a)})}catch(r){console.error("crash! "+
r)}}})})},"xide/rpc/Service":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/xhr dojo/_base/declare xide/rpc/AdapterRegistry dojo/_base/url xide/utils xide/lodash".split(" "),function(e,p,m,n,f,b,a,d){function c(a,b){var c=a._baseUrl;a.target&&(c=new e._Url(c,a.target)+"");b.target&&(c=new e._Url(c,b.target)+"");return c}function g(a,b){if(e.isArray(b))return b;for(var c=[],d=0;d<a.length;d++)c.push(b[a[d].name]);return c}var r=new f(!0),q=new f(!0),h=1;n=n("xide.rpc.Service",null,
{constructor:function(b,c){function g(a){a._baseUrl=new e._Url(e.isBrowser?location.href:e.config.baseUrl,f||".")+"";h._smd=a;c&&"methods"===c.services&&(a.services=a.methods,delete a.methods,a.transport="POST",c.mixin&&p.mixin(a,c.mixin),c=null);for(var b in h._smd.services){a=b.split(".");for(var d=h,l=0;l<a.length-1;l++)d=d[a[l]]||(d[a[l]]={});d[a[a.length-1]]=h._generateService(b,h._smd.services[b])}}var f,h=this;b&&(d.isString(b)||b instanceof e._Url?(f=b instanceof e._Url?b+"":b,this.__init=
m.getText(f),h=this,this.__init.then(function(b){g(a.fromJson(b))})):g(b));this._options=c?c:{};this._requestId=0},_generateService:function(a,b){if(this[b])throw Error("WARNING: "+a+" already exists for service. Unable to generate function");b.name=a;var c=e.hitch(this,"_executeMethod",b),d=r.match(b.transport||this._smd.transport);d.getExecutor&&(c=d.getExecutor(c,b,this));d=b.returns||(b._schema={});d._service=c;c.servicePath="/"+a+"/";c._schema=d;c.id=h++;return c},_getRequest:function(a,b){var d=
this._smd,f=q.match(a.envelope||d.envelope||"NONE"),h=(a.parameters||[]).concat(d.parameters||[]);if(f.namedParams){if(1==b.length&&e.isObject(b[0]))b=b[0];else{for(var r={},n=0;n<a.parameters.length;n++)"undefined"==typeof b[n]&&a.parameters[n].optional||(r[a.parameters[n].name]=b[n]);b=r}if(a.strictParameters||d.strictParameters)for(n in b){for(var r=!1,m=0;m<h.length;m++)h[m].name==n&&(r=!0);r||delete b[n]}for(n=0;n<h.length;n++)if(r=h[n],!r.optional&&r.name&&!b[r.name])if(r["default"])b[r.name]=
r["default"];else if(!(r.name in b))throw Error("Required parameter "+r.name+" was omitted");}else h&&h[0]&&h[0].name&&1==b.length&&e.isObject(b[0])&&(b=!1===f.namedParams?g(h,b):b[0]);e.isObject(this._options)&&(b=e.mixin(b,this._options));delete b.mixin;h=a._schema||a.returns;n=f.serialize.apply(this,[d,a,b]);n._envDef=f;return e.mixin(n,{sync:!1,contentType:a.contentType||d.contentType||n.contentType,headers:a.headers||d.headers||n.headers||{},target:n.target||c(d,a),transport:a.transport||d.transport||
n.transport,envelope:a.envelope||d.envelope||n.envelope,timeout:a.timeout||d.timeout,callbackParamName:a.callbackParamName||d.callbackParamName,rpcObjectParamName:a.rpcObjectParamName||d.rpcObjectParamName,schema:h,handleAs:n.handleAs||"auto",preventCache:a.preventCache||d.preventCache,frameDoc:this._options.frameDoc||void 0})},_executeMethod:function(a){var b=[],c;for(c=1;c<arguments.length;c++)b.push(arguments[c]);var d=this._getRequest(a,b),b=r.match(d.transport).fire(d);b.addBoth(function(a){return d._envDef.deserialize.call(this,
a)});return b}});n.transportRegistry=r;n.envelopeRegistry=q;n._nextId=h;n.getTarget=c;n.toOrdered=g;n._sync=!1;q.register("URL",function(a){return"URL"==a},{serialize:function(a,b,c){return{data:e.objectToQuery(c),transport:"POST"}},deserialize:function(a){return a},namedParams:!0});q.register("JSON",function(a){return"JSON"==a},{serialize:function(a,b,c){return{data:e.toJson(c),handleAs:"json",contentType:"application/json"}},deserialize:function(a){return a}});q.register("PATH",function(a){return"PATH"==
a},{serialize:function(a,b,d){var g;a=c(a,b);if(e.isArray(d))for(g=0;g<d.length;g++)a+="/"+d[g];else for(g in d)a+="/"+g+"/"+d[g];return{data:"",target:a}},deserialize:function(a){return a}});r.register("POST",function(a){return"POST"==a},{fire:function(a){a.url=a.target;a.postData=a.data;return e.rawXhrPost(a)}});r.register("GET",function(a){return"GET"==a},{fire:function(a){a.url=a.target+(a.data?"?"+(a.rpcObjectParamName?a.rpcObjectParamName+"\x3d":"")+a.data:"");return m.get(a)}});e._contentHandlers&&
(e._contentHandlers.auto=function(a){var b=e._contentHandlers,c=a.getResponseHeader("Content-Type");return c?c.match(/\/.*json/)?b.json(a):c.match(/\/javascript/)?b.javascript(a):c.match(/\/xml/)?b.xml(a):b.text(a):b.text(a)});return n})},"xide/rpc/AdapterRegistry":function(){define(["dojo/_base/kernel","dojo/_base/lang"],function(e,p){var m=e.AdapterRegistry=function(e){this.pairs=[];this.returnWrappers=e||!1};p.extend(m,{register:function(e,f,b,a,d){this.pairs[d?"unshift":"push"]([e,f,b,a])},match:function(){for(var e=
0;e<this.pairs.length;e++){var f=this.pairs[e];if(f[1].apply(this,arguments))return f[3]||this.returnWrappers?f[2]:f[2].apply(this,arguments)}throw Error("No match found");},unregister:function(e){for(var f=0;f<this.pairs.length;f++)if(this.pairs[f][0]==e)return this.pairs.splice(f,1),!0;return!1}});return m})},"xide/rpc/JsonRPC":function(){define(["./Service","dojo/errors/RequestError","xide/utils/StringUtils"],function(e,p,m){function n(f){return{serialize:function(b,a,d,c){b={id:this._requestId++,
method:a.name,params:d};f&&(b.jsonrpc=f);return{data:JSON.stringify(b),handleAs:"json",contentType:"application/json",transport:"POST"}},deserialize:function(b){if("Error"==b.name||b instanceof p)b=m.fromJson(b.responseText);if(b.error){var a=Error(b.error.message||b.error);a._rpcErrorObject=b.error;return a}return b.result}}}e.envelopeRegistry.register("JSON-RPC-1.0",function(f){return"JSON-RPC-1.0"==f},m.mixin({namedParams:!1},n()));e.envelopeRegistry.register("JSON-RPC-2.0",function(f){return"JSON-RPC-2.0"==
f},m.mixin({namedParams:!0},n("2.0")))})},"xide/encoding/SHA1":function(){define(["./_base"],function(e){function p(a,b){a[b>>5]|=128<<24-b%32;a[(b+64>>9<<4)+15]=b;for(var c=Array(80),g=1732584193,f=-271733879,q=-1732584194,h=271733878,l=-1009589776,k=0;k<a.length;k+=16){for(var n=g,m=f,p=q,z=h,v=l,x=0;80>x;x++){if(16>x)c[x]=a[k+x];else{var D=c[x-3]^c[x-8]^c[x-14]^c[x-16];c[x]=D<<1|D>>>31}D=e.addWords(e.addWords(g<<5|g>>>27,20>x?f&q|~f&h:40>x?f^q^h:60>x?f&q|f&h|q&h:f^q^h),e.addWords(e.addWords(l,
c[x]),20>x?1518500249:40>x?1859775393:60>x?-1894007588:-899497514));l=h;h=q;q=f<<30|f>>>2;f=g;g=D}g=e.addWords(g,n);f=e.addWords(f,m);q=e.addWords(q,p);h=e.addWords(h,z);l=e.addWords(l,v)}return[g,f,q,h,l]}function m(a){for(var b=[],c=0,g=8*a.length;c<g;c+=8)b[c>>5]|=(a.charCodeAt(c/8)&255)<<24-c%32;return b}function n(a){for(var b=[],c=0,g=4*a.length;c<g;c++)b.push("0123456789abcdef".charAt(a[c>>2]>>8*(3-c%4)+4&15),"0123456789abcdef".charAt(a[c>>2]>>8*(3-c%4)&15));return b.join("")}function f(a){for(var b=
[],c=0,g=32*a.length;c<g;c+=8)b.push(String.fromCharCode(a[c>>5]>>>24-c%32&255));return b.join("")}function b(a){for(var b=[],c=0,g=4*a.length;c<g;c+=3)for(var f=(a[c>>2]>>8*(3-c%4)&255)<<16|(a[c+1>>2]>>8*(3-(c+1)%4)&255)<<8|a[c+2>>2]>>8*(3-(c+2)%4)&255,e=0;4>e;e++)8*c+6*e>32*a.length?b.push("\x3d"):b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>6*(3-e)&63));return b.join("")}e.SHA1=function(a,d){var c=d||e.outputTypes.Base64,g=p(m(a),8*a.length);switch(c){case e.outputTypes.Raw:return g;
case e.outputTypes.Hex:return n(g);case e.outputTypes.String:return f(g);default:return b(g)}};e.SHA1._hmac=function(a,d,c){c=c||e.outputTypes.Base64;var g=m(d);16<g.length&&(g=p(g,8*d.length));var r=Array(16);d=Array(16);for(var q=0;16>q;q++)r[q]=g[q]^909522486,d[q]=g[q]^1549556828;a=p(r.concat(m(a)),512+8*a.length);a=p(d.concat(a),672);switch(c){case e.outputTypes.Raw:return a;case e.outputTypes.Hex:return n(a);case e.outputTypes.String:return f(a);default:return b(a)}};return e.SHA1})},"xide/manager/ManagerBase":function(){define("dcl/dcl xide/mixins/EventedMixin xide/model/Base xide/utils dojo/_base/xhr dojo/_base/kernel".split(" "),
function(e,p,m,n,f,b){p=e([m.dcl,p.dcl],{declaredClass:"xide.manager.ManagerBase",ctx:null,init:function(){this.initReload&&this.initReload()},_getText:function(a,b){var c;b=n.mixin({url:a,sync:!0,handleAs:"text",load:function(a){c=a}},b);var g=f.get(b);return b.sync?""+c+"":g},getContext:function(){return this.ctx}});e.chainAfter(p,"init");return p})},"xide/data/Reference":function(){define(["dcl/dcl","xide/utils","xide/lodash","xide/mixins/EventedMixin"],function(e,p,m,n){var f={_sources:[],destroyOnRemove:!0,
_store:null,removeSource:function(b){},updateSource:function(b){},onSourceUpdate:function(b){},onSourceRemoved:function(b){},onSourceDelete:function(b){},onItemChanged:function(b){},destroy:function(){(!this.item||this.item.removeReference)&&this.item&&this.item.removeReference(this);this.inherited&&this.inherited(arguments);if(this._sources){for(var b=0;b<this._sources.length;b++){var a=this._sources[b];a.item&&a.item.removeReference&&a.item.removeReference(this)}this._sources=null}},hasSource:function(b){return m.find(this._sources,
{item:b})},addSource:function(b,a){this.hasSource(b)||(this._sources.push({item:b,settings:a}),a&&a.onDelete&&this.addHandle("delete",b._store.on("delete",function(a){a.target==b&&this._store.removeSync(this[this._store.idProperty])}.bind(this))))},updateSources:function(b){for(var a=0;a<this._sources.length;a++){var d=this._sources[a],c=d.item,d=d.settings;b.property&&d.properties&&d.properties[b.property]&&(c._store.silent(!0),c.set(b.property,b.value),c._store.silent(!1),c._store.emit("update",
{target:c}))}},constructor:function(b){this._sources=[];p.mixin(this,b)}};e=e([n.dcl],f);e.Implementation=f;return e})},"xcf/manager/DeviceManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/encoding/MD5 xide/types xide/utils xide/factory xcf/manager/BeanManager xide/mixins/ReloadMixin xide/mixins/EventedMixin ./DeviceManager_Server ./DeviceManager_DeviceServer xide/data/Memory xide/data/TreeMemory dojo/has xide/data/ObservableStore dstore/Trackable xcf/model/Device dojo/Deferred xide/manager/ServerActionBase xide/data/Reference xide/utils/StringUtils xcf/mixins/LogMixin xdojo/has!xcf-ui?./DeviceManager_UI xdojo/has!xexpression?xexpression/Expression dojo/promise/all xide/console xide/lodash".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r,q,h,l,k,t,w,u,z,v,x,D,A,J,H,G,y,C,F,B){a=[v,d,r,q,c.dcl,A];var I=k("xcf-ui"),E=f.DEVICE_PROPERTY;k("runDrivers");var K=f.EVENTS;k("xcf-ui")&&a.push(J);return e(a,{declaredClass:"xcf.manager.DeviceManager",beanNamespace:"device",beanName:"Device",beanUrlPattern:"{id}",breanScheme:"device://",beanPriority:1,beanIconClass:"fa-sliders",groupType:f.ITEM_TYPE.DEVICE_GROUP,itemType:f.ITEM_TYPE.DEVICE,itemMetaTitleField:E.CF_DEVICE_TITLE,systemScope:"system_devices",userScope:"user_devices",
appScope:"app_devices",defaultScope:"system_devices",serviceClass:"XCF_Device_Service",rawData:null,store:null,treeView:null,deviceServerClient:null,deviceInstances:null,driverScopes:null,autoConnectDevices:!0,consoles:null,lastUpTime:null,reconnectDevice:15E3,reconnectDeviceServer:5E3,onRunClassEvent:function(a){var b=a.args.id||a.id;if(this.running&&this.running[b]){var c=this.running[b].delegate;if(c){a.error&&c.onError&&(c.onError(a.error),delete this.running[b]);a.finish&&c.onFinish&&(c.onFinish(a.finish),
delete this.running[b]);if(a.progress&&c.onProgress)c.onProgress(a.progress);if(a.interrupt&&c.onInterrupt)c.onInterrupt(a.interrupt)}}},getInstanceByName:function(a){var b=this.deviceInstances,c;for(c in b){var d=b[c].device;if(d&&this.getMetaValue(d,E.CF_DEVICE_TITLE)===a)return b[c]}},getFile:function(a){var b=new z,c=this.ctx;C.isString(a)&&(a=this.getItemByPath(a+".meta.json")||this.getItemByPath(a)||a);var d=c.getFileManager().getStore(a.scope);if(c=d._getItem(a.path))return b.resolve(c),b;
d.initRoot().then(function(){d._loadPath(".",!0).then(function(){d.getItem(a.path,!0).then(function(a){b.resolve(a)})})});return b},getSourceHash:function(){return this.ctx.getUserDirectory()||"no_user_directory"},checkDeviceServerConnection:function(){if(!this.ctx.getNodeServiceManager)return!0;var a=this.getContext(),a=k("xnode")&&a.getNodeServiceManager?this.ctx.getNodeServiceManager():null;if(!this.deviceServerClient&&a){a=a.getStore();if(!a)return!1;this.createDeviceServerClient(a)}else return!1;
return!0},addDriverFunctions:function(a,b){for(var c in b)"constructor"!==c&&"inherited"!==c&&"getInherited"!==c&&"isInstanceOf"!==c&&"__inherited"!==c&&"onModuleReloaded"!==c&&"start"!==c&&"publish"!==c&&"subscribe"!==c&&"getInherited"!==c&&"getInherited"!==c&&C.isFunction(b[c])&&!a[c]&&(a[c]=b[c])},addLoggingFunctions:function(a,b){var c=this;b.log=function(a,d,g,k){k=k||{};var e=m.clone(k);k.type=k.type||d||"Driver";b.options&&(k.device=b.options);c.publish(f.EVENTS.ON_SERVER_LOG_MESSAGE,{data:k,
level:a||"info",message:g,details:e})}},completeDriverInstance:function(a,b,c){var d=this,g=b.blockScope.blockStore,k=c.path,e=k+"_commands",h=k+"_variables";g.on("delete",function(a){var b=-1!==a.target.declaredClass.indexOf("Variable")?h:e,d=c._store.getSync(b);d&&d.refresh();(a=c._store.getSync(b+"_reference_"+a.target.id))&&a.refresh()});g.on("added",function(b){var d=b.name,g=b.icon||"fa-exclamation",k=-1!==b.declaredClass.indexOf("Variable"),l=k?h:e;-1!=b.declaredClass.indexOf(k?"Variable":
"Command")&&(d=new x({enabled:!0,path:l+"_reference_"+b.id,name:d,id:b.id,parentId:l,_mayHaveChildren:!1,virtual:!0,tooltip:!0,icon:g,ref:{driver:a,item:b,device:c},type:f.ITEM_TYPE.BLOCK}),d=c._store.putSync(d),b.addReference(d,{properties:{name:!0,enabled:!0,value:!0},onDelete:!0},!0),d.refresh())});b.setVariable=function(b,c,g,k,e){if(b=this.blockScope.getVariable(b))b.value=c,!1===e&&(b.__ignoreChangeMark=!0),b.set("value",c,g,k,e),!1===e&&(b.__ignoreChangeMark=!1),d.publish(f.EVENTS.ON_DRIVER_VARIABLE_CHANGED,
{item:b,scope:this.blockScope,driver:a,owner:d,save:!0===g,publish:k})};b.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a._getArg(a.value,!1):""};b.log=function(a,c,g,k){k=k||{};var e=m.clone(k);k.type=k.type||c||"Driver";b.options&&(k.device=b.options);d.publish(f.EVENTS.ON_SERVER_LOG_MESSAGE,{data:k,level:a||"info",message:g,details:e})};for(var l in a)"constructor"!==l&&"inherited"!==l&&"getInherited"!==l&&"isInstanceOf"!==l&&"__inherited"!==l&&"onModuleReloaded"!==l&&"start"!==
l&&"publish"!==l&&"subscribe"!==l&&"getInherited"!==l&&"getInherited"!==l&&m.isFunction(a[l])&&!b[l]&&(b[l]=a[l])},getDevice:function(a){var b=a;if(C.isString(a)){var c=this.getItemById(a);c?b=c:(a=this.getItemByPath(a))&&(b=a)}return b},stopDevice:function(a){var b=this.getDevice(a)||a;if(b){if(this.checkDeviceServerConnection(),b._userStopped=!0,(a=this.toDeviceControlInfo(b))&&(a.serverSide||b.isServer())){var c=a.hash;this.deviceInstances[c]&&(this._removeInstance(this.deviceInstances[c],c,b),
delete this.deviceInstances[c],this.sendManagerCommand(f.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER,a))}}else y.error("cant find device "+a)},getStore:function(a){a=a||"system_devices";var b=this.stores[a];if(b)return b;if(a)return this.ls(a)},getDevices:function(a,c){var d=this.getStore();if(!d)return[];d=b.queryStore(d,{isDir:!1});d._S&&(d=[d]);for(var g=[],k=0;k<d.length;k++){var f=d[k],e=this.getMetaValue(f,E.CF_DEVICE_ENABLED);if(!0===a&&!0===e||null===e||!1===a)if(g.push(f),!0===c&&(e=this.getMetaValue(f,
E.CF_DEVICE_DRIVER)))if(e=this.ctx.getDriverManager().getItemById(e))f.driver=e}return g},getStores:function(){var a=[],b;for(b in this.stores){var c=this.stores[b];c&&a.push(c)}return a},getStorePath:function(a){var b=this.getContext().getResourceManager();if("user_devices"===a)return b.getVariable("USER_DIRECTORY")},connectToAllDevices:function(){function a(c){if(!c)y.error("have no device store");else if(!c.connected){c.connected=!0;c=b.queryStore(c,{isDir:!1});c._S&&(c=[c]);C.isArray(c)||(c=[c]);
for(var k=0;k<c.length;k++){var f=c[k],e=d.getMetaValue(f,E.CF_DEVICE_ENABLED);if(1==e||null==e)f=d.startDevice(f),g.push(f)}}}if(this.deviceServerClient){var c=this.getStores(),d=this;if(this.getStores().length){var g=[];this.deviceServerClient.dfd?this.deviceServerClient.dfd.then(function(){C.each(c,a,this)}.bind(this)):C.each(c,a,this);return g}}else this.checkDeviceServerConnection()},updateDevice:function(a,b){b&&(b.setMetaValue(f.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS,a.driverOptions),b.setMetaValue(f.DEVICE_PROPERTY.CF_DEVICE_OPTIONS,
a.options),b.setMetaValue(f.DEVICE_PROPERTY.CF_DEVICE_ENABLED,a.enabled))},debug:function(){y.info("Debug info stores : ");C.each(this.stores,function(a){y.log("have store "+a.scope)})},_getLogText:function(a){return moment().format("HH:mm:ss:SSS")+" ::   "+a+""},_parse:function(a,b){var c=""+b;if(0<c.indexOf("{{")||0<c.indexOf("}}"))y.time("parse expression"),c=(new H).parse(f.EXPRESSION_PARSER.FILTREX,c,this,{variables:a.getVariablesAsObject(),delimiters:{begin:"{{",end:"}}"}}),y.timeEnd("parse expression");
else{var d=a.parseExpression(b);d&&(c=d)}return c},runCommand:function(a,b){},_lastActions:null,onStoreReloaded:function(a){this.completeDeviceStore()},getInstance:function(a){if(a=a?a._store?this.toDeviceControlInfo(a):a:null)return this.getDriverInstance(a,!1)},getDriverInstance:function(a,c){if(!a)return y.error("getDriverInstance::have no device info"),null;for(var d in this.deviceInstances){var g=this.deviceInstances[d],e=g.options;if(e&&e.port===a.port&&e.host===a.host&&e.protocol===a.protocol&&
e.isServer===a.isServer)return c&&g.sendSettings&&k("xcf-ui")&&(c=!1),!1!==c&&g&&!g.sendSettings&&(d=this.ctx.getDriverManager().getItemById(a.driverId))&&(d=d.user,(e=b.getCIByChainAndName(d,0,f.DRIVER_PROPERTY.CF_DRIVER_COMMANDS))&&e.params&&(g.sendSettings=b.getJson(e.params)),(d=b.getCIByChainAndName(d,0,f.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&d.params&&(g.responseSettings=b.getJson(d.params))),g}return null},_reconnectServerTimer:null,onDeviceServerConnectionLost:function(){if(!this.deviceServerClient||
!this.deviceServerClient.pageUnloaded)if(this.deviceServerClient&&(this.deviceServerClient.destroy(),this.deviceServerClient=null),!this._reconnectServerTimer){var a=this;I&&a.ctx.getNotificationManager().postMessage({message:"Lost connection to device server, try reconnecting in 5 seconds",type:"error",showCloseButton:!0,duration:1E3});this._reconnectServerTimer=setTimeout(function(){a.checkDeviceServerConnection();a._reconnectServerTimer=null},this.reconnectDeviceServer);y.log("lost device server connection");
C.each(this.deviceInstances,function(a){if(a&&a.device&&!a.domNode){a=a.device;var b=a.driverInstance;b&&b.onLostServer&&b.onLostServer();a.setState(f.DEVICE_STATE.LOST_DEVICE_SERVER)}})}},onMQTTMessage:function(a){var c=b.getJson(a.message),d=!1;if(c){var g=c.sourceHost,e=c.sourcePort,h=a.host,l=a.port;g&&e&&g===h&&e==l&&(d=!0)}if(!d&&(d=a.topic.split("/"),4==d.length&&"Variable"===d[2]&&c.device))if(this.getDeviceStoreItem(c.device)){if(a=this.toDeviceControlInfo(c.device))if(a=this.getDriverInstance(a))if(a=
a.blockScope.getVariable(d[3]))k("xcf-ui")?(a.set("value",c.value),a.refresh()):(delete a.value,a.value=c.value),this.publish(f.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:a,scope:a.scope,owner:this,save:!1,publish:!0,source:"mqtt",publishMQTT:!1})}else y.error("cant find device for : "+a.topic)},getBlock:function(a){for(var b in this.deviceInstances){var c=this.deviceInstances[b];if(c&&c.device&&(c=c.blockScope)&&(c=c.resolveBlock(a)))return c}return this.ctx.getDriverManager().getBlock(a)},onNodeServiceStoreReady:function(a){if(this.deviceServerClient)return this.deviceServerClient;
this.createDeviceServerClient(a.store)},onDriverUpdated:function(a,b){},onModuleReloaded:function(a){if(0!=this.deviceInstances.length){var c=b.replaceAll("//","/",a.module);a=a.newModule;for(var d in this.deviceInstances){var g=this.deviceInstances[d];if(g.modulePath===c||g.baseClass===c)this.mergeFunctions(g,a.prototype),g.blockScope&&(g.blockScope.expressionModel.expressionCache={}),this.onDriverUpdated(g,c)}}},_removeInstance:function(a,b,c){a.destroy&&a.destroy();a.blockScope&&a.blockScope._destroy();
delete this.deviceInstances[b];this.ctx.getBlockManager().removeScope(a.options.id);this.ctx.getDriverManager().removeDriverInstance(a,c);c.reset()},removeDriverInstance:function(a){if(a=this.getDriverInstance(a))this.ctx.getBlockManager().removeScope(a.options.id),a.blockScope&&a.blockScope.destroy(),a.destroy();for(var b in this.deviceInstances)a==this.deviceInstances[b]&&delete this.deviceInstances[b]},getMetaValue:function(a,c){var d=a.user;return d?b.getCIInputValueByName(d,c):null},getDeviceByHost:function(a,
c){for(var d=b.queryStore(this.getStore(),{isDir:!1}),g=0;g<d.length;g++){var k=d[g],f=this.getMetaValue(k,E.CF_DEVICE_HOST),e=this.getMetaValue(k,E.CF_DEVICE_PORT);if(f==a&&e==c)return k}return null},getDeviceByUrl:function(a){a=b.parse_url(a);a=b.urlArgs(a.host);return this.getDeviceById(a.device.value)},getDeviceById:function(a,c){function d(c){c=b.queryStore(c,{isDir:!1});c._S&&(c=[c]);for(var k=0;k<c.length;k++){var f=c[k];if(g.getMetaValue(f,E.CF_DEVICE_ID)==a)return f}return null}var g=this,
k=C.isString(c)?this.getStore(c):null;if(k)return d(k);for(var f in this.stores)if(k=d(this.stores[f]))return k;return null},getDeviceByName:function(a,c){function d(c){c=b.queryStore(c,{isDir:!1});c._S&&(c=[c]);for(var k=0;k<c.length;k++){var f=c[k];if(g.getMetaValue(f,E.CF_DEVICE_TITLE)==a)return f}return null}var g=this,k=C.isString(c)?this.getStore(c):null;if(k)return d(k);for(var f in this.stores)if(k=d(this.stores[f]))return k;return null},getDevicesByDriverId:function(a){var c=b.queryStore(this.getStore(),
{isDir:!1});c._S&&(c=[c]);for(var d=0;d<c.length;d++){var g=c[d];if(this.getMetaValue(g,E.CF_DEVICE_ID)==a)return g}return null},_cachedItems:null,getDeviceStoreItem:function(a){if(a){if(a.hash&&this._cachedItems){var c=this._cachedItems[a.hash];if(c)return c}if(c=this.getStore(a.deviceScope)){var d=a.devicePath?this.getItemByPath(a.devicePath):null;if(d)return d;var g=C.filter(c.data,function(a){return!0!==a.isDir});if(!g)return null;g&&!C.isArray(g)&&(g=[g]);for(var k=0;k<g.length;k++){var d=g[k],
f=d.user,e=b.getCIInputValueByName(f,E.CF_DEVICE_HOST),h=b.getCIInputValueByName(f,E.CF_DEVICE_PORT),l=b.getCIInputValueByName(f,E.CF_DEVICE_ID),f=b.getCIInputValueByName(f,E.CF_DEVICE_PROTOCOL);if(h===a.port&&e===a.host&&f===a.protocol&&d.isServer()===a.isServer&&l===a.id)return(c=c.getSync(d.path))&&(d=c),a.hash&&(this._cachedItems||(this._cachedItems={}),this._cachedItems[a.hash]=d),d}}}},onDriverSettingsChanged:function(a,c){for(var d in this.deviceInstances){var g=this.deviceInstances[d];if(g&&
g.driver==c){d=c.user;var k=b.getCIByChainAndName(d,0,f.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);k&&k.params&&k==a&&(g.sendSettings=b.getJson(k.params));(d=b.getCIByChainAndName(d,0,f.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&d.params&&(g.responseSettings=b.getJson(d.params));break}}},onDeviceStateChanged:function(a,b){!0!==a._userStopped&&!0!==b&&a.info&&a.state&&a.state==f.DEVICE_STATE.DISCONNECTED&&this.ctx.getNotificationManager().postMessage({message:"Lost connection to "+a.info.host+", ...reconnecting",
type:"error",showCloseButton:!1,duration:1500});!0!==b&&a.info&&a.state&&a.state==f.DEVICE_STATE.CONNECTED&&this.ctx.getNotificationManager().postMessage({message:"Connected to "+a.info.host+"",type:"success",showCloseButton:!1,duration:2E3})},connectDevice:function(a){this.checkDeviceServerConnection();var b=this.toDeviceControlInfo(a);if(b){var c=b.hash;if(this.deviceInstances[c])return a.setState(f.DEVICE_STATE.CONNECTED),this.deviceInstances[c];a.setState(f.DEVICE_STATE.CONNECTING);this.publish(f.EVENTS.ON_STATUS_MESSAGE,
{text:"Trying to connect to "+b.toString(),type:"info"});this.sendManagerCommand(f.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,b)}else y.error("couldnt start device, invalid control info")},onAppReady:function(a){a=a.context;a.deviceManager=this;a.driverManager=this;a.blockManager&&b.mixin(a.blockManager.scopes,this.ctx.getBlockManager().scopes)},onHaveNoDeviceServer:function(){if(this.ctx.getNotificationManager())var a=this,b=this.ctx.getNotificationManager().postMessage({message:"Have no device server connection",
type:"error",showCloseButton:!0,duration:1500,actions:{reconnect:{label:"Reconnect",action:function(){a.checkDeviceServerConnection();return b.update({message:"Reconnecting...",type:"success",actions:!1,duration:1500})}}}})},setDriverScriptContent:function(a,b,c,d,g){return this.callMethodEx(null,"setDriverContent",[a,b,c],d,!0)},getDriverScriptContent:function(a,b,c){return this.callMethodEx(null,"getDriverContent",[a,b],c,!0)},createStore:function(a,c,d){var g=this;a=new (k("xcf-ui")?p("deviceStore",
[l,w,t],{}):p("deviceStore",[h],{}))({data:a.items,idProperty:"path",parentProperty:"parentId",Model:u,id:b.createUUID(),scope:c,ctx:this.getContext(),mayHaveChildren:function(a){if(!1===a._mayHaveChildren)return!1;if(a.isDevice){if(a.driverInstance)return!0;var b=g.toDeviceControlInfo(a);b?(b=g.getContext().getDriverManager().getDriverById(b.driverId))&&!b.blockScope&&(this.ctx.getDriverManager().createDriverBlockScope(b),g.completeDevice(a,b)):y.error("cant get device info for ",a)}return!0},observedProperties:["name",
"state","iconClass","enabled"]});c&&!1!==d&&this.setStore(c,a);return a},initStore:function(a,b,c){return this.createStore(a,b,c)},_deviceInfoCache:null,toDeviceControlInfo:function(a){if(!a)return null;k("xcf-ui");if(!a._store&&a.id){var c=this.getItemById(a.id);c&&(a=c)}if(!a||!a.path)if(c=this.getDeviceStoreItem(a),!c)return null;var d=a.user,c=b.getCIInputValueByName(d,E.CF_DEVICE_HOST),g=b.getCIInputValueByName(d,E.CF_DEVICE_PORT),e=b.getCIInputValueByName(d,E.CF_DEVICE_ENABLED),h=b.getCIInputValueByName(d,
E.CF_DEVICE_TITLE),l=b.getCIInputValueByName(d,E.CF_DEVICE_PROTOCOL),q=b.getCIInputValueByName(d,E.CF_DEVICE_DRIVER),r=b.getCIInputValueByName(d,E.CF_DEVICE_OPTIONS),m=b.getCIInputValueByName(d,E.CF_DEVICE_LOGGING_FLAGS),d=b.getCIInputValueByName(d,E.CF_DEVICE_DRIVER_OPTIONS),p=a.isServerSide(),t=a.isServer(),u=null;this.fixDeviceCI(a);var v=this.ctx.getDriverManager().getDriverById(q);if(v){var w=v.user,u=b.getCIInputValueByName(w,f.DRIVER_PROPERTY.CF_DRIVER_CLASS),w=b.getCIByChainAndName(w,0,f.DRIVER_PROPERTY.CF_DRIVER_RESPONSES),
z={},v=v.scope;w&&w.params&&(z=b.getJson(w.params));u={host:c,port:g,protocol:l,driver:u?u.replace("./",""):"",driverId:q,driverScope:v,id:a.id,devicePath:a.path,deviceScope:a.getScope(),title:h,options:r,enabled:e,driverOptions:d,serverSide:p,isServer:t,responseSettings:z,source:I?"ide":"server",user_devices:this.ctx.getMount(a.getScope()),system_devices:this.ctx.getMount("system_devices"),system_drivers:this.ctx.getMount("system_drivers"),user_drivers:this.ctx.getMount("user_drivers"),loggingFlags:m,
toString:function(){return a.getScope()+"://"+this.host+":"+this.port+"@"+this.protocol}};u.hash=n(JSON.stringify({host:c,port:g,protocol:l,driverId:q,driverScope:v,id:a.id,devicePath:a.path,deviceScope:a.getScope(),source:I?"ide":"server",user_devices:this.ctx.getMount(a.getScope()),system_devices:this.ctx.getMount("system_devices"),system_drivers:this.ctx.getMount("system_drivers"),user_drivers:this.ctx.getMount("user_drivers")}),1);if(c=this.ctx.getUserDirectory())u.userDirectory=c}a.info=u;k("xcf-ui");
return u},getItemById:function(a){for(var b in this.stores){var c;c=this.stores[b];var d=C.find(c.data,{id:a});c=d?c.getSync(d.path):null;if(c)return c}},onStoreCreated:function(a){var c=this,d=c.ctx,g=a.type,k=a.store,e=k?b.queryStore(k,{isDir:!1}):[],h=this.ctx.getDriverManager();e&&!C.isArray(e)&&(e=[e]);if(g===f.ITEM_TYPE.DEVICE){for(g=0;g<e.length;g++){var l=k.getSync(e[g].path);if(!l)y.error("cant find "+e[g].path);else if(!l._completed){l._completed=!0;l.isDevice=!0;var q=this.getMetaValue(l,
f.DEVICE_PROPERTY.CF_DEVICE_DRIVER);q?(q=h.getItemById(q),C.each(l.user.inputs,function(a){a.device=l;a.actionTarget=I?d.mainView.getToolbar():null;a.ctx=d}),!C.isEmpty(q)&&I&&(this.completeDevice(l,q),l.iconClass=l.getStateIcon())):y.error("device has no driver id!")}}G(this.connectToAllDevices()).then(function(){c.publish("DevicesConnected",a)})}},onClientMessage:function(a){this.checkDeviceServerConnection();this.deviceServerClient&&this.sendManagerCommand(f.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE,
a)},onClientLogMessage:function(a){},onVariableChanged:function(a){var b=a.item,c=a.scope,d=b.name,g=!1!==a.publish;"value"!==d&&!1!==g&&b&&(b=b.value,(c=c.device)&&c.info&&(c=c.info,d=c.host+"/"+c.port+"/Variable/"+d,!1!==a.publishMQTT&&this.sendManagerCommand(f.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH,{topic:d,data:{value:b,device:c}})))},init:function(){var a=this;this.initUI&&this.initUI();this.stores={};this._deviceInfoCache={};this.subscribe(f.EVENTS.ON_DRIVER_VARIABLE_CHANGED,this.onVariableChanged);
this.subscribe(f.EVENTS.ON_DEVICE_SERVER_CONNECTED,function(){y.log("got device server connection");a.autoConnectDevices&&G(a.connectToAllDevices()).then(function(){a.publish("DevicesConnected")})});this.subscribe([K.ON_NODE_SERVICE_STORE_READY,K.ON_MODULE_RELOADED,K.ON_DEVICE_DISCONNECTED,K.ON_DEVICE_CONNECTED,K.ON_CLIENT_LOG_MESSAGE,K.ON_STORE_CREATED]);this.deviceInstances=this.consoles={};this.driverScopes={system_drivers:"system_drivers/",user_drivers:"user_drivers/"};this.lastUpTime=(new Date).getTime();
setInterval(function(){var b=(new Date).getTime();3E4<b-a.lastUpTime&&(a.lastUpTime=(new Date).getTime());a.lastUpTime=b},1E3);this.initReload()},onDeviceServerConnected:function(){var a=this;this.deviceInstances&&C.each(this.deviceInstances,function(b){b&&b.device&&!b.domNode&&a.startDevice(b.device)})},addDeviceInstance:function(a,b){},ls:function(a,b){function c(g){try{var k=this.createStore(g,a,b);this.onStoreReady(k);!1!==b&&this.publish(f.EVENTS.ON_STORE_CREATED,{data:g,owner:this,store:k,type:this.itemType});
d.resolve(k)}catch(e){logError(e,"error ls drivers")}}var d=new z;if(this.prefetch&&this.prefetch[a])return c.apply(this,[this.prefetch[a]]),delete this.prefetch[a],d;k("php")?this.runDeferred(null,"ls",[a]).then(c.bind(this)):d.resolve({items:[]});return d},hasStore:function(a){return this.stores[a]},fixDeviceCI:function(a){var c=f.DEVICE_PROPERTY,d=a.user,g=b.getCIByChainAndName(d,0,c.CF_DEVICE_DRIVER_OPTIONS);g?(g.data=[{value:2,label:"Runs Server Side"},{value:4,label:"Show Debug Messages"},{value:8,
label:"Allow Multiple Device Connections"},{value:16,label:"Server"}],g.group="Common"):d.inputs.push({chainType:0,"class":"cmx.types.ConfigurableInformation",dataRef:"",dataSource:"",description:null,enabled:!0,enumType:"-1",flags:-1,group:"Common",id:c.CF_DEVICE_DRIVER_OPTIONS,name:c.CF_DEVICE_DRIVER_OPTIONS,order:1,params:null,platform:null,title:"Driver Options",type:5,uid:"-1",value:0,data:[{value:2,label:"Runs Server Side"},{value:4,label:"Show Debug Messages"},{value:8,label:"Allow Multiple Device Connections"},
{value:16,label:"Server"}],visible:!0,device:a});(g=b.getCIByChainAndName(d,0,c.CF_DEVICE_LOGGING_FLAGS))?g.group="Logging":d.inputs.push({chainType:0,"class":"cmx.types.ConfigurableInformation",dataRef:"",dataSource:"",description:null,enabled:!0,enumType:"-1",flags:-1,group:"Logging",id:c.CF_DEVICE_LOGGING_FLAGS,name:c.CF_DEVICE_LOGGING_FLAGS,order:1,params:null,platform:null,title:"Logging Flags",type:c.CF_DEVICE_LOGGING_FLAGS,uid:"-1",value:0,data:[{value:2,label:"On Connected"},{value:4,label:"On Disconnected"},
{value:8,label:"On Error"},{value:16,label:"Commands"},{value:32,label:"Responses"}],visible:!0,device:a});if(c=b.getCIByChainAndName(d,0,c.CF_DEVICE_PROTOCOL))c.type=3,c.options=[{label:"TCP",value:"tcp"},{label:"UDP",value:"udp"},{label:"Driver",value:"driver"},{label:"SSH",value:"ssh"},{label:"Serial",value:"serial"},{label:"MQTT",value:"mqtt"}];a.id||(a.id=b.getCIInputValueByName(d,f.DEVICE_PROPERTY.CF_DEVICE_ID));(c=b.getCIByChainAndName(d,0,f.DEVICE_PROPERTY.CF_DEVICE_OPTIONS))?c.device=a:d.inputs.push({chainType:0,
"class":"cmx.types.ConfigurableInformation",dataRef:"",dataSource:"",description:null,enabled:!0,enumType:"-1",flags:-1,group:"Network",id:"options",name:"options",order:1,params:null,platform:null,title:"Options",type:28,uid:"-1",value:{},visible:!0,device:a})}})})},"xcf/manager/DeviceManager_Server":function(){define(["dcl/dcl"],function(e){return e(null,{})})},"xcf/manager/DeviceManager_DeviceServer":function(){define("dcl/dcl xide/encoding/MD5 xide/types xide/utils xide/factory xdojo/has dojo/Deferred xide/mixins/ReloadMixin xide/mixins/EventedMixin require xide/lodash xcf/model/Variable xide/utils/HexUtils xdojo/has!host-node?nxapp/utils/_console".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r,q,h,l){var k="undefined"!==typeof window?window.console:"undefined"!==typeof global?global.console:l;l&&(k=l);var t=b("xcf-ui"),w=!1;h=e(null,{declaredClass:"xcf.manager.DeviceManager_DeviceServer",running:null,onDeviceStarted:function(a,b,c){if(a&&b&&c){var d=this.toDeviceControlInfo(b),g=d.serverSide,k=d.isServer,f=a.blockScope;(g||k||!g&&!k)&&f.start();a.__didStartBlocks=!0;this.publish(m.EVENTS.ON_DEVICE_DRIVER_INSTANCE_READY,{device:b,instance:a,driver:c,blockScope:f});
this.publish(m.EVENTS.ON_DEVICE_CONNECTED,{device:d,instance:a,driver:c,blockScope:f});this.ctx.getDriverManager().addDeviceInstance(b,c)}},runClass:function(a,b,c){this.checkDeviceServerConnection();if(this.deviceServerClient){var d=n.createUUID();b.id=d;var g={"class":a,args:b,manager_command:m.SOCKET_SERVER_COMMANDS.RUN_CLASS};!this.running&&(this.running={});this.running[d]={"class":a,args:b,delegate:c};this.deviceServerClient.emit(null,g,m.SOCKET_SERVER_COMMANDS.RUN_CLASS)}else this.onHaveNoDeviceServer()},
runAppServerClass:function(a,b,c){this.checkDeviceServerConnection();if(this.deviceServerClient){var d=n.createUUID();b.id=d;var g={"class":a,args:b,manager_command:m.SOCKET_SERVER_COMMANDS.RUN_APP_SERVER_CLASS};!this.running&&(this.running={});this.running[d]={"class":a,args:b,delegate:c};this.deviceServerClient.emit(null,g,m.SOCKET_SERVER_COMMANDS.RUN_APP_SERVER_CLASS)}else this.onHaveNoDeviceServer()},runAppServerClassMethod:function(a,b,c,d){this.checkDeviceServerConnection();if(this.deviceServerClient){b=
n.createUUID();c.id=b;var g={"class":a,method:_method,args:c,manager_command:m.SOCKET_SERVER_COMMANDS.RUN_APP_SERVER_CLASS_METHOD};!this.running&&(this.running={});this.running[b]={"class":a,args:c,delegate:d,method:_method};this.deviceServerClient.emit(null,g,m.SOCKET_SERVER_COMMANDS.RUN_APP_SERVER_CLASS_METHOD)}else this.onHaveNoDeviceServer()},runAppServerComponentMethod:function(a,b,c,d,g){this.checkDeviceServerConnection();if(this.deviceServerClient){var k=n.createUUID();c.id=k;d={component:a,
method:b,options:d,args:c,id:k,manager_command:m.SOCKET_SERVER_COMMANDS.RUN_APP_SERVER_COMPONENT_METHOD};!this.running&&(this.running={});this.running[k]={component:a,args:c,delegate:g,method:b};this.deviceServerClient.emit(null,d,m.SOCKET_SERVER_COMMANDS.RUN_APP_SERVER_COMPONENT_METHOD)}else this.onHaveNoDeviceServer()},cancelAppServerComponentMethod:function(a,b){this.checkDeviceServerConnection();if(this.deviceServerClient){var c={component:a,id:b,manager_command:m.SOCKET_SERVER_COMMANDS.CANCEL_APP_SERVER_COMPONENT_METHOD};
!this.running&&(this.running={});this.deviceServerClient.emit(null,c,m.SOCKET_SERVER_COMMANDS.CANCEL_APP_SERVER_COMPONENT_METHOD)}else this.onHaveNoDeviceServer()},answerAppServerComponentMethodInterrupt:function(a,b,c){this.checkDeviceServerConnection();if(this.deviceServerClient)a={component:a,id:b,manager_command:m.SOCKET_SERVER_COMMANDS.ANSWER_APP_SERVER_COMPONENT_METHOD_INTERRUPT,answer:c},!this.running&&(this.running={}),this.deviceServerClient.emit(null,a,m.SOCKET_SERVER_COMMANDS.ANSWER_APP_SERVER_COMPONENT_METHOD_INTERRUPT);
else this.onHaveNoDeviceServer()},startDevice:function(b,c){var d=this;if(!b)return k.error("start device invalid item"),null;this.checkDeviceServerConnection();b.check();w=!0;var f=new a;b._startDfd&&!b._startDfd.isResolved()||b.driverInstance||b.reset();!0===c&&b.setMetaValue(m.DEVICE_PROPERTY.CF_DEVICE_ENABLED,!0,!1);b.getMetaValue(m.DEVICE_PROPERTY.CF_DEVICE_ENABLED);var e=this.toDeviceControlInfo(b);if(!e)return k.error("invalid client info, assuming no driver found"),f.reject("invalid client info, assuming no driver found"),
f;if(!e)return k.error("couldnt start device, invalid control info "+e.toString()),f.reject(),f;var h=e.hash,l=b.state===m.DEVICE_STATE.LOST_DEVICE_SERVER;if(this.deviceInstances[h]&&!0!==l)return w&&k.warn("device already started : "+e.toString()),f.resolve(this.deviceInstances[h]),f;if(l&&this.deviceInstances[h])return d.publish(m.EVENTS.ON_STATUS_MESSAGE,{text:"Trying to re-connect to "+e.toString(),type:"info"}),d.sendManagerCommand(m.SOCKET_SERVER_COMMANDS.CREATE_CONNECTION,e),b.setState(m.DEVICE_STATE.CONNECTING),
f.resolve(this.deviceInstances[h]),f;b.setState(m.DEVICE_STATE.CONNECTING);b._userStopped=null;b._startDfd=f;var l=this.driverScopes.system_drivers,q=l+"DriverBase";try{g([q],function(a){a.prototype.declaredClass=q;d.createDriverInstance(e,a,b).then(function(a){a.id||(a.id=n.createUUID());a||k.warn("buildMQTTParams:have no driver instance");e.mqtt={driverScopeId:a&&a.blockScope?a.blockScope.id:"have no driver instance",driverId:a?a.driver.id:"have no driver id",deviceId:b.path};d.publish(m.EVENTS.ON_STATUS_MESSAGE,
{text:"Trying to connect to "+e.toString(),type:"info"});b._startDfd&&!b._startDfd.isResolved()?d.sendManagerCommand(m.SOCKET_SERVER_COMMANDS.CREATE_CONNECTION,e):d.sendManagerCommand(m.SOCKET_SERVER_COMMANDS.START_DEVICE,e);f.resolve(d.deviceInstances[h]);delete e.mqtt}).then(function(){},function(a){f.resolve(null)})},function(a){k.error(a)})}catch(r){logError(r,"DeviceManager::startDevice: requiring base driver at "+q+" failed! Base Driver - Prefix : "+l)}return f},createDriverInstance:function(b,
f,h){var l=b.hash,q=this.driverScopes[b.driverScope],r=!g.cache,p=g.toUrl(q),p=n.removeURLParameter(p,"bust");r&&(p=p.replace("/.js","/"));var t=decodeURIComponent(p)+b.driver,t=t.replace("","").trim(),w=this,p=w.ctx,r=n.getCIInputValueByName(h.user,m.DEVICE_PROPERTY.CF_DEVICE_DRIVER),p=p.getDriverManager(),y=p.getDriverById(r),C=new a;h.getMetaValue(m.DEVICE_PROPERTY.CF_DEVICE_ENABLED);h.isEnabled();if(!(h.isServerSide()||h.isServer()||b.isServer||b.serverSide))return C.reject("DeviceManager_DeviceServer: wont create driver instance! I am server and device isnt server side : "+
b.title),C;try{p.getDriverModule(y).then(function(a){var g=new (e([f,c.dcl,d.dcl,a],{}));g.declaredClass=t;g.options=b;g.baseClass=f.prototype.declaredClass;g.modulePath=n.replaceAll("//","/",q+b.driver).replace(".js","");g.delegate=w;g.driver=y;g.serverSide=b.serverSide;g.utils=n;g.types=m;g.device=h;g.Module=a;g.id=n.createUUID();g.getDevice=function(){return this.device};g.getDeviceInfo=function(){return this.getDevice().info};a=y.user;var r=n.getCIByChainAndName(a,0,m.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);
r&&r.params&&(g.sendSettings=n.getJson(r.params));(a=n.getCIByChainAndName(a,0,m.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&a.params&&(g.responseSettings=n.getJson(a.params));try{g.start(),g.initReload()}catch(p){k.error("crash in driver instance startup! "+h.toString()),logError(p,"crash in driver instance startup!")}w.deviceInstances[l]=g;y.blox&&y.blox.blocks||(y.blox={blocks:[]});h.driverInstance=g;w.getDriverInstance(b,!0);g._id=n.createUUID();C.resolve(g);return g})}catch(F){k.error("DeviceManager::createDriverInstance:: requiring base driver at "+
t+" failed "+F.message,n.inspect(b))}return C},onSetDeviceServerVariables:function(a){var b=this.getDriverInstance(a.device,!0),c=this.getDeviceStoreItem(a.device);if(c){if(!b.blockScope){var d=c.info,g=d.hash,f=b.driver,e=d.driverId,h=this.getContext(),d=d.serverSide,l=e+"_"+g+"_"+c.path;f.blox&&f.blox.blocks||(f.blox={blocks:[]});f.blockPath&&(n.getJson(n.readFile(f.blockPath)),f.blox=n.getJson(n.readFile(f.blockPath)));g=h.getBlockManager().createScope({id:l,device:c,driver:f,instance:b,serviceObject:this.serviceObject,
ctx:h,serverSide:d,getContext:function(){return this.instance}},n.clone(f.blox.blocks),function(a){a&&k.error(a+" : in "+f.name+" Resave Driver! in scope id "+l)});b.blockScope=g;c.blockScope=g;t&&this.completeDriverInstance(f,b,c)}if(b){var g=a.variables,q=b.blockScope;c.serverVariables=a.variables;r.each(g,function(a){var b=q.getVariable(a.name);b&&(b.value=a.value)})}this.onDeviceConnected(a,!1);c.setState(m.DEVICE_STATE.SYNCHRONIZING);c.setState(m.DEVICE_STATE.READY);c._startDfd&&c._startDfd.resolve(c.driverInstance);
delete c._userStopped;delete c.lastError;delete c._startDfd;c._startDfd=null}else w&&k.log("did set device server variables failed, have no device",a)},getDeviceServerVariables:function(a,b){var c=b.driver;c.blox&&c.blox.blocks||(c.blox={blocks:[]});var d=[];r.each(c.blox.blocks,function(a){a.group===m.BLOCK_GROUPS.CF_DRIVER_BASIC_VARIABLES&&d.push(a)});for(var c=[],g=0;g<d.length;g++)c.push({name:d[g].name,value:d[g].value,initial:d[g].value});a.setState(m.DEVICE_STATE.SYNCHRONIZING);this.sendManagerCommand(m.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES,
{device:this.toDeviceControlInfo(a),variables:c})},onDeviceConnected:function(a,b){var c=this.getDeviceStoreItem(a.device);if(a.isReplay&&c&&c.state===m.DEVICE_STATE.READY)c.setState(m.DEVICE_STATE.READY);else{var d=this.getDriverInstance(a.device,!0)||a.instance;if(d)if(c){var f=this.toDeviceControlInfo(c);if(f)if(!f.serverSide&&w&&k.error("onDeviceConnected:: device info is not server side, abort"),d&&!c.serverVariables)c.setState(m.DEVICE_STATE.CONNECTED),this.getDeviceServerVariables(c,d);else if(f){var e=
f.hash;if(this.deviceInstances[e]){if(!d.__didStartBlocks)this.onDeviceStarted(d,c,d.driver);c.setState(m.DEVICE_STATE.READY);this.publish(m.EVENTS.ON_STATUS_MESSAGE,{text:'Device is Ready \x3cspan class\x3d"text-success"\x3e'+f.host+":"+f.port+"\x3c/span\x3e",type:"success"});return this.deviceInstances[e]}var h=this,l=this.driverScopes.system_drivers+"DriverBase";try{g([l],function(a){a.prototype.declaredClass=l;h.createDriverInstance(f,a,c)})}catch(q){k.error("requiring base driver at "+l+" failed",
q)}}else k.error("couldnt start device, invalid control info");else w&&k.error("onDeviceConnected:: device info  is null")}else w&&k.error("onDeviceConnected:: deviceStoreItem is null");else c&&c.setState(m.DEVICE_STATE.DISCONNECTED)}},onDeviceDisconnected:function(a){if(a||a.device){var b=a.error,c=b&&b.code?b.code:b||"",d=this.getDeviceStoreItem(a.device);if(d)if(!0===a.stopped)this.stopDevice(d);else{this.publish(m.EVENTS.ON_STATUS_MESSAGE,{text:'Device has been disconnected \x3cspan class\x3d"text-warning"\x3e'+
a.device.host+":"+a.device.port+'\x3c/span\x3e :  \x3cspan class\x3d"text-danger"\x3e'+c+"\x3c/span\x3e",type:"info"});var g=this.toDeviceControlInfo(d);if(!g||g.serverSide)if(this.getDriverInstance(a.device,!0)&&this.removeDriverInstance(a.device),d.reset(),d.state===m.DEVICE_STATE.DISABLED)d.setState(m.DEVICE_STATE.DISCONNECTED);else if(d.setState(m.DEVICE_STATE.DISCONNECTED),d.lastError=b,d.refresh(),g.serverSide&&d){var f=this;d.reconnectTimer||(d.isReconnecting=!0,d.lastReconnectTime?3600<d.lastReconnectTime&&
(d.lastReconnectTime=3600):d.lastReconnectTime=f.reconnectDevice,d.reconnectRetry||(d.reconnectRetry=0),d.reconnectTimer=setTimeout(function(){d.reconnectTimer=null;d.lastReconnectTime*=2;d.reconnectRetry+=1;d.shouldReconnect()&&(g&&d.setState(m.DEVICE_STATE.CONNECTING),f.startDevice(d))},d.lastReconnectTime))}}else w&&t&&k.error("deviceStoreItem is null")}},onCommandFinish:function(a,c){var d=this.getDriverInstance(a,!0);if(d){var g=c.params||{};if(g.src&&g.id){var k=d.blockScope.getBlockById(g.src);
if(k&&k.onCommandFinish){g=null;k=k.onCommandFinish(c);try{g=JSON.stringify(k,function(a,b){return"object"==typeof b?null:b},2)}catch(f){logError(f,"error serializing on command finish")}if(b("xcf-ui")&&g){var d=d.device,k=[g],e=this.consoles[a.hash+"-Console"];if(e)for(var h=0;h<e.length;h++){var l=e[h];if(l){var q=!0,p=!1;l.console&&(p=l.console.getTextEditor(),q=p.getAction("Console/Settings/Split").value,p=p.getAction("Console/Settings/HEX").value);if(!q&&p)p=n.bufferToHexString(deviceMessageData.data.bytes),
l.log(p,q,!1,m.LOG_OUTPUT.RESPONSE);else for(var t=0;t<k.length;t++){var w=k[t];r.isString(w.string)&&0===w.string.length||(p&&(w=n.stringToHex(w)),l.log(w,q,!0,m.LOG_OUTPUT.RESPONSE))}}}k&&k.length&&this.publish(m.EVENTS.ON_DEVICE_MESSAGE_EXT,{device:d,deviceInfo:a,raw:g,messages:k,bytes:[]})}}}}},onCommandProgress:function(a,b){var c=this.getDriverInstance(a,!0);if(c){var d=b.params||{};if(d.src&&d.id&&(c=c.blockScope)&&(d=c.getBlockById(d.src))&&d.onCommandProgress)d.onCommandProgress(b)}},onCommandPaused:function(a,
b){var c=this.getDriverInstance(a,!0);if(c){var d=b.params||{};if(d.src&&d.id&&(c=c.blockScope.getBlockById(d.src))&&c.onCommandPaused)c.onCommandPaused(b)}},onCommandStopped:function(a,b){var c=this.getDriverInstance(a,!0);if(c){var d=b.params||{};if(d.src&&d.id&&(c=c.blockScope.getBlockById(d.src))&&c.onCommandStopped)c.onCommandStopped(b)}},onCommandError:function(a,b){var c=this.getDriverInstance(a,!0);if(c){var d=b.params||{};if(d.src&&d.id&&(c=c.blockScope.getBlockById(d.src))&&c.onCommandError)c.onCommandError(b)}},
onDeviceServerMessage:function(a){function c(a){delete a.resposeSettings;delete a.driver;delete a.lastResponse;delete a.scope;delete a.driverId;delete a.device;delete a.sourceHost;delete a.sourcePort}var d=a.data,g=null;if(r.isString(d)&&-1!=d.indexOf("{"))try{g=n.fromJson(d)}catch(f){k.error("error parsing device message",a);return}else r.isObject(d)&&d.data&&(g=d);if(g&&g.data&&g.data.device){var e=g.data.device;if(e&&e.serverSide){var h=this.getDriverInstance(g.data.device,!0);if(h){var l=this.getDeviceStoreItem(e);
if(l){(e=l.info)||k.error("invalid device : "+l.toString());var p=l.get("state");a=e.serverSide;var t=g.data.deviceMessage;if(null!=t){d=[];r.isString(t)?d=h.split(t):r.isObject(t)&&(c(t),d=[t]);var w=h.onMessageRaw({device:g.data.device,message:t,bytes:g.data.bytes});w&&!w.length&&(w=null);for(var F=[],B=0;B<d.length;B++)F.push(n.stringToBuffer(d[B]));if(w&&w.length)for(d=[],F=[],B=0;B<w.length;B++){var I=w[B];d.push(I.string);F.push(I.bytes)}if(d&&d.length)for(B=0;B<d.length;B++)I=d[B],h.onMessage({device:g.data.device,
message:I,raw:t,bytes:F[B]}),h.onBroadcastMessage({device:g.data.device,message:I,raw:t,bytes:F[B]});p!==m.DEVICE_STATE.READY&&l.set("state",m.DEVICE_STATE.READY);B=l.isDebug();g.event&&(g.data.driverInstance=h,this.publish(g.event,g.data));if(b("xcf-ui")){var E=[],p=this.consoles[e.hash+"-Console"];if(B){B=g.data.deviceMessage;if(r.isObject(B)){c(B);try{B=JSON.stringify(B)}catch(K){logError(K,"error serialize message")}}this.publish(m.EVENTS.ON_STATUS_MESSAGE,{text:"Device Message from "+h.options.host+
' : \x3cspan class\x3d"text-info"\x3e'+B+"\x3c/span\x3e"})}if(p)for(var N=0;N<p.length;N++){var L=p[N];if(L){var M=!0,P=!1;L.console&&(B=L.console.getTextEditor(),M=B.getAction("Console/Settings/Split").value,P=B.getAction("Console/Settings/HEX").value);if(!M&&P)B=n.bufferToHexString(g.data.bytes),L.log(B,M,!1,m.LOG_OUTPUT.RESPONSE);else for(E=[],r.isString(t)?E=M?w&&w.length?w:h.split(t):[t]:r.isObject(t)&&(c(t),E=[t]),B=0;B<E.length;B++)I=E[B],r.isString(I.string)&&0===I.string.length||(P&&(I=n.stringToHex(I.string)),
L.log(I,M,!0,m.LOG_OUTPUT.RESPONSE))}}d&&d.length&&this.publish(m.EVENTS.ON_DEVICE_MESSAGE_EXT,{device:l,deviceInfo:e,raw:t,messages:d,bytes:g.data.bytes})}if(0<d.length&&h.blockScope)for(g=h.blockScope,e=g.blockStore._find({group:m.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS}),h=g.blockStore._find({group:m.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES}),l=g.getVariable("value"),l||(l=new q({id:n.createUUID(),name:"value",value:"",scope:g,type:13,group:"processVariables",gui:!1,cmd:!1}),g.blockStore.putSync(l)),
t=0;t<d.length;t++)if(0!==d[t].length){l.value=new String(d[t]);l.value.setBytes(F[t]);l.value.setString(d[t]);this.publish(m.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:l,scope:g,owner:this,save:!1,source:m.MESSAGE_SOURCE.DEVICE,publishMQTT:!1});for(w=0;w<h.length;w++){var O=h[w];"value"!=h[w].title&&(p=null,p=l.value,"number"!==typeof p&&(p=""+p,p="'"+p+"'"),O.target&&"None"!=O.target&&null!==p&&"null"!=p&&"'null'"!=p&&(B=g.getVariable(O.target)))&&(B.value=p,this.publish(m.EVENTS.ON_DRIVER_VARIABLE_CHANGED,
{item:B,scope:g,owner:this,save:!1,source:m.MESSAGE_SOURCE.BLOX}))}if(a){for(p=0;p<d.length;p++)if(B=d[p],r.isObject(B)&&B.src&&(w=g.getBlockById(B.src))&&w.onData)w.onData(B);for(p=0;p<e.length;p++)if(w=e[p],!1!==w.enabled){w.override={args:O?[O.value]:null};try{g.solveBlock(e[p],{highlight:!1})}catch(Q){logError(Q,"----solving response block crashed ")}}}}}}}else B&&k.error(" onDeviceMessage : failed! Have no device instance for "+g.data.device.host,g)}}},sendManagerCommand:function(a,b){this.checkDeviceServerConnection();
var c={manager_command:a};n.mixin(c,b);if(this.deviceServerClient)return this.deviceServerClient.emit(null,c,a);k.error("Send Manager Command "+a+" failed, have no  device Server client");this.onHaveNoDeviceServer()},sendDeviceCommand:function(a,c,d,g,f,e,h,l,q,t){this.checkDeviceServerConnection();var w=a.getDeviceInfo();n.mixin({src:d},w);var F={command:c,device_command:q||m.SOCKET_SERVER_COMMANDS.DEVICE_SEND,options:w};n.mixin(F.options,{params:{src:d,id:g,wait:e,stop:h,pause:l,args:t}});g=this.getDevice(w.id);
g&&r.isObject(g)?g._userStopped||g&&(g.state===m.DEVICE_STATE.DISABLED||g.state===m.DEVICE_STATE.DISCONNECTED||g.state===m.DEVICE_STATE.CONNECTING)||(q=n.stringFromDecString(F.command),g.isDebug()&&this.publish(m.EVENTS.ON_STATUS_MESSAGE,{text:'Did send message : \x3cspan class\x3d"text-warnin"\x3e'+q.substr(0,30)+'\x3c/span\x3e to \x3cspan class\x3d"text-info"\x3e'+w.host+":"+w.port+"@"+w.protocol+"\x3c/span\x3e"}),w=p(JSON.stringify(a.options),1)+"-Console",this.deviceServerClient?(this.deviceServerClient.emit(null,
F,"Device_Send"),b("xcf-ui")&&!1!==f&&r.each(this.consoles[w],function(a){a.printCommand('\x3cspan class\x3d"text-info"\x3e\x3cb\x3e'+F.command+"\x3c/span\x3e","")})):(this.onHaveNoDeviceServer(),k.error("this.deviceServerClient is null"),k.error(" Send Device Command "+c+"failed, have no  device Server client")),a.blockScope&&(q=a.blockScope.getBlockById(d),this.publish(m.EVENTS.ON_DEVICE_COMMAND,{device:g,command:n.stringFromDecString(c),deviceInfo:this.toDeviceControlInfo(g),name:q?q.name:""}))):
k.error("invalid device")},loadDevices:function(a){this.sendManagerCommand(m.SOCKET_SERVER_COMMANDS.INIT_DEVICES,{path:a})},protocolMethod:function(b,c,d,g){var f=new a,e=m.SOCKET_SERVER_COMMANDS.PROTOCOL_METHOD,h=n.createUUID(),l=e+"_"+h;b={protocol:b,method:c,options:{args:d,id:h,device:g}};var q=this;this.subscribe(l,function(a){q.unsubscribe(l);clearTimeout(r);f.resolve(a)});try{this.sendManagerCommand(e,b);var r=setTimeout(function(){q.unsubscribe(l);f.reject("timeout");k.error("protocol method timeout")},
8E3)}catch(p){f.reject(p)}return f},callMethod:function(a,b,c,d,g){this.checkDeviceServerConnection();a={method:b,args:c,device_command:m.SOCKET_SERVER_COMMANDS.CALL_METHOD,params:{id:g,src:d},options:a.options};if(this.deviceServerClient)this.deviceServerClient.emit(null,a,m.SOCKET_SERVER_COMMANDS.CALL_METHOD);else this.onHaveNoDeviceServer()},runShell:function(a,b,c,d,g){a=a.getDeviceInfo();this.sendManagerCommand(m.SOCKET_SERVER_COMMANDS.RUN_SHELL,{cmd:b,args:c,options:n.mixin(a,{params:{id:g,
src:d}})})},watchDirectory:function(a,b){this.checkDeviceServerConnection();var c={path:a,watch:b,manager_command:m.SOCKET_SERVER_COMMANDS.WATCH};if(this.deviceServerClient)this.deviceServerClient.emit(null,c,m.SOCKET_SERVER_COMMANDS.WATCH);else this.onHaveNoDeviceServer()},handle:function(a){var b=this.ctx.getUserDirectory();a=a.data;return!(b&&a&&a.device&&a.device.userDirectory&&a.device.userDirectory!==b)},createDeviceServerClient:function(b){var c=this,d=new a;this.deviceServerClient=null;if(this.deviceServerClient=
f.createClientWithStore(b,"Device Control Server",{delegate:{onConnected:function(){c.onDeviceServerConnected();d.resolve();c.publish(m.EVENTS.ON_DEVICE_SERVER_CONNECTED);t&&c.ctx.getNotificationManager().postMessage({message:"Connected to Device Server",type:"success",duration:3E3})},onLostConnection:function(){c.onDeviceServerConnectionLost()},onServerResponse:function(a){var b=a.data,d=null;if(r.isString(b)){try{d=JSON.parse(b)}catch(g){d=b}if((d=d||{},d.data)&&d.data.deviceMessage&&d.data.deviceMessage.event===
m.EVENTS.ON_COMMAND_FINISH){c.onCommandFinish(d.data.device,d.data.deviceMessage);return}if(d&&d.data&&d.data.deviceMessage&&d.data.deviceMessage.event===m.EVENTS.ON_COMMAND_PROGRESS){c.onCommandProgress(d.data.device,d.data.deviceMessage);return}if(d&&d.data&&d.data.deviceMessage&&d.data.deviceMessage.event===m.EVENTS.ON_COMMAND_PAUSED){c.onCommandPaused(d.data.device,d.data.deviceMessage);return}if(d&&d.data&&d.data.deviceMessage&&d.data.deviceMessage.event===m.EVENTS.ON_COMMAND_STOPPED){c.onCommandStopped(d.data.device,
d.data.deviceMessage);return}if(d.data&&d.data.deviceMessage&&d.data.deviceMessage.event===m.EVENTS.ON_COMMAND_ERROR){c.onCommandError(d.data.device,d.data.deviceMessage);return}if(d.event===m.EVENTS.ON_DEVICE_DISCONNECTED){c.publish(m.EVENTS.ON_DEVICE_DISCONNECTED,d.data);return}if(d.event===m.EVENTS.SET_DEVICE_VARIABLES)return c.onSetDeviceServerVariables(d.data);if(d.event===m.EVENTS.ON_RUN_CLASS_EVENT)return c.onRunClassEvent(d.data);if(d.event===m.EVENTS.ON_DEVICE_CONNECTED){c.publish(m.EVENTS.ON_DEVICE_CONNECTED,
d.data);return}if(d.event===m.SOCKET_SERVER_COMMANDS.PROTOCOL_METHOD){c.publish(m.SOCKET_SERVER_COMMANDS.PROTOCOL_METHOD+"_"+d.data.options.id,d.data);return}if(d.event===m.EVENTS.ON_SERVER_LOG_MESSAGE){c.publish(m.EVENTS.ON_SERVER_LOG_MESSAGE,d.data);return}if(d.event===m.EVENTS.ON_MQTT_MESSAGE){c.publish(m.EVENTS.ON_MQTT_MESSAGE,d.data);c.onMQTTMessage(d.data);return}if(d.event===m.EVENTS.ON_FILE_CHANGED)return c.ctx.onXIDEMessage(n.fromJson(a.data));if(!c.handle(d))return}c.onDeviceServerMessage(a)}}}))return this.deviceServerClient.dfd=
d,this.deviceServerClient}});e.chainAfter(h,"onDeviceStarted");e.chainAfter(h,"onDeviceDisconnected");return h})},"xcf/model/Device":function(){define("dcl/dcl xide/data/Model xide/data/Source xide/types xide/utils xide/mixins/EventedMixin xcf/types/Types".split(" "),function(e,p,m,n,f,b){e=e([p,m.dcl,b.dcl],{declaredClass:"xcf.model.Device",_userStopped:!1,state:n.DEVICE_STATE.DISCONNECTED,driverInstance:null,blockScope:null,getParent:function(){return this.getStore().getSync(this.parentId)},isServerSide:function(){var a=
this.getMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);return 1<<n.DRIVER_FLAGS.RUNS_ON_SERVER&a?!0:!1},isServer:function(){var a=this.getMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);return 1<<n.DRIVER_FLAGS.SERVER&a?!0:!1},setServer:function(a){a=this.getMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);a.value|=1<<n.DRIVER_FLAGS.SERVER;this.setMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS,a.value)},setServerSide:function(a){a=this.getMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);
a|=1<<n.DRIVER_FLAGS.RUNS_ON_SERVER;this.setMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS,a)},isDebug:function(){var a=this.getMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);return 1<<n.DRIVER_FLAGS.DEBUG&a?!0:!1},check:function(){this._startDfd&&!0===this._userStopped&&this.reset()},getStore:function(){return this._store},getScope:function(){var a=this.getStore();return a?a.scope:this.scope},isEnabled:function(){return!0===this.getMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_ENABLED)},setEnabled:function(a){return this.setMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_ENABLED,
a)},shouldReconnect:function(){return this._userStopped?!1:this.isEnabled()},reset:function(){delete this._startDfd;this._startDfd=null;delete this.blockScope;this.blockScope=null;delete this.serverVariables;this.serverVariables=null;delete this.driverInstance;this.driverInstance=null;clearTimeout(this.reconnectTimer);delete this.lastReconnectTime;delete this.reconnectRetry;delete this.isReconnecting;this.setState(n.DEVICE_STATE.DISCONNECTED)},constructor:function(){},getBlockScope:function(){return this.driverInstance&&
this.driverInstance.blockScope?this.driverInstance.blockScope:this.blockScope},getDriverInstance:function(){return this.driverInstance},getDriver:function(){var a=this.getBlockScope();return a?a.driver:null},getMetaValue:function(a){return f.getCIInputValueByName(this.user,a)},setMetaValue:function(a,b,c){var g=f.getCIByChainAndName(this.user,0,a);if(!g)return null;var e=this.getMetaValue(a);f.setCIValueByField(g,"value",b);this[a]=b;if(!1!==c&&e!=b)return this.publish(n.EVENTS.ON_CI_UPDATE,{owner:this.owner,
ci:g,newValue:b,oldValue:e})},getStateIcon:function(a){a=a||this.state;switch(a){case n.DEVICE_STATE.READY:case n.DEVICE_STATE.CONNECTED:return"fa-link iconStatusOn";case n.DEVICE_STATE.SYNCHRONIZING:case n.DEVICE_STATE.CONNECTING:return"fa-spinner fa-spin";case n.DEVICE_STATE.LOST_DEVICE_SERVER:return"fa-spinner fa-spin"}return"fa-unlink iconStatusOff"},setState:function(a,b){if(a!==this.state){var c=this.state,g=this.getStateIcon(a);this.state=a;this.set("iconClass",g);this.set("state",a);this._emit(n.EVENTS.ON_DEVICE_STATE_CHANGED,
{old:c,state:a,icon:g,"public":!0});this.refresh("state")}}});e.createSubclass=p.createSubclass;return e})},"xcf/mixins/LogMixin":function(){define(["dcl/dcl","xcf/types/Types","xide/utils"],function(e,p,m){var n=p.DEFAULT_DEVICE_LOGGING_FLAGS;e=e(null,{hasFlagEx:function(f,b,a){f=f.loggingFlags;f=_.isString(f)?m.fromJson(f):f||{};a=f[a]?f[a]:n[a];return null!=a&&a&b?!0:!1}});e.DEFAULT_LOGGING_FLAGS=n;return e})},"xide/console":function(){define([],function(){return"undefined"!==typeof window?window.console:
"undefined"!==typeof global?global.console:{}})},"xcf/manager/Context":function(){define("dcl/dcl xide/manager/Context xcf/manager/DriverManager xcf/manager/DeviceManager xcf/manager/ProtocolManager xcf/manager/Application xcf/manager/LogManager xide/manager/ResourceManager xide/manager/PluginManager xdojo/has".split(" "),function(e,p,m,n,f,b,a,d,c,g){return e([p],{declaredClass:"xcf.manager.Context",namespace:"xcf.manager.",driverManager:null,deviceManager:null,protocolManager:null,debugManager:null,
nodeServiceManager:null,blockManager:null,getBlockManager:function(){return this.blockManager},getProtocolManager:function(){return this.protocolManager},getDriverManager:function(){return this.driverManager},getDeviceManager:function(){return this.deviceManager},getNodeServiceManager:function(){return this.nodeServiceManager},getDebugManager:function(){return this.debugManager},constructManagers:function(a){this.isEditor()},initManagers:function(){this.isEditor()||(this.driverManager.init(),this.deviceManager.init(),
g("protocols")&&this.protocolManager.init(),g("log")&&this.logManager.init());this.resourceManager&&this.resourceManager.init()},getUserDirectory:function(){if(this.args&&this.args.userDirectory)return this.args.userDirectory;var a=this.getResourceManager();if(a)return a.getVariable("USER_DIRECTORY")}})})},"xide/manager/Context":function(){define("dcl/dcl dojo/Deferred dojo/has xide/manager/ContextBase xide/types xide/utils require dojo/promise/all xdojo/has!host-browser?xide/manager/Context_UI".split(" "),
function(e,p,m,n,f,b,a,d,c){m=e([n],{declaredClass:"xide.manager.Context",application:null,contextManager:null,fileManager:null,resourceManager:null,notificationManager:null,serviceObject:null,pluginManager:null,windowManager:null,logManager:null,mountManager:null,config:null,managers:null,namespace:"xide.manager.",defaultNamespace:"xide.manager.",vfsMounts:null,xideServiceClient:null,fileUpdateTimes:{},onXIDEMessage:function(c,d){if(c&&c.event&&c.event===f.EVENTS.ON_FILE_CHANGED)if(c.data&&c.data.mask&&
-1!==c.data.mask.indexOf("delete"))this.publish(f.EVENTS.ON_FILE_DELETED,c);else if(c.data&&"delete"==c.data.type)this.publish(f.EVENTS.ON_FILE_DELETED,c);else{var e=c.data.path,h=(new Date).getTime();if(this.fileUpdateTimes[e]&&1E3>h-this.fileUpdateTimes[e])this.fileUpdateTimes[e]=h;else if(!1!==d&&this.publish(c.event,c),this.fileUpdateTimes[e]=h,e=b.replaceAll("\\","/",c.data.path),e=b.replaceAll("//","/",c.data.path),e=e.replace(/\\/g,"/"),-1===e.indexOf("/build/")&&null!=e&&null!=e.indexOf){if(e.match(/\.css$/))this.onCSSChanged({path:e});
if(e.match(/\.js$/)&&(h=c.data.modulePath)){h=h.replace(".js","");try{a(h)}catch(l){}var k="data/system/drivers";-1!=e.indexOf(k)&&(h=e.substr(e.indexOf(k)+(k.length+1),e.length),h=h.replace(".js",""),h="system_drivers/"+h);k="user/drivers";-1!=e.indexOf(k)&&(h=e.substr(e.indexOf(k)+(k.length+1),e.length),h=h.replace(".js",""),h="user_drivers/"+h);(k=(k=this.getResourceManager())?k.getVariable("VFS_CONFIG")||{}:null)&&k.user_drivers&&-1!==e.indexOf(k.user_drivers)&&(k=k.user_drivers,k=k.replace(/\/+$/,
""),h=e.substr(e.indexOf(k)+(k.length+1),e.length),h=h.replace(".js",""),h="user_drivers/"+h);h=b.replaceAll(".","/",h);h.indexOf("/build/")}}}},onNodeServiceStoreReady:function(a){},mergeFunctions:function(a,b,c,d){for(var f in b)_.isFunction(b[f])&&b[f]&&a&&(a[f]=b[f])},reloadModules:function(b,c){var f=new p,e=[],l=[],k=this;a({cacheBust:"time\x3d"+(new Date).getTime()});_.each(b,function(b){var d=null,g=new p;!1!==c&&(d=a(b));a.undef(b);a([b],function(a){d&&k.mergeFunctions(d.prototype,a.prototype);
l.push(a);g.resolve()});e.push(g)});d(e).then(function(){f.resolve(l);a({cacheBust:null})});return f},_reloadModule:function(c,d){var e=null,h=new p;c=c.replace("0/8","0.8");c=c.replace("/src/","/");var l=this.getModule(c);if(l&&l.prototype&&l.prototype.reloadModule)return l.prototype.reloadModule();var e=a.on("error",function(a){console.log(a.src,a.id);console.error("require error "+c,a);e.remove();h.reject(a)}),k=this.getModule(c);if(!k&&(k="undefined"!==typeof c?k:null,!k&&"undefined"!==typeof window))if(k=
b.getAt(window,b.replaceAll("/",".",c),null))l=k;else try{k=a(b.replaceAll(".","/",c))}catch(n){console.log("couldnt require old module",c)}k&&(l=k);a.undef(c);var m=this;d?setTimeout(function(){a({cacheBust:"time\x3d"+(new Date).getTime(),waitSeconds:5});try{a([c],function(b){a({cacheBust:null});if(_.isString(b))console.error("module reloaded failed : "+b+" for module : "+c);else{b.modulePath=c;l&&(m.mergeFunctions(l.prototype,b.prototype,l,b),l.prototype&&l.prototype._onReloaded&&l.prototype._onReloaded(b));
if(k&&k.onReloaded)k.onReloaded(b,k);m.publish(f.EVENTS.ON_MODULE_RELOADED,{module:c,newModule:b});b.prototype&&b.prototype.declaredClass&&m.publish(f.EVENTS.ON_MODULE_UPDATED,{moduleClass:b.prototype.declaredClass,moduleProto:b.prototype});m.setModule(c,b);h.resolve(b)}})}catch(b){console.error("error reloading module",b),logError(b,"error reloading module"),h.reject(b)}},100):h.resolve();return h},onCSSChanged:function(a){},onDidChangeFileContent:function(a){if(!a.didProcess&&(a.didProcess=!0,this.vfsMounts&&
a.path)){var c=a.path;if(-1==c.indexOf(".css")&&-1==c.indexOf("resources")&&-1==c.indexOf("meta")&&-1!=c.indexOf(".js")){var c=a.mount.replace("/",""),d=null;if(this.vfsMounts[c]){var d=""+a.path,d=d.replace("./",""),d=d.replace("/","."),d=d.replace(".js",""),d=b.replaceAll(".","/",d),f=this;setTimeout(function(){try{f._reloadModule(d,!0)}catch(a){console.error("error reloading module",a)}},100)}}}},getMount:function(a){var b=this.getResourceManager();return(b=b?b.getVariable("VFS_CONFIG")||{}:null)&&
b[a]?b[a]:null},toVFSShort:function(a,c){var d=this.getResourceManager();return(d=d?d.getVariable("VFS_CONFIG")||{}:null)&&d[c]&&(d=d[c],d=b.replaceAll("//","/",d),d=d.replace(/\/+$/,""),-1!==a.indexOf(d))?(d=d.replace(/\/+$/,""),a.substr(a.indexOf(d)+(d.length+1),a.length)):null},findVFSMount:function(a){var c=this.getResourceManager();if(c=c?c.getVariable("VFS_CONFIG")||{}:null)for(var d in c){var f=c[d],f=b.replaceAll("//","/",f),f=f.replace(/\/+$/,"");if(-1!==a.indexOf(f))return d}return null},
getBlockManager:function(){return this.blockManager},getPluginManager:function(){return this.pluginManager},getService:function(){return this.serviceObject},getFileManager:function(){return this.fileManager},getResourceManager:function(){return this.resourceManager},getMountManager:function(){return this.mountManager},getContextManager:function(){return this.contextManager},getLogManager:function(){return this.logManager},getApplication:function(){return this.application},constructor:function(a,b){this.managers=
[];this.config=a;this.args=b;this.language="en";this.subscribe(f.EVENTS.ON_CHANGED_CONTENT,this.onDidChangeFileContent)},prepare:function(){this.config&&this.initWithConfig(this.config)},initWithConfig:function(a){a&&a.mixins&&this.doMixins(a.mixins)},isEditor:function(){return this.args&&this.args.file}});e.chainAfter(m,"constructManagers");e.chainAfter(m,"initManagers");return m})},"xcf/manager/ProtocolManager":function(){define("dcl/dcl dojo/_base/declare xide/manager/ServerActionBase xide/types xide/utils xide/factory xaction/Action xcf/manager/BeanManager".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r,q,h,l){return e([m,d],{declaredClass:"xcf.manager.ProtocolManager",beanNamespace:"protocol",beanName:"Protocol",beanIconClass:"fa-code",groupType:n.ITEM_TYPE.PROTOCOL_GROUP,itemType:n.ITEM_TYPE.PROTOCOL,itemMetaPath:"user.meta",itemMetaStorePath:"/meta/inputs",itemMetaTitleField:n.PROTOCOL_PROPERTY.CF_PROTOCOL_TITLE,systemScope:"system_protocols",userScope:"user_protocols",appScope:"app_protocols",defaultScope:"system_protocols",serviceClass:"XCF_Protocol_Service",rawData:null,
store:null,treeView:null,protocolScopes:null,getItemActions:function(){var a=[],b=this,c=this.getItem(),d=c?!0===f.toBoolean(c.isDir):!1;a.push({title:"New Group",icon:"el-icon-folder",place:"last",emit:!1,style:"",handler:function(a,c,d){b.newGroup()}});a.push({title:"Reload",icon:"fa-refresh",disabled:!1,command:"Reload",place:"last",emit:!1,style:"",handler:function(){b.reload()}});null!=this.getItem()&&(a.push({title:"Delete",icon:"el-icon-remove-circle",disabled:!1,command:"Delete",place:"last",
emit:!1,style:"",handler:function(){b.onDeleteItem(c)}}),d?a.push({title:"New Protocol",icon:"el-icon-file-new",disabled:!1,command:"NewItem",place:"last",emit:!1,style:"",handler:function(){b.newItem(c)}}):a.push({title:"Connect",icon:"el-icon-play-circle",disabled:!1,command:"Start",place:"last",emit:!1,style:"",handler:function(){b.startDevice(c)}}));return a},onItemRemoved:function(a){a==this.currentItem&&(this.currentItem=null);a&&(a=this.getView(a))&&f.destroy(a)},_onDeleteItem:function(a){var b=
!0===f.toBoolean(a.isDir),d=f.toString(a.name),g=b?"removeGroup":"removeItem",e=this;(new c({title:"Remove Protocol"+(b?" Group":"")+" '"+d+"'",style:"max-width:400px",titleBarClass:"text-danger",delegate:{isRemoving:!1,onOk:function(b){e[g](f.toString(a.scope),f.toString(a.path),function(){e.onItemRemoved(a)})}},inserts:[{query:".dijitDialogPaneContent",insert:'\x3cdiv\x3e\x3cspan class\x3d"fileManagerDialogText"\x3eDo you really want to remove  this item?\x3c/span\x3e\x3c/div\x3e',place:"first"}]})).show()},
newItem:function(){var a=this.getItem();a||(a={path:""});var b=[f.createCI("In Group",13,f.toString(a.path),{widget:{disabled:!0},group:"Common"}),f.createCI("Title",13,"",{group:"Common"})],a=new r({title:"New Device",resizable:!0,delegate:{onOk:function(a,c){var d=f.createCI("Id",13,f.createUUID(),{visible:!1,group:"Common"});c.push(d);f.toOptions(c);f.getInputCIByName(b,"Title");f.getInputCIByName(b,"Scope");f.getInputCIByName(b,"In Group")}},cis:b});a.show();a.resize()},reload:function(){},onFileChanged:function(a){if(!a._pp2){a._pp2=
!0;var b=a.data;this.fileUpdateTimes||(this.fileUpdateTimes={});if(b.event===n.EVENTS.ON_FILE_CHANGED){if(b.data&&b.mask&&-1!==b.mask.indexOf("delete")){console.error("deleted");return}(new Date).getTime()}var c=f.replaceAll("\\","/",b.path),c=f.replaceAll("//","/",b.path),c=c.replace(/\\/g,"/");-1!=c.indexOf("protocols")&&(c.match(/\.json$/)&&(-1!=c.indexOf("data/system/protocols")&&console.log("protocol changed"+c),this.ls("system_protocols")),this.onFileChanged2&&this.onFileChanged2(a))}},init:function(){this.subscribe(n.EVENTS.ON_FILE_CHANGED,
this.onFileChanged)},_resetItem:function(a){a.commandsItem&&f.removeFromStore(this.getStore(),a.commandsItem,!0,"path","parentId");a.variablesItem&&f.removeFromStore(this.getStore(),a.variablesItem,!0,"path","parentId")},_completeProtocolItem:function(a){if(a&&a.user){var b=f.getInputCIByName(a.user.meta,"content"),c=this,d=this.getStore();if(!b&&(a.mount=""+a.scope,a.getPath=function(){return a.path},a.virtual=!1,a.isDir=!0,a.children=[],b=f.createCI("Content",n.ECIType.FILE_EDITOR,"no value",{group:"Content",
editor:"JSON Editor",editorArgs:{subscribers:[{event:"onSave",handler:function(b){(b=f.getJson(b.value))&&b.meta&&(a.user=b,a._completed=!1,c._resetItem(a),c._completeProtocolItem(a),c.publish(n.EVENTS.ON_PROTOCOL_CHANGED,{item:a}))},owner:c}],leftEditorArgs:{subscribers:[{event:"addAction",handler:function(a){console.log("add action",arguments)},owner:c}],hiddenFields:{},readOnlyNodes:{commands:!0,variables:!0,meta:!0},insertTemplates:[{label:"New Command",path:"commands",value:'{title:"No Title",send:""}',
newNodeTemplate:"[]",collapse:!0,select:!0},{label:"New Variable",path:"variables",value:'{title:"No Title",value:""}',newNodeTemplate:"[]",collapse:!0,select:!0}],renderTemplates:[{nodeValuePath:"field.innerHTML",match:[/^variables[\s]?\.(\d+)$/,/^commands[\s]?\.(\d+)$/],replaceWith:"{nodeValue} - {title}",variables:null,nodeValueTransform:function(a){return f.capitalize(a)},insertIfMatch:{}}]},rightEditorArgs:{subscribers:[{event:"addAction",handler:function(a){console.log("add action",arguments)},
owner:c}]}},editorItem:a,editorOverrides:{},isOwnTab:!0}),a.user.meta.inputs.push(b),!a._completed)){a._completed=!0;var g={path:f.createUUID(),name:"Commands",isDir:!0,type:"leaf",parentId:a.path,virtual:!0,children:[]};a.commandsItem=g;a.children.push(g);d.putSync(g);for(var e=a.user.commands,b=0;b<e.length;b++){var h=e[b];g.children.push(d.putSync({path:f.createUUID(),name:h.name,id:f.createUUID(),parentId:g.path,_mayHaveChildren:!1,virtual:!0,user:{},isDir:!1,value:h.value,ref:{protocol:a,item:h},
type:"protocolCommand"}))}g={path:f.createUUID(),name:"Variables",isDir:!0,type:"leaf",parentId:a.path,virtual:!0,items:[],children:[]};d.putSync(g);a.children.push(g);a.variablesItem=g;e=a.user.variables;for(b=0;b<e.length;b++)h=e[b],g.children.push(d.putSync({isDir:!1,path:f.createUUID(),name:h.name,id:f.createUUID(),parentId:g.path,_mayHaveChildren:!1,value:h.value,virtual:!0,user:{},ref:{protocol:a,item:h},type:"protocolVariable"}))}}},onStoreReady:function(a){a=a?f.queryStore(a,{isDir:!1}):[];
var b=this;_.each(a,function(a,c,d){b._completeProtocolItem(a)})},onMainViewReady:function(){g.prototype.ctx=this.ctx},openItemSettings:function(a){var b=a.user;if(!b||!b.meta)return null;var c=this.getViewId(a),d=h.byId(c);try{if(d)return d.parentContainer&&d.parentContainer.selectChild(d),null}catch(g){f.destroy(d)}var d=this.getViewTarget(),e=this.getMetaValue(a,this.itemMetaTitleField);a.beanContextName=this.ctx.mainView.beanContextName;return f.addWidget(q,{title:e||f.toString(a.name),cis:b.meta.inputs,
beanContextName:this.ctx.mainView.beanContextName,storeItem:a,iconClass:this.beanIconClass,id:c,delegate:this,storeDelegate:this,closable:!0,showAllTab:!1,blockManager:this.ctx.getBlockManager()},this,d,!0)}})})},"xaction/Action":function(){define("dcl/dcl xide/model/Base xide/types xide/utils/ObjectUtils xide/utils xide/mixins/EventedMixin xide/cache/Circular".split(" "),function(e,p,m,n,f,b,a){f.mixin(m,{ACTION_VISIBILITY:{MAIN_MENU:"MAIN_MENU",CONTEXT_MENU:"CONTEXT_MENU",QUICK_LAUNCH:"QUICK_LAUNCH",
ACTION_TOOLBAR:"ACTION_TOOLBAR",PROPERTY_VIEW:"PROPERTY_VIEW",RIBBON:"RIBBON",widgetArgs:null,factory:function(){var a=arguments[1]||f.clone(m.ACTION_VISIBILITY),b=arguments;if(0<b[0].length&&_.isNumber(b[0][0])){var d=b[0],e=0;_.each(a,function(b,g){"function"!==typeof a[g]&&e<d.length&&(a[g+"_val"]=d[e]);e++})}if(_.isString(b[0][0])){if(!0===b[0][2])f.mixin(a[b[0][0]+"_val"],b[0][2]);else return a[b[0][0]+"_val"]=b[0][1],a;return b[1]}return a}}});m.ACTION_VISIBILITY_ALL="ACTION_VISIBILITY_ALL";
var d=e([p.dcl,b.dcl],{declaredClass:"xaction/Action",disabled:!1,destroy:function(){},enabled:!0,object:null,show:!0,group:"",types:"",command:null,icon:"fa-play",event:null,handler:null,tab:null,visibility_:null,value:null,setVisibility:function(){if(2==arguments.length&&_.isString(arguments[0])&&arguments[0]==m.ACTION_VISIBILITY_ALL){var a=arguments[1],b=m.ACTION_VISIBILITY,d=this;[b.MAIN_MENU,b.ACTION_TOOLBAR,b.CONTEXT_MENU,b.RIBBON].forEach(function(b){d.setVisibility(b,f.cloneKeys(a,!1))});
return this}b=_.isArray(arguments[0])?arguments[0]:arguments;this.visibility_=m.ACTION_VISIBILITY.factory(b,this.visibility_);return this},getVisibility:function(a){this.visibility_||this.setVisibility(m.ACTION_VISIBILITY_ALL,{});return this.visibility_?(null==this.visibility_[a+"_val"]&&(this.visibility_[a+"_val"]={vis:a}),this.visibility_[a+"_val"]):{}},shouldDestroyWidget:function(a,b,d){a=null!=this.getVisibility?this.getVisibility(a):null;var f=!0;a&&a.permanent&&(f=!(_.isFunction(a.permanent)?
a.permanent(this,b,d):a.permanent));return f}});d.create=function(a,b,e,q,h,l,k,n,m,p,z){n=null;n=new d({permanent:q,command:e,icon:b,label:a,owner:this,types:l,operation:h,group:k,handler:p,title:a});f.mixin(n,z);return n};d.createDefault=function(a,b,f,e,h,l){return d.create(a,b,f,!1,null,null,e||"nogroup",null,!1,h,l)};return d})},"xide/cache/Circular":function(){define([],function(){function e(p){if(!(this instanceof e))return new e(p);if("object"==typeof p&&Array.isArray(p._buffer)&&"number"==
typeof p._capacity&&"number"==typeof p._first&&"number"==typeof p._size)for(var m in p)p.hasOwnProperty(m)&&(this[m]=p[m]);else{if("number"!=typeof p||0!=p%1||1>p)throw new TypeError("Invalid capacity");this._buffer=Array(p);this._capacity=p;this._size=this._first=0}}e.prototype={size:function(){return this._size},capacity:function(){return this._capacity},enq:function(e){0<this._first?this._first--:this._first=this._capacity-1;this._buffer[this._first]=e;this._size<this._capacity&&this._size++},
push:function(e){this._size==this._capacity?(this._buffer[this._first]=e,this._first=(this._first+1)%this._capacity):(this._buffer[(this._first+this._size)%this._capacity]=e,this._size++)},deq:function(){if(0==this._size)throw new RangeError("dequeue on empty buffer");var e=this._buffer[(this._first+this._size-1)%this._capacity];this._size--;return e},pop:function(){return this.deq()},shift:function(){if(0==this._size)throw new RangeError("shift on empty buffer");var e=this._buffer[this._first];this._first==
this._capacity-1?this._first=0:this._first++;this._size--;return e},get:function(e,m){if(0==this._size&&0==e&&(void 0==m||0==m))return[];if("number"!=typeof e||0!=e%1||0>e)throw new TypeError("Invalid start");if(e>=this._size)throw new RangeError("Index past end of buffer: "+e);if(void 0==m)return this._buffer[(this._first+e)%this._capacity];if("number"!=typeof m||0!=m%1||0>m)throw new TypeError("Invalid end");if(m>=this._size)throw new RangeError("Index past end of buffer: "+m);this._first+e>=this._capacity&&
(e-=this._capacity,m-=this._capacity);return this._first+m<this._capacity?this._buffer.slice(this._first+e,this._first+m+1):this._buffer.slice(this._first+e,this._capacity).concat(this._buffer.slice(0,this._first+m+1-this._capacity))},toarray:function(){return 0==this._size?[]:this.get(0,this._size-1)}};return e})},"xcf/manager/Application":function(){define("dcl/dcl require xide/manager/Application xide/utils xide/types xdojo/declare xdojo/has xdojo/has!xcf-ui?xcf/manager/Application_UI xdojo/has!xexpression?xexpression/Expression".split(" "),
function(e,p,m,n,f,b,a,d,c,g){return e(m,{declaredClass:"xcf.manager.Application",vfsItems:null,onReloaded:function(){},onMountDataReady:function(a){},onPluginLoaded:function(a){this.publish(f.EVENTS.ON_PLUGIN_READY,{name:a.name,mainView:this.rootView,config:this.config,ctx:this.ctx,panelManager:this,fileManager:this.ctx.getFileManager(),store:this.store,serviceObject:this.ctx.getService()},this)},_onXBlocksReady:function(){p("xfile/manager/BlockManager");var a=this.ctx;if(a.blockManager)a.blockManager.onReady();
p(["xcf/manager/BlockManager"],function(b){a.blockManager=new b;a.blockManager.ctx=a;a.blockManager.updatePalette=!1;a.blockManager.init();a.blockManager.onReady();a.blockManager.serviceObject=a.fileManager.serviceObject});var b=p("xblox/views/BlocksFileEditor");a.registerEditorExtension("xBlocks","xblox","fa-play-circle-o",this,!0,null,b,{ctx:this.ctx,mainView:this.mainView,blockManagerClass:"xfile.manager.BlockManager",registerView:!0})}})})},"xide/manager/Application":function(){define("dcl/dcl xdojo/has xide/manager/ManagerBase xide/types xide/utils dojo/Deferred dojo/promise/all dojo/has!host-browser?xide/manager/Application_UI".split(" "),
function(e,p,m,n,f,b,a,d){return e([m],{declaredClass:"xide.manager.Application",container:null,ctx:null,_debug:!0,_loadedComponents:{},_loadingComponents:null,getComponents:function(){return this._loadedComponents},doComponents:function(){function c(a,c){if(p(a)&&d[a]&&d[a].dfd){var f=new b;h.push(f);d[a].dfd.then(function(){c(f)})}}var d=this.loadComponents(),f=require,e=this,h=[],l=new b;if(!d||!d.dfd)return console.error("componentsToLoad is null or has no head dfd"),d;var k=n.COMPONENT_NAMES;
c(k.XTRACK,function(a){a.resolve()});c(k.XFILE,function(a){e.initXFile().then(function(){a.resolve()})});c(k.XIDEVE,function(a){e.initXIDEVE().then(function(){a.resolve()})});c(k.XNODE,function(a){e.initXNODE().then(function(){a.resolve()})});c(k.XBLOX,function(a){f(["xblox/embedded_ui","xfile/manager/BlockManager","xblox/views/BlocksFileEditor"],function(){e.onXBlocksReady().then(function(){a.resolve()})})});d.dfd.then(function(){a(h).then(function(){l.resolve()})});l.then(function(){e.registerEditorExtensions()});
return l},loadComponents:function(a){if(this._loadingComponents)return this._loadingComponents;var d=this,e,q;d._loadedComponents={};a=a||f.getJson(this.ctx.getResourceManager().getVariable("COMPONENTS"));_.each(a,function(b,d){!1===p(d)&&delete a[d]});if(!a)return null;e=function(){var b=_.find(a,{status:0});b?q(b.name,b):(a.dfd.resolve(a),d.publish(n.EVENTS.ON_ALL_COMPONENTS_LOADED,a),a.dfd.resolve())};q=function(a,b){var c=b.settings;!1===p(a)&&console.error("loading component "+a+"which is disabled by has!");
d.ctx.getPluginManager().loadComponent(a,null,!0===c?null:c).then(function(c){d._loadedComponents[a]=c;c={component:c,name:a};b.dfd.resolve(c);d.publish(n.EVENTS.ON_COMPONENT_READY,c);b.status=1;e()})};for(var h in a){var l=""+h,k=a[l];a[l]=k?{settings:k,status:0,name:l,dfd:new b}:{status:1}}a.dfd=new b;e();return this._loadingComponents=a},hasComponent:function(a){var b=f.getJson(this.ctx.getResourceManager().getVariable("COMPONENTS"));return!(!b||!b[a])}})})},"xcf/manager/LogManager":function(){define(["dcl/dcl",
"xlog/manager/LogManager"],function(e,p){return e(p,{declaredClass:"xcf.manager.LogManager",ls:function(e){var n=this;return this.callMethodEx(null,"ls",["unset"],function(f){n.rawData=f;n.initStore(f);e&&e(f)},!0)}})})},"xlog/manager/LogManager":function(){define("dcl/dcl xdojo/declare xide/manager/ServerActionBase xide/manager/BeanManager xide/encoding/MD5 xide/types xide/utils dojo/cookie dojo/json dojo/Deferred xide/data/Memory xide/mixins/EventedMixin".split(" "),function(e,p,m,n,f,b,a,d,c,g,
r,q){var h=p([q],{bytesLoaded:null,percentValue:null,item:null,delegate:null,_onEnd:null,_onHandle:null,serviceClass:"XIDE_Log_Service",constructor:function(a){this.item=a;this.subscribe(a.progressMessage,this._onProgress);this.subscribe(a.progressFailedMessage,this._onProgressFailed)},_onProgressFailed:function(a){this.item.level="error";this.item.message=this.item.oriMessage+" : Failed";this.item._isTerminated=!0;a&&a.item&&a.item.error&&this.item.details&&(this.item.details.error=a.item.error)},
_onFinish:function(){this._onHandle&&this._onHandle.remove()},_onProgress:function(a){try{var b=a.progress;a=null;null==a&&(a=Math.round(100*b.loaded/b.total),this.bytesLoaded=b.loaded);if(this.percentValue!=a){var c=""+this.item.oriMessage;this.item.message=""+(c+(" : "+a+"%"))}this.percentValue=a;this._emit("progress");100<=this.percentValue&&(this.item.message=this.item.oriMessage+" : Done",this._emit("finish"),this._onFinish(),this.destroy())}catch(d){console.error("crash in log progress "+d)}}});
return e([m,n],{declaredClass:"xcf.manager.LogManager",serviceClass:"XIDE_Log_Service",cookiePrefix:"logging",singleton:!0,serviceView:null,clients:null,beanNamespace:"logging",views:null,stores:{},removeStore:function(a){var b=this.stores[a];b&&(b.destroy&&b.destroy(),delete this.stores[a])},getViewId:function(a){return this.beanNamespace+f(JSON.stringify({info:a.info}),1)},loadPreferences:function(){var a=d(this.cookiePrefix+"_debug_settings");return a=a?c.parse(a):{}},savePreferences:function(a){d(this.cookiePrefix+
"_debug_settings",c.stringify(a))},empty:function(a){this.clear(a);a=this.getStore(a);a.then&&a.then(function(a){a.setData([])})},clear:function(a){return this.runDeferred(null,"clearAbs",[a||""]).then(function(a){})},getViewTarget:function(){return this.ctx.getApplication().mainView.getNewAlternateTarget()},getStore:function(b){if(!b)return this.store;var c=new g;if(this.stores[b])return c.resolve(this.stores[b]),c;var d=this;this.runDeferred(null,"lsAbs",[b||""]).then(function(g){_.isString(g)&&
(g=a.getJson(g));g=d.initStore(g);d.stores[b]=g;c.resolve(g)});return c},isValid:function(){return null!=this.store},_buildLoggingMessage:function(b){var c={id:a.createUUID(),level:b.level,message:b.message,host:"",data:b.data||{},time:b.time||(new Date).getTime(),type:"",show:!0,showDevice:!0};b.type&&(c.type=b.type);b.device&&b.device.host&&(c.host=b.device.host+":"+b.device.port);b.deviceMessage&&(c.message=c.message+":"+b.deviceMessage);c.ori=b;return c},initStore:function(b){var c={identifier:"time",
label:"level",items:[],sort:"time"};0==b.length&&(b=[]);for(var d=0;d<b.length;d++)c.items.push(this._buildLoggingMessage(b[d]));return new (p("LogStore",[r],{}))({idProperty:"time",data:c,id:a.createUUID()})},createLoggingView:function(b,c,d){c=c||this.getViewTarget();return a.addWidget(!1,{delegate:this,store:b,title:"Log",closable:!0,style:"padding:0px",silent:d},this,c,!0)},updateViews:function(a,b){for(var c=0;c<this.views.length;c++)this.views[c].update(a,b)},refreshViews:function(){for(var a=
0;a<this.views.length;a++)this.views[a].grid.refresh()},addLogView:function(a){this.views.push(a)},openLogView:function(a,b){this.isValid()||this.initStore([]);var c=this.createLoggingView(this.store,a,b);this.views.push(c);return c},_createPendingEvent:function(a,b,c,d){function g(a){!b._isTerminated&&f&&(b.message=b.oriMessage+" : Done",a&&!0===a.failed&&(b.level="error",b.message=b.oriMessage+" : Failed"),b._isTerminated=!0,f.remove(),f=null,e.refreshViews(),b.progressHandler&&b.progressHandler.destroy())}
var f=null,e=this;b._isInProgress=!0;f=e.subscribe(c,g,e)[0];b.showProgress&&b.progressMessage&&!b.progressHandler&&(a=new h(b,this),a._onEnd=g,a._onEndHandle=f,b.progressHandler=a)},addLoggingMessage:function(b){if(b&&b.data){var c=b.data.logId;!c&&b.data&&b.data.device&&(c=b.data.device,c=c.host+"_"+c.port+"_"+c.protocol)}var d={id:a.createUUID(),level:b.level,message:b.message,host:b.host||"",data:b.data||{},time:b.time||(new Date).getTime(),type:b.type||"",show:!0,showDevice:!0,terminatorItem:b.item,
terminatorMessage:b.terminatorMessage,showProgress:b.showProgress,progressMessage:b.progressMessage,progressFailedMessage:b.progressFailedMessage,details:b.details};b.data&&(b.data.type&&(d.type=b.data.type),b.data.device&&b.data.device.host&&(d.host=b.data.device.host+":"+b.data.device.port),b.data.deviceMessage&&(d.message=d.message+":"+b.data.deviceMessage));try{null==d.terminatorMessage||d._isTerminated||(null==d.oriMessage&&(d.oriMessage=""+d.message),this._createPendingEvent(d.oriMessage,d,
d.terminatorMessage,d.time));var g=this.getStore(c);g&&(g.then?g.then(function(a){g=a;d=a.putSync(d);a._emit("added",{item:d,store:g})}):(d=g.putSync(d),g._emit("added",{item:d,store:g})))}catch(f){console.error("adding log message to store failed "+f)}},onServerLogMessage:function(a){a.data&&a.data.time&&(a.time=a.data.time);this.addLoggingMessage(a);!0===a.write&&this.publish(b.EVENTS.ON_CLIENT_LOG_MESSAGE,{message:a.message,data:a.data,details:a.details,level:a.level,type:a.type,time:a.data.time||
a.time})},init:function(){this.subscribe([b.EVENTS.ON_SERVER_LOG_MESSAGE]);this.views=[];this.stores={}},onStoreReloaded:function(){for(var a=0;a<this.views.length;a++){var b=this.views[a];b.reload(this.store);b.update()}},reload:function(){var a=this;this.currentItem=null;this.ls(function(b){a.onStoreReloaded(b)})},ls:function(b,c,d){var g=this;return this.callMethodEx(null,"lsAbs",[c||""],d||function(c){g.rawData=c;_.isString(c)&&(c=a.getJson(c));g.store=g.initStore(c);b&&b(c)},!0)}})})},"xide/manager/ResourceManager":function(){define(["dcl/dcl",
"xide/manager/ServerActionBase","xide/utils","xide/mixins/VariableMixin"],function(e,p,m,n){return e([p,n.dcl],{declaredClass:"xide.manager.ResourceManager",serviceClass:"XApp_Resource_Service",resourceData:null,resourceVariables:null,getResourceVariables:function(){return this.resourceVariables},setVariable:function(f,b){return this.resourceVariables[f]=b},getVariable:function(f){return this.resourceVariables[f]},init:function(){this.resourceVariables||(this.resourceVariables={})},replaceVariables:function(f,
b){return m.multipleReplace(""+f,b||this.resourceVariables)}})})},"xide/mixins/VariableMixin":function(){define(["dcl/dcl","xdojo/declare","xide/utils"],function(e,p,m){var n={resolve:function(f,b,a){b=b||this.resourceVariables||this.ctx.getResourceManager().getResourceVariables()||null;a=a||this.variableDelimiters||null;return m.replace(f,null,b,a)}};p=p("xide/mixins/VariableMixin",null,n);p.dcl=e(null,n);return p})},"xide/manager/PluginManager":function(){define("dcl/dcl dojo/has xide/manager/ManagerBase xide/utils xide/types xide/factory dojo/Deferred dojo/promise/all".split(" "),
function(e,p,m,n,f,b,a,d){return e(m,{declaredClass:"xide.manager.PluginManager",_defaultPackageLocationPrefix:"../../",_defaultPackageLocationSuffix:"/component",_defaultComponentFlags:{LOAD:1,RUN:2},defaultComponentMixin:function(a){return{owner:this,ctx:this.ctx,flags:a}},componentBaseClasses:null,ctx:null,pluginResources:null,pluginInstances:null,_componentReady:function(a,b,d){if(b.RUN)try{a.run(this.ctx)}catch(f){}return d.resolve(a)},_componentLoaded:function(a,d,f,e){try{n.mixin(f,this.defaultComponentMixin(d));
var h=b.createInstance(a,f,this.componentBaseClasses),l=function(a,b,c){this._componentReady(a,b,c)}.bind(this);d.LOAD?h.load().then(function(){l(h,d,e)}):l(h,d,e)}catch(k){e.reject(arguments),logError(k)}},loadComponent:function(b,d,f,e,h){f="true"===f?{}:f;b=-1==b.indexOf("/")?this._defaultPackageLocationPrefix+b+this._defaultPackageLocationSuffix:b;d=null!=d?d:this._defaultComponentFlags;var l=new a,k=this;(e=n.getObject(b))?_.isFunction(e.then)?e.then(function(a){k._componentLoaded(a,d,f,l)},
function(a){console.error("error in loading component at path "+b,a)}):this._componentLoaded(e,d,f,l):console.error("cant get object at "+b);return l},loadComponentResources:function(a,b){},reloadComponent:function(a){},loadPlugins:function(b){if(p("plugins")){var g=new a,e=[],n=this;this.pluginResources=b;this.pluginInstances=[];if(this.pluginResources)for(var h=0;h<this.pluginResources.length;h++){var l=this.pluginResources[h];l.type&&"JS-PLUGIN"==l.type&&l.path&&e.push(this.loadComponent(l.path,
null,l).then(function(a){a.pluginResources=l;n.pluginInstances.push(a)}))}d(e).then(function(){g.resolve(e);n.publish(f.EVENTS.ALL_PLUGINS_READY,{instances:n.pluginInstances,resources:b})});return g}}})})},"nxapp/manager/DeviceManager":function(){define("dcl/dcl dojo/node!fs xcf/manager/DeviceManager xide/utils xide/types nxapp/utils/_console nxapp/utils dojo/node!child_process".split(" "),function(e,p,m,n,f,b,a,d){function c(a,b,c,d,f,e,n){r.exec(c,q,function(a,b,c){if(b&&127===parseInt(b,10)&&(g.error("--have error "+
c),n&&n.onCommandError))n.onCommandError();b&&0===parseInt(b,10)&&g.error("--terminate with "+b);b&&1===parseInt(b,10)&&g.error("--terminate with 1 "+b);g.error("response ",arguments)}.bind(this))}var g=b;e(null,{emit:function(){g.error("device server client emit",arguments)}});var r=d,q={stdout:!0,stderr:!0,stdin:!0,failOnError:!0,stdinRawMode:!1,killSignal:"SIGTERM"};return e(m,{declaredClass:"nxapp.manager.DeviceManager",connection:null,runShell:function(a,b,c){var d=this.getContext().getConnectionManager();
r.exec(a,q,function(b,e,l){e&&127===parseInt(e,10)&&g.error("--have error "+l);b&&g.log("err",b);e&&g.log("stdout",e);l&&g.log("stderr",l);e&&0===parseInt(e,10)&&g.info("--terminate with 0"+e);if(e&&1===parseInt(e,10)){g.info("--terminate with 1 "+e);try{d.onData(d.getConnection2(c),n.mixin({cmd:a,event:f.EVENTS.ON_COMMAND_FINISH,result:e},c),new Buffer(e))}catch(q){g.error("onFinish-Error:",q)}}}.bind(this))},runShell2:function(a,b,d,g,f,e){f=a.options;c(a,{host:f.host,port:f.port,protocol:f.protocol},
b,d,g,q,e)},onDeviceMetaChanged:function(b,c){var d=this.store;d&&_.each(d.data,function(d){if(-1!==d.path.indexOf(c)&&p.existsSync(b)){var g=n.getJson(a.readFile(b));g&&(d.user=g)}})},onFileChanged:function(a){if("changed"===a.type&&!a._did){a._did=!0;a=n.replaceAll("\\","/",a.path);a=n.replaceAll("//","/",a);a=a.replace(/\\/g,"/");var b;b=a;b=-1!=b.indexOf("system/devices")?b.substr(b.indexOf("system/devices")+15,b.length):null;if(b&&-1!==b.indexOf(".meta.json"))this.onDeviceMetaChanged(a,b)}},
checkDeviceServerConnection:function(){},sendManagerCommand:function(a,b){try{var c=this.ctx.getDeviceServer(),d={manager_command:a};n.mixin(d,b);c.handleManagerCommand(d,this.connection)}catch(f){g.error("error "+f.message,f.stack)}},sendDeviceCommand:function(a,b,c,d){a=a.options;n.mixin({src:c},a);b={command:b,device_command:"Device_Send",options:a};n.mixin(b.options,{params:{src:c,id:d}});this.ctx.getDeviceServer().handleDeviceCommand(b,this.connection)},debug:function(){g.log("------------stores");
g.log("have "+_.size(this.stores));_.each(this.stores,function(a){})}})})},"xcf/manager/BlockManager":function(){define(["dcl/dcl","xide/types","xide/manager/ManagerBase","xblox/manager/BlockManager","xide/lodash"],function(e,p,m,n,f){return e([m,n],{declaredClass:"xcf.manager.BlockManager",onReady:function(){},addDriverFunctions:function(b,a){for(var d in a)"constructor"!==d&&"inherited"!==d&&f.isFunction(a[d])&&(b[d]=a[d])},setScriptFunctions:function(b,a,d){var c=d;a.context||(a.context=b);b.blockScope||
(b.blockScope=a);a.context&&a.context.instance&&(a.device=a.context.instance);b.callCommand||(b.callCommand=function(a){(a=this.blockScope.getBlockByName(a))&&a.solve(this.blockScope)});b.setVariable||(b.setVariable=function(d,f,e,h,l){if(d=this.blockScope.getVariable(d))d.value=f,d.set("value",f),!1!==h&&c.publish(p.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:d,scope:a,driver:b,owner:c,save:!0===e,source:l||p.MESSAGE_SOURCE.BLOX})});b.getVariable||(b.getVariable=function(a){return(a=this.blockScope.getVariable(a))?
a.value:""});this.inherited(arguments)},onReloaded:function(){this.init()},getDeviceVariablesAsEventOptions:function(){},onCreateVariableCI:function(b){}})})},"xblox/manager/BlockManager":function(){define("dcl/dcl dojo/has dojo/Deferred dojo/promise/all xide/types xide/utils xide/factory xblox/model/ModelBase xblox/model/Scope xblox/model/BlockModel xide/mixins/ReloadMixin xide/manager/ManagerBase xblox/data/Store xdojo/has!xblox-ui?xblox/manager/BlockManagerUI xide/lodash".split(" "),function(e,
p,m,n,f,b,a,d,c,g,r,q,h,l,k){return e([q,r.dcl],{declaredClass:"xblox/manager/BlockManager",serviceObject:null,loaded:{},test:function(){},scope:null,scopes:null,_createBlock:null,_registerActions:function(){},toScope:function(a){try{a=b.getJson(a)}catch(c){return console.error("BlockManager::toScope: failed,err\x3d"+c),null}a||(console.error("correct data"),a={blocks:[],variables:[]});var d=b.createUUID(),g=a;!k.isArray(a)&&k.isObject(a)&&(d=a.scopeId||d,g=a.blocks||[]);a=this.getScope(d,{owner:this},
!0);g=a.blocksFromJson(g);for(d=0;d<g.length;d++)g[d]._lastRunSettings={force:!1,highlight:!0};a.serviceObject=this.serviceObject;return a},loadFiles:function(a){for(var b=[],c=new m,d=0;d<a.length;d++){var g=a[d];b.push(this.load(g.mount,g.path,g.force))}n(b).then(function(a){c.resolve(a)});return c.promise},load:function(a,c,d){var g=new m,f=this,k=b.replaceAll("/","",a),e=b.replaceAll("./","",c),h=k+e,h=h.trim();this.loaded[h]&&!0===d&&(this.removeScope(this.loaded[h].id),this.loaded[h]=null);
if(!0!==d&&this.loaded[h])return g.resolve(this.loaded[h]),g.promise;this.ctx.getFileManager().getContent(k,e,function(b){if(b=f.toScope(b))f.loaded[h]=b,b.mount=a,b.path=c;g.resolve(b)},!1);return g.promise},onBlocksReady:function(a){for(var b=a.allBlocks(),c=0;c<b.length;c++)this.setScriptFunctions(b[c],a,this);if((a=a.getBlocks({group:"On Load"}))&&0<a.length)for(c=0;c<a.length;c++)if(b=a[c],b.onLoad)b.onLoad()},getBlock:function(){},setScriptFunctions:function(a,b,c){a.blockScope||(a.blockScope=
b);b.serviceObject=this.serviceObject;a.setVariable||(a.setVariable=function(d,g,k,e,h){if(d=this.blockScope.getVariable(d))d.value=g,!1!==e&&c.publish(f.EVENTS.ON_VARIABLE_CHANGED,{item:d,scope:b,driver:a,owner:c,save:!0===k,source:h||f.MESSAGE_SOURCE.BLOX})});a.getVariable||(a.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""})},hasScope:function(a){this.scopes||(this.scopes={});return this.scopes[a]?this.scopes[a]:null},getScope:function(b,c,d){this.scopes||(this.scopes=
{});if(!this.scopes[b]&&(this.scopes[b]=this.createScope({id:b,ctx:this.ctx}),this.scopes[b].userData=c,!1!==d))try{a.publish(f.EVENTS.ON_SCOPE_CREATED,this.scopes[b])}catch(g){console.error("bad, scope creation failed "+g,g)}return this.scopes[b]},removeScope:function(a){this.scopes||(this.scopes={});for(var b in this.loaded)this.loaded[b].id==a&&delete this.loaded[b];this.scopes[a]&&(this.scopes[a]._destroy(),delete this.scopes[a]);return null},createScope:function(a,d,f){d=d||[];var k=new h({data:[],
Model:g,id:b.createUUID(),__events:{},observedProperties:["name","enabled","value"],getLabel:function(a){return a.name},labelAttr:"name"});k.reset();k.setData([]);k={owner:this,blockStore:k,serviceObject:this.serviceObject,config:this.config};b.mixin(k,a);try{var e=new c(k);d&&e.initWithData(d,f);e.init()}catch(l){logError(l,"error creating scope, data:",a)}return e},onReloaded:function(){},init:function(){this.scope={variables:[],blocks:[]};d.prototype.types=f;d.prototype.factory=a;if(this.onReady)this.onReady()}})})},
"xblox/model/Scope":function(){define("dcl/dcl ./ModelBase ./Expression xide/factory xide/utils xide/types xide/mixins/EventedMixin dojo/_base/lang dojo/has xide/encoding/MD5 xcf/model/Variable xdojo/has!host-node?nxapp/utils/_console".split(" "),function(e,p,m,n,f,b,a,d,c,g,r,q){var h="undefined"!==typeof window?window.console:"undefined"!==typeof global?global.console:q;q&&(h=q);var l=c("xcf-ui");p=e([p,a.dcl],{declaredClass:"xblox.model.Scope",variableStore:null,serviceObject:null,context:null,
blockStore:null,expressionModel:null,start:function(){if(!0===this.__didStartBlocks)h.error("already started blocks");else{this.__didStartBlocks=!0;var a=this.getVariable("value");a||(a=new r({id:f.createUUID(),name:"value",value:"",scope:this,type:13,group:"processVariables",gui:!1,cmd:!1}),this.blockStore.putSync(a));var a=[],c=this.getBlocks({group:b.COMMAND_TYPES.INIT_COMMAND}),d=this;try{_.each(c,function(a){!1!==a.enabled&&!0!==a.__started&&(a.solve(d),a.__started=!0)},this)}catch(g){h.error("starting init blocks failed",
g),logError(g,this)}a=a.concat(this.getBlocks({group:b.COMMAND_TYPES.BASIC_COMMAND}));for(c=0;c<a.length;c++){var e=a[c];e.enabled&&e.start&&e.startup&&!0!==e.__started&&(e.start(),e.__started=!0)}}},getExpressionModel:function(){this.expressionModel||(this.expressionModel=new m);return this.expressionModel},toFriendlyName:function(a,b){if(!b||!a)return null;var c=this,d=this.ctx,g=this.driver,g=d.getDeviceManager(),e=d.getDriverManager();if(-1==b.indexOf("://"))return(c=c.getBlockById(b))?c.name:
b;var d=f.parse_url(b),d=f.urlArgs(d.host),h=g.getItemById(d.device.value);if(h){var l=g.toDeviceControlInfo(h),g=e.getDriverById(l.driverId);if((h=h.driverInstance)||g)if(c=g.blockScope?g.blockScope:h?h.blockScope:c,(a=c.getStore().getSync(d.block.value))||h&&h.blockScope&&(a=h.blockScope.getBlock(d.block.value)))return l.title+"/"+a.name}return b},getContext:function(){return this.instance},toString:function(){var a={blocks:null,variables:null},b=this.blocksToJson();try{f.fromJson(JSON.stringify(b))}catch(c){return}a.blocks=
b;return JSON.stringify(a,null,2)},initWithData:function(a,b){a&&this.blocksFromJson(a,null,b);this.clearCache()},getService:function(){return this.serviceObject},getStore:function(){return this.blockStore},reset:function(){this.getExpressionModel().reset()},empty:function(){this.clearCache();var a=this.blockStore,b=this.getBlocks();a.silent(!0);_.each(b,function(b){b&&a.removeSync(b.id)});a.setData([]);a.silent(!1)},fromScope:function(a){var b=this.blockStore;b.silent(!0);this.empty();a=a.blocksToJson();
this.blocksFromJson(a);b.silent(!1)},clearCache:function(){this.getExpressionModel().reset()},getVariableStore:function(){return this.blockStore},getBlockStore:function(){return this.blockStore},getVariables:function(a){if(!this.blockStore)return[];var b=this.blockStore.data,c=[];if(a&&"processVariables"===a.group){for(a=0;a<b.length;a++)"processVariables"===b[a].group&&c.push(b[a]);return c}if(!a){for(a=0;a<b.length;a++){var d=b[a],g=d.declaredClass;"xblox.model.variables.Variable"!=g&&"xcf.model.Variable"!=
g||c.push(d)}return c}return this.blockStore.query(a)},loopBlock:function(a,b){1==a._destroyed&&h.error("block destroyed");var c=a.getInterval?a.getInterval():0;if(a&&0<c&&a.enabled&&!0!==a._destroyed){var d=this;a._loop&&clearInterval(a._loop);a._loop=setInterval(function(){!a.enabled||a._destroyed?(clearInterval(a._loop),a._loop=null):a.solve(d,b||a._lastSettings)},c)}},getEventsAsOptions:function(a){var c=[],d;for(d in b.EVENTS)c.push({label:b.EVENTS[d],value:b.EVENTS[d]});c=c.concat([{label:"onclick",
value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}]);for(d=0;d<c.length;d++){var g=
c[d];if(g.value===a){g.selected=!0;break}}return c},getVariablesAsObject:function(){for(var a=this.getVariables(),b={},c=0;c<a.length;c++)b[a[c].title]=a[c].value;return b},getVariablesAsOptions:function(){var a=this.getVariables(),b=[];if(a)for(var c=0;c<a.length;c++)b.push({label:a[c].label,value:a[c].variable});return b},getCommandsAsOptions:function(a){var b=this.getBlocks({declaredClass:"xcf.model.Command"}),c=[];if(b)for(var d=0;d<b.length;d++){var g={};g[a||"label"]=b[d].name;g.value=b[d].name;
c.push(g)}return c},_cached:null,getBlocks:function(a,b){if(!l&&!1!==b&&(this._cached||(this._cached={}),a)){var c=g(JSON.stringify(a),1);if(c=this._cached[c])return c}if(!this.blockStore)return[];a=a||{id:/\S+/};var d=_.isEmpty(a)?this.blockStore.data:this.blockStore.query(a,null,!0);l||!1===b||(c=g(JSON.stringify(a),1),this._cached[c]=d);return d},registerVariable:function(a){this.variables[a.title]=a;this.blockStore&&this.blockStore.putSync(a)},getVariable:function(a){for(var b=this.getVariables(),
c=0;c<b.length;c++){var d=b[c];if(d.name===a)return d}return null},getVariableById:function(a){if(!a)return null;var b=a.split("/"),c=this;2==b.length&&((a=c.owner)&&a.hasScope&&(a.hasScope(b[0])?c=a.getScope(b[0]):h.error("have scope id but cant resolve it",this)),a=b[1]);return(b=c.blockStore.getSync(a))?b:null},registerBlock:function(a,b){var c=this.blockStore;if(c){var d=c.getSync(a.id);if(d)return d;d=null;return d=a.addToStore?a.addToStore(c):c.putSync(a,b)}},allBlocks:function(a,b){return this.getBlocks({},
b)},hasGroup:function(a){for(var b=this.allGroups({},!1),c=0;c<b.length;c++)if(b[c]===a)return!0;return!1},allGroups:function(){for(var a=[],b=this.allBlocks({},!1),c=function(b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1},d=0;d<b.length;d++){var g=b[d];g.parentId||(g.group?c(g.group)||a.push(g.group):c("No Group")||a.push("No Group"))}return a},variablesToJson:function(){var a=[],b=this.variableStore?this.getVariables():this.variables,c;for(c in b){var d=b[c];if(!1!==d.serializeMe&&
null!=d.keys){var g={},f;for(f in d)if(this.isString(d[f])||this.isNumber(d[f])||this.isBoolean(d[f]))g[f]=d[f];a.push(g)}}return a},isScript:function(a){return this.isString(a)&&(-1!=a.indexOf("return")||-1!=a.indexOf(";")||-1!=a.indexOf("[")||-1!=a.indexOf("{")||-1!=a.indexOf("}"))},variablesToJavascriptEx:function(a,b){for(var c=[],d=this.variableStore?this.getVariables():this.variables,g=0;g<d.length;g++){var f=d[g];if(f!=a){var e=""+f.value;a&&a.value&&-1==a.value.indexOf(f.title)||b&&-1==b.indexOf(f.title)||
0==e.length||(this.isScript(e)||-1!=e.indexOf("'")?this.isScript(e)&&(e=this.expressionModel.parseVariable(this,f)):e="'"+e+"'","''"===e&&(e="'0'"),c.push(e))}}return c},variablesToJavascript:function(a,b){for(var c="",d=this.variableStore?this.getVariables():this.variables||[],g=0;g<d.length;g++){var f=d[g];if(f!=a){var e=""+f.value;a&&a.value&&-1==a.value.indexOf(f.title)||b&&-1==b.indexOf(f.title)||0==e.length||(this.isScript(e)||-1!=e.indexOf("'")?this.isScript(e)&&(e=this.expressionModel.parseVariable(this,
f)):e="'"+e+"'","''"===e&&(e="'0'"),c+="var "+f.title+" \x3d "+e+";",c+="\n")}}return c},variablesFromJson:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d.scope=this;if(d.declaredClass){var g=f.replaceAll(".","/",d.declaredClass);(g=require(g))&&b.push(new g(d))}else h.log("   variable has no class ")}return b},regenerateIDs:function(a){for(var b=this,c=function(a){var d=f.createUUID(),g=b.getBlocks({parentId:a.id});if(g&&0<g.length)for(var e=0;e<g.length;e++){var k=g[e];k.parentId=d;c(k)}a.id=
d},d=0;d<a.length;d++)c(a[d])},cloneBlocks2:function(a,b){var c=this.blocksToJson(a),d=this.owner.getScope(f.createUUID(),null,!1),c=d.blocksFromJson(c,!1),g=this.blockStore,c=d.allBlocks();d.regenerateIDs(c);c=d.blocksToJson(c);if(b)for(d=0;d<c.length;d++){var e=c[d];null==e.parentId&&(e.group=b)}var h=[],c=this.blocksFromJson(c);_.each(c,function(a){h.push(g.getSync(a.id))});return h},cloneBlocks:function(a){a=this.blocksToJson(a);var b=this.owner.getScope(f.createUUID(),null,!1);a=b.blocksFromJson(a,
!1);a=b.allBlocks();for(b=0;b<a.length;b++){var c=a[b];c.id=f.createUUID();c.parentId=null}this.blocksToJson(a);this.blocksFromJson(a);return a},blockToJson:function(a){var b={_containsChildrenIds:[]},c;for(c in a)if("ctrArgs"!=c&&("function"===typeof a[c]||a.serializeField(c))){if(this.isString(a[c])||this.isNumber(a[c])||this.isBoolean(a[c]))b[c]=a[c];if("parent"!=c)if(this.isBlock(a[c]))b[c]=a[c].id,b._containsChildrenIds.push(c);else if(this.areBlocks(a[c])){b[c]=[];for(var d=0;d<a[c].length;d++)b[c].push(a[c][d].id);
b._containsChildrenIds.push(c)}}return b},blocksToJson:function(a){try{var b=[];a=a&&a.length?a:this.blockStore?this.blockStore.data:this.blocks;for(var c in a){var d=a[c];if(null!=d.keys&&!1!==d.serializeMe){var g={_containsChildrenIds:[]},f;for(f in d)if("ctrArgs"!=f&&("function"===typeof d[f]||d.serializeField(f))){if(this.isString(d[f])||this.isNumber(d[f])||this.isBoolean(d[f]))g[f]=d[f];_.isObject(d[f])&&d.serializeObject&&!0===d.serializeObject(f)&&(g[f]=JSON.stringify(d[f],null,2));if("parent"!=
f)if(this.isBlock(d[f]))g[f]=d[f].id,g._containsChildrenIds.push(f);else if(this.areBlocks(d[f])){g[f]=[];for(var e=0;e<d[f].length;e++)g[f].push(d[f][e].id);g._containsChildrenIds.push(f)}}b.push(g)}}}catch(l){h.error("from json failed : "+l)}return b},_createBlockStore:function(){},blockFromJson:function(a){a.scope=this;null==a._containsChildrenIds&&(a._containsChildrenIds=[]);for(var b={},c=0;c<a._containsChildrenIds.length;c++){var d=a._containsChildrenIds[c];b[d]=a[d];a[d]=null}delete a._containsChildrenIds;
if(!a.declaredClass)return h.log("   not a class "),null;d=c=null;try{d=f.replaceAll(".","/",a.declaredClass),c=require(d)}catch(g){try{d=f.replaceAll("/",".",a.declaredClass),c=require(d)}catch(l){}}c||(c=e.getObject(a.declaredClass));if(!c)return null;d=null;try{d=n.createBlock(c,a)}catch(q){return logError(q),null}d._children=b;return d},blocksFromJson:function(a,b,c){for(var d=[],g={},l=0;l<a.length;l++){var q=a[l];q.scope=this;null==q._containsChildrenIds&&(q._containsChildrenIds=[]);for(var r=
{},m=0;m<q._containsChildrenIds.length;m++){var p=q._containsChildrenIds[m];r[p]=q[p];q[p]=null}delete q._containsChildrenIds;if(q.declaredClass){var H=m=null;try{H=f.replaceAll(".","/",q.declaredClass),m=require(H)}catch(G){h.error("couldnt resolve class "+H)}m||(m=e.getObject(q.declaredClass));if(m){H=null;try{H=n.createBlock(m,q,null,!1)}catch(y){h.error("error in block creation ",y+" "+q.declaredClass);logError(y);continue}H._children=r;g[H.id]=r;d.push(H)}else h.log("couldnt resolve "+H)}else h.log("   not a class ")}a=
this.allBlocks(null,!1);for(l=0;l<a.length;l++){q=a[l];q._children=g[q.id];if(q._children){for(p in q._children)if("string"==typeof q._children[p])(r=this.getBlockById(q._children[p]))?(q[p]=r,r.parent=q,r.postCreate&&r.postCreate()):(this.blockStore.removeSync(q._children[p]),c&&c("   couldnt resolve child: "+q._children[p]+"@"+q.name+":"+q.declaredClass),h.log("   couldnt resolve child: "+q._children[p]+"@"+q.name+":"+q.declaredClass));else if("object"==typeof q._children[p])for(q[p]=[],m=0;m<q._children[p].length;m++)(r=
this.getBlockById(q._children[p][m]))?(q[p].push(r),(H=this.getBlockById(r.parentId))?r.parent=H:h.error("child has no parent")):(c&&c("   couldnt resolve child: "+q._children[p]+"@"+q.name+":"+q.declaredClass),h.log("   couldnt resolve child: "+q._children[p][m]+"@"+q.name+":"+q.declaredClass));delete q._children}!1!==b&&null!=q.parentId&&null==this.getBlockById(q.parentId)&&(q.parentId=null);q.postCreate()}this.allBlocks();return d},resolveBlock:function(a){var b=this,c=this.ctx,b=this.driver,b=
this.device,d=c.getDeviceManager(),c=c.getDriverManager();if(-1==a.indexOf("://"))return(b=this.getBlockById(a))?b:a;a=f.parse_url(a);a=f.urlArgs(a.host);var g=d.getItemById(a.device.value);if(!g){var e=d.getInstanceByName(a.device.value);e&&(g=e.device)}if(g)if(d=d.toDeviceControlInfo(g)){if(b=c.getDriverById(d.driverId),(d=g.driverInstance)||b)if(a=(b=d?d.blockScope:b.blockScope)?b.getStore().getSync(a.block.value):null)return a}else h.warn("cant get device info for "+g.title,b)},getBlock:function(a){return this.getBlockById(a)},
getBlockByName:function(a){if(-1!==a.indexOf("://")){var b=this.resolveBlock(a);if(b)return b}for(var c=this.getBlocks(),d=0;d<c.length;d++)if(b=c[d],b.name===a)return b;return(a=this.blockStore.query({name:a}))&&0<a.length?a[0]:null},getBlockById:function(a){return this.blockStore.getSync(a)},_flatten:function(a){var b=[],c;for(c in a){var d=a[c];if(null!=d.keys){b.push(d);for(var g in d)if("ctrArgs"!=g&&"parent"!==g)if(this.isBlock(d[g]))b.push(d[g]);else if(this.areBlocks(d[g]))for(var f=0;f<d[g].length;f++)b.push(d[g][f])}}return b},
flatten:function(a){var b=[],c;for(c in a){var d=a[c];if(null!=d.keys){var g=_.find(b,{id:d.id});g||b.push(d);for(var f in d)if("ctrArgs"!=f&&"parent"!==f){var e=d[f];if(this.isBlock(e))(g=_.find(b,{id:e.id}))||b.push(e);else if(this.areBlocks(e))for(var h=0;h<e.length;h++){var l=e[h];(g=_.find(b,{id:l.id}))||b.push(l);b=b.concat(this.flatten([l]))}}}}return b=_.uniq(b,!1,function(a){return a.id})},_getSolve:function(a){return a.prototype?a.prototype.solve:a.__proto__.solve},solveBlock:function(a,
b,c,g){b=b||{highlight:!1};var e=null;this.isString(a)?(e=this.getBlockByName(a))||(e=this.getBlockById(a)):this.isObject(a)&&(e=a);a=null;if(e){if(!0!==b.force&&0==e.enabled)return null;!0===b.force&&(b.force=!1);var h=e.declaredClass;(h=d.getObject(f.replaceAll("/",".",h))||d.getObject(h))?h.prototype&&h.prototype.solve&&(a=h.prototype.solve.apply(e,[this,b])):(a=e.solve(e.getScope(),b,c,g),delete e.override,e.override={})}return a},solve:function(a,b){for(var c="",d=0;d<this.items.length;d++)c+=
this.items[d].solve(a,b);return c},parseExpression:function(a,b,c,d,g,f,e,h){return this.getExpressionModel().parse(this,a,b,d,g,f,c,e,h)},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isBoolean:function(a){return"boolean"==typeof a},isObject:function(a){return"object"===typeof a},isBlock:function(a){var b=!1;"object"==typeof a&&null!=a&&void 0==a.length&&a.serializeMe&&(b=!0);return b},areBlocks:function(a){var b=!1;"object"==typeof a&&null!=a&&0<a.length&&
this.isBlock(a[0])&&(b=!0);return b},_onVariableChanged:function(a){a.item&&this.getExpressionModel().variableFuncCache[a.item.title]&&delete this.expressionModel.variableFuncCache[a.item.title]},init:function(){this.getExpressionModel();this.subscribe(b.EVENTS.ON_DRIVER_VARIABLE_CHANGED,this._onVariableChanged);var a=this;this.subscribe(b.EVENTS.ON_MODULE_RELOADED,function(b){var c=b.module,d=b.newModule;(b=a.getBlocks().filter(function(a){return a.declaredClass==c||a.declaredClass==f.replaceAll("/",
".",c)?a:null}))&&_.each(b,function(a){var b=d.prototype,c;for(c in b){var g=b[c];g&&_.isFunction(g)&&(a[c]=g)}})})},_destroy:function(){for(var a=this.allBlocks(),c=0;c<a.length;c++){var d=a[c];if(d)try{d&&d.stop&&d.stop(!0),d&&d.reset&&d.reset(),d&&d._destroy&&d._destroy(),d&&d.destroy&&d.destroy(),d._emit&&d._emit(b.EVENTS.ON_ITEM_REMOVED,{item:d})}catch(g){}}},destroy:function(){this._destroy();this.reset();this._destroyed=!0;delete this.expressionModel},moveTo:function(a,b,c,d){h.log("move to : ",
arguments);if(d){if(b.canAdd&&b.canAdd()){var g=this.getBlockById(a.parentId);g&&g.removeBlock(a,!1);return b.add(a,null,null)}h.error("cant reparent");return!1}if(b.parentId||!1!==d)if(!a.parentId&&b.parentId&&0==d)a.group=b.group;else if(a.parentId||b.parentId||!d){if(a.parentId&&b.parentId&&0==d&&a.parentId===b.parentId){g=this.getBlockById(a.parentId);if(!g)return!1;for(var f=g[g._getContainer(a)],g=a.indexOf(f,a),e=a.indexOf(f,b),f=g>e?-1:1,e=Math.abs(g-(e+(1==c?-1:1))),g=0;g<e-1;g++)a.move(f);
return!0}if(a.parentId&&b.parentId&&0==d&&a.parentId!==b.parentId){g=this.getBlockById(a.parentId);if(!g)return!1;var l=this.getBlockById(b.parentId);if(l&&g&&g.removeBlock&&l.canAdd&&l.canAdd())g.removeBlock(a,!1),l.add(a,null,null);else return!1;f=l[l._getContainer(a)];null==f&&h.error("weird : target parent has no item container");g=l.indexOf(f,a);e=l.indexOf(f,b);if(!g||!e){h.error(" weird : invalid drop processing state, have no valid item indicies");return}f=g>e?-1:1;e=Math.abs(g-(e+(1==c?-1:
1)));for(g=0;g<e-1;g++)l.move(a,f);return!0}}else return b.canAdd&&b.canAdd()&&(a.group=null,b.add(a,null,null)),!0;else{(g=this.getBlockById(a.parentId))&&g.removeBlock&&(g.removeBlock(a,!1),a.parentId=null,a.group=b.group);for(var l=[],e=this.getBlocks({group:b.group}),q=[],f=this.getBlockStore(),n=f.storage.index[b.id],g=0;g<e.length;g++){var r=e[g];null==e[g].parentId&&e[g]!=a&&(r=f.storage.index[r.id],d=c?r>=n:r<=n)&&(l.push(e[g]),q.push(f.storage.index[e[g].id]))}for(g=0;g<l.length;g++)f.remove(l[g].id);
this.getBlockStore().remove(a.id);c&&this.getBlockStore().putSync(a);for(g=0;g<l.length;g++)f.put(l[g]);c||this.getBlockStore().putSync(a);return!0}return!1}});e.chainAfter(p,"destroy");return p})},"xblox/model/Expression":function(){define(["xdojo/declare","xdojo/has","xide/utils","xide/types","xblox/model/ModelBase"],function(e,p,m,n,f,b,a){var d="undefined"!==typeof window?window.console:global.console;b&&d&&d.error&&(d=a);return e("xblox.model.Expression",[f],{id:null,context:null,variableDelimiters:{begin:"[",
end:"]"},blockCallDelimiters:{begin:"{",end:"}"},expressionCache:null,variableFuncCache:null,constructor:function(){this.reset()},reset:function(){this.expressionCache={};this.variableFuncCache={}},replaceVariables:function(a,b,f,e,h,l,k,m){var p=n.CIFLAG;k=k||this.variableDelimiters;m=m||p.NONE;m&p.DONT_ESCAPE&&(e=!1);m&p.DONT_PARSE&&(f=!1);var u=this.findOccurrences(b,k);if(u)for(var z=0;z<u.length;z++){var v=u[z],v=v.replace(k.begin,""),v=v.replace(k.end,"");(v=this._getVar(a,v))&&v.flags&p.DONT_PARSE&&
(f=!1);var x=null;if(v){if(l){b=b.replace(u[z],"this.getVariable('"+v.name+"')");continue}x=this.getValue(v.value);h&&v.name in h&&(x=h[v.name]);if(this.isScript(x)&&!1!==f)try{var D=a.variablesToJavascript(v,!0);D&&(x=D+x);var A=(new Function("{\n"+x+"\n}")).call(a.context||{});"undefined"===A||"undefined"===typeof A?x=""+v.value:(x=A,m&p.DONT_ESCAPE||(x="'"+x+"'"))}catch(J){d.log(" parsed variable expression failed \n"+x,J)}else this.isNumber(x)||!1!==e&&(x="'"+x+"'")}else x=u[z];b=b.replace(u[z],
x)}return b},parse:function(a,b,f,e,h,l,k,n,m){b=this.replaceAll("''","'",b);f=l||a.context||a.getContext()||{};b=this.replaceVariables(a,b,null,null,k,null!=f.getVariable,null,m);k=this.isScript(b);if(!k&&(this.isString(b)||this.isNumber(b)))return e&&e("Expression "+b+" evaluates to "+b),b;-1==b.indexOf("return")&&k&&(b="return "+b);a=this;try{b=this.replaceAll("''","'",b);var p=this.expressionCache[b];p||(p=new Function("{"+b+"; }"),this.expressionCache[b]=p);a=p.apply(f,n)}catch(z){return d.error("invalid expression : \n"+
b,z),h&&h("invalid expression : \n"+b+": "+z,z),a=""+b}e&&e("Expression "+b+" evaluates to "+a);return a},parseVariable:function(a,b,d,f,e,l,k){var n=""+b.value;d=d||"";!1!==e?(e=this.variableFuncCache[a.id+"|"+b.title],e||(e=new Function("{"+d+n+"}"),this.variableFuncCache[a.id+"|"+b.title]=e)):e=new Function("{"+d+n+"}");a=e.apply(l||a.context||{},k||[]);return n="undefined"===a||"undefined"===typeof a?""+b.value:this.isNumber(a)||!1===f?a:"'"+a+"'"},replaceBlockCalls:function(a,b){var d=this.findOccurrences(b,
this.blockCallDelimiters);if(d)for(var f=0;f<d.length;f++){var e=this._removeDelimiters(d[f],this.blockCallDelimiters),e=a.solveBlock(e).join("\n");b=b.replace(d[f],e)}return b},_getVar:function(a,b){return a.getVariable(this._getVarName(b))},_getVarName:function(a){return this._removeDelimiters(a,this.variableDelimiters)},_removeDelimiters:function(a,b){return a.replace(b.begin,"").replace(b.end,"")},_escapeRegExp:function(a){for(var b="[](){}*+.".split(""),d=0;d<b.length;d++)a=a.replace(b[d],"\\"+
b[d]);return a},findOccurrences:function(a,b){var d=this._escapeRegExp(b.begin),f=this._escapeRegExp(b.end);return a.match(new RegExp(d+"([^"+f+"]*)"+f,"g"))}})})},"xblox/model/BlockModel":function(){define(["dcl/dcl","xdojo/declare","xide/data/Model","xide/data/Source"],function(e,p,m,n){return p("xblox.model.BlockModel",[m,n],{declaredClass:"xblox.model.BlockModel",icon:"fa-play",mayHaveChildren:function(f){return null!=this.items&&0<this.items.length},getChildren:function(f){return this.items},
getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e'}})})},"xblox/data/Store":function(){define(["dojo/_base/declare","xide/data/TreeMemory","xide/data/ObservableStore","dstore/Trackable","dojo/Deferred"],function(e,p,m,n,f){return e("xblox.data.Store",[p,n,m],{idProperty:"id",parentField:"parentId",parentProperty:"parentId",filter:function(b){var a=this.inherited(arguments);delete this._state.filter;this._state.filter=b;return a},getRootItem:function(){return{canAdd:function(){return!0},
id:this.id+"_root",group:null,name:"root",isRoot:!0,parentId:null}},getChildren:function(b){return this.root.filter({parentId:this.getIdentity(b)})},_fetchRange:function(b){var a=new f;b=this.fetchRangeSync(b);if(this._state.filter){if(this._state.filter.parentId){var d=this.getSync(this._state.filter.parentId);d&&(this.reset(),b=d.items,d.getChildren&&(b=d.getChildren()),a.resolve(b))}this._state&&this._state.filter&&this._state.filter.group&&(this.getSync(this._state.filter.parent),d&&(this.reset(),
b=d.items))}a.resolve(b);return a},mayHaveChildren:function(b){return b.mayHaveChildren?b.mayHaveChildren(b):null!=b.items&&0<b.items.length}})})},"xblox/factory/Blocks":function(){define("xide/factory xide/utils xide/types xide/mixins/ReloadMixin xide/mixins/EventedMixin xblox/model/logic/CaseBlock xblox/model/Block xblox/model/functions/CallBlock xblox/model/functions/StopBlock xblox/model/functions/PauseBlock xblox/model/functions/SetProperties xblox/model/code/CallMethod xblox/model/code/RunScript xblox/model/loops/ForBlock xblox/model/loops/WhileBlock xblox/model/variables/VariableAssignmentBlock xblox/model/logic/IfBlock xblox/model/logic/ElseIfBlock xblox/model/logic/SwitchBlock xblox/model/variables/VariableSwitch xblox/model/logging/Log xblox/model/server/RunServerMethod xblox/model/server/Shell xblox/model/code/RunBlock xblox/model/events/OnEvent xblox/model/events/OnKey xblox/model/mqtt/Subscribe xblox/model/mqtt/Publish xblox/model/File/ReadJSON xcf/factory/Blocks".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r,q,h,l,k,t,w,u,z,v,x,D,A,J,H,G,y,C,F){var B=null;e.createBlock=function(b,c,d,g){a.prototype.prepareArgs(c);b=e.createInstance(b,c,d);b.ctrArgs=null;var f;try{b&&b.init&&b.init(),b.scope&&(f=b.scope.registerBlock(b,g)),b.initReload&&b.initReload()}catch(h){logError(h,"create block")}return f||b};e.clearVariables=function(){};e.getAllBlocks=function(a,b,c,d,g){if(!1!==g&&null!=B)return B;0==g&&(B=null);g=e._getFlowBlocks(a,b,c,d);g=g.concat(e._getLoopBlocks(a,b,c,d));
g=g.concat(e._getCommandBlocks(a,b,c,d));g=g.concat(e._getCodeBlocks(a,b,c,d));g=g.concat(e._getEventBlocks(a,b,c,d));g=g.concat(e._getLoggingBlocks(a,b,c,d));g=g.concat(e._getServerBlocks(a,b,c,d));g=g.concat(e._getMQTTBlocks(a,b,c,d));return B=g=g.concat(e._getFileBlocks(a,b,c,d))};e._getMQTTBlocks=function(a,b,c,d){var g=[];g.push({name:"MQTT",iconClass:"fa-cloud",items:[{name:"Subscribe",owner:b,iconClass:"fa-bell",proto:y,target:c,ctrArgs:{scope:a,group:d}},{name:"Publish",owner:b,iconClass:"fa-send",
proto:C,target:c,ctrArgs:{scope:a,group:d}}]});e.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:g,group:"MQTT"});return g};e._getFileBlocks=function(a,b,c,d){var g=[];g.push({name:"File",iconClass:"fa-file",items:[{name:"%%Read JSON",owner:b,iconClass:"fa-file",proto:F,target:c,ctrArgs:{scope:a,group:d}}]});e.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:g,group:"File"});return g};e._getServerBlocks=function(a,b,c,d){var g=[];g.push({name:"Server",iconClass:"el-icon-repeat",items:[{name:"Run Server Method",
owner:b,iconClass:"fa-plug",proto:D,target:c,ctrArgs:{scope:a,group:d}},{name:"Shell",owner:b,iconClass:"fa-code",proto:A,target:c,ctrArgs:{scope:a,group:d}}]});e.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:g,group:"Server"});return g};e._getVariableBlocks=function(a,b,c,d){var g=[];g.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:w,target:c,ctrArgs:{scope:a,group:d,condition:"[value]\x3d\x3d'PW'"}}]});return g};e._getEventBlocks=
function(a,b,c,d){var g=[];g.push({name:"Events",iconClass:"fa-bell",items:[{name:"On Event",owner:b,iconClass:"fa-bell",proto:H,target:c,ctrArgs:{scope:a,group:d}},{name:"On Key",owner:b,iconClass:"fa-keyboard-o",proto:G,target:c,ctrArgs:{scope:a,group:d}}]});e.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:g,group:"Events"});return g};e._getLoggingBlocks=function(a,b,c,d){var g=[];g.push({name:"Logging",iconClass:"fa-bug",items:[{name:"Log",owner:b,iconClass:"fa-bug",proto:x,target:c,ctrArgs:{scope:a,
group:d}}]});e.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:g,group:"Logging"});return g};e._getCodeBlocks=function(a,b,c,d){var g=[];g.push({name:"Code",iconClass:"fa-code",items:[{name:"Call Method",owner:b,iconClass:"el-icon-video",proto:q,target:c,ctrArgs:{scope:a,group:d}},{name:"Run Script",owner:b,iconClass:"fa-code",proto:h,target:c,ctrArgs:{scope:a,group:d}},{name:"Run Block",owner:b,iconClass:"fa-code",proto:J,target:c,ctrArgs:{scope:a,group:d}},{name:"Set Properties",owner:b,iconClass:"fa-code",
proto:r,target:c,ctrArgs:{scope:a,group:d}}]});e.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:g,group:"Code"});return g};e._getFlowBlocks=function(a,b,c,d){var g=[];g.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:w,target:c,ctrArgs:{scope:a,group:d,condition:"[value]\x3d\x3d'PW'"}},{name:"Switch",owner:b,iconClass:"el-icon-fork",proto:z,target:c,ctrArgs:{scope:a,group:d}},{name:"Variable Switch",owner:b,iconClass:"el-icon-fork",proto:v,
target:c,ctrArgs:{scope:a,group:d}}]});e.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:g,group:"Flow"});return g};e._getLoopBlocks=function(a,b,c,d){var g=[];g.push({name:"Loops",iconClass:"el-icon-repeat",items:[{name:"While",owner:b,iconClass:"el-icon-repeat",proto:k,target:c,ctrArgs:{scope:a,group:d,condition:"[Volume]\x3c\x3d100"}},{name:"For",owner:b,iconClass:"el-icon-repeat",proto:l,target:c,ctrArgs:{scope:a,group:d,initial:"1",comparator:"\x3c\x3d","final":"5",modifier:"+1",counterName:"value"}}]});
e.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:g,group:"Loops"});return g};e._getMathBlocks=function(a,b,c,d){b=[];b.push({name:"Math",owner:this,iconClass:"el-icon-qrcode",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-compass",proto:w,item:c,ctrArgs:{scope:a,group:d}}]});return b};e._getTimeBlocks=function(a,b,c,d){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-qrcode",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-time",proto:w,item:c,ctrArgs:{scope:a,
group:d}}]});return b};e._getTransformBlocks=function(a,b,c,d){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-magic",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-time",proto:w,item:c,ctrArgs:{scope:a,group:d}}]});return b};return e})},"xblox/model/logic/CaseBlock":function(){define(["dcl/dcl","xide/utils","xblox/model/Block","dojo/Deferred","xblox/model/logic/BreakBlock"],function(e,p,m,n,f){return e(m,{declaredClass:"xblox.model.logic.CaseBlock",comparator:null,expression:null,
items:null,name:"Case",icon:"",hasInlineEdits:!0,toText:function(){return'\x3cspan style\x3d"text-indent: 1em;"\x3e\x26nbsp;\x26nbsp;\x26nbsp;'+this.getBlockIcon("I")+this.name+" "+this.makeEditable("comparator","right","text","Enter a comparison","inline")+(null!=this.expression?" "+this.makeEditable("expression","right","text","Enter a value to compare"):"")+"\x3c/span\x3e"},canAdd:function(){return[]},_solve:function(b,a,d){a=a||{highlight:!1};for(var c=[],g=0;g<this.items.length;g++){var f=this.items[g];
-1!==f.declaredClass.indexOf("BreakBlock")&&d.stop();this.addToEnd(c,f.solve(b,a))}return c},solve:function(b,a,d){try{var c=b.getVariableById(a.variable);!c&&d.args&&d.args[0]&&(c={value:d.args[0]});var g="";if(c)g=this._getArg(c.value,!0);else return this.onFailed(this,d),!1;if(!0!==b.parseExpression(""+g+""+this.comparator+this._getArg(this.expression,!0)))return this.onFailed(this,d),!1;this.onSuccess(this,d);this._solve(b,d,a);return!0}catch(f){logError(f)}},getChildren:function(){return this.items},
getFields:function(){function b(a,b){return{label:b||a,value:a}}var a=this.inherited(arguments)||this.getDefaultFields();a.push(p.createCI("Expression",13,this.expression,{group:"General",title:"Expression",dst:"expression"}));a.push(p.createCI("Comparator",3,this.comparator,{group:"General",title:"Comparator",dst:"comparator",widget:{options:[b("\x3d\x3d"),b("\x3c\x3d"),b("\x3d\x3e"),b("!\x3d"),b("\x3c"),b("\x3e")],editable:!0}}));return a},runAction:function(b){if("New/Break"===b.command){b=new n;
var a=this.add(f,{group:null});b.resolve({select:[a],focus:!0,append:!1});a.refresh();return b}},getActions:function(){return[this.createAction({label:"Break",command:"New/Break",tab:"Home",icon:"fa-stop",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}})]}})})},"xblox/model/logic/BreakBlock":function(){define(["dcl/dcl","xblox/model/Block"],function(e,p){return e(p,{declaredClass:"xblox.model.logic.BreakBlock",name:"Break",icon:"fa-stop",hasInlineEdits:!1,canAdd:!1,toText:function(){return'\x26nbsp;\x3cspan class\x3d"fa-stop text-warning"\x3e\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan\x3e'+
this.name+"\x3c/span\x3e"},solve:function(e,n){this.onSuccess(this,n)}})})},"xblox/model/functions/CallBlock":function(){define("dcl/dcl xide/utils xide/types dojo/Deferred xblox/model/Block xcf/model/Command".split(" "),function(e,p,m,n,f,b){return e(b,{declaredClass:"xblox.model.functions.CallBlock",command:"Select command please",icon:"",args:null,_timeout:100,isCommand:!0,_commandHandles:null,onCommandProgress:function(a){this.getScope().getContext();var b=a.params;b&&b.id&&(this._emit("cmd:"+
a.cmd+"_"+b.id,{msg:a}),a.lastResponse&&this.storeResult(a.lastResponse),this._emit("progress",{msg:a,id:b.id}));this._lastResult=null;this._lastResult=a?a.result:null;a=this.getItems(m.BLOCK_OUTLET.PROGRESS);this._lastSettings||(this._lastSettings={});this._lastSettings.override={};a.length&&this.runFrom(a,0,this._lastSettings)},stop:function(){this._lastCommand&&this._lastCommand.stop()},pause:function(){this._lastCommand&&this._lastCommand.pause()},destroy:function(){_.invoke(this._commandHandles,
"remove");delete this._commandHandles;delete this._lastCommand},solve:function(a,b){this._commandHandles&&_.invoke(this._commandHandles,"remove");this._commandHandles=[];var c=this._timeout||50;_.isString(c)&&(c=parseInt(c));var g=new n,f=this._commandHandles;b=b||{};setTimeout(function(){if(this.command){var c=null;if(this.args){b.override=b.override||{};var e=a.expressionModel.replaceVariables(a,this.args,!1,!1,null,null,{begin:"%%",end:"%%"});try{c=p.fromJson(e)}catch(l){c=e}b.override.args=_.isArray(c)?
c:[e];b.override.mixin=c}if(this._lastCommand=a.resolveBlock(this.command))f.push(this._lastCommand._on("paused",this.onCommandPaused,this)),f.push(this._lastCommand._on("finished",this.onCommandFinish,this)),f.push(this._lastCommand._on("stopped",this.onCommandStopped,this)),f.push(this._lastCommand._on("error",this.onCommandError,this)),f.push(this._lastCommand._on("progress",this.onCommandProgress,this));if(c=a.solveBlock(this.command,b))this.onSuccess(this,b);else this.onFailed(this,b);g.resolve(c);
return c}}.bind(this),c);return g},hasInlineEdits:!0,makeEditable:function(a,b,c,g,f,e,h){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+b+"' display-mode\x3d'"+(f||"popup")+"' display-type\x3d'"+(c||"text")+"' data-prop\x3d'"+a+"' data-title\x3d'"+g+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[a]+"\x3c/a\x3e"},getFieldOptions:function(a){if("command"===a)return this.scope.getCommandsAsOptions("text")},toText:function(){var a="Unknown",b=this.scope.getBlock(this.command);b&&(a=b.name);
-1!==this.command.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Call Command : "+a},getFields:function(){var a=this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);a.push(p.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));
a.push(p.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(p.createCI("timeout",13,this._timeout,{group:"General",title:"Delay",dst:"_timeout"}));return a}})})},"xcf/model/Command":function(){define("dcl/dcl xblox/model/Block xblox/model/Contains xide/utils xide/types dojo/Deferred xblox/types/Types xide/lodash".split(" "),function(e,p,m,n,f,b,a,d){return e([p,m],{declaredClass:"xcf.model.Command",startup:!1,auto:null,send:"",name:"No Title",observed:["send"],
interval:0,flags:2048,_runningDfd:null,__started:!1,isCommand:!0,getItems:function(a){return this.getItemsByType(a)},onCommandFinish:function(a){var b=null;if(a.params&&a.params.id){var d=a.params.id,b=this.getDeferred(d);delete this._solving[d];a.lastResponse&&this.storeResult(a.lastResponse);this._emit("finished",{msg:a,result:this._lastResult})}a=this.getItems(f.BLOCK_OUTLET.FINISH);a.length&&this.runFrom(a,0,this._lastSettings);this.resolve({});this.onSuccess(this,this._lastSettings);b&&b.resolve(this._lastResult);
return this._lastResult},onCommandPaused:function(a){var b=a.params;b&&b.id&&(a.lastResponse&&this.storeResult(a.lastResponse),this._emit("paused",{msg:a,result:this._lastResult,id:b.id}));a=this.getItems(f.BLOCK_OUTLET.PAUSED);a.length&&this.runFrom(a,0,this._lastSettings)},onCommandStopped:function(a){this.reset();var b=a.params;b&&b.id&&this._emit("stopped",{msg:a,result:this._lastResult,id:b.id});a=this.getItems(f.BLOCK_OUTLET.STOPPED);a.length&&this.runFrom(a,0,this._lastSettings)},onCommandProgress:function(a){var b=
a.params;b&&b.id&&(a.lastResponse&&this.storeResult(a.lastResponse),this._emit("progress",{msg:a,result:this._lastResult,id:b.id}));a=this.getItems(f.BLOCK_OUTLET.PROGRESS);a.length&&this.runFrom(a,0,this._lastSettings)},storeResult:function(a){var b=n.getJson(a);a=null;if(b&&b.result&&d.isString(b.result)){var f=b.result,e=-1!==f.indexOf("{")||-1!==f.indexOf("["),b=f;e&&(f=n.getJson(f,!0,!1))&&(b=f);this._lastResult=null!==b?a=b:null}return a},resolve:function(a){a=a||this._lastResult;this._runningDfd&&
this._runningDfd.resolve(a)},onCommandError:function(a){var b=a.params;b.id&&(a.lastResponse&&this.storeResult(a.lastResponse),this._emit("cmd:"+a.cmd+"_"+b.id,a),this._emit("error",{msg:a,result:this._lastResult,id:b.id}));this.onFailed(this,this._settings);a=this.getItems(f.BLOCK_OUTLET.ERROR);a.length&&this.runFrom(a,0,this._lastSettings)},sendToDevice:function(a,b,d,e,h){if(!this._destroyed){a=this.replaceAll("'","",a);h=h||n.createUUID();var l=this,k=this.flags&f.CIFLAG.WAIT?!0:!1;this.lastCommand=
""+a;if(this.scope.instance)k&&this._on("cmd:"+a+"_"+h,function(a){if(a.error)l.onFailed(l,b);else l.onSuccess(l,b)}),this.scope.instance.sendMessage(a,null,this.id,h,k,d,e,this.getSendOptions());else return this.publish(f.EVENTS.ON_STATUS_MESSAGE,{text:"Command "+this.name+" : have no device",type:"error",delay:1E3}),!1;return h}},reset:function(){delete this._runningDfd;this._lastSettings={};this._loop&&(clearTimeout(this._loop),this._loop=null);delete this.override;this.override=null;delete this._lastResult;
this.override=null;this.override={}},_solving:null,addDeferred:function(a){this._solving||(this._solving={});this._solving[a]=new b;return this._solving[a]},getDeferred:function(a){this._solving||(this._solving={});return this._solving[a]},getSendOptions:function(){var a={},b=this.getDriverModule();b&&b.getCommandArgs&&(a=b.getCommandArgs(this)||a);return a},_resolve:function(a,b,e){if(d.isNumber(a)||d.isBoolean(a))return a;var q=this.scope;a=a||this._get("send");b=b||{};var h=b.flags||this.flags,
l=!(h&f.CIFLAG.DONT_PARSE),k=h&f.CIFLAG.EXPRESSION;h&f.CIFLAG.TO_HEX&&(a=n.to_hex(a));!1!==l&&(a=n.convertAllEscapes(a,"none"));b=b||this._lastSettings||{};if(h=(b=b.override||this.override||{},b.variables)?b.variables:null)for(var m in h)d.isNumber(h[m])&&(h[m]=Math.round(h[m]));m="";var p=this.getDriverModule();p&&p.resolveBefore&&!1!==e&&(a=p.resolveBefore(this,a)||a);m=k&&!1!==l?q.parseExpression(a,null,h,null,null,null,b.args):""+a;p&&p.resolveAfter&&!1!==e&&(m=p.resolveAfter(this,m)||m);return m},
solve:function(a,b,d,e){var h=null;a=a||this.scope;(b=this._lastSettings=b||this._lastSettings||{},b.override)&&b.override.mixin&&n.mixin(this.override,b.override.mixin);var l=e||this._get("send")||this.send,k=!(this.flags&f.CIFLAG.DONT_PARSE);e=this.flags&f.CIFLAG.WAIT?!0:!1;var m=n.createUUID();this.flags&f.CIFLAG.TO_HEX&&(l=n.to_hex(l));!1!==k&&(l=n.convertAllEscapes(l,"none"));if(this.enabled||!0===d){!0===d&&this._loop&&this.reset();if(!0!==e)this.onRun(this,b);else this.onRun(this,b,{timeout:!1}),
h=this.addDeferred(m);if(this.items&&0<this.items.length){if(l&&0<l.length&&(l=this._resolve(this.send,b))&&0<l.length)if(this.sendToDevice(l,b))this.onSuccess(this,b);else this.onFailed(this,b);if(e)return h;d=[];for(h=0;h<this.items.length;h++)e=this.items[h],e.enabled&&d.push(e.solve(a,b));return d}if(0<l.length){if((l=this._resolve(this.send,b))&&0<l.length&&!this.sendToDevice(l,b,null,null,m))this.onFailed(this,b);if(!0!==e)this.onSuccess(this,b);else this._settings=b;d&&this.auto&&0<this.getInterval()&&
this.scope.loopBlock(this,b);return e?h:[l]}return!1}this.reset()},canAdd:function(){return[]},mayHaveChildren:function(){return null!=this.items&&0<this.items.length},getChildren:function(){return this.items},hasInlineEdits:!0,toText:function(a,b,d,f){var e="";!1!==a&&(e+="\x3cspan class\x3d'text-primary inline-icon'\x3e"+this.getBlockIcon()+"\x3c/span\x3e");!1!==b&&(e+=""+this.makeEditable("name","bottom","text","Enter a unique name","inline")+"");!0===f&&(e+="\x3cbr/\x3e");!1!==d&&(e+="\x3cspan class\x3d'text-muted small'\x3e Send:\x3ckbd class\x3d'text-warning'\x3e"+
this.makeEditable("send","bottom","text","Enter the string to send","inline")+"\x3c/kbd\x3e\x3c/span\x3e");!1!==a&&(this.startup&&(e+=this.getIcon("fa-bell inline-icon text-warning","text-align:right;float:right;","")),this.auto&&0<this.getInterval()&&(e+=this.getIcon("fa-clock-o inline-icon text-warning","text-align:right;float:right","")));return e=this.getDriverToText(e)||e},getInterval:function(){return parseInt(this.interval,10)},start:function(){this.startup&&!this.auto?this.solve(this.scope):
this.auto&&0<this.getInterval()&&this.scope.loopBlock(this)},getDriverModule:function(){var a=null,b=this.getInstance();b?a=b.Module:(b=this.getScope().driver)&&b.Module&&(a=b.Module);return a},getDriverToText:function(a){var b=this.getDriverModule();if(b&&b.toText)return b.toText(this,a)},getDriverFields:function(a){var b=this.getDriverModule(),d=[];b&&b.getFields&&(d=b.getFields(this,a)||[]);return d},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),b=this;a.push(this.utils.createCI("name",
13,this.name,{group:"General",title:"Name",dst:"name",order:200}));a.push(this.utils.createCI("startup",0,this.startup,{group:"General",title:"Send on Startup",dst:"startup",order:199}));a.push(this.utils.createCI("auto",0,this.auto,{group:"General",title:"Auto Send",dst:"auto",order:198}));a.push(this.utils.createCI("interval",13,this.interval,{group:"General",title:"Interval",dst:"interval",order:197}));a.push(this.utils.createCI("send",f.ECIType.EXPRESSION_EDITOR,this.send,{group:"Send",title:"Send",
dst:"send",widget:{instantChanges:!1,allowACECache:!0,showBrowser:!1,showSaveButton:!0,style:"height:inherit;",editorOptions:{showGutter:!1,autoFocus:!1},aceOptions:{hasEmmet:!1,hasLinking:!1,hasMultiDocs:!1},item:this},delegate:{runExpression:function(a,c,d){return b.scope.expressionModel.parse(b.scope,a,!1,c,d)}}}));a.push(this.utils.createCI("flags",5,this.flags,{group:"General",title:"Flags",dst:"flags",data:[{value:4096,label:"Dont parse",title:"Do not parse the string and use it as is"},{value:2048,
label:"Expression",title:"Parse it as Javascript"},{value:32768,label:"Wait",title:"Wait for response"}],widget:{hex:!0}}));return a=a.concat(this.getDriverFields(a))},icon:"fa-exclamation",getIconClass:function(){return"el-icon-play-circle"},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e '},canEdit:function(){return!0},onChangeField:function(a,b,d){var f=this.getInterval();"auto"==a&&(!0===b?0<f&&this.scope.loopBlock(this):this._loop&&this.reset());"enabled"==a&&
(!1===b?this.reset():f&&this.scope.loopBlock(this));"interval"==a&&(0<f&&this.auto?this.scope.loopBlock(this):this.reset());this.inherited(arguments)},destroy:function(){this.reset()},pause:function(){var a=this.lastCommand||this._resolve(this.send,this._lastSettings);null!==a&&this.sendToDevice(a,this._lastSettings,!1,!0)},stop:function(a){!0!==a&&(this.onSuccess(this,{highlight:!0}),this.resolve(""),a=this.lastCommand||this._resolve(this.send,this._lastSettings),d.isEmpty(a)||this.sendToDevice(a,
this._lastSettings,!0,!1),delete this._runningDfd)}})})},"xblox/model/Contains":function(){define(["dcl/dcl","dojo/promise/all","xide/types"],function(e,p,m){return e(null,{declaredClass:"xblox.model.Contains",runByType:function(e,f){var b=this.getItemsByType(e);b.length&&this.runFrom(b,0,f)},getItemsByType:function(e){var f=this.items;if(!e)return f;var b=[];_.each(f,function(a){a.outlet&e&&b.push(a)});return b},getContainer:function(){return this[this._getContainer()]},mayHaveChildren:function(e){e=
this[this._getContainer()];return null!=e&&0<e.length},getChildren:function(e){return this[this._getContainer()]},canAdd:function(){return[]},_solve:function(e,f,b,a){!this._lastRunSettings&&f&&(this._lastRunSettings=f);f=this._lastRunSettings||f;this._currentIndex=0;this._return=[];e=this[this._getContainer()];if(e.length)return e=this.runFrom(e,0,f),this.onSuccess(this,f),e;this.onSuccess(this,f);return[]},onDidRunItem:function(e,f){this._emit(m.EVENTS.ON_RUN_BLOCK_SUCCESS,this);e.resolve(f)},onDidRunItemError:function(e,
f){e.reject(f)},onRunThis:function(){this._emit(m.EVENTS.ON_RUN_BLOCK,this)},onDidRunThis:function(e,f,b,a){var d=this;if(b&&b.length)b=d.runFrom(b,0,a),p(b).then(function(){d.onDidRunItem(e,f,a)},function(b){d.onDidRunItem(e,b,a)});else d.onDidRunItem(e,f,a)},___solve:function(e,f,b,a){}})})},"xblox/types/Types":function(){define(["xide/types/Types","xide/utils"],function(e,p){e.BLOCK_MODE={NORMAL:0,UPDATE_WIDGET_PROPERTY:1};e.BLOCK_OUTLET={NONE:0,PROGRESS:1,ERROR:2,PAUSED:4,FINISH:8,STOPPED:16};
p.mixin(e.EVENTS,{ON_RUN_BLOCK:"onRunBlock",ON_RUN_BLOCK_FAILED:"onRunBlockFailed",ON_RUN_BLOCK_SUCCESS:"onRunBlockSuccess",ON_BLOCK_SELECTED:"onItemSelected",ON_BLOCK_UNSELECTED:"onBlockUnSelected",ON_BLOCK_EXPRESSION_FAILED:"onExpressionFailed",ON_BUILD_BLOCK_INFO_LIST:"onBuildBlockInfoList",ON_BUILD_BLOCK_INFO_LIST_END:"onBuildBlockInfoListEnd",ON_BLOCK_PROPERTY_CHANGED:"onBlockPropertyChanged",ON_SCOPE_CREATED:"onScopeCreated",ON_VARIABLE_CHANGED:"onVariableChanged",ON_CREATE_VARIABLE_CI:"onCreateVariableCI"});
e.BlockType={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",
ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",
SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"};e.BLOCK_CAPABILITIES={TOPMOST:16384,TARGET:262144,VARIABLE_INPUTS:128,VARIABLE_OUTPUTS:256,VARIABLE_OUTPUT_PARAMETERS:512,VARIABLE_INPUT_PARAMETERS:1024,CHILDREN:32,SIGNALS:128};
e.EXECUTION_STATE={NONE:0,RUNNING:1,ERROR:2,PAUSED:4,FINISH:8,STOPPED:16,ONCE:2147483648,RESET_NEXT_FRAME:8388608,LOCKED:536870912};e.RUN_FLAGS={CHILDREN:32,WAIT:32768};return e})},"xblox/model/functions/StopBlock":function(){define(["dcl/dcl","xide/utils","xblox/model/Block"],function(e,p,m){return e(m,{declaredClass:"xblox.model.functions.StopBlock",command:"Select command please",icon:"",args:null,_timeout:100,hasInlineEdits:!0,solve:function(e,f){if(this.command){var b=e.resolveBlock(this.command);
if(b&&b.stop){var a=b.stop();this.onSuccess(this,f)}else this.onFailed(this,f);return a}},makeEditable:function(e,f,b,a,d){return'\x3ca tabIndex\x3d"-1" pos\x3d\''+f+"' display-mode\x3d'"+(d||"popup")+"' display-type\x3d'"+(b||"text")+"' data-prop\x3d'"+e+"' data-title\x3d'"+a+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[e]+"\x3c/a\x3e"},getFieldOptions:function(e){if("command"===e)return this.scope.getCommandsAsOptions("text")},toText:function(){var e="Unknown",f=this.scope.getBlock(this.command);
f&&(e=f.name);-1!==this.command.indexOf("://")&&(e='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Stop Command : "+e},onChangeField:function(e,f){},getFields:function(){var e=this.inherited(arguments)||this.getDefaultFields();e.push(p.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));
return e}})})},"xblox/model/functions/PauseBlock":function(){define(["dcl/dcl","xide/utils","xide/types","dojo/Deferred","xblox/model/Block"],function(e,p,m,n,f){return e(f,{declaredClass:"xblox.model.functions.PauseBlock",command:"Select command please",icon:"",args:null,_timeout:100,hasInlineEdits:!0,solve:function(b,a){if(this.command){var d=b.resolveBlock(this.command);if(d&&d.pause){var c=d.pause();this.onSuccess(this,a)}else this.onFailed(this,a);return c}},makeEditable:function(b,a,d,c,g,f,
e){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+a+"' display-mode\x3d'"+(g||"popup")+"' display-type\x3d'"+(d||"text")+"' data-prop\x3d'"+b+"' data-title\x3d'"+c+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[b]+"\x3c/a\x3e"},getFieldOptions:function(b){if("command"===b)return this.scope.getCommandsAsOptions("text")},toText:function(){var b="Unknown",a=this.scope.getBlock(this.command);a&&(b=a.name);-1!==this.command.indexOf("://")&&(b='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,
this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Pause Command : "+b},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);b.push(p.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));return b}})})},"xblox/model/functions/SetProperties":function(){define("dcl/dcl xide/utils xide/types dojo/Deferred xblox/model/Block xide/lodash".split(" "),
function(e,p,m,n,f,b){return e(f,{declaredClass:"xblox.model.functions.SetProperties",command:"Select block",icon:"",args:null,_timeout:100,hasInlineEdits:!1,solve:function(a,b){var c=new n;if(this.command){var g=a.resolveBlock(this.command);if(g&&this.props){for(var f in this.props)g.set(f,this.props[f]),g[f]=this.props[f],g.onChangeField&&g.onChangeField(f,this.props[f]);this.onSuccess(this,b)}else this.onFailed(this,b);c.resolve([])}return c},makeEditable:function(a,b,c,g,f){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+
b+"' display-mode\x3d'"+(f||"popup")+"' display-type\x3d'"+(c||"text")+"' data-prop\x3d'"+a+"' data-title\x3d'"+g+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[a]+"\x3c/a\x3e"},getFieldOptions:function(a){if("command"===a)return this.scope.getCommandsAsOptions("text")},toText:function(){var a="Unknown",b=this.scope.getBlock(this.command);b&&(a=b.name);-1!==this.command.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");
return this.getBlockIcon("D")+"Set Properties : "+a},serializeObject:function(a){return"props"===a},onChangeField:function(a){"command"===a&&(delete this.props,this.props={})},init:function(){this.props&&b.isString(this.props)&&(this.props=p.fromJson(this.props))},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();a.push(p.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,
pickerType:"command",value:this.command}));var d=this.scope.resolveBlock(this.command);if(d&&d.getFields){this.props||(this.props={});var d=d.getFields(),c=b.find(d,{dst:"description"});d.remove(c);b.each(d,function(a){a.group="Properties";a.value=p.getAt(this.props,a.dst,a.value);a.dst="props."+a.dst},this);a=a.concat(d)}return a}})})},"xblox/model/code/CallMethod":function(){define(["dcl/dcl","xblox/model/Block","xide/utils"],function(e,p,m){return e(p,{declaredClass:"xblox.model.code.CallMethod",
name:"Call Method",method:"",args:"",sharable:!0,solve:function(e,f){var b=this.getContext();if(b&&null!=b[this.method]){var a=[],d=b[this.method];try{var c=this.getArgs(f);console.log("args",c);a=d.apply(b,c||[]);this.onSuccess(this,f);return a}catch(g){console.error("call method "+this.method+" failed: "+g),logError(g),this.onFailed(this,f)}}else this.onFailed(this,f);return[]},toText:function(){var e=this.getBlockIcon()+" "+this.name+" ";this.method&&(e+=this.makeEditable("method","bottom","text",
"Enter a driver method","inline"));return e},getFields:function(){var e=this.getDefaultFields();this.getContext();e.push(m.createCI("value",13,this.method,{group:"General",title:"Method",dst:"method"}));e.push(m.createCI("value",27,this.args,{group:"Arguments",dst:"args",widget:{title:""}}));return e},getBlockIcon:function(){return'\x3cspan class\x3d"fa-caret-square-o-right"\x3e\x3c/span\x3e'}})})},"xblox/model/code/RunScript":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains dojo/promise/all xide/types module".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r,q,h){var l="undefined"!==typeof window?window.console:global.console;g&&l&&l.error&&(l=r);return e([n,b],{declaredClass:"xblox.model.code.RunScript",name:"Run Script",method:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-code",observed:["method"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve2:function(a,b,c,d){this._currentIndex=0;this._return=[];var g=""+this._get("method"),f=this,e=this.getContext();
if(g&&g.length){var h=function(){var a=new Function("{"+g+"}"),h=f.getArgs()||[];try{var k=a.apply(e,h||{});f._lastResult=k;c&&c("Expression "+g+" evaluates to "+k);if("false"!==k&&!1!==k)f.onSuccess(f,b,{result:k});else return f.onFailed(f,b),[]}catch(l){return d&&d("invalid expression : \n"+g+": "+l),f.onFailed(f,b),[]}};if(a.global)(function(){window=a.global;var h=f.getArgs()||[];try{var l=null,l=e.runExpression?e.runExpression(g,null,h):(new Function("{"+g+"}")).bind(this).apply(e,h||{});f._lastResult=
l;c&&c("Expression "+g+" evaluates to "+l);if("false"!==l&&!1!==l)f.onSuccess(f,b);else return f.onFailed(f,b),[]}catch(q){return f._lastResult=null,d&&d("invalid expression : \n"+g+": "+q),f.onFailed(f,b),[]}}).call(a.global);else return h()}else l.error("have no script");h=this[this._getContainer()];if(h.length)this.runFrom(h,0,b);else this.onSuccess(this,b);this.onDidRun();return[]},solve:function(a,b,c,d,g,f){this._currentIndex=0;this._return=[];b=b||{};c=d||(this._get("method")?this._get("method"):
this.method);if(!a.expressionModel)throw Error("na");var e=this;d=this.getContext();var h=this[this._getContainer()],q=new m,n=e.deferred,r=a.getExpressionModel();this.onRunThis(b);if(!r)return l.error("scope has no expression model"),!1;var p=r.replaceVariables(a,c,null,null);(a=r.expressionCache[p])||(a=r.expressionCache[p]=new Function("{"+p+"}"));r=e.getArgs(b)||[];try{n&&(d.resolve=function(a){e._deferredObject&&e._deferredObject.resolve();e.onDidRunThis(q,a,h,b)});var y=a.apply(d,r||{});e._lastResult=
y;g&&g("Expression "+c+" evaluates to "+y);if(!n)e.onDidRunThis(q,y,h,b);if("false"!==y&&!1!==y)e.onSuccess(e,b);else e.onFailed(e,b)}catch(C){C=C||{},e.onDidRunItemError(q,C,b),e.onFailed(e,b),f&&f("invalid expression : \n"+c+": "+C)}return q},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.name+" :: \x3c/span\x3e";this.method&&(a+=this.method.substr(0,50));return a},canAdd:function(){return!0},getFields:function(){"No Description"===this.description&&(this.description=
q);var a=this.inherited(arguments)||this.getDefaultFields(),b=this;a.push(f.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));a.push(f.createCI("deferred",0,this.deferred,{group:"General",title:"Deferred",dst:"deferred"}));a.push(f.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(f.createCI("value",d.ECIType.EXPRESSION_EDITOR,this.method,{group:"Script",title:"Script",dst:"method",select:!0,widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,
editorOptions:{showGutter:!0,autoFocus:!1},item:this},delegate:{runExpression:function(a,c,d){b.method=a;b.solve(b.scope,null,c,d)}}}));return a}})})},"xblox/model/loops/ForBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/variables/Variable xblox/model/Contains dojo/promise/all dojo/Deferred".split(" "),function(e,p,m,n,f,b){return e([p,n],{declaredClass:"xblox.model.loops.ForBlock",initial:null,"final":null,comparator:null,modifier:null,items:null,counterName:null,_counter:null,name:"For",
sharable:!0,icon:"",ignoreErrors:!1,deferred:!0,_forState:!1,_currentForIndex:0,runFrom:function(a,d,c){var g=this,f=a||this.items;a=[];var e=function(a){a._deferredObject.then(function(b){a._lastResult=a._lastResult||b;g._currentIndex++;g.runFrom(f,g._currentIndex,c)})};if(f.length)for(;d<f.length;d++){var h=f[d];if(!1!==h.enabled)if(!0===h.deferred){h._deferredObject=new b;this._currentIndex=d;e(h);a.push(h.solve(this.scope,c));break}else a.push(h.solve(this.scope,c))}else this.onSuccess(this,c);
return a},runFromDirect:function(a,d,c){var g=this,f=a||this.items;a=[];var e=function(a){a._deferredObject.then(function(b){a._lastResult=a._lastResult||b;g._currentIndex++;g.runFrom(f,g._currentIndex,c)})};if(f.length)for(;d<f.length;d++){var h=f[d];if(!1!==h.enabled)if(!0===h.deferred){h._deferredObject=new b;this._currentIndex=d;e(h);a.push(h.solve(this.scope,c));break}else a.push(h.solve(this.scope,c))}else this.onSuccess(this,c);return a},solveSubs:function(a,b,c,g){var e=this;g.override=g.override||
{};g.override.args=[this._currentForIndex];if(c.length)return b=e.runFrom(c,0,g),f(b).then(function(a){},function(b){e.onDidRunItem(a,b,g)}),b;e.onDidRunItem(a,b,g)},solveSubsDirect:function(a,b,c,g){g.override=g.override||{};g.override.args=[this._currentForIndex];if(c.length)return this.runFromDirect(c,0,g)},_solve:function(a,d){var c=new b,g=this,e=this.solveSubs(c,null,this.items,d);e?f(e).then(function(a){a=a.indexOf(!1);!0!==g.ignoreErrors&&-1!==a?c.resolve(!1):c.resolve(!0)}):c.resolve(!0);
return c},step:function(a,d){var c=this._checkCondition(a,d),g=new b;c&&this._solve(a,d).then(function(a){1==a?g.resolve(!0):g.resolve(!1)});return g},loop:function(a,b){var c=this;this.step(a,b).then(function(g){c._updateCounter(a);c._currentForIndex=c._counter.value;if(1==g)c.loop(a,b);else c.onFailed(c,b)})},_solveDirect:function(a,b){return this.solveSubsDirect(null,null,this.items,b)},stepDirect:function(a,b){return this._solveDirect(a,b)},loopDirect:function(a,b){this.stepDirect(a,b);for(var c=
parseInt(this.initial,10);c<parseInt(this["final"],10);c++)this.stepDirect(a,b)},solve:function(a,b){this._counter=new m({title:this.counterName,value:this.initial,scope:a,register:!1});this._forState=!0;this._currentForIndex=this.initial;this.deferred?this.loop(a,b):this.loopDirect(a,b);return[]},_checkCondition:function(a,b){var c=a.parseExpression(""+this._counter.value+this.comparator+this["final"]);if(0!=c)this.onSuccess(this,b);return this._forState=c},_updateCounter:function(a){var b=this._counter.value,
b=a.parseExpression(""+b+this.modifier);if(b==this._counter.value)return!1;this._counter.value=b;return!0},mayHaveChildren:function(){return null!=this.items&&0<this.items.length},getChildren:function(){var a=[];this.items&&(a=a.concat(this.items));return a},canAdd:function(){return[]},toText:function(){return this.getBlockIcon("F")+this.name+" "+this.initial+" "+this.comparator+" "+this["final"]+" with "+this.modifier},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();
return a=a.concat([this.utils.createCI("initial",13,this.initial,{group:"General",title:"Initial",dst:"initial"}),this.utils.createCI("Final",13,this["final"],{group:"General",title:"Final",dst:"final"}),this.utils.createCI("comparator",13,this.comparator,{group:"General",title:"Comparision",dst:"comparator"}),this.utils.createCI("modifier",13,this.modifier,{group:"General",title:"Modifier",dst:"modifier"}),this.utils.createCI("Abort on Error",0,this.ignoreErrors,{group:"General",title:"Ignore Errors",
dst:"ignoreErrors"}),this.utils.createCI("Deferred",0,this.deferred,{group:"General",title:"Use Deferred",dst:"deferred"})])}})})},"xblox/model/loops/WhileBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/variables/Variable"],function(e,p,m){return e(p,{declaredClass:"xblox.model.loops.WhileBlock",condition:null,items:null,loopLimit:1500,name:"While",wait:0,_currentIndex:0,sharable:!0,icon:"",_timer:null,canAdd:function(){return[]},_solve:function(e,f){for(var b=0;b<this.items.length;b++)this.items[b].solve(e,
f);return[]},doStep:function(e){if(this._currentIndex<this.loopLimit){var f=[];this._checkCondition(this.scope)?(this.onSuccess(this,e),this.addToEnd(f,this._solve(this.scope,e)),this._currentIndex++):(this._timer&&clearInterval(this._timer),this.onFailed(this,e))}else console.error("--while block : reached loop limit"),this.reset()},reset:function(){this._timer&&(clearTimeout(this._timer),this._timer=null);this._currentIndex=0},solve:function(e,f){this.loopLimit=1500;f=f||{};var b=0,a=this,d=this._getArg(this.wait);
this.reset();if(0<d)return this._timer=setInterval(function(){a.doStep(f)},d),[];for(;this._checkCondition(e)&&b<this.loopLimit;)this._solve(e,f),b++;this.reset();return[]},toText:function(){return this.getBlockIcon("G")+this.name+" "+this.condition},_checkCondition:function(e){return e.parseExpression(this.condition)},mayHaveChildren:function(e){return null!=this.items&&0<this.items.length},getChildren:function(e){e=[];this.items&&(e=e.concat(this.items));return e},getFields:function(){var e=this,
f=this.inherited(arguments)||this.getDefaultFields();f.push(this.utils.createCI("condition",25,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(b,a,d){return e.scope.expressionModel.parse(e.scope,b,!1,a,d)}}}));f.push(this.utils.createCI("wait",13,this.wait,{group:"General",title:"Wait",dst:"wait"}));return f}})})},"xblox/model/variables/VariableAssignmentBlock":function(){define("dcl/dcl xblox/model/Block xide/utils xide/types dstore/legacy/DstoreAdapter xide/factory xdojo/has".split(" "),
function(e,p,m,n,f,b,a){return e(p,{declaredClass:"xblox.model.variables.VariableAssignmentBlock",variable:null,value:null,name:"Set Variable",icon:"",hasInlineEdits:!0,flags:4,toText:function(){var a=this.scope.getVariableById(this.variable),a=a?a.name:"";this.variable&&-1!==this.variable.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.variable)+"\x3c/span\x3e");return this.getBlockIcon("C")+this.name+" "+a+"\x3cspan class\x3d'text-muted small'\x3e to \x3ckbd class\x3d'text-warning'\x3e"+
this.makeEditable("value","bottom","text","Enter the string to send","inline")+"\x3c/kbd\x3e\x3c/span\x3e"},_getPreviousResult:function(){var a=null;return(a=(a=this.getPreviousBlock())&&a._lastResult&&a.enabled?a:this.getParent())&&null!=a._lastResult?(this.isArray(a._lastResult),a._lastResult):null},solve:function(a,c){var g=this.value,f=!1;if(!g){var e=this.getArgs();0<e.length&&(g=e[0])}if(this.variable&&null!==g){this.onRun(this,c);var h=-1!==this.variable.indexOf("://")?this.scope.resolveBlock(this.variable):
a.getVariableById(this.variable),e=this._getArg(g),l=this.getArgs(c)||[];if(!h)return[];var k=null;this.isScript(e)?(k=this.override||{},k=a.parseExpression(g,null,null,null,null,null,l||k.args),k=this.replaceAll("'","",k),h.value!==k&&(f=!0)):(l&&1==l.length&&null==g&&(e=l[0]),h.value!==e&&(f=!0),k=h.value=e);h.set("value",k);g=!1;(l=this.getContext())&&(l=l.device)&&l.info&&l.info.serverSide&&(g=this.flags&n.VARIABLE_FLAGS.PUBLISH_IF_SERVER?!0:!1);this.flags&n.VARIABLE_FLAGS.PUBLISH&&f&&(g=!0);
f&&b.publish(n.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:h,scope:this.scope,save:!1,block:this,name:h.name,value:e,publish:g,result:k});this.onSuccess(this,c);return[]}},canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(!1),b=this;a.push(this.utils.createCI("value",29,this.value,{group:"General",title:"Value",dst:"value",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!1,autoSelect:!1,autoFocus:!1,hasConsole:!1,
hasItemActions:function(){return!1}},item:this},delegate:{runExpression:function(a,d,f){return b.scope.expressionModel.parse(b.scope,a,!1,d,f)}}}));a.push(m.createCI("value","xcf.widgets.CommandPicker",this.variable,{group:"Variable",title:"Variable",dst:"variable",block:this,pickerType:"variable",value:this.variable,widget:{store:this.scope.blockStore,labelField:"name",valueField:"id",value:this.variable,query:[{group:"basicVariables"},{group:"processVariables"}]}}));a.push(this.utils.createCI("flags",
5,this.flags,{group:"Variable",title:"Flags",dst:"flags",data:[{value:2,label:"Publish to network",title:"Publish to network in order to make a network variable"},{value:4,label:"Publish if server",title:"Publish only on network if this is running server side"}],widget:{hex:!0}}));return a}})})},"dstore/legacy/DstoreAdapter":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/store/util/QueryResults"],function(e,p,m){function n(b){return b}var f={store:null,constructor:function(b){this.store=
b;if(b._getQuerierFactory("filter")||b._getQuerierFactory("sort"))this.queryEngine=function(a,c){c=c||{};var g=b._getQuerierFactory("filter"),f=g?g(a):n,g=b._getQuerierFactory("sort"),e=n;g&&(e=g(p.map(c.sort,function(a){return{property:a.attribute,descending:a.descending}})));var h=n;isNaN(c.start)&&isNaN(c.count)||(h=function(a){var b=c.start||0,b=a.slice(b,b+(c.count||Infinity));b.total=a.length;return b});return function(a){return h(e(f(a)))}};var a=this;b.on("add,update,delete",function(d){var c=
d.type,g=d.target;a.notify("add"===c||"update"===c?g:void 0,"delete"===c||"update"===c?"id"in d?d.id:b.getIdentity(g):void 0)})},labelAttr:"title",getLabel:function(b){return this.store.getLabel(b)},query:function(b,a){a=a||{};var d=this.store.filter(b),c,g,f;if(f=a.sort)if("[object Array]"===Object.prototype.toString.call(f))for(var e;e=f.pop();)d=d.sort(e.attribute,e.descending);else d=d.sort(f);d.track&&!d.tracking&&(d=d.track(),g=!0);"start"in a&&(c=a.start||0,c=d[d.fetchRangeSync?"fetchRangeSync":
"fetchRange"]({start:c,end:a.count?c+a.count:Infinity}));c=c||d[d.fetchSync?"fetchSync":"fetch"]();f=c.totalLength;c=new m(c);c.total=f;c.observe=function(a,b){function c(a){return void 0===a&&g?-1:a}var f=d.on("add",function(b){a(b.target,-1,c(b.index))}),e=d.on("update",function(d){!b&&d.previousIndex===d.index&&isFinite(d.index)||a(d.target,c(d.previousIndex),c(d.index))}),q=d.on("delete",function(b){a(b.target,c(b.previousIndex),-1)}),n={remove:function(){f.remove();e.remove();q.remove()}};n.cancel=
n.remove;return n};return c},notify:function(){}};p.forEach(["get","put","add","remove","getIdentity"],function(b){f[b]=function(){var a=this.store;return(a[b+"Sync"]||a[b]).apply(a,arguments)}});return e(null,f)})},"xblox/model/logic/IfBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/Statement xblox/model/logic/ElseIfBlock dojo/Deferred xide/utils".split(" "),function(e,p,m,n,f,b){return e(p,{declaredClass:"xblox.model.logic.IfBlock",condition:"Invalid Expression",consequent:null,
elseIfBlocks:null,alternate:null,canAdd:function(){return[]},autoCreateElse:!0,name:"if",icon:"",add:function(a,b,c){null==c&&(c="consequent");return this._add(a,b,c,!1)},__addToStore:function(a){a.put(this)},mayHaveChildren:function(){return null!==this.items&&this.items.length||null!==this.elseIfBlocks&&this.elseIfBlocks.length||null!=this.consequent&&this.consequent.length||null!=this.alternate&&this.alternate.length},getChildren:function(){var a=[];this.consequent&&(a=a.concat(this.consequent));
this.elseIfBlocks&&(a=a.concat(this.elseIfBlocks));this.alternate&&(a=a.concat(this.alternate));return a},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon("E")+this.name+" \x3c/span\x3e\x3cspan class\x3d'text-warning small'\x3e"+this.condition+"\x3cspan\x3e"},_checkCondition:function(a){return a.parseExpression(this.condition,null,null)},solve:function(a,b){var c=this._checkCondition(a),g=this.getElseIfBlocks(),f=this.childrenByNotClass(n),e=null,f=f.filter(function(a){return!a.isInstanceOf(m)});
if(1==c||0<c){this.onSuccess(this,b);if(f&&f.length)for(g=0;g<f.length;g++)e=f[g].solve(a,b);return e}e=!1;this.onFailed(this,b);if(g)for(f=0;f<g.length&&!e;f++){c=g[f];if(c._checkCondition(a))return c.onSuccess(c,b),e=!0,c.solve(a,b);c.onFailed(c,b)}f=this.childrenByClass(m);if(0<f.length&&!e){e=null;for(g=0;g<f.length;g++)e=f[g].solve(a,b);return e}return[]},empty:function(){this._empty(this.alternate);this._empty(this.consequent);this._empty(this.elseIfBlocks)},removeBlock:function(a){a&&(a&&a.empty&&
a.empty(),delete a.items,a.parent=null,this.alternate.remove(a),this.consequent.remove(a),this.elseIfBlocks.remove(a))},_getContainer:function(a){return-1!=this.consequent.indexOf(a)?"consequent":-1!=this.alternate.indexOf(a)?"alternate":-1!=this.elseIfBlocks.indexOf(a)?"elseIfBlocks":"_"},init:function(){this.alternate=this.alternate||[];this.consequent=this.consequent||[];this.elseIfBlocks=this.elseIfBlocks||[];for(var a=0;a<this.alternate.length;a++)this.alternate[a].parentId=this.id,this.alternate[a].parent=
this;for(a=0;a<this.elseIfBlocks.length;a++)this.elseIfBlocks[a].parentId=this.id,this.elseIfBlocks[a].parent=this;for(a=0;a<this.consequent.length;a++)this.consequent[a].parentId=this.id,this.consequent[a].parent=this},getFields:function(){var a=this,b=this.inherited(arguments)||this.getDefaultFields();b.push(this.utils.createCI("condition",this.types.ECIType.EXPRESSION_EDITOR,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(b,d,f){return a.scope.expressionModel.parse(a.scope,
b,!1,d,f)}}}));return b},postCreate:function(){this._postCreated||(this._postCreated=!0)},toCode:function(a,b){},getElseIfBlocks:function(){return this.childrenByClass(n)},runAction:function(a){var d=this.scope.blockStore;a=a.command;if("New/Else"===a||"New/Else If"===a){a="New/Else If"===a?n:m;var c=b.mixin({name:"else",items:[],dstField:"alternate",parentId:this.id,parent:this,scope:this.scope,canAdd:function(){return[]},canEdit:function(){return!1}},a==n?{name:"else if",dstField:"elseIfBlocks"}:
{name:"else",dstField:"alternate"});a=this.add(a,c,a==m?"alternate":"elseIfBlocks");var c={select:[a],focus:!0,append:!1,expand:!0,delay:10},g=new f;d._emit("added",{target:a});g.resolve(c);a.refresh();return g}},getActions:function(){var a=[];0==this.alternate.length&&a.push(this.createAction({label:"Else",command:"New/Else",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0}}));a.push(this.createAction({label:"Else If",command:"New/Else If",icon:this.getBlockIcon("I"),
tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0}}));return a}})})},"xblox/model/Statement":function(){define(["dcl/dcl","xblox/model/Block"],function(e,p){return e(p,{declaredClass:"xblox.model.Statement",toText:function(){return this.name},getChildren:function(){return this.items}})})},"xblox/model/logic/ElseIfBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/Contains"],function(e,p,m){return e([p,m],{declaredClass:"xblox.model.logic.ElseIfBlock",condition:"",consequent:null,
name:"else if",icon:"",solve:function(e,f){return this._checkCondition(e)?this._solve(e,f):!1},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon("E")+this.name+" \x3c/span\x3e\x3cspan class\x3d'text-warning small'\x3e"+(this.condition||"")+"\x3cspan\x3e"},_checkCondition:function(e){return null!==this.condition?e.parseExpression(this.condition):!1},getFields:function(){var e=this,f=this.inherited(arguments)||this.getDefaultFields();f.push(this.utils.createCI("condition",
this.types.ECIType.EXPRESSION_EDITOR,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(b,a,d){return e.scope.expressionModel.parse(e.scope,b,!1,a,d)}}}));return f}})})},"xblox/model/logic/SwitchBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/logic/CaseBlock xblox/model/logic/DefaultBlock dojo/Deferred xide/lodash".split(" "),function(e,p,m,n,f,b){return e(p,{declaredClass:"xblox.model.logic.SwitchBlock",items:null,name:"Switch",icon:null,
toText:function(){return this.getBlockIcon("H")+this.name+" "},canAdd:function(a){return a&&a.isInstanceOf?a.isInstanceOf(m)||a.isInstanceOf(n):[]},getFields:function(){return this.getDefaultFields(!1,!1)},solve:function(a,b){var c=this._stopped=!1,f=[];this.onSuccess(this,b);for(var e=0;e<this.items.length;e++){var n=this.items[e];if("xblox.model.logic.CaseBlock"===n.declaredClass&&(n=n.solve(a,this,b),0!=n)){c=!0;this.addToEnd(f,n);break}if(this._stopped)break}if(!c)for(e=0;e<this.items.length;e++)n=
this.items[e],"xblox.model.logic.CaseBlock"!=n.declaredClass&&this.addToEnd(f,n.solve(a,b));return f},getChildren:function(){return this.items},stop:function(){this._stopped=!0},runAction:function(a){var b=a.command;if("New/Case"===b||"New/Default"===a.command){a=this.scope.blockStore;var c=new f,g=null;switch(b){case "New/Case":g=this.add(m,{comparator:"\x3d\x3d",expression:"on",group:null});break;case "New/Default":g=this.add(n,{group:null})}c.resolve({select:[g],focus:!0,append:!1});g.refresh();
a._emit("added",{target:g})}},getActions:function(a,d){var c=[this.createAction({label:"New Case",command:"New/Case",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}})];b.find(this.items,{declaredClass:"xblox.model.logic.DefaultBlock"})||c.push(this.createAction({label:"Default",command:"New/Default",icon:"fa-eject",tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}}));return c}})})},"xblox/model/logic/DefaultBlock":function(){define(["dcl/dcl",
"xblox/model/Block"],function(e,p){return e(p,{declaredClass:"xblox.model.logic.DefaultBlock",name:"Default",icon:"",hasInlineEdits:!1,toText:function(){return'\x26nbsp;\x3cspan class\x3d"fa-eject text-info"\x3e\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan\x3e'+this.name+"\x3c/span\x3e"},solve:function(e,n){this.onSuccess(this,n);return this._solve(e,n)}})})},"xblox/model/variables/VariableSwitch":function(){define("dcl/dcl xblox/model/logic/SwitchBlock xide/types xblox/model/logic/CaseBlock xblox/model/logic/DefaultBlock dojo/Deferred".split(" "),
function(e,p,m,n,f,b){return e(p,{declaredClass:"xblox.model.variables.VariableSwitch",name:"Switch on Variable",icon:"",variable:"PowerState",toText:function(){var a=this.scope.getVariableById(this.variable),a=a?a.name:"";return this.getBlockIcon("H")+this.name+" "+a},getFields:function(){var a=this.getDefaultFields(!1,!1);return a=a.concat([this.utils.createCI("Variable",3,this.variable,{group:"General",widget:{store:this.scope.blockStore,labelField:"name",valueField:"id",query:[{group:"basicVariables"},
{group:"processVariables"}]},dst:"variable"})])}})})},"xblox/model/logging/Log":function(){define("dcl/dcl dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin".split(" "),function(e,p,m,n,f,b){return e([m,b.dcl],{declaredClass:"xblox.model.logging.Log",name:"Log Message",level:"info",message:'return "Message: " + arguments[0];',_type:"XBlox",host:"this host",sharable:!0,toText:function(){var a="text-primary";switch(this.level){case "info":a="text-info";break;case "warn":a=
"text-warning";break;case "error":a="text-danger"}a=this.getBlockIcon()+" "+this.name+" : \x3cspan class\x3d'"+a+" small'\x3e  :: ";this.message&&(a+=this.message);return a+"\x3c/span\x3e"},_solveExpression:function(a,b,c,f,e){if((a=""+a)&&a.length){a=n.convertAllEscapes(a,"none");var q=this.getArgs();try{var h=b.parseExpression(a,null,null,null,null,this,q);f&&f("Expression "+a+" evaluates to "+h);return h}catch(l){e&&e("invalid expression : \n"+a+": "+l),this.onFailed(this,c)}}return a},solve:function(a,
b,c,g){var e=new p,n=a.device;a=this._solveExpression(this.message,a,b,c,g);n={message:a,level:this.level,type:this._type,details:this.getArgs(),time:(new Date).getTime(),data:{device:n?n.info:null},write:!0};this.onSuccess(this,b);e.resolve(a);try{this.publish(f.EVENTS.ON_SERVER_LOG_MESSAGE,n)}catch(h){this.onFailed(this,b)}return e},canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),b=this;a.push(n.createCI("Level",3,this.level,{group:"General",
options:[{value:"info",label:"Info"},{value:"warn",label:"Warning"},{value:"error",label:"Error"},{value:"debug",label:"Debug"},{value:"help",label:"Help"},{value:"verbose",label:"verbose"},{value:"silly",label:"Silly"}],dst:"level"}));a.push(n.createCI("message",25,this.message,{group:"General",title:"Message",dst:"message",delegate:{runExpression:function(a,f,e){b._solveExpression(a,b.scope,null,f,e)}}}));a.push(n.createCI("message",13,this._type,{group:"General",title:"Type",dst:"_type"}));return a},
getBlockIcon:function(){return'\x3cspan class\x3d"fa-bug"\x3e\x3c/span\x3e'}})})},"xblox/model/server/RunServerMethod":function(){define(["dcl/dcl","xblox/model/server/ServerBlock","xide/utils"],function(e,p,m){return e(p,{declaredClass:"xblox.model.server.RunServerMethod",description:"Runs a JSON-RPC-2.0 method on the server",name:"Run Server Method",method:"XShell::run",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onMethodChanged:function(e,f){this.method=
e;if(!m.isValidString(this.args)){var b=this.getServerParams();b&&this._updateArgs(b,f)}},_getArgs:function(){var e=m.getJson(this.args||"[]"),f=[];if(e){var b=!1;e&&e[0]&&null!=e[0].optional&&(b=!0);if(b)for(b=0;b<e.length;b++){var a=e[b],d=a.value;-1!=a.name.indexOf("Base64")&&(d=this.getService().base64_encode(d));"notset"!==a.value?-1!=a.value.indexOf("[")&&-1!=a.value.indexOf("]")?(d=this.scope.expressionModel.replaceVariables(this.scope,a.value,!1,!1),-1!=a.name.indexOf("Base64")&&(d=this.getService().base64_encode(d)),
f.push(d)):f.push(d||a["default"]):f.push(a["default"]||d)}}else return[this.args];return f},_updateArgs:function(e,f){var b=this.utils.getCIWidgetByName(f,"args");if(b){var a=JSON.stringify(e);b.editBox.set("value",a);this.args=a}},getServerParams:function(){var e=this.getService().getParameterMap(this.getServiceClass(),this.getServiceMethod());if(e)for(var f=0;f<e.length;f++)e[f].value="notset";return e},onReloaded:function(e){console.log("sdfsd");this._solve()},_solve:function(e,f,b,a){console.log("solve223")},
solve:function(e,f,b,a){this._return=[];this._lastResult=null;e=[];if(!this.isInValidState())return this.onFailed(this,f),e;e=this._getArgs();this.onRun(this,f);this.getService();f=this.scope.serviceObject;console.error("run deferred");(f=f.runDeferred(this.getServiceClass(),this.getServiceMethod(),e))&&f.then(function(a){console.error("returned ",a)});return f},toText:function(){var e=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(e+=this.method.substr(0,50));return e},canAdd:function(){return[]},
getFields:function(){var e=this.inherited(arguments)||this.getDefaultFields(),f=this;e.push(m.createCI("value",25,this.method,{group:"General",title:"Method",dst:"method",description:"This should be in the format : MyServerClass::myMethod",delegate:{runExpression:function(b,a,d){f.method=b;f.solve(f.scope,null,a,d)}}}));return e=e.concat(this.getServerDefaultFields())},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(e){return null!=this.items&&
0<this.items.length},getChildren:function(e){return this.items},onChangeField:function(e,f,b){if("method"===e)this.onMethodChanged(f,b)},isInValidState:function(){return null!=this.getService()},getService:function(){var e=this.scope.getService();e||console.error("have no service object");return e},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(e){return this.isInValidState()&&
null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(e){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/server/ServerBlock":function(){define(["dcl/dcl","xblox/model/Block","xide/utils"],
function(e,p,m){return e(p,{declaredClass:"xblox.model.server.ServerBlock",name:"Run Server Block",method:"XShell::run",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onReloaded:function(){},solve:function(e,f,b,a){this._currentIndex=0;this._return=[];if((e=""+this.method)&&e.length){var d=new Function("{"+e+"}"),c=this.getArgs();try{var g=d.apply(this,c||{});this._lastResult=g;b&&b("Expression "+e+" evaluates to "+g);if("false"!==g&&!1!==g)this.onSuccess(this,
f);else return this.onFailed(this,f),[]}catch(m){return a&&a("invalid expression : \n"+e+": "+m),this.onFailed(this,f),[]}}else console.error("have no script");b=this[this._getContainer()];if(b.length)this.runFrom(b,0,f);else this.onSuccess(this,f);return[]},toText:function(){var e=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(e+=this.method.substr(0,50));return e},canAdd:function(){return[]},getServerDefaultFields:function(e){e=e||[];e.push(m.createCI("args",27,this.args,{group:"General",
title:"Arguments",dst:"args"}));return e},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(e){return null!=this.items&&0<this.items.length},getChildren:function(e){return this.items},isInValidState:function(){return null!=this.getService()},getService:function(){return this.scope.getService()},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},
hasMethod:function(e){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(e){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/server/Shell":function(){define(["dcl/dcl",
"xblox/model/server/ServerBlock","xide/utils","xcf/model/Command"],function(e,p,m,n){return e([n,p],{declaredClass:"xblox.model.server.Shell",description:"Runs a JSON-RPC-2.0 method on the server",name:"Run Shell",method:"",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onMethodChanged:function(f,b){this.method=f;if(!m.isValidString(this.args)){var a=this.getServerParams();a&&this._updateArgs(a,b)}},_getArgs:function(){var f=m.getJson(this.args||"[]"),b=[];
if(f){var a=!1;f&&f[0]&&null!=f[0].optional&&(a=!0);if(a)for(a=0;a<f.length;a++){var d=f[a],c=d.value;-1!=d.name.indexOf("Base64")&&(c=this.getService().base64_encode(c));"notset"!==d.value?-1!=d.value.indexOf("[")&&-1!=d.value.indexOf("]")?(c=this.scope.expressionModel.replaceVariables(this.scope,d.value,!1,!1),-1!=d.name.indexOf("Base64")&&(c=this.getService().base64_encode(c)),b.push(c)):b.push(c||d["default"]):b.push(d["default"]||c)}}else return[this.args];return b},_updateArgs:function(f,b){var a=
this.utils.getCIWidgetByName(b,"args");if(a){var d=JSON.stringify(f);a.editBox.set("value",d);this.args=d}},getServerParams:function(){var f=this.getService().getParameterMap(this.getServiceClass(),this.getServiceMethod());if(f)for(var b=0;b<f.length;b++)f[b].value="notset";return f},solve:function(f,b,a,d,c,e){this._return=[];this._lastResult=null;this._lastSettings=b||this._lastSettings;b=this.getInstance();f=f.expressionModel.replaceVariables(f,this.method,!1,!1);b.runShell(f,m.mixin({},{}),this.id,
this.id,this)},toText:function(){var f=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(f+=this.method.substr(0,50));return f},canAdd:function(){return[]},getFields:function(){var f=this.inherited(arguments)||this.getDefaultFields(),b=this;f.push(m.createCI("value",25,this.method,{group:"General",title:"Cmd",dst:"method",delegate:{runExpression:function(a,d,c){b.method=a;b.solve(b.scope,null,d,c)}}}));return f},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(f){return null!=
this.items&&0<this.items.length},getChildren:function(f){return this.items},onChangeField:function(f,b,a){if("method"===f)this.onMethodChanged(b,a)},isInValidState:function(){return null!=this.getService()},getService:function(){var f=this.scope.getService();f||console.error("have no service object");return f},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(f){return this.isInValidState()&&
null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(f){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/code/RunBlock":function(){define(["dcl/dcl","xblox/model/Block","xide/types",
"xide/utils"],function(e,p,m,n){return e(p,{declaredClass:"xblox.model.code.RunBlock",name:"Run Block",file:"",method:"",args:"",sharable:!0,block:"",description:"Runs another Block",solve:function(f,b){var a=this.getContext();if(a&&null!=a[this.method]){var d=[],c=a[this.method];try{var e=this._getArgs(),d=c.apply(a,e||[]);this.onSuccess(this,b);return d}catch(m){console.error("call method failed"),this.onFailed(this,b)}}else this.onFailed(this,b);return[]},toText:function(){var f=this.getBlockIcon()+
" "+this.name+" ";this.method&&(f+=this.method.substr(0,20));return f},getFields:function(){var f=this.getDefaultFields();f.push(n.createCI("Block",m.ECIType.BLOCK_REFERENCE,this.block,{toolTip:"Enter  block, you can use also the block's share title",group:"General",dst:"block",value:this.block,title:"Block",scope:this.scope}));f.push(n.createCI("File",m.ECIType.FILE,this.file,{toolTip:"Leave empty to auto-select this file",group:"General",dst:"file",value:this.file,intermediateChanges:!1,acceptFolders:!1,
acceptFiles:!0,encodeFilePath:!1,buildFullPath:!0,filePickerOptions:{dialogTitle:"Select Block File",filePickerMixin:{beanContextName:this.id,persistent:!1,globalPanelMixin:{allowLayoutCookies:!1}},configMixin:{beanContextName:this.id,LAYOUT_PRESET:m.LAYOUT_PRESET.SINGLE,PANEL_OPTIONS:{ALLOW_MAIN_MENU:!1,ALLOW_NEW_TABS:!0,ALLOW_MULTI_TAB:!1,ALLOW_INFO_VIEW:!0,ALLOW_LOG_VIEW:!1,ALLOW_CONTEXT_MENU:!0,ALLOW_LAYOUT_SELECTOR:!0,ALLOW_SOURCE_SELECTOR:!0,ALLOW_COLUMN_RESIZE:!0,ALLOW_COLUMN_REORDER:!0,ALLOW_COLUMN_HIDE:!0,
ALLOW_ACTION_TOOLBAR:!0,ALLOW_BREADCRUMBS:!1}},defaultStoreOptions:{fields:1663,includeList:"xblox",excludeList:"*"},startPath:this.file}}));return f},getBlockIcon:function(){return'\x3cspan class\x3d"el-icon-share-alt"\x3e\x3c/span\x3e'}})})},"xblox/model/events/OnEvent":function(){define("dcl/dcl dojo/_base/lang dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xide/registry dojo/on xwire/_Base".split(" "),function(e,p,m,n,f,b,a,d,c,g,r){return e([n,
a.dcl,d.dcl,r],{declaredClass:"xblox.model.events.OnEvent",name:"On Event",event:"",reference:"",references:null,sharable:!0,_didSubscribe:!1,filterPath:"item.name",filterValue:"",valuePath:"item.value",_nativeEvents:"onclick ondblclick onmousedown onmouseup onmouseover onmousemove onmouseout onkeypress onkeydown onkeyup onfocus onblur onchange".split(" "),stop:function(){this._destroy()},solve:function(a,b,c,d){c&&this._destroy();b=this._lastSettings=b||this._lastSettings;if(!this._didSubscribe)return this._registerEvent(this.event),
this.onSuccess(this,b),!1;this.onSuccess(this,b);this._currentIndex=0;this._return=[];a=this[this._getContainer()];if(a.length)return a=this.runFrom(a,0,b),this.onSuccess(this,b),a;this.onSuccess(this,b);return[]},toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();this.deserialize(this.reference);var c=null;if(-1<f.contains(this._nativeEvents,
this.event))for(var c=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],
d=0;d<c.length;d++){var e=c[d];if(e.value===this.event){e.selected=!0;break}}else c=this.scope.getEventsAsOptions(this.event);a.push(f.createCI("Event",b.ECIType.ENUMERATION,this.event,{group:"General",options:c,dst:"event",widget:{search:!0}}));a.push(f.createCI("Filter Path",13,this.filterPath,{group:"General",dst:"filterPath"}));a.push(f.createCI("Filter Value",13,this.filterValue,{group:"General",dst:"filterValue"}));a.push(f.createCI("Value Path",13,this.valuePath,{group:"General",dst:"valuePath"}));
a.push(f.createCI("Object/Widget",b.ECIType.WIDGET_REFERENCE,this.reference,{group:"Widget",dst:"reference",value:this.reference}));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bell"\x3e\x3c/span\x3e'},onEvent:function(a){this._lastResult=a;if(this.filterPath&&this.filterValue){var b=this.getValue(a,this.filterPath);if(b&&this.filterValue!==b)return}b=null;this.valuePath&&(this._lastSettings||(this._lastSettings={}),b=this.getValue(a,this.valuePath),null!==b&&(!this._lastSettings.override&&
(this._lastSettings.override={}),this._lastSettings.override.args=[b]));this.solve(this.scope,this._lastSettings)},_subscribe:function(a,b,c){if(a)if(-1==f.contains(this._nativeEvents,a))this.__events&&this.__events[a]&&(c=this.__events[a],_.each(c,function(a){this.unsubscribe(a.type,a.handler);a.remove()},this),_.each(c,function(b){this.__events[a].remove(b)},this)),this.subscribe(a,this.onEvent);else if(c){b=a.replace("on","");var d=this;c=g(c,b,function(a){d.onEvent(a)});console.log("wire native event : "+
b);this._events.push(c)}},_registerEvent:function(a){try{if(!a||!a.length)return;console.log("register event : "+a+" for "+this.reference);var b=this.resolveReference(this.deserialize(this.reference)),d=this;if(b&&b.length){for(var f=0;f<b.length;f++){var e=b[f];if(e&&e.id){var g=c.byId(e.id);if(g&&g.on){var m=this.event.replace("on","");console.log("found widget : "+e.id+" will register event "+m);var n=g.on(m,p.hitch(this,function(a){console.log("event triggered : "+d.event);d.onEvent(a)}));this._events.push(n)}else this._subscribe(a,
this.onEvent,e)}else this._subscribe(a,this.onEvent,e)}console.log("objects found : ",b)}else this._subscribe(a,this.onEvent)}catch(r){logError(r,"registering event failed")}this._didSubscribe=a},onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},updateEventSelector:function(a,c){var d=[];if(a&&a.length)for(var d=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",
value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],e=0;e<d.length;e++){var f=d[e];if(f.value===this.event){f.selected=!0;break}}else d=this.scope.getEventsAsOptions(this.event);for(e=0;e<c.length;e++)if(f=
c[e],f.widget&&"Event"===f.widget.title){e=f._widget;e.nativeWidget.set("options",d);e.nativeWidget.reset();e.nativeWidget.set("value",this.event);this.publish(b.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this._destroy();this.reference=a;var c=this.resolveReference(this.deserialize(a));this.updateEventSelector(c,b);this._registerEvent(this.event)},onChangeField:function(a,b,c){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=b,this._registerEvent(b)));if("reference"==a)this.onReferenceChanged(b,
c);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){this._events||(this._events=[]);_.each(this._events,dojo.unsubscribe);this.unsubscribe(this.event,this.onEvent);this._lastResult=null;this._didSubscribe=!1}})})},"xblox/model/Referenced":function(){define(["dcl/dcl","dojo/_base/declare","xide/mixins/ReferenceMixin","xide/utils"],function(e,p,m,n){var f={reference:null,deserialize:function(b){if(!b||
0==b.length)return{};try{return n.fromJson(b)}catch(a){return{}}}};p=p("xblox.model.Referenced",[m],f);p.dcl=e(m.dcl,f);return p})},"xide/mixins/ReferenceMixin":function(){define(["dcl/dcl","dojo/_base/declare","xide/types","xide/utils","xide/registry"],function(e,p,m,n,f){function b(a,b){var e=a.document.getElementById(b);return e?e:null}n.find=function(a,b,e){return(a=$(b).find(a))&&0<a.length?!1===e?a:a[0]:null};var a={_targetReference:null,getTarget:function(){return this._targetReference||this.inherited(arguments)},
skipWidgetCSSClasses:"dijitButtonHover dijitHover dijit dijitInline dijitReset dijitCheckBoxChecked dijitChecked dijitLeft".split(" "),_cssClassesToQuery:function(a){var b="";if(a){a=a.split(" ");for(var e=0;e<a.length;e++)-1<n.contains(this.skipWidgetCSSClasses,a[e])||-1<a[e].toLowerCase().indexOf("hover")||(b+=""+a[e])}return b.trim()},resolveReference:function(a,c){var g=null;try{g=this.getTarget()}catch(p){return logError(p),null}var q=this.scope,h=a.reference;if(!(a&&h&&h.length)&&g)return[g];
switch(a.mode){case m.WIDGET_REFERENCE_MODE.BY_ID:if(this.scope&&this.scope.document){g=[];if(-1!==h.indexOf(" "))for(var h=h.split(" "),l=0;l<h.length;l++){var k=b(q,h[l]);k&&g.push(k)}else return[b(q,h)];return g}q=f.byId(h);g="undefined"!==typeof document?document.getElementById(h):null;if(q||g)return q?[q]:[g];break;case m.WIDGET_REFERENCE_MODE.BY_CLASS:if(q=dojo.getObject(h)||e.getObject(h))return[q];break;case m.WIDGET_REFERENCE_MODE.BY_CSS:q=this._cssClassesToQuery(h);this._parseString&&(q=
this._parseString(q,c,null,c&&c.flags?c.flags:m.CIFLAG.EXPRESSION)||q);g=null;this.scope&&this.scope.global&&this.scope.global.$?g=this.scope.global.$:"undefined"!==typeof $&&(g=$);if(g&&(g=g(q)))return g;if(q=n.find(q,null,!1))return q}return null}};p=p("xblox.model.ReferenceMixin",null,a);p.dcl=e(null,a);return p})},"xwire/_Base":function(){define(["dcl/dcl","xide/mixins/EventedMixin"],function(e,p){function m(e,b){for(var a=n(b),d=0,c=a.length;d<c;++d){var g=a[d];e=null==e?e:e[g]}return e}function n(e,
b){return""===e?[]:"function"!==typeof e.splice?e.split("."):b?e.slice():e}return e([p.dcl],{declaredClass:"xwire._Base",constructor:function(e){for(var b in e)e.hasOwnProperty(b)&&(this[b]=e[b])},getValue:function(e,b){return m(e,b)},setValue:function(e,b,a){var d=n(b,!0),c=d.pop();e=0<d.length?m(e,d):e;return Object(e)===e&&b?"function"===typeof e.set?e.set(c,a):e[c]=a:void 0}})})},"xblox/model/events/OnKey":function(){define("dcl/dcl dojo/_base/lang dojo/_base/array dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xblox/model/Contains xblox/model/events/OnEvent xide/registry dojo/on".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r,q,h){return e([f,d.dcl,c.dcl,g],{declaredClass:"xblox.model.events.OnKey",name:"On Key",event:"",reference:"",references:null,description:"Triggers when a keyboard sequence "+this.event+" has been entered",listeners:null,sharable:!0,toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var c=this.inherited(arguments)||this.getDefaultFields();c.push(b.createCI("Keyboard Sequence",
a.ECIType.STRING,this.event,{group:"General",dst:"event",value:this.event,intermediateChanges:!1}));c.push(b.createCI("Object/Widget",a.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",value:this.reference}));return c},getBlockIcon:function(){return'\x3cspan class\x3d"fa-keyboard-o"\x3e\x3c/span\x3e'},onEvent:function(a){this._lastResult=a;this.solve(this.scope,this._lastRunSettings)},_addListerner:function(a,b,c){null==this.listeners&&(this.listeners=[]);var d=null,d=new window.keypress.Listener(c,
{is_unordered:!0,prevent_repeat:!1,prevent_default:!1,on_keyup:function(a){console.log("up")},on_keydown:function(a){console.log("down")},on_release:function(a){console.log("release")}});d.simple_combo(a,function(a){b&&b(arguments)});this.listeners.push(d)},_subscribe:function(a,b,c){a&&(c&&c.domNode&&(c=c.domNode),this._addListerner(a,b,c))},_registerEvent:function(a){if(a&&a.length){var b=this.resolveReference(this.deserialize(this.reference)),c=this;if(b&&b.length)for(var d=0;d<b.length;d++){var e=
b[d];if(e&&e.id){var f=q.byId(e.id);f=null,this._subscribe(a,function(){c.onEvent(arguments)},e)}else this._subscribe(a,function(){c.onEvent(arguments)},e)}else this._subscribe(a,function(){c.onEvent(arguments)})}},onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},destroy:function(){this.inherited(arguments)},updateEventSelector:function(b,c){var d=[];if(b&&b.length)for(var d=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},
{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],e=0;e<d.length;e++){var f=d[e];if(f.value===this.event){f.selected=!0;break}}else d=
this.scope.getEventsAsOptions(this.event);for(e=0;e<c.length;e++)if(f=c[e],f.widget&&"Event"===f.widget.title){e=f._widget;e.nativeWidget.set("options",d);e.nativeWidget.reset();e.nativeWidget.set("value",this.event);this.publish(a.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this._destroy();this.reference=a;this.resolveReference(this.deserialize(a));this._registerEvent(this.event)},onChangeField:function(a,b,c){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=b,this._registerEvent(b)));
if("reference"==a)this.onReferenceChanged(b,c);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){if(this.listeners)for(var a=0;a<this.listeners.length;a++){var b=this.listeners[a];b.stop_listening();var c=b.get_registered_combos();c&&b.unregister_many(c);b.reset();console.log("did destroy listener")}this.listeners=[]},onFieldsRendered:function(a,b){}})})},"xblox/model/mqtt/Subscribe":function(){define("dcl/dcl xdojo/has xblox/model/Block xide/utils xblox/model/Contains xide/types".split(" "),
function(e,p,m,n,f,b,a,d){p="undefined"!==typeof window?window.console:global.console;a&&p&&p.error&&(p=d);return e([m,f],{declaredClass:"xblox.model.mqtt.Subscribe",name:"Subscribe",topic:"Topic",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-bell",path:"",qos:0,stop:function(){var a=this.getInstance();a&&a.callMethod("unSubscribeTopic",n.mixin({topic:this.topic},n.getJson(this.args||{})),this.id,this.id)},onData:function(a){if(a&&a.topic&&a.topic==this.topic){delete a.src;delete a.id;var b=
this[this._getContainer()],d=this._lastSettings,e=[];if(0<b.length){var b=a,f=this.path&&this.path.length?this.path:null!==a.payload?"payload":null;f&&_.isObject(a)&&(b=n.getAt(a,f,a));for(a=0;a<this.items.length;a++)f=this.items[a],f.enabled&&(f.override={args:[b]},e.push(f.solve(this.scope,d)))}this.onSuccess(this,this._lastSettings);return e}},observed:["topic"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve:function(a,b){this._currentIndex=
0;this._return=[];this._lastSettings=b;var d=this.getInstance();d&&d.callMethod("subscribeTopic",n.mixin({topic:this.topic,qos:this.qos},n.getJson(this.args||"{}")),this.id,this.id);b=b||{};this.onRunThis(b)},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+""+this.makeEditable("topic","bottom","text","Enter a topic","inline")+" :: \x3c/span\x3e";this.topic&&(a+=this.topic.substr(0,30));return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||
this.getDefaultFields();a.push(n.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));a.push(n.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(n.createCI("topic",b.ECIType.STRING,this.topic,{group:"General",title:"Topic",dst:"topic",select:!0}));a.push(n.createCI("name",b.ECIType.ENUMERATION,this.qos,{group:"General",title:"QOS",dst:"qos",widget:{options:[{label:"0 - at most once",value:0},{label:"1 - at least once",value:1},{label:"2 - exactly once",
value:2}]}}));a.push(n.createCI("path",b.ECIType.STRING,this.path,{group:"General",title:"Value Path",dst:"path"}));return a}})})},"xblox/model/mqtt/Publish":function(){define(["dcl/dcl","xdojo/has","xide/utils","xide/types","xcf/model/Command"],function(e,p,m,n,f,b,a){p="undefined"!==typeof window?window.console:global.console;b&&p&&p.error&&(p=a);return e(f,{declaredClass:"xblox.model.mqtt.Publish",name:"Publish",topic:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-send",isCommand:!0,
qos:0,retain:!1,path:null,onData:function(a){if(a&&a.topic&&a.topic==this.topic){this.getContext();var b=this[this._getContainer()],e=this._lastSettings,f=[];if(0<b.length)for(b=a,(this.path="value",_.isObject(a))&&(b=m.getAt(a,this.path,a)),a=0;a<this.items.length;a++){var n=this.items[a];n.enabled&&(n.override={args:[b]},f.push(n.solve(this.scope,e)))}this.onSuccess(this,this._lastSettings);return f}},observed:["topic"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():
this)},solve:function(a,b,e){this._currentIndex=0;this._return=[];b=this._lastSettings=b||this._lastSettings;var f=this.getInstance();1==e&&this._loop&&this.reset();e=this.args;var n=this.getArgs(b);n[0]&&(e=n[0]);f&&(e=m.getJson(e,!0,!1),null!==e&&0!==e&&!0!==e&&!1!==e&&_.isObject(e)||(e={payload:this.args}),a=a.expressionModel.replaceVariables(a,this.topic,!1,!1),f.callMethod("publishTopic",m.mixin({topic:a,qos:this.qos,retain:this.retain},e),this.id,this.id));b=b||{};this.onDidRun();this.onSuccess(this,
b);return!0},toText:function(a){a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.makeEditable("name","top","text","Enter a name","inline")+" :: \x3c/span\x3e";this.topic&&(a+=this.makeEditable("topic","bottom","text","Enter a topic","inline"),this.startup&&(a+=this.getIcon("fa-bell inline-icon text-warning","text-align:right;float:right;","")),0<this.interval&&(a+=this.getIcon("fa-clock-o inline-icon text-warning","text-align:right;float:right","")));return a},canAdd:function(){return[]},
getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();a.push(m.createCI("qos",n.ECIType.ENUMERATION,this.qos,{group:"General",title:"QOS",dst:"qos",widget:{options:[{label:"0 - at most once",value:0},{label:"1 - at least once",value:1},{label:"2 - exactly once",value:2}]}}));a.push(m.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(m.createCI("topic",n.ECIType.STRING,this.topic,{group:"General",title:"Topic",dst:"topic",select:!0}));
a.push(m.createCI("retain",n.ECIType.BOOL,this.retain,{group:"General",title:"Retain",dst:"retain"}));a.remove(_.find(a,{name:"send"}));a.remove(_.find(a,{name:"waitForResponse"}));return a}})})},"xblox/model/File/ReadJSON":function(){define("dcl/dcl dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains xide/types xdojo/has!xblox-ui?xfile/data/DriverStore xdojo/has!xblox-ui?xfile/views/FileGridLight".split(" "),function(e,p,m,n,f,b,a,d){function c(b,c,d){return new a({data:[],config:{},
mount:"none",options:c,driver:d,micromatch:"(*.json)|!(*.*)",glob:b})}return e([m,f],{declaredClass:"xblox.model.File.ReadJSON",name:"Read JSON",deferred:!1,sharable:!1,context:null,icon:"fa-file",observed:["path"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},getFileContent:function(a){return this.getScope().ctx.getDeviceManager().getInstanceByName("File-Server").callCommand("GetProg",{override:{args:[a]}})},processJSON:function(a,c){var d=this.jsonPath;
this._lastResult=d?n.getAt(a,d):a;this.onSuccess(this,c);this.runByType(b.BLOCK_OUTLET.FINISH,c)},solve:function(a,b,c,d,e){this._currentIndex=0;this._return=[];b=this._lastSettings=b||this._lastSettings||{};c=""+this._get("path");var f=new p,m=this;this.onRunThis(b);a=a.expressionModel.replaceVariables(a,c,null,null);this.getFileContent(a).then(function(a){(a=a.content)&&(a=n.getJson(a,!0))&&m.processJSON(a,b)}.bind(this));try{d&&d("Expression "+c+" evaluates to "+a)}catch(w){this.onDidRunItemError(f,
w,b),this.onFailed(this,b),e&&e("invalid expression : \n"+c+": "+w)}return f},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.name+" :: \x3c/span\x3e";this.path&&(a+=this.path.substr(0,50));return a},canAdd:function(){return[]},getFields:function(){var e=this.inherited(arguments)||this.getDefaultFields(),f=this.getScope().ctx,m=f.getDeviceManager().getInstanceByName("File-Server"),h=n.clone(b.DEFAULT_FILE_GRID_PERMISSIONS);m&&a&&(f={ctx:f,owner:this,selection:"/",resizeToParent:!0,
Module:d,permissions:h},h={fields:b.FIELDS.SHOW_ISDIR|b.FIELDS.SHOW_OWNER|b.FIELDS.SHOW_SIZE|b.FIELDS.SHOW_FOLDER_SIZE|b.FIELDS.SHOW_MIME|b.FIELDS.SHOW_PERMISSIONS|b.FIELDS.SHOW_TIME|b.FIELDS.SHOW_MEDIA_INFO},f.leftStore=c("/*",h,m),f.rightStore=c("/*",h,m),e.push(n.createCI("path",4,this.path,{group:"General",title:"Path",dst:"path",filePickerOptions:f,widget:{item:this}})));e.push(n.createCI("jsonPath",13,this.jsonPath,{group:"General",title:"Select",dst:"jsonPath"}));return e}})})},"xcf/factory/Blocks":function(){define("xblox/factory/Blocks xcf/model/Command xblox/model/functions/CallBlock xblox/model/functions/StopBlock xblox/model/functions/PauseBlock xide/factory".split(" "),
function(e,p,m,n,f,b){return e?(e._getCommandBlocks=function(a,b,c,e){var r=[];r.push({name:"Commands",iconClass:"el-icon-random",items:[{name:"Call Command",owner:b,iconClass:"el-icon-video",proto:m,target:c,ctrArgs:{scope:a,group:e,condition:""}},{name:"Stop Command",owner:b,iconClass:"el-icon-video",proto:n,target:c,ctrArgs:{scope:a,group:e,condition:""}},{name:"Pause Command",owner:b,iconClass:"el-icon-video",proto:f,target:c,ctrArgs:{scope:a,group:e,condition:""}},{name:"New Command",owner:b,
iconClass:"el-icon-video",proto:p,target:c,ctrArgs:{scope:a,group:e,condition:"",name:"No-Title"}}]});return r},e):b})},"nxapp/manager/TestManager":function(){define("dcl/dcl dojo/node!fs xcf/manager/DeviceManager xide/utils xide/types nxapp/utils/_console nxapp/utils dojo/node!child_process nxapp/manager/ManagerBase require xide/mixins/ReloadMixin dojo/node!path xdojo/has".split(" "),function(e,p,m,n,f,b,a,d,c,g,r,q,h){function l(){k.clear();g(["intern/lib/executors/PreExecutorEmbedded","intern/lib/reporters/Console"],
function(a,b){var c=new a({executorId:"client",config:n.mixin(t,{suites:["tests/devices/all"]}),defaultLoaderOptions:dojoConfig});try{k.error("run tests"),c.run(function(a){k.error("did tests ",a)}),g.undef("tests/devices/all")}catch(d){k.error("error running tests ",d)}})}var k=b,t={proxyPort:9E3,proxyUrl:"http://localhost:9000/",tunnel:"NullTunnel",capabilities:{name:"dojo-loader",project:"Dojo 2",fixSessionCapabilities:!1},environments:[{browserName:"internet explorer",version:["9.0","10.0","11.0"],
platform:"Windows 7"},{browserName:"firefox",platform:"Windows 10"},{browserName:"chrome",platform:"Windows 10"},{browserName:"safari",version:"9",platform:"OS X 10.11"},{browserName:"android",platform:"Linux",version:"4.4",deviceName:"Google Nexus 7 HD Emulator"}],maxConcurrency:2,loaderOptions:{packages:[{name:"dojo",location:"./node_modules/dojo"},{name:"dijit",location:"dijit"},{name:"dgrid",location:"dgrid"},{name:"dstore",location:"dstore"},{name:"xide",location:"xide"},{name:"xfile",location:"xfile"},
{name:"dojox",location:"dojox"},{name:"xdojo",location:"xdojo"},{name:"xgrid",location:"xgrid"},{name:"xblox",location:"xblox"},{name:"xdocker",location:"xdocker"},{name:"wcDocker",location:"wcDocker/src"},{name:"dcl",location:"./node_modules/dcl"},{name:"tests",location:"tests"}]},excludeInstrumentation:/(?:node_modules|bower_components|tests)[\/\\]/,suites:["tests/all"],functionalSuites:[],reporters:[{id:"tests/ConsoleEmbedded",delegate:{onStart:function(a){k.error("on start "+a.name)},onFail:function(a){k.error("on fail "+
a.name)},onEnd:function(a){k.error("on start "+a.name)}}},{id:"JUnit",filename:"report.xml"}]};(p=global.sctx)&&p.getTestManager();return e([c,r.dcl],{declaredClass:"nxapp.manager.TestManager",connection:null,test1:function(){return"   ha"},loadFixtures:function(){q.resolve("./tests/")},onReloaded:function(){k.error("on reloaded")},doTests:function(){},init:function(){this.subscribe(f.EVENTS.ON_MODULE_RELOADED,function(a){-1!==a.module.indexOf("tests/devices")&&a.module.indexOf(".js")&&(g.undef("tests/devices/Minimal"),
l())})}})})},"nxappmain/main_export":function(){require("dojo/node!path dojo/node!fs dojo/node!util nxapp/Commons nxapp/Logger nxapp/utils/_console xide/utils nxappmain/nxAppExport nxapp/manager/ExportManager nxapp/model/ExportOptions xide/types require".split(" "),function(e,p,m,n,f,b,a,d,c,g,r,q){e=new d({commander:null});e.init();e=e.profile;b.log("export "+e.user+" and system data:  "+e.system);new g(e);(new c).initWithOptions(e)})},"nxapp/Logger":function(){define(["dcl/dcl","xide/types","xide/factory",
"dojo/node!winston","nxapp/utils/_console"],function(e,p,m,n,f){return e(null,{declaredClass:"nxapp.Logger",fileLogger:null,loggly:null,delegate:null,publishLog:!1,loggers:{},constructor:function(b){for(var a in arguments)arguments.hasOwnProperty(a)&&(this[a]=b[a])},createLogger:function(b){var a=new n.Logger({transports:[new n.transports.File(b)]});if(this.publishLog)a.on("logging",function(a,c,e,f){f.logId=b.filename;a={level:c,message:e,data:f,time:(new Date).getTime()};m.publish(p.EVENTS.ON_SERVER_LOG_MESSAGE,
a)});return a},log:function(){return this.logger.log.apply(this.logger,arguments)},verbose:function(){return this.logger.verbose.apply(this.logger,arguments)},info:function(){return this.logger.info.apply(this.logger,arguments)},start:function(b){this.loggers={};this.options=b;this.logger=new n.Logger({transports:[new n.transports.Console({level:"debug"})]});this.logger.transports.console.level="debug";this.logger.on("logging",function(a,b,c,e){})}})})},"nxappmain/nxAppExport":function(){define("dcl/dcl nxapp/utils/FileUtils dojo/node!commander dojo/node!fs dojo/node!os dojo/node!path xide/factory/Events dojo/has xide/model/Base xide/utils nxappmain/nxAppBase".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r){d.add("windows",function(){return"win32"===f.platform()});d.add("osx",function(){return"darwin"===f.platform()});d.add("linux",function(){return"linux"===f.platform()});d.add("arm",function(){return"arm"===f.arch()});return e(r,{declaredClass:"nxappmain.nxAppExport",profilePath:"/nxappmain/profile_device_server.json",init:function(){this.commander||(m.version("0.0.1").option("-f, --file \x3cpath\x3e","run a file").option("-r, --root \x3cpath\x3e","root path to Control-Freak").option("-u, --user \x3cpath\x3e",
"user directory").option("-t, --target \x3cpath\x3e","target directory").option("-s, --system \x3cname\x3e","path to system scope location").option("-d, --dist \x3cpath\x3e","path to the pre-compiled NodeJS servers").option("--windows \x3cboolean\x3e","true/false to export windows NodeJS server").option("--osx \x3cboolean\x3e","true/false to export OSX NodeJS server").option("--linux32 \x3cboolean\x3e","true/false to export Linux-32 Bit NodeJS server").option("--linux64 \x3cboolean\x3e","true/false to export Linux-64 NodeJS server").option("--arm \x3cboolean\x3e",
"true/false to export ARM-v7 NodeJS server").option("--client \x3cstring\x3e","path to client root"),this.commander=m,this.commander.allowUnknownOption(!0),this.commander.parse(process.argv));if(m.jhelp){var a=[];m.options.map(function(b){a.push(b)});console.log(JSON.stringify(a));process.exit()}this.profile=this.getProfile(this.profilePath);m.root||(this.profile.root=p.resolve("../.."));m.target||(this.profile.target=p.resolve("../../myapp"));g.mixin(this.profile,this.commander);var c=b.resolve(this.profile.system);
n.existsSync(c)?this.profile.system=c:(c=process.cwd()+"/data/system",this.profile.system=c,m.system=c)}})})},"nxapp/model/ExportOptions":function(){define(["dcl/dcl","xide/model/Base","xide/mixins/EventedMixin","xide/encoding/MD5","xide/utils"],function(e,p,m,n,f){return e([p.dcl,m.dcl],{connected:!1,__registered:!1,declaredClass:"nxapp/model/ExportOptions",toString:function(){var b=this.options;return b.deviceScope+"://"+b.host+":"+b.port+"@"+b.protocol},constructor:function(b){this.options=b}})})},
"nxappmain/main_server":function(){require("dojo/node!readline nxapp/Commons xide/types nxapp/utils/TCPUtils nxappmain/nxAppBase nxapp/manager/DeviceServerContext nxapp/client/WebSocket xlog/Server dojo/node!winston dojo/node!path dojo/node!fs dojo/node!util dojo/node!vm nxapp/manager/MQTTManager nxapp/Commons nxapp/utils/FileUtils nxapp/Logger nxapp/utils/_console require dojo/node!tcp-port-used dojo/Deferred".split(" "),function(e,p,m,n,f,b,a,d,c,g,r,q,h,l,k,t,w,u,z,v,x){global.dojoRequire=z;global._=
_;p={filename:"all.log",dirname:dojoConfig.logRoot,json:!0};var D=new d({});D.start({fileLogger:p,console:null});var A=new f({commander:null});f=new x;var J,H,G;A.init();var y=A.profile;d=A.commander;if(d.diagnose){console.error("run diagnose");console.log("loaded modules: ",null!==global.nRequire.cache);for(var C in global.nRequire.cache)console.log(C)}else{if(d.modules){h=["/nxappmain/server","/nxappmain/dojoConfig","/dojo/dojo","/dojo/_base/configNode"];t="";b=0;for(C in global.nRequire.cache)r=
C.replace(process.cwd(),"").replace(g.sep+"node_modules"+g.sep,"").replace(".js",""),-1===h.indexOf(r)&&(t+="var a_"+b+' \x3d require("'+r+'");\n',b++);console.log(t);return t}if(d.file){g=g.resolve(d.file);if(r.existsSync(g)){C=new h.createContext({require:z.nodeRequire,commander:d,console:console,process:process,setTimeout:setTimeout,global:global});g=t.readFile(g);(new h.Script(g)).runInContext(C);return}console.error("file specified but doesnt exists "+d.file)}d.port&&(y.socket_server.port=d.port);
d.host&&(y.socket_server.host=d.host);if(A.commander.info)console.log(JSON.stringify({host:"http://"+A.profile.socket_server.host,port:A.profile.socket_server.port})),process.exit();else{var F=null;try{F=new b,F.profile=y}catch(B){console.error("error launching ",B)}try{F.constructManagers();F.initManagers(y);F.logManager=D;var I=new l({ctx:F,profile:y});I.init(y);F.connectionManager.mqttManager=I;F.mqttManager=I}catch(E){console.error("launching",E)}var K=null,N=function(){var b=new a;b.init({options:{host:"http://"+
A.profile.socket_server.host,port:A.profile.socket_server.port,debug:A.profile.debug}});b.connect();b.onSignal(m.SIGNAL_RESPONSE,function(a){y.common.stdout&&process.stdout.write(a+"\n");A.commander.oneshot&&A.commander.command&&process.exit()});return b},L=function(){A.commander.host&&(J=A.commander.host);A.commander.port&&(H=parseInt(A.commander.port));A.commander.protocol&&(G=A.commander.protocol);if(A.commander.driver){console.error("run in driver mode");var a=N(),b={driver:"xcf/driver/SubTest",
host:"192.168.1.20",port:23,protocol:"tcp"},c=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER;b.manager_command=m.SOCKET_SERVER_COMMANDS.START_DRIVER;c=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER;a.emit(c,b)}else if(A.commander.send){console.error("sending command");console.error("  create web socket client to control server : http://"+A.profile.socket_server.host+":"+A.profile.socket_server.port);var a=N(),d=function(b){if(null!==a&&null!=b){var c={command:b,host:J,port:H,protocol:G},d=m.SOCKET_SERVER_COMMANDS.SIGNAL_DEVICE;
"startDriver"==b?(c.manager_command=m.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,d=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):"status"==b?(c.manager_command=m.SOCKET_SERVER_COMMANDS.MANAGER_STATUS,d=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):"closeall"==b?(c.manager_command=m.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL,d=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):c.device_command=m.SOCKET_SERVER_COMMANDS.DEVICE_SEND;a.emit(d,c)}},b=function(b){if(null!==a&&null!=b)if(b.indexOf&&-1!=b.indexOf(";")){b=b.split(";");
for(var c=0;c<b.length;c++)d(b[c])}else d(b)};e.createInterface({input:process.stdin,output:process.stdout}).on("line",function(a){null!=a&&0<a.length&&(console.log("sending stdin : "+a),d(a))});"string"==typeof A.commander.command&&b(A.commander.command);console.error("Send command. ^C to close connection and quit")}};if(y.common.createSocketServer){var M=function(){console.log("start device server at "+y.socket_server.port);K=n.createDeviceServer(y,F);F.deviceServer=K;F.logger=c;F.deviceServer.logger=
c;F.logManager=D};v.check(y.socket_server.port,y.socket_server.host).then(function(a){if(a)console.log("device server already started"),N();else{M();try{L()}catch(b){console.error("error main",b)}}},function(a){M();try{L()}catch(b){console.error("error main",b)}})}else try{L()}catch(P){console.error("app crash!")}return f}}})},"nxapp/manager/MQTTManager":function(){define("dcl/dcl nxapp/manager/ManagerBase nxapp/utils/_LogMixin nxapp/types/Types dojo/node!mosca dojo/node!mqtt dojo/node!node-notifier dojo/node!colors xide/utils nxapp/utils/_console dojo/node!tcp-port-used".split(" "),
function(e,p,m,n,f,b,a,d,c,g,r){return e([p,m],{declaredClass:"nxapp.manager.MQTTManager",options:null,profile:null,lastUpTime:null,mqttClients:null,destroy:function(){this.server&&this.server.close&&this.server.close()},publishTopic:function(a,b){var c={topic:a,payload:JSON.stringify(b),qos:1};this.server.publish(c,function(){})},createMQTTClient2:function(a,c,d){var e=a+":"+c,f=b.connect("mqtt://localhost",{clean:!1,clientId:e}),m=this.ctx;g.log("create mqtt - client for "+e);f.on("connect",function(){g.log("on connected local mqtt client for "+
e)});f.on("message",function(b,e){m.getDeviceServer().broadCastMessage(n.EVENTS.ON_MQTT_MESSAGE,{host:a,port:c,topic:b,message:e.toString(),mqtt:d})});return f},createMQTTClient:function(a,c,d){a=a+":"+c;if(this.mqttClients[a])return this.mqttClients[a];if(!this.mqttClients[a])return c=b.connect("mqtt://localhost",{clean:!1,clientId:a}),c.on("connect",function(){}),this.mqttClients[a]=c},onConnectedToDevice:function(a,b,c){},onWakeup:function(){this.lastUpTime=(new Date).getTime();for(var a=0;a<this.pool.length;a++){var b=
this.pool[a];b.socket&&b.socket.close&&b.socket.close();b.socket&&b.socket._socket&&b.socket._socket.close&&b.socket._socket.close()}this.pool=[]},init:function(b){function e(){if(!l.__started){l.__started=!0;try{a.notify({title:"Control-Freak",message:"All servers up and running, you can start now Control-Freak IDE",sound:!0,wait:!0,open:"file:///"},function(a,b){})}catch(b){}g.log(d.green("\n\r\t Device server up and running\n\r \t ***********   You can start Control Freak now  **************\n\r"));
l.ctx.onReady()}}this.profile=b;this.lastUpTime=(new Date).getTime();var l=this;this.mqttClients={};c.mixin({type:"mongo",url:"mongodb://localhost:27017/mqtt",pubsubCollection:"xcf",mongo:{}},this.profile.ascoltatore);var k={port:1883,persistence:{factory:f.persistence.Memory}};this.profile.mosca.port&&(this.profile.mosca.port=parseInt(this.profile.mosca.port));c.mixin(k,this.profile.mosca);if("false"===this.profile.mqtt)g.warn("MQTT is disabled, proceed without"),this.server={},e();else try{var m=
function(){var a=new f.Server(k);a.on("error",function(a){g.error("Unable to connect to Mongo:"+a.message);e()});a.on("ready",e);a.on("clientConnected",function(){});a.on("clientDisconnected",function(){});l.server=a};r.check(b.socket_server.port,b.socket_server.host).then(function(a){a||m()},function(){m()})}catch(n){g.error("error starting mosca ",n)}},onTimeout:function(a){},onClose:function(a){this.removeConnection(a)},onDrain:function(a){},onError:function(a,b){},onData:function(a,b){throw Error();
},onConnect:function(a,b,c,d){g.log("Connected to "+a+":"+b+" via "+c,"protocol_messages");a={device:{host:a,port:b,protocol:c,deviceScope:d}};this.ctx.getDeviceServer().broadCastMessage(n.EVENTS.ON_DEVICE_CONNECTED,a)},onHandle:function(a,b){this.showDebugMsg("protocol_messages")}})})}}});define("nxappmain/serverbuild",[],1);
//# sourceMappingURL=serverbuild.js.map